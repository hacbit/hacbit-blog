<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>hacbit&#39;s blog</title>
    <link>https://blog.hacbit.net/</link>
    
    <atom:link href="https://blog.hacbit.net/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description>The world open itself before those with noble heart.</description>
    <pubDate>Sun, 09 Nov 2025 09:22:54 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>UE5é¡¹ç›®é…ç½®VSCodeå’ŒClangç¯å¢ƒ</title>
      <link>https://blog.hacbit.net/UE5%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEVSCode%E5%92%8CClang%E7%8E%AF%E5%A2%83/</link>
      <guid>https://blog.hacbit.net/UE5%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEVSCode%E5%92%8CClang%E7%8E%AF%E5%A2%83/</guid>
      <pubDate>Sun, 09 Nov 2025 07:20:07 GMT</pubDate>
      
      <description>&lt;blockquote&gt;
&lt;p&gt;æˆ‘æœ¬åœ°ç”¨çš„æ˜¯  UE 5.6.1 ç‰ˆæœ¬ï¼Œå…¶ä»–ç‰ˆæœ¬ä»…ä¾›å‚è€ƒ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;èµ·å› &quot;&gt;&lt;a href=&quot;#èµ·å› &quot; class=&quot;headerlink&quot; title=&quot;èµ·å› &quot;&gt;&lt;/a&gt;èµ·å› &lt;/h2&gt;&lt;p&gt;UE å®˜æ–¹æ–‡æ¡£é‡Œé¢æœ‰å…³äºé…ç½® VSCode çš„æ•™ç¨‹ï¼Œä¸è¿‡æ˜¯åŸºäº MSVC çš„ã€‚ğŸ‘‰&lt;a href=&quot;https://dev.epicgames.com/documentation/zh-cn/unreal-engine/setting-up-visual-studio-code-for-unreal-engine&quot;&gt;UEå®˜æ–¹é…ç½®VSCodeæ•™ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æŒ‰ç…§å®˜æ–¹æ•™ç¨‹çš„åšæ³•ï¼Œåœ¨ VSCode ä¸­éœ€è¦å¯ç”¨ C&amp;#x2F;C++ æ’ä»¶çš„ Intelli Sense åŠŸèƒ½ï¼Œæ‰€ä»¥å…ˆæŠŠæˆ‘æœ¬åœ°çš„ clangd æ’ä»¶ç¦ç”¨äº†ï¼ˆå’Œ C&amp;#x2F;C++ æ’ä»¶çš„ intelli sense å†²çªï¼‰ï¼Œå¼€å¯è¿™ä¸ªè¯•äº†è¯•ï¼Œç»“æœéå¸¸çš„å¡ï¼Œå¯¹äºå®çš„æç¤ºç®€ç›´ä¸€å¨ï¼Œè§£æé€Ÿåº¦ä¹Ÿå¾ˆæ…¢ï¼Œæ•´ä½“çš„å¼€å‘ä½“éªŒéå¸¸å·®ï¼Œäºæ˜¯å¼€å§‹ç ”ç©¶èƒ½ä¸èƒ½åˆ‡æ¢åˆ° clangd æ¥è¯» UE5 é¡¹ç›®&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>æˆ‘æœ¬åœ°ç”¨çš„æ˜¯  UE 5.6.1 ç‰ˆæœ¬ï¼Œå…¶ä»–ç‰ˆæœ¬ä»…ä¾›å‚è€ƒ</p></blockquote><h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p>UE å®˜æ–¹æ–‡æ¡£é‡Œé¢æœ‰å…³äºé…ç½® VSCode çš„æ•™ç¨‹ï¼Œä¸è¿‡æ˜¯åŸºäº MSVC çš„ã€‚ğŸ‘‰<a href="https://dev.epicgames.com/documentation/zh-cn/unreal-engine/setting-up-visual-studio-code-for-unreal-engine">UEå®˜æ–¹é…ç½®VSCodeæ•™ç¨‹</a></p><p>æŒ‰ç…§å®˜æ–¹æ•™ç¨‹çš„åšæ³•ï¼Œåœ¨ VSCode ä¸­éœ€è¦å¯ç”¨ C&#x2F;C++ æ’ä»¶çš„ Intelli Sense åŠŸèƒ½ï¼Œæ‰€ä»¥å…ˆæŠŠæˆ‘æœ¬åœ°çš„ clangd æ’ä»¶ç¦ç”¨äº†ï¼ˆå’Œ C&#x2F;C++ æ’ä»¶çš„ intelli sense å†²çªï¼‰ï¼Œå¼€å¯è¿™ä¸ªè¯•äº†è¯•ï¼Œç»“æœéå¸¸çš„å¡ï¼Œå¯¹äºå®çš„æç¤ºç®€ç›´ä¸€å¨ï¼Œè§£æé€Ÿåº¦ä¹Ÿå¾ˆæ…¢ï¼Œæ•´ä½“çš„å¼€å‘ä½“éªŒéå¸¸å·®ï¼Œäºæ˜¯å¼€å§‹ç ”ç©¶èƒ½ä¸èƒ½åˆ‡æ¢åˆ° clangd æ¥è¯» UE5 é¡¹ç›®</p><span id="more"></span><h2 id="é…ç½®-Clangd"><a href="#é…ç½®-Clangd" class="headerlink" title="é…ç½® Clangd"></a>é…ç½® Clangd</h2><p>å…ˆæŠŠ C&#x2F;C++ æ’ä»¶çš„æ™ºèƒ½æ„ŸçŸ¥ç¦ç”¨äº†ï¼Œç„¶åä¸‹è½½ clangd æ’ä»¶</p><p><img src="/UE5%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEVSCode%E5%92%8CClang%E7%8E%AF%E5%A2%83/c_cpp-intellisense.png" alt="c_cpp-intellisense"></p><p>ä½¿ç”¨ clangd å¼€å‘éå¸¸çœ‹é…ç½®ï¼Œé…ç½®çš„å¥½åç›´æ¥å½±å“å¼€å‘ä½“éªŒã€‚è€Œé€šå¸¸éœ€è¦æä¾›ä¸€ä¸ªå«åš compile_commands.json çš„é…ç½®æ–‡ä»¶ï¼ˆä¸€èˆ¬ä¹Ÿè¢«ç§°ä¸º Clang Databaseï¼‰</p><p>ç„¶åå¯ä»¥å‘ç°å®˜æ–¹æä¾›äº†ç”Ÿæˆè¿™ä¸œè¥¿çš„å·¥å…·ï¼š</p><p><img src="/UE5%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEVSCode%E5%92%8CClang%E7%8E%AF%E5%A2%83/buildbat-help.png" alt="buildbat-help"></p><p>æ‰¾åˆ°å¼•æ“ç›®å½•ä¸‹ &#x2F;Engine&#x2F;Build&#x2F;BatchFiles&#x2F;Build.bat  è¿™ä¸ªè„šæœ¬ä¼šè°ƒç”¨å†…éƒ¨çš„ UBT å·¥å…·ï¼ˆUnrealBuildToolï¼‰ï¼Œç„¶åé‡Œé¢æœ‰ä¸“é—¨çš„é€‰é¡¹å¯ä»¥ç”Ÿæˆ clang database</p><p>æ‰€ä»¥å¯ä»¥è¿è¡Œä¸€ä¸‹ä¸‹é¢è¿™ä¸ªå‘½ä»¤ï¼š</p><blockquote><p>æˆ‘æ˜¯åœ¨ UE5 é¡¹ç›®çš„æ ¹ç›®å½•è¿è¡Œçš„ï¼Œå‡è®¾é¡¹ç›®åæ˜¯ <strong>Test</strong>ï¼Œä¸‹é¢æ¶‰åŠçš„ç›¸å…³è·¯å¾„è§†æƒ…å†µè°ƒæ•´</p></blockquote><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\..\..\UE_5.<span class="number">6</span>\Engine\Build\BatchFiles\Build.bat TestEditor Win64 Development -Project=&quot;D:/Epic Games/Unreal_Projs/Test/Test.uproject&quot; -<span class="built_in">mode</span>=GenerateClangDatabase </span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥çœ‹åˆ°åœ¨ UE_5.6&#x2F; ä¸‹é¢ç”Ÿæˆäº†ä¸€ä¸ª compile_commands.json æ–‡ä»¶ï¼Œå†ç§»åŠ¨åˆ°æˆ‘ä»¬é¡¹ç›®ä¸­çš„ .vscode&#x2F; ä¸‹é¢å³å¯</p><h3 id="ä¸€é”®generate-clang-databaseè„šæœ¬"><a href="#ä¸€é”®generate-clang-databaseè„šæœ¬" class="headerlink" title="ä¸€é”®generate clang databaseè„šæœ¬"></a>ä¸€é”®generate clang databaseè„šæœ¬</h3><p>æˆ‘ç®€å•å†™äº†ä¸ª bat è„šæœ¬æ¥è¾…åŠ©ç”Ÿæˆï¼Œ<del>åç»­å¯èƒ½ä¼šä¸“é—¨å†™ä¸ªæ’ä»¶ä¸€é”®é…ç½®</del></p><p>ç›´æ¥å¤åˆ¶åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼ˆç¡®ä¿å’Œ .uproject åŒç›®å½•ï¼‰ï¼ŒåŒå‡»è¿è¡Œå³å¯ï¼Œæ— éœ€ä¿®æ”¹</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="comment">REM made by @hacbit</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">setlocal</span> enabledelayedexpansion</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM find .uproject</span></span><br><span class="line"><span class="built_in">set</span> &quot;project_name=&quot;</span><br><span class="line"><span class="keyword">for</span> <span class="variable">%%f</span> <span class="keyword">in</span> (*.uproject) <span class="keyword">do</span> (</span><br><span class="line">    <span class="built_in">set</span> &quot;project_name=<span class="variable">%%~</span>nf&quot;</span><br><span class="line">    <span class="built_in">echo</span> found project =&gt; <span class="variable">!project_name!</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> &quot;<span class="variable">!project_name!</span>&quot;==&quot;&quot; (</span><br><span class="line">    <span class="built_in">echo</span> Error: No .uproject file found <span class="keyword">in</span> current directory</span><br><span class="line">    <span class="built_in">pause</span></span><br><span class="line">    <span class="keyword">exit</span> /b <span class="number">1</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM use powershell to read workspace configuration file</span></span><br><span class="line"><span class="comment">REM and parse json to get UE5 path</span></span><br><span class="line"><span class="built_in">set</span> &quot;ue5_path=&quot;</span><br><span class="line"><span class="built_in">set</span> &quot;workspace_file=<span class="variable">!project_name!</span>.code-workspace&quot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exist</span> &quot;<span class="variable">!workspace_file!</span>&quot; (</span><br><span class="line">    <span class="built_in">echo</span> Error: <span class="variable">!workspace_file!</span> <span class="keyword">not</span> found</span><br><span class="line">    <span class="built_in">pause</span></span><br><span class="line">    <span class="keyword">exit</span> /b <span class="number">1</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> /f &quot;tokens=*&quot; <span class="variable">%%i</span> <span class="keyword">in</span> (&#x27;powershell -Command &quot;&amp; &#123;(Get-Content &#x27;<span class="variable">!workspace_file!</span>&#x27; | ConvertFrom-Json).folders | Where-Object &#123;$_.name -eq &#x27;UE5&#x27;&#125; | Select-Object -ExpandProperty <span class="built_in">path</span>&#125;&quot;&#x27;) <span class="keyword">do</span> (</span><br><span class="line">    <span class="built_in">set</span> &quot;ue5_path=<span class="variable">%%i</span>&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> &quot;<span class="variable">!ue5_path!</span>&quot;==&quot;&quot; (</span><br><span class="line">    <span class="built_in">echo</span> Error: UE5 engine <span class="built_in">path</span> <span class="keyword">not</span> found <span class="keyword">in</span> workspace configuration</span><br><span class="line">    <span class="built_in">pause</span></span><br><span class="line">    <span class="keyword">exit</span> /b <span class="number">1</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"><span class="built_in">echo</span> Configuration Summary:</span><br><span class="line"><span class="built_in">echo</span> ======================</span><br><span class="line"><span class="built_in">echo</span> Project Name: <span class="variable">!project_name!</span></span><br><span class="line"><span class="built_in">echo</span> UE5 Engine <span class="built_in">Path</span>: <span class="variable">!ue5_path!</span></span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM Generate Clang Database</span></span><br><span class="line"><span class="built_in">set</span> &quot;build_bat=<span class="variable">!ue5_path!</span>\Engine\Build\BatchFiles\Build.bat&quot;</span><br><span class="line"><span class="built_in">set</span> &quot;project_path=<span class="variable">%CD%</span>\rhythm2.uproject&quot;</span><br><span class="line"><span class="built_in">set</span> &quot;from=<span class="variable">!ue5_path!</span>\compile_commands.json&quot;</span><br><span class="line"><span class="built_in">set</span> &quot;target=<span class="variable">%CD%</span>\.vscode&quot;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> Try generate clang database</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> &quot;<span class="variable">!build_bat!</span>&quot; rhythm2Editor Win64 Development ^</span><br><span class="line">    -Project=&quot;<span class="variable">!project_path!</span>&quot; ^</span><br><span class="line">    -<span class="built_in">mode</span>=GenerateClangDatabase</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="variable">%errorlevel%</span> <span class="keyword">neq</span> <span class="number">0</span> (</span><br><span class="line">    <span class="built_in">echo</span>.</span><br><span class="line">    <span class="built_in">echo</span> Build.bat failed with error level <span class="variable">%errorlevel%</span></span><br><span class="line">    <span class="built_in">pause</span></span><br><span class="line">    <span class="keyword">exit</span> /b <span class="variable">%errorlevel%</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"><span class="built_in">echo</span> Generate Clang Database completed successfully</span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"><span class="built_in">echo</span> Try <span class="built_in">move</span> compile_commands.json...</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM check exists</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exist</span> &quot;<span class="variable">!from!</span>&quot; (</span><br><span class="line">    <span class="built_in">echo</span>.</span><br><span class="line">    <span class="built_in">echo</span> Error: Source file <span class="keyword">not</span> found: <span class="variable">!from!</span></span><br><span class="line">    <span class="built_in">pause</span></span><br><span class="line">    <span class="keyword">exit</span> /b <span class="number">1</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">REM move compile_commands.json to .vscode</span></span><br><span class="line"><span class="built_in">move</span> /y &quot;<span class="variable">!from!</span>&quot; &quot;<span class="variable">!target!</span>&quot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="variable">%errorlevel%</span> <span class="keyword">equ</span> <span class="number">0</span> (</span><br><span class="line">    <span class="built_in">echo</span>.</span><br><span class="line">    <span class="built_in">echo</span> Successfully moved compile_commands.json</span><br><span class="line">    <span class="built_in">echo</span> File location: <span class="variable">!target!</span></span><br><span class="line">) <span class="keyword">else</span> (</span><br><span class="line">    <span class="built_in">echo</span>.</span><br><span class="line">    <span class="built_in">echo</span> Failed to <span class="built_in">move</span> file with error level <span class="variable">%errorlevel%</span></span><br><span class="line">    <span class="built_in">pause</span></span><br><span class="line">    <span class="keyword">exit</span> /b <span class="variable">%errorlevel%</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">endlocal</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥åœ¨é¡¹ç›®ä¸­ç”Ÿæˆ clang database äº†ï¼Œæœ€ååˆ«å¿˜äº†ç»™ clangd é…ç‚¹å‚æ•°ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„é…ç½®ï¼š</p><p><img src="/UE5%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEVSCode%E5%92%8CClang%E7%8E%AF%E5%A2%83/clangd-args.png" alt="clangd-args"></p><blockquote><p>æˆ–è€…ä»…å¯¹å½“å‰é¡¹ç›®ç”Ÿæ•ˆï¼Œç›´æ¥åœ¨å·¥ä½œåŒºé…ç½®æ–‡ä»¶ ï¼ˆ <strong>é¡¹ç›®å.code-workspace</strong>ï¼‰ é‡ŒåŠ ä¸Šè¿™æ®µ</p><p><strong>æ³¨æ„ï¼šç›´æ¥åŠ åˆ° .vscode&#x2F;settings.json æ²¡ç”¨</strong></p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;clangd.arguments&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;--compile-commands-dir=$&#123;workspaceFolder&#125;/.vscode&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;--background-index&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;--completion-style=detailed&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;--header-insertion=iwyu&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;--all-scopes-completion&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/UE5%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEVSCode%E5%92%8CClang%E7%8E%AF%E5%A2%83/workspace-setting.png" alt="workspace-setting"></p><h2 id="ä½¿ç”¨æ•ˆæœ"><a href="#ä½¿ç”¨æ•ˆæœ" class="headerlink" title="ä½¿ç”¨æ•ˆæœ"></a>ä½¿ç”¨æ•ˆæœ</h2><p>åŸºæœ¬ä¸Šç¬¦å·æç¤ºæ˜¯æ²¡é—®é¢˜çš„ï¼Œå¯¹äºå®çš„æ”¯æŒä¹Ÿæ¯”è¾ƒå¥½ï¼Œå®å†…éƒ¨çš„ç¬¦å·ä¹Ÿèƒ½è¯†åˆ«ï¼ˆä¹‹å‰ç”¨ VS çš„æ—¶å€™è°ƒç”¨å®æ—¶å†…éƒ¨çš„ç¬¦å·è¯†åˆ«ä¸å¥½ï¼Œæ¯”å¦‚è¾“å…¥ LogXXX  ,æŒ‡å®š Verbosity çš„æ—¶å€™éƒ½æ²¡æœ‰å¾ˆå¥½çš„æç¤ºï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯æ²¡é…ç½®å¥½ï¼‰</p><img src="/UE5%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEVSCode%E5%92%8CClang%E7%8E%AF%E5%A2%83/test1.png" alt="test1" style="zoom:67%;"><img src="/UE5%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEVSCode%E5%92%8CClang%E7%8E%AF%E5%A2%83/test2.png" alt="test2" style="zoom:67%;"><h2 id="ä¸€äº›bug-or-æ³¨æ„äº‹é¡¹"><a href="#ä¸€äº›bug-or-æ³¨æ„äº‹é¡¹" class="headerlink" title="ä¸€äº›bug or æ³¨æ„äº‹é¡¹"></a>ä¸€äº›bug or æ³¨æ„äº‹é¡¹</h2><h3 id="LLVM-out-of-memory"><a href="#LLVM-out-of-memory" class="headerlink" title="LLVM out of memory"></a>LLVM out of memory</h3><p><strong>ç–‘ä¼¼ llvm çš„ bug</strong></p><p>ç”±äºæœ¬äººä½¿ç”¨çš„ UE5.6.1 è¦æ±‚ clang ç‰ˆæœ¬æ˜¯ 19.0.0 + ï¼Œ ç„¶åæˆ‘ç”¨ VS Installer ä¸‹è½½çš„ LLVM 19.1.5 ç»™ clangd æ’ä»¶ä½¿ç”¨ï¼Œä½†æ˜¯åŸºæœ¬å¯åŠ¨è·‘ä¸€ä¼š clangd æœåŠ¡å°±æŒ‚äº†ï¼Œç„¶åç»™æˆ‘æŠ›å‡ºæ¥ä¸ªçˆ†å†…å­˜çš„é”™è¯¯ã€‚ä¹‹åæ”¹æˆäº†æˆ‘æœ¬åœ°è£…çš„å¦ä¸€ä¸ªç‰ˆæœ¬ï¼ˆç›´æ¥ä» Github ä¸‹è½½çš„ LLVM 18.1.8ï¼‰å°±æ²¡æœ‰è¿™æ ·çš„é—®é¢˜äº†ã€‚</p><p>è§£å†³æ–¹æ³•ï¼š<strong>å‡é«˜ç‰ˆæœ¬ or é™ä½ç‰ˆæœ¬</strong></p><p>ç›®å‰æˆ‘ç”¨ä½ç‰ˆæœ¬å¼€å‘é™¤äº†ä¼šæç¤ºéœ€è¦ 19.0.0+ çš„ clang è¿™æ ·çš„æŠ¥é”™ï¼Œå¹¶æ²¡æœ‰å½±å“å®é™…çš„å¼€å‘ä½“éªŒï¼ŒåŸºæœ¬å¯ä»¥å¿½ç•¥çš„ã€‚</p><p><img src="/UE5%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEVSCode%E5%92%8CClang%E7%8E%AF%E5%A2%83/version-nomatch.png" alt="version nomatch"></p><blockquote><p>æ”¹ç‰ˆæœ¬ç›´æ¥æ”¹è¿™é‡Œçš„è·¯å¾„å°±è¡Œ</p><p><img src="/UE5%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEVSCode%E5%92%8CClang%E7%8E%AF%E5%A2%83/clangd-path.png" alt="clangd-path"></p></blockquote><h2 id="ä¸€é”®é…ç½®æ’ä»¶ï¼ˆTODOï¼Œç”»ä¸ªé¥¼å…ˆ-xï¼‰"><a href="#ä¸€é”®é…ç½®æ’ä»¶ï¼ˆTODOï¼Œç”»ä¸ªé¥¼å…ˆ-xï¼‰" class="headerlink" title="ä¸€é”®é…ç½®æ’ä»¶ï¼ˆTODOï¼Œç”»ä¸ªé¥¼å…ˆ xï¼‰"></a>ä¸€é”®é…ç½®æ’ä»¶ï¼ˆTODOï¼Œç”»ä¸ªé¥¼å…ˆ xï¼‰</h2><p>å…ˆé¸½ç€ï¼Œæœ‰ç©ºå¼€å‘ä¸€ä¸ª ï¼šï¼‰</p>]]></content:encoded>
      
      
      <category domain="https://blog.hacbit.net/categories/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">æ¸¸æˆå¼€å‘</category>
      
      
      <category domain="https://blog.hacbit.net/tags/Tutorial/">Tutorial</category>
      
      <category domain="https://blog.hacbit.net/tags/UE/">UE</category>
      
      
      <comments>https://blog.hacbit.net/UE5%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AEVSCode%E5%92%8CClang%E7%8E%AF%E5%A2%83/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>ä½¿ç”¨CSharpè¡¨è¾¾å¼æ ‘ä¼˜åŒ–ä»£ç </title>
      <link>https://blog.hacbit.net/%E4%BD%BF%E7%94%A8CSharp%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A0%91%E4%BC%98%E5%8C%96%E4%BB%A3%E7%A0%81/</link>
      <guid>https://blog.hacbit.net/%E4%BD%BF%E7%94%A8CSharp%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A0%91%E4%BC%98%E5%8C%96%E4%BB%A3%E7%A0%81/</guid>
      <pubDate>Sun, 25 May 2025 03:52:18 GMT</pubDate>
      
      <description>&lt;p&gt;è¿‘æœŸåœ¨ç ”ç©¶ C# çš„è¡¨è¾¾å¼æ ‘ï¼Œæ„Ÿè§‰éƒ¨åˆ†åœºæ™¯ä¸‹ä½¿ç”¨è¡¨è¾¾å¼æ ‘ä¼šå¾ˆæœ‰ä¼˜åŠ¿ï¼Œä¸çŸ¥é“è¡¨è¾¾å¼æ ‘æ˜¯ä»€ä¹ˆç›´æ¥çœ‹&lt;a href=&quot;https://learn.microsoft.com/zh-cn/dotnet/csharp/advanced-topics/expression-trees/expression-trees-explained&quot;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;å§&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯æˆ‘é‡åˆ°çš„å‡ ç§è§‰å¾—å¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼æ ‘çš„åœºæ™¯ï¼ˆå…·ä½“æƒ…å†µå…·ä½“åˆ†æï¼Œå»ºè®®è¾©è¯çš„çœ‹å¾…ï¼‰&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>è¿‘æœŸåœ¨ç ”ç©¶ C# çš„è¡¨è¾¾å¼æ ‘ï¼Œæ„Ÿè§‰éƒ¨åˆ†åœºæ™¯ä¸‹ä½¿ç”¨è¡¨è¾¾å¼æ ‘ä¼šå¾ˆæœ‰ä¼˜åŠ¿ï¼Œä¸çŸ¥é“è¡¨è¾¾å¼æ ‘æ˜¯ä»€ä¹ˆç›´æ¥çœ‹<a href="https://learn.microsoft.com/zh-cn/dotnet/csharp/advanced-topics/expression-trees/expression-trees-explained">å®˜æ–¹æ–‡æ¡£</a>å§</p><p>ä¸‹é¢æ˜¯æˆ‘é‡åˆ°çš„å‡ ç§è§‰å¾—å¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼æ ‘çš„åœºæ™¯ï¼ˆå…·ä½“æƒ…å†µå…·ä½“åˆ†æï¼Œå»ºè®®è¾©è¯çš„çœ‹å¾…ï¼‰</p><span id="more"></span><h2 id="ä½¿ç”¨-Expression-ä»£æ›¿åµŒå¥—-Lambda"><a href="#ä½¿ç”¨-Expression-ä»£æ›¿åµŒå¥—-Lambda" class="headerlink" title="ä½¿ç”¨ Expression ä»£æ›¿åµŒå¥— Lambda"></a>ä½¿ç”¨ Expression ä»£æ›¿åµŒå¥— Lambda</h2><p>å‡è®¾ä¸€ç§åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ªèŠ‚ç‚¹æ ‘ï¼ˆç®€å•ç‚¹å°±åªç”¨ä¸€ä¸ªå•é“¾äº†ï¼‰ï¼Œç„¶åæ ¹æ®èŠ‚ç‚¹ä¸Šçš„ä¸€äº›ä¿¡æ¯æ„å»ºæˆä¸€ä¸ª lambdaï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="built_in">int</span> <span class="title">Foo</span>(<span class="params"><span class="built_in">int</span> x</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> Operation</span><br><span class="line">&#123;</span><br><span class="line">    Add,</span><br><span class="line">    Sub,</span><br><span class="line">    Mul,</span><br><span class="line">    Div,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Node</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> required Operation Op &#123; <span class="keyword">get</span>; <span class="keyword">init</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> required <span class="built_in">int</span> Value &#123; <span class="keyword">get</span>; <span class="keyword">init</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> Node? Next = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Foo <span class="title">BuildLambda</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Foo proc = Op <span class="keyword">switch</span></span><br><span class="line">        &#123;</span><br><span class="line">            Operation.Add =&gt; x =&gt; x + Value,</span><br><span class="line">            Operation.Sub =&gt; x =&gt; x - Value,</span><br><span class="line">            Operation.Mul =&gt; x =&gt; x * Value,</span><br><span class="line">            Operation.Div =&gt; x =&gt; x / Value,</span><br><span class="line">            _ =&gt; x =&gt; x,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> x =&gt; proc((Next?.BuildLambda() ?? (x =&gt; x))(x));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆå®¹æ˜“å‘ç°é—®é¢˜ï¼Œå¦‚æœæ ‘æ¯”è¾ƒå¤æ‚ï¼Œä¼šå¯¼è‡´ lambda å¥—äº†å¾ˆå¤šå±‚ï¼Œè‡ªç„¶å°±å¯¼è‡´è¿è¡Œæ•ˆç‡ä¸é«˜</p><p>ç¼–å†™ä¸€æ®µæµ‹è¯•ä»£ç </p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">const</span> <span class="built_in">int</span> N = <span class="number">1000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(<span class="string">$&quot;Test <span class="subst">&#123;N&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> node = Generate();</span><br><span class="line">    <span class="keyword">var</span> sw = <span class="keyword">new</span> Stopwatch();</span><br><span class="line">    sw.Start();</span><br><span class="line">    <span class="keyword">var</span> f = node.BuildLambda();</span><br><span class="line">    sw.Stop();</span><br><span class="line">    Console.WriteLine(<span class="string">$&quot;Lambda Build used <span class="subst">&#123;sw.ElapsedMilliseconds&#125;</span> ms&quot;</span>);</span><br><span class="line">    sw.Restart();</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        f(i);</span><br><span class="line">    &#125;</span><br><span class="line">    sw.Stop();</span><br><span class="line">    Console.WriteLine(<span class="string">$&quot;Lambda Run used <span class="subst">&#123;sw.ElapsedMilliseconds&#125;</span> ms&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Node <span class="title">Generate</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> root = <span class="keyword">new</span> Node &#123; Op = Operation.Add, Value = <span class="number">114514</span> &#125;;</span><br><span class="line">    <span class="keyword">var</span> node = root;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> op = (Operation)Random.Shared.Next(<span class="number">4</span>);</span><br><span class="line">        <span class="keyword">var</span> val = Random.Shared.Next(<span class="number">1919810</span>);</span><br><span class="line">        node!.Next = <span class="keyword">new</span> Node &#123; Op = op, Value = val &#125;;</span><br><span class="line">        node = root.Next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•ç”Ÿæˆäº†ä¸€ä¸ªå¥—äº†å¤§æ¦‚10å±‚çš„èŠ‚ç‚¹ï¼Œç„¶åæ„å»ºæˆ lambda å»è·‘æ•°æ®ï¼Œæµ‹è¯•äº†å‡ ä¸ª N å¾—åˆ°äº†å¦‚ä¸‹æ•°æ®</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Test <span class="number">1000</span></span><br><span class="line">Lambda Build used <span class="number">0</span> ms</span><br><span class="line">Lambda Run used <span class="number">0</span> ms</span><br><span class="line"></span><br><span class="line">Test <span class="number">10000</span></span><br><span class="line">Lambda Build used <span class="number">0</span> ms</span><br><span class="line">Lambda Run used <span class="number">21</span> ms</span><br><span class="line"></span><br><span class="line">Test <span class="number">100000</span></span><br><span class="line">Lambda Build used <span class="number">0</span> ms</span><br><span class="line">Lambda Run used <span class="number">36</span> ms</span><br><span class="line"></span><br><span class="line">Test <span class="number">1000000</span></span><br><span class="line">Lambda Build used <span class="number">0</span> ms</span><br><span class="line">Lambda Run used <span class="number">102</span> ms</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å¯ä»¥è€ƒè™‘ä¸€ä¸‹è¡¨è¾¾å¼æ ‘ä¼šæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Œå¾ˆæ˜¾ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥æ“ä½œèŠ‚ç‚¹æ ‘ï¼Œè‡ªä¸‹è€Œä¸Šåˆå¹¶æˆä¸€ä¸ªå‡½æ•°</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Expression&lt;Foo&gt; <span class="title">BuildExpression</span>(<span class="params">ParameterExpression param</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">value</span> = Expression.Constant(Value);</span><br><span class="line">    Expression next = Next?.BuildExpression(param).Body ?? param;</span><br><span class="line">    Expression proc = Op <span class="keyword">switch</span></span><br><span class="line">    &#123;</span><br><span class="line">        Operation.Add =&gt; Expression.Add(next, <span class="keyword">value</span>),</span><br><span class="line">        Operation.Sub =&gt; Expression.Subtract(next, <span class="keyword">value</span>),</span><br><span class="line">        Operation.Mul =&gt; Expression.Multiply(next, <span class="keyword">value</span>),</span><br><span class="line">        Operation.Div =&gt; Expression.Divide(next, <span class="keyword">value</span>),</span><br><span class="line">        _ =&gt; next,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> Expression.Lambda&lt;Foo&gt;(proc, param);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ¯æ¬¡è·å–å­è¡¨è¾¾å¼ï¼Œç„¶åæŠŠå‡½æ•°ä½“æ‹¼æ¥ï¼Œå…¶å®å°±æ˜¯æŠŠä¸€ä¸ªæ ‘çŠ¶ç»“æ„å¹³å¦åŒ–äº†</p><blockquote><p>  è¿™é‡Œè¦æ³¨æ„ï¼Œå‚æ•°é€šè¿‡å‡½æ•°æ¥ä¼ é€’è€Œä¸æ˜¯æ¯æ¬¡buildéƒ½åœ¨é‡Œé¢å®šä¹‰ä¸€ä¸ªå˜é‡æ˜¯å› ä¸ºå³ä¾¿è®¾ç½®çš„å˜é‡åä¸€æ ·ï¼Œä½†æ˜¯æœ¬è´¨ä¹Ÿæ˜¯ç»‘å®šçš„ä¸åŒçš„å‚æ•°ï¼Œè¿™æ—¶å€™å°±ä¸èƒ½ç›´æ¥ä½¿ç”¨ Body æ‹¼æ¥ï¼Œå¦åˆ™ä¼šè¿è¡Œæ—¶å¼‚å¸¸</p></blockquote><p>åšä¸€ä¸‹åŸºå‡†æµ‹è¯•</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Benchmark</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> Node node;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">int</span> N = <span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">GlobalSetup</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Setup</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        node = Program.Generate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Benchmark</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestExpression</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> param = Expression.Parameter(<span class="keyword">typeof</span>(<span class="built_in">int</span>), <span class="string">&quot;x&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> expr = node.BuildExpression(param);</span><br><span class="line">        <span class="keyword">var</span> f2 = expr.Compile();</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            f2(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Benchmark</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestLambda</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> f = node.BuildLambda();</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            f(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> summary = BenchmarkRunner.Run&lt;Benchmark&gt;();</span><br><span class="line">        Console.WriteLine(summary);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// other code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/%E4%BD%BF%E7%94%A8CSharp%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A0%91%E4%BC%98%E5%8C%96%E4%BB%A3%E7%A0%81/image-20250526011451685.png" alt="benchmark"></p><p>åŸºæœ¬ä¸Šè¿™ä¸ªè¡¨è¾¾å¼æ ‘éœ€è¦å¤§æ¦‚ 15-30 ms çš„æ—¶é—´ç¼–è¯‘ï¼Œè€Œè¿è¡Œçš„æ€§èƒ½éå¸¸é«˜ï¼Œè¿™ä¸ªä¼˜åŠ¿ä¼šåœ¨æ•°æ®æ•°é‡çº§è¶Šé«˜ï¼Œæ ‘ç»“æ„è¶Šå¤æ‚çš„æ—¶å€™ç”±å¾ˆæ˜¾è‘—çš„è¡¨ç°</p><p>ä¸è¿‡ expression ç¼ºç‚¹æ˜¯å†™èµ·æ¥å¾ˆéº»çƒ¦ï¼Œä¹Ÿä¸ç›´è§‚ï¼Œè€Œä¸”å®¹æ˜“å†™å‡º bugï¼Œç‰¹åˆ«æ˜¯ç±»å‹å¯¹åº”ä¸ä¸Šçš„æƒ…å†µï¼Œå¾€å¾€è¦åˆ°è¿è¡Œæ—¶æŠ¥é”™äº†æ‰èƒ½å‘ç°</p><p>ä¸€èˆ¬çš„æƒ…å†µç”¨åµŒå¥—å‡½æ•°å·²ç»å¤Ÿäº†</p><h2 id="åå°„-Expression-ä»£æ›¿çº¯åå°„"><a href="#åå°„-Expression-ä»£æ›¿çº¯åå°„" class="headerlink" title="åå°„ + Expression ä»£æ›¿çº¯åå°„"></a>åå°„ + Expression ä»£æ›¿çº¯åå°„</h2><p>æ¯”å¦‚é€šè¿‡åå°„è·å–ä¸€ä¸ª MethodInfoï¼Œè°ƒç”¨å®ƒçš„æ–¹å¼äº¦æœ‰å·®åˆ«ã€‚é€šå¸¸å¯èƒ½ä¼šç›´æ¥ <code>.Invoke(...)</code> è°ƒç”¨äº†ï¼Œä½†æ˜¯è¿™ç§åŠ¨æ€è°ƒç”¨æœºåˆ¶ä¼šåœ¨è¿è¡Œæ—¶å¯¹ä¼ å…¥è¿›è¡Œå‚æ•°ç±»å‹æ£€æŸ¥ï¼Œè£…æ‹†ç®±ç­‰æ“ä½œï¼Œä»¥åŠæ–¹æ³•çš„åŠ¨æ€æ´¾å‘ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰ JIT çš„ä¼˜åŒ–ï¼Œè¿™å¯¼è‡´å°±ç®—æ˜¯ç¼“å­˜äº†è¿™ä¸ª infoï¼Œå¤šæ¬¡è°ƒç”¨ä¹Ÿä¸èƒ½æœ‰å¾ˆé«˜çš„æ€§èƒ½ã€‚</p><p>è¿™æ—¶å€™å¯ä»¥é€šè¿‡è¡¨è¾¾å¼æ ‘æ¥æä¾›æ›´å¥½çš„æ€§èƒ½</p><p>æ¯”å¦‚æˆ‘ä»¬è¦è·å–ä¸€ä¸ªç±»å‹çš„ property çš„ setter æ¥è¿›è¡Œèµ‹å€¼æ“ä½œ</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Benchmark2</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> Bar bar;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">int</span> N = <span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">GlobalSetup</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Setup</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        bar = <span class="keyword">new</span> Bar(<span class="number">114514</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MethodInfo? setter;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Benchmark</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestReflection</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        setter ??= <span class="keyword">typeof</span>(Bar).GetProperty(<span class="string">&quot;value&quot;</span>, BindingFlags.NonPublic | BindingFlags.Instance)?</span><br><span class="line">            .GetSetMethod(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            setter?.Invoke(bar, <span class="keyword">new</span> <span class="built_in">object</span>[] &#123; i &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å¾ˆè‡ªç„¶çš„æ“ä½œï¼Œå¦‚æœéœ€è¦å¤šæ¬¡è°ƒç”¨ï¼ŒæŠŠè¿™ä¸ª methodInfo ç¼“å­˜ä¸‹æ¥ï¼Œä¹‹åç›´æ¥ invoke è¿™ä¸ª methodinfo</p><p>ç„¶åæˆ‘ä»¬ä½¿ç”¨åŒæ ·çš„é€»è¾‘æ¥ä½¿ç”¨è¡¨è¾¾å¼æ ‘ï¼Œè¿™é‡Œä½¿ç”¨ <code>Expression.Call</code> æ¥è°ƒç”¨ä¸€ä¸ª MethodInfo</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Action&lt;Bar, <span class="built_in">int</span>&gt;? setter2;</span><br><span class="line"></span><br><span class="line">[<span class="meta">Benchmark</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestExpression</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (setter2 <span class="keyword">is</span> <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> barParam = Expression.Parameter(<span class="keyword">typeof</span>(Bar), <span class="string">&quot;bar&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> valueParam = Expression.Parameter(<span class="keyword">typeof</span>(<span class="built_in">int</span>), <span class="string">&quot;value&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> setterMethod = <span class="keyword">typeof</span>(Bar).GetProperty(<span class="string">&quot;value&quot;</span>, BindingFlags.NonPublic | BindingFlags.Instance)?</span><br><span class="line">            .GetSetMethod(<span class="literal">true</span>);</span><br><span class="line">        setter2 = Expression.Lambda&lt;Action&lt;Bar, <span class="built_in">int</span>&gt;&gt;(</span><br><span class="line">            Expression.Call(barParam, setterMethod!, valueParam),</span><br><span class="line">            barParam, valueParam</span><br><span class="line">        ).Compile();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        setter2(bar, i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ¬¡æˆ‘ä»¬ä¸éœ€è¦ç¼“å­˜è¿™ä¸ª methodInfoï¼Œè€Œæ˜¯ç¼–è¯‘æˆä¸€ä¸ªå§”æ‰˜ç„¶åç¼“å­˜è¯¥å§”æ‰˜</p><p>åŒæ ·è·‘ä¸€ä¸‹åŸºå‡†æµ‹è¯•</p><p><img src="/%E4%BD%BF%E7%94%A8CSharp%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A0%91%E4%BC%98%E5%8C%96%E4%BB%A3%E7%A0%81/image-20250526014002834.png" alt="benchmark2"></p><blockquote><p>  è¡¨è¾¾å¼æ ‘ç¼–è¯‘åçš„å§”æ‰˜æ˜¯ç›´æ¥å»è°ƒç”¨ç›®æ ‡æ–¹æ³•çš„ IL ä»£ç ï¼Œæ€§èƒ½å‡ ä¹æ˜¯æ¥è¿‘ç›´æ¥è°ƒç”¨çš„ï¼Œé¿å…åŠ¨æ€è°ƒç”¨å¼€é”€ï¼Œæ‰€ä»¥æ€§èƒ½ä¼šè¿œé«˜äº MethodInfo.Invoke</p></blockquote>]]></content:encoded>
      
      
      <category domain="https://blog.hacbit.net/categories/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">æ¸¸æˆå¼€å‘</category>
      
      
      <category domain="https://blog.hacbit.net/tags/CSharp/">CSharp</category>
      
      
      <comments>https://blog.hacbit.net/%E4%BD%BF%E7%94%A8CSharp%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A0%91%E4%BC%98%E5%8C%96%E4%BB%A3%E7%A0%81/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>åŸºäºValueDropdownæ‹“å±•ä»¥æ”¯æŒè‡ªå®šä¹‰icon</title>
      <link>https://blog.hacbit.net/%E5%9F%BA%E4%BA%8EValueDropdown%E6%8B%93%E5%B1%95%E4%BB%A5%E6%94%AF%E6%8C%81%E8%87%AA%E5%AE%9A%E4%B9%89icon/</link>
      <guid>https://blog.hacbit.net/%E5%9F%BA%E4%BA%8EValueDropdown%E6%8B%93%E5%B1%95%E4%BB%A5%E6%94%AF%E6%8C%81%E8%87%AA%E5%AE%9A%E4%B9%89icon/</guid>
      <pubDate>Tue, 13 May 2025 13:56:12 GMT</pubDate>
      
      <description>&lt;p&gt;ä¹‹å‰é‡åˆ°è¿‡ä¸€ä¸ªéœ€æ±‚æ˜¯è¦åœ¨ä¸‹æ‹‰æ¡†çš„ç›®å½•åšä¸€ä¸ªæ ‡è®°æ¥æŒ‡ç¤ºçŠ¶æ€ï¼Œåº”è¯¥å¾ˆè‡ªç„¶å°±å¯ä»¥æƒ³åˆ°èƒ½ä¸èƒ½ä¿®æ”¹ä¸€ä¸‹ iconï¼Œæ¯”å¦‚æŠŠæ–‡ä»¶å¤¹çš„é‚£ä¸ªiconæ”¹æˆå…¶ä»–é¢œè‰²çš„ï¼Œè¿™æ ·ä¼šæ¯”ä¿®æ”¹æ˜¾ç¤ºåå­—æ¯«æ— ç–‘é—®æ›´åŠ æ˜¾çœ¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡å…¶å®æƒ³è¦è¿›è¡Œæ›´å¤§é™åº¦çš„ä¿®æ”¹æ˜¯å®Œå…¨å¯ä»¥çš„ï¼Œåªéœ€è¦é­”æ”¹ä¸€ä¸‹ ValueDropdown å°±è¡Œã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>ä¹‹å‰é‡åˆ°è¿‡ä¸€ä¸ªéœ€æ±‚æ˜¯è¦åœ¨ä¸‹æ‹‰æ¡†çš„ç›®å½•åšä¸€ä¸ªæ ‡è®°æ¥æŒ‡ç¤ºçŠ¶æ€ï¼Œåº”è¯¥å¾ˆè‡ªç„¶å°±å¯ä»¥æƒ³åˆ°èƒ½ä¸èƒ½ä¿®æ”¹ä¸€ä¸‹ iconï¼Œæ¯”å¦‚æŠŠæ–‡ä»¶å¤¹çš„é‚£ä¸ªiconæ”¹æˆå…¶ä»–é¢œè‰²çš„ï¼Œè¿™æ ·ä¼šæ¯”ä¿®æ”¹æ˜¾ç¤ºåå­—æ¯«æ— ç–‘é—®æ›´åŠ æ˜¾çœ¼ã€‚</p><p>ä¸è¿‡å…¶å®æƒ³è¦è¿›è¡Œæ›´å¤§é™åº¦çš„ä¿®æ”¹æ˜¯å®Œå…¨å¯ä»¥çš„ï¼Œåªéœ€è¦é­”æ”¹ä¸€ä¸‹ ValueDropdown å°±è¡Œã€‚</p><span id="more"></span><p>å…ˆè¯´ä¸€ä¸‹ç®€å•çš„è§£å†³å…ˆå‰æåˆ°çš„éœ€æ±‚çš„åŠæ³•å§â€”â€”æ”¹æ˜¾ç¤ºåå­—ã€‚</p><p>ä¸€èˆ¬æ˜¯ä½¿ç”¨ <code>ValueDropdownList&lt;T&gt;</code> æˆ–è€… <code>IEnumerable&lt;ValueDropdownItem&lt;T&gt;&gt;</code>  (äºŒè€…æ˜¯ç­‰ä»·çš„) ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">ShowInInspector, LabelText(<span class="string">&quot;æµ‹è¯•ä¸‹æ‹‰æ¡†&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">ValueDropdown(nameof(GetAllowIndexs))</span>]</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">int</span> Index;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> ValueDropdownList&lt;<span class="built_in">int</span>&gt; <span class="title">GetAllowIndexs</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> list = <span class="keyword">new</span> ValueDropdownList&lt;<span class="built_in">int</span>&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        list.Add(<span class="string">$&quot;The <span class="subst">&#123;i + <span class="number">1</span>&#125;</span> item&quot;</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼Œå¯ä»¥ç»™æ¯ä¸ª value éƒ½æŒ‡å®šè‡ªå®šä¹‰çš„åå­—ï¼Œä¸è¿‡æ›´å¤æ‚çš„æ“ä½œä¼¼ä¹å°±ä¸è¡Œäº†ï¼ˆæˆ–è€…æˆ‘æ²¡æœ‰æ‰¾åˆ°ï¼Ÿï¼‰</p><p><img src="/%E5%9F%BA%E4%BA%8EValueDropdown%E6%8B%93%E5%B1%95%E4%BB%A5%E6%94%AF%E6%8C%81%E8%87%AA%E5%AE%9A%E4%B9%89icon/image-20250513221635581.png" alt="æµ‹è¯•ä¸‹æ‹‰æ¡†"></p><h2 id="æ‹“å±•-ValueDropdown"><a href="#æ‹“å±•-ValueDropdown" class="headerlink" title="æ‹“å±• ValueDropdown"></a>æ‹“å±• ValueDropdown</h2><p>æ—¢ç„¶åŸæœ¬çš„ ValueDropdown æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œé‚£å°±è‡ªå·±æ“ä¸€ä¸ªå§ï¼Œå†™ä¸€ä¸ªç±»ç»§æ‰¿åŸæ¥çš„ ValueDropdown ç‰¹æ€§ã€‚</p><p>ç„¶åæˆ‘ä»¬å†åŸæ¥çš„åŸºç¡€ä¸Šï¼Œå†æ·»åŠ ä¸€ä¸ªå›è°ƒå­—æ®µ</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">if</span> UNITY_EDITOR &amp;&amp; ODIN_INSPECTOR</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Sirenix.OdinInspector</span>;</span><br><span class="line"></span><br><span class="line">[<span class="meta">AttributeUsage(AttributeTargets.All, AllowMultiple = false, Inherited = true)</span>]</span><br><span class="line">[<span class="meta">Conditional(<span class="string">&quot;UNITY_EDITOR&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CustomValueDropdownAttribute</span> : <span class="title">ValueDropdownAttribute</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> ItemAction;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomValueDropdownAttribute</span>(<span class="params"><span class="built_in">string</span> valueGetter, <span class="built_in">string</span> itemAction</span>)</span></span><br><span class="line"><span class="function">        : <span class="title">base</span>(<span class="params">valueGetter</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        ItemAction = itemAction;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>ç„¶åè‡ªå®šä¹‰ attribute drawer</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Sirenix.OdinInspector.Editor.Drawers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">CustomValueDropdownAttributeDrawer</span> : <span class="title">OdinAttributeDrawer</span>&lt;<span class="title">CustomValueDropdownAttribute</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•çœ‹ä¸€ä¸‹ <code>ValueDropdownAttributeDrawer</code> çš„å®ç°ï¼Œå°±ä¼šå‘ç°æ˜¯åŸºäº OdinMenuTree åšçš„ï¼Œæ¯ä¸€é¡¹å…¶å®éƒ½æ˜¯ä¸€ä¸ª OdinMenuItemï¼Œæ‰€ä»¥ä¸å¦¨è®©æˆ‘ä»¬çš„è‡ªå®šä¹‰çš„å›è°ƒçš„å‚æ•°æ˜¯ OdinMenuItemï¼Œè¿™æ ·å°±å¯ä»¥å®ç°æ›´å¤§é™åº¦çš„è‡ªå®šä¹‰æ¯ä¸€é¡¹ã€‚</p><p>æ·»åŠ ä¸€ä¸ª ActionResolver å­—æ®µåŸæ¥è§£æä¼ å…¥çš„æ–¹æ³•å</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ActionResolver? itemAction;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨åˆå§‹åŒ–å‡½æ•°ä¸­æ·»åŠ è§£æé€»è¾‘ï¼Œï¼ˆä¹Ÿåˆ«å¿˜äº†è®¾ç½®é”™è¯¯ä¿¡æ¯ï¼‰</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">base</span>.Attribute.ItemAction <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">    itemAction = ActionResolver.Get(</span><br><span class="line">        <span class="keyword">base</span>.Property,</span><br><span class="line">        <span class="keyword">base</span>.Attribute.ItemAction,</span><br><span class="line"><span class="keyword">new</span>[] &#123; <span class="keyword">new</span> ActionResolvers.NamedValue(<span class="string">&quot;item&quot;</span>, <span class="keyword">typeof</span>(OdinMenuItem)) &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">error = rawGetter.ErrorMessage ?? itemAction?.ErrorMessage;</span><br></pre></td></tr></table></figure><p>ç¿»ä¸€ä¸‹é€»è¾‘ï¼Œä¼šå‘ç°è®¾ç½® icon æ˜¯é€šè¿‡ <code>AddThumbnailIcons(preferAssetPreviewAsIcon: true);</code> è°ƒç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹è¿™éƒ¨åˆ†çš„é€»è¾‘ï¼Œå½“ itemAction ä¸ºç©ºæ—¶ï¼Œå°±ç»§ç»­èµ°è€é€»è¾‘ï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œé‚£å°±å°è¯•è°ƒç”¨è§£æçš„é€»è¾‘</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    genericSelector.SelectionTree.EnumerateTree(x =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        itemAction?.Context.NamedValues.Set(<span class="string">&quot;item&quot;</span>, x);</span><br><span class="line">        itemAction?.DoAction();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (x.Icon == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            x.AddThumbnailIcon(preferAssetPreviewAsIcon: <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•æ•ˆæœ"><a href="#æµ‹è¯•æ•ˆæœ" class="headerlink" title="æµ‹è¯•æ•ˆæœ"></a>æµ‹è¯•æ•ˆæœ</h2><p>åœ¨åŸæ¥çš„æµ‹è¯•ä»£ç é‚£é‡Œæ·»åŠ ä¸€ä¸ªå‡½æ•°</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">HandleItem</span>(<span class="params">OdinMenuItem item</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    item.Icon = EditorIcons.Flag.Active;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¹¶ä¸”ä¿®æ”¹å­—æ®µçš„ç‰¹æ€§</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CustomValueDropdown(nameof(GetAllowIndexs), nameof(HandleItem))</span>]</span><br></pre></td></tr></table></figure><p><img src="/%E5%9F%BA%E4%BA%8EValueDropdown%E6%8B%93%E5%B1%95%E4%BB%A5%E6%94%AF%E6%8C%81%E8%87%AA%E5%AE%9A%E4%B9%89icon/image-20250513231709716.png" alt="image-20250513231709716"></p>]]></content:encoded>
      
      
      <category domain="https://blog.hacbit.net/categories/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">æ¸¸æˆå¼€å‘</category>
      
      
      <category domain="https://blog.hacbit.net/tags/Unity/">Unity</category>
      
      <category domain="https://blog.hacbit.net/tags/CSharp/">CSharp</category>
      
      <category domain="https://blog.hacbit.net/tags/Odin/">Odin</category>
      
      
      <comments>https://blog.hacbit.net/%E5%9F%BA%E4%BA%8EValueDropdown%E6%8B%93%E5%B1%95%E4%BB%A5%E6%94%AF%E6%8C%81%E8%87%AA%E5%AE%9A%E4%B9%89icon/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æµ…è°ˆCSharpä¸Rustçš„å…ƒç¼–ç¨‹æœºåˆ¶</title>
      <link>https://blog.hacbit.net/%E6%B5%85%E8%B0%88CSharp%E4%B8%8ERust%E7%9A%84%E5%85%83%E7%BC%96%E7%A8%8B%E6%9C%BA%E5%88%B6/</link>
      <guid>https://blog.hacbit.net/%E6%B5%85%E8%B0%88CSharp%E4%B8%8ERust%E7%9A%84%E5%85%83%E7%BC%96%E7%A8%8B%E6%9C%BA%E5%88%B6/</guid>
      <pubDate>Wed, 05 Mar 2025 15:33:16 GMT</pubDate>
      
      <description>&lt;p&gt;å¤§éƒ¨åˆ†çš„è¯­è¨€æˆ–å¤šæˆ–å°‘æä¾›äº†ä¸€äº›å…ƒç¼–ç¨‹æœºåˆ¶ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿå¯¹ç°æœ‰çš„è¯­æ³•è¯­ä¹‰è¿›è¡Œæ‹“å±•ï¼Œèƒ½å¤Ÿæå¤§çš„æé«˜ç¼–ç¨‹ä½“éªŒå’Œå¼€å‘æ•ˆç‡ã€‚å¯èƒ½ä¸€æåˆ°å…ƒç¼–ç¨‹ï¼Œå¤§å®¶å¾ˆå®¹æ˜“æƒ³åˆ°å¤§åé¼é¼çš„ &lt;code&gt;Lisp&lt;/code&gt; è¯­è¨€ï¼ˆä½ å¯èƒ½ä¼šè¯´ï¼šâ€œéš¾é“ä¸æ˜¯ Cppï¼Ÿâ€ï¼Œæˆ‘åˆä¸ä¼šæ¨¡æ¿å…ƒç¼–ç¨‹ï¼Œä½ è®©æˆ‘è®²å•¥ xï¼‰ã€‚å¾—ç›Šäºå…¶æœ¬èº«æ¥è¿‘è¯­æ³•æ ‘çš„è¯­æ³•ï¼Œä½¿å¾— Lisp å¼€å‘è€…å¯ä»¥å¾ˆå®¹æ˜“æ“ä½œè¯­æ³•èŠ‚ç‚¹ï¼Œç”šè‡³å®ç° â€œè‡ªå·±çš„ Lispâ€ï¼Œäºæ˜¯å°±æ‰æ¶Œç°äº†å¾ˆå¤šçš„ Lisp æ–¹è¨€ã€‚å½“ç„¶ï¼Œæœ¬ç¯‡æ–‡ç« å¹¶ä¸æ˜¯ä¸ºäº†è®¨è®º Lispï¼Œåªæ˜¯æƒ³è¦å°± â€œå…ƒç¼–ç¨‹â€ è¿™ä¸€ä¸ªè§’åº¦ï¼Œæ¥è°ˆè°ˆ C# å’Œ Rust è¯­è¨€å„è‡ªçš„æœºåˆ¶ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;  å…³äº&lt;strong&gt;å…ƒç¼–ç¨‹&lt;/strong&gt;æ˜¯ä»€ä¹ˆï¼Œç®€å•æ¥è¯´æ˜¯ç”¨&lt;strong&gt;ç¨‹åºç¼–å†™ç¨‹åº&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;  æ›´è¯¦ç»†çš„æè¿°å»ºè®®å‚è€ƒ wiki ï¼š &lt;a href=&quot;https://zh.wikipedia.org/wiki/%E5%85%83%E7%BC%96%E7%A8%8B&quot;&gt;https://zh.wikipedia.org/wiki/%E5%85%83%E7%BC%96%E7%A8%8B&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>å¤§éƒ¨åˆ†çš„è¯­è¨€æˆ–å¤šæˆ–å°‘æä¾›äº†ä¸€äº›å…ƒç¼–ç¨‹æœºåˆ¶ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿå¯¹ç°æœ‰çš„è¯­æ³•è¯­ä¹‰è¿›è¡Œæ‹“å±•ï¼Œèƒ½å¤Ÿæå¤§çš„æé«˜ç¼–ç¨‹ä½“éªŒå’Œå¼€å‘æ•ˆç‡ã€‚å¯èƒ½ä¸€æåˆ°å…ƒç¼–ç¨‹ï¼Œå¤§å®¶å¾ˆå®¹æ˜“æƒ³åˆ°å¤§åé¼é¼çš„ <code>Lisp</code> è¯­è¨€ï¼ˆä½ å¯èƒ½ä¼šè¯´ï¼šâ€œéš¾é“ä¸æ˜¯ Cppï¼Ÿâ€ï¼Œæˆ‘åˆä¸ä¼šæ¨¡æ¿å…ƒç¼–ç¨‹ï¼Œä½ è®©æˆ‘è®²å•¥ xï¼‰ã€‚å¾—ç›Šäºå…¶æœ¬èº«æ¥è¿‘è¯­æ³•æ ‘çš„è¯­æ³•ï¼Œä½¿å¾— Lisp å¼€å‘è€…å¯ä»¥å¾ˆå®¹æ˜“æ“ä½œè¯­æ³•èŠ‚ç‚¹ï¼Œç”šè‡³å®ç° â€œè‡ªå·±çš„ Lispâ€ï¼Œäºæ˜¯å°±æ‰æ¶Œç°äº†å¾ˆå¤šçš„ Lisp æ–¹è¨€ã€‚å½“ç„¶ï¼Œæœ¬ç¯‡æ–‡ç« å¹¶ä¸æ˜¯ä¸ºäº†è®¨è®º Lispï¼Œåªæ˜¯æƒ³è¦å°± â€œå…ƒç¼–ç¨‹â€ è¿™ä¸€ä¸ªè§’åº¦ï¼Œæ¥è°ˆè°ˆ C# å’Œ Rust è¯­è¨€å„è‡ªçš„æœºåˆ¶ã€‚</p><blockquote><p>  å…³äº<strong>å…ƒç¼–ç¨‹</strong>æ˜¯ä»€ä¹ˆï¼Œç®€å•æ¥è¯´æ˜¯ç”¨<strong>ç¨‹åºç¼–å†™ç¨‹åº</strong></p><p>  æ›´è¯¦ç»†çš„æè¿°å»ºè®®å‚è€ƒ wiki ï¼š <a href="https://zh.wikipedia.org/wiki/%E5%85%83%E7%BC%96%E7%A8%8B">https://zh.wikipedia.org/wiki/%E5%85%83%E7%BC%96%E7%A8%8B</a></p></blockquote><span id="more"></span><h2 id="å…ƒç¼–ç¨‹æ¦‚è¿°"><a href="#å…ƒç¼–ç¨‹æ¦‚è¿°" class="headerlink" title="å…ƒç¼–ç¨‹æ¦‚è¿°"></a>å…ƒç¼–ç¨‹æ¦‚è¿°</h2><p>å…ƒç¼–ç¨‹ä¸€èˆ¬æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼šä¸€æ˜¯é€šè¿‡ä½¿ç”¨å†…éƒ¨æš´éœ²çš„ API æ¥ç›´æ¥å¤„ç†è¯­æ³•èŠ‚ç‚¹ï¼ŒäºŒæ˜¯èƒ½å¤ŸåŠ¨æ€æ‰§è¡Œå­—ç¬¦ä¸²è¡¨è¾¾å¼ã€‚</p><p>å¯¹äºåè€…æ¥è¯´ï¼Œå…¸å‹çš„æ˜¯ Python çš„ <code>eval</code>  å’Œ <code>exec</code> å‡½æ•°ï¼ŒJS ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„åŠŸèƒ½ã€‚å¯¹äºè¿™ç±»å®ç°æ¥è¯´ï¼Œå›ºç„¶ååˆ†æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿä¼šå¸¦æ¥å¾ˆä¸¥é‡çš„å®‰å…¨é—®é¢˜ã€‚å¦‚æœå¯¹äºå¤–éƒ¨ç”¨æˆ·æ¥è¯´ï¼Œ<code>eval</code> è¿™ç±»çš„å±é™©å‡½æ•°çš„è¾“å…¥æ˜¯å¯æ§çš„ï¼Œé‚£ä¹ˆç”¨æˆ·å°±å¯ä»¥ä¼ å…¥ä¸€æ®µç²¾å¿ƒæ„é€ çš„å­—ç¬¦ä¸²æ¥æ‰§è¡Œæ¶æ„å‘½ä»¤å¯¼è‡´å¯èƒ½çš„ä¿¡æ¯æ³„éœ²ã€ææƒç­‰å®‰å…¨é—®é¢˜ã€‚</p><p>æ‰€ä»¥æˆ‘ä¸ªäººä¼šæ›´å€¾å‘äºå‰è€…ï¼ˆè™½ç„¶è¿™å¾€å¾€æ„å‘³ç€æ›´åŠ æŠ½è±¡çš„è¯­æ³•å’Œæ›´é«˜çš„ç¼–å†™éš¾åº¦ï¼‰ï¼Œæ¯”å¦‚ C# å’Œ Rust ä¾¿æ˜¯å¦‚æ­¤ã€‚</p><p>åœ¨ C# ä¸­ï¼ŒRoslyn ç¼–è¯‘å™¨æä¾›äº†ä¸€ç³»åˆ— API ï¼ˆ<code>Microsoft.CodeAnalysis.CSharp</code>ï¼‰ç”¨äºç¼–å†™æºç”Ÿæˆå™¨ï¼Œæºç”Ÿæˆå™¨ä¼šåœ¨ç¼–è¯‘æ—¶è¢«è°ƒç”¨ï¼Œè®¿é—®æ¯ä¸ªè¯­æ³•èŠ‚ç‚¹ï¼Œç„¶åæ ¹æ®ä½ çš„å®ç°å»åŠ¨æ€çš„ç”Ÿæˆä»£ç ç»™ç¼–è¯‘å™¨ï¼ˆå¦‚æœä¸å¼€ emitï¼Œé‚£ä¹ˆè¿™äº›ä»£ç ä¸ä¼šä»¥å®é™…çš„æºæ–‡ä»¶å½¢å¼å‡ºç°åœ¨ä½ çš„æ–‡ä»¶å¤¹ä¸­ï¼‰ï¼›è€Œ Rust åˆ™æ˜¯æä¾›äº†æå…¶å¼ºå¤§ï¼Œå ªæ¯” Lisp çš„å®ç³»ç»Ÿã€‚æ™®é€šçš„å‡½æ•°å®ä¼šä¾æ®ç”¨æˆ·ç¼–å†™çš„è§„åˆ™å»åœ¨ç¼–è¯‘æœŸå±•å¼€ï¼Œè¿‡ç¨‹å®åˆ™æœ‰ç‚¹æ¥è¿‘ C#ï¼Œä¸è¿‡ Rust å¹¶ä¸æä¾›ç›´æ¥éå†å…¨å±€çš„è¯­æ³•èŠ‚ç‚¹ï¼Œè€Œåªæ˜¯é™åˆ¶åœ¨è¯¥å®çš„ä½¿ç”¨è€…æœ¬èº«ã€‚</p><h2 id="ä¸€äº›ç®€å•å®è·µ"><a href="#ä¸€äº›ç®€å•å®è·µ" class="headerlink" title="ä¸€äº›ç®€å•å®è·µ"></a>ä¸€äº›ç®€å•å®è·µ</h2><p>ä»¥ä¸‹æ˜¯å…³äº C# å’Œ Rust å…ƒç¼–ç¨‹çš„ç®€å•å®è·µï¼Œå¯ä»¥è§‚å¯Ÿä¸€ä¸‹ä»–ä»¬ä¹‹é—´çš„å·®å¼‚ã€‚</p><blockquote><p>  ä»¥ä¸‹ä»£ç å¹¶éæ˜¯ä¸ºäº†æ•™å­¦ï¼Œåªæ˜¯ä»ä¸€äº›ç®€å•çš„ç¤ºä¾‹æ¥æ¯”è¾ƒä»–ä»¬ä¹‹é—´çš„å·®å¼‚æ€§ï¼Œä»¥åŠè®¨è®ºå„è‡ªçš„ä¼˜åŠ£ã€‚</p><p>  å…³äºä»£ç çš„è§£é‡Šï¼Œä¼šåœ¨åé¢ä¸€èµ·åˆ†æ</p></blockquote><h3 id="C-å¢é‡ç”Ÿæˆå™¨ï¼ˆIncrementalGeneratorï¼‰å®è·µ"><a href="#C-å¢é‡ç”Ÿæˆå™¨ï¼ˆIncrementalGeneratorï¼‰å®è·µ" class="headerlink" title="C# å¢é‡ç”Ÿæˆå™¨ï¼ˆIncrementalGeneratorï¼‰å®è·µ"></a>C# å¢é‡ç”Ÿæˆå™¨ï¼ˆIncrementalGeneratorï¼‰å®è·µ</h3><blockquote><p>  ç”±äº C# çš„<strong>æºç”Ÿæˆå™¨</strong>æ¯æ¬¡éƒ½è¦éå†æ‰€æœ‰è¯­æ³•èŠ‚ç‚¹ï¼Œååˆ†å½±å“æ€§èƒ½ï¼Œå¾®è½¯å·²ç»å°†å…¶æ ‡è®°ä¸º<strong>å¼ƒç”¨</strong>ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æ–°çš„å¢é‡ç”Ÿæˆå™¨ API</p><p>  <strong>å¢é‡ç”Ÿæˆå™¨</strong>ä¸­æä¾›äº†å¤šç§ç®¡é“è¿›è¡Œåˆ†æï¼Œæ¯”å¦‚ <code>CompilationProvider</code> , <code>SyntaxProvider</code>, <code>AdditionalTextsProvider</code> ç­‰ç­‰ã€‚ç›¸æ¯”äºæ—§çš„ <code>ISourceGenerator</code> ï¼Œå¯ä»¥æä¾›æ›´ç»†ç²’åº¦çš„åˆ†æï¼Œæ¥å—çš„åˆ†æå¯¹è±¡ä¹Ÿä¸å±€é™äºæºä»£ç ã€‚</p></blockquote><p>é¦–å…ˆéœ€è¦æ–°å»ºä¸€ä¸ª C# åº“é¡¹ç›®ï¼Œæˆ‘æ¨èç›®æ ‡æ¡†æ¶æ˜¯ netstandard2.0ï¼Œä½¿ç”¨çš„ <code>Microsoft.CodeAnalysis.CSharp</code> ç‰ˆæœ¬ä¸º <code>4.3.0</code> ï¼ˆè¿™å¯ä»¥ä¿è¯è¯¥æºç”Ÿæˆå™¨èƒ½åœ¨å¤§éƒ¨åˆ†çš„é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œç”šè‡³ Unityï¼‰</p><p>ç®€å•å†™ä¸€ä¸ªå° demoï¼š</p><p>å¯¹äºè¯¥ç”Ÿæˆå™¨ï¼Œéœ€è¦å®ç° <code>IIncrementalGenerator</code>  æ¥å£çš„ <code>Initialize</code> æ–¹æ³•ã€‚ç„¶åæˆ‘ä»¬ä»è¯­æ³•èŠ‚ç‚¹çš„è§’åº¦åˆ‡å…¥ï¼Œæ¯”å¦‚æˆ‘ä»¬éœ€è¦ç»™å…·æœ‰ <code>[Test]</code> Attribute çš„ class åˆ†éƒ¨å®ç°ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå°±å¯ä»¥åƒä¸‹é¢è¿™æ ·ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> Microsoft.CodeAnalysis;</span><br><span class="line"><span class="keyword">using</span> Microsoft.CodeAnalysis.CSharp.Syntax;</span><br><span class="line"><span class="keyword">using</span> Microsoft.CodeAnalysis.Text;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Test.Analysis</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Generator(LanguageNames.CSharp)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">TestGenerator</span> : <span class="title">IIncrementalGenerator</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Initialize</span>(<span class="params">IncrementalGeneratorInitializationContext context</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> provider = context.SyntaxProvider</span><br><span class="line">                .CreateSyntaxProvider(</span><br><span class="line">                    (s, _) =&gt; s <span class="keyword">is</span> ClassDeclarationSyntax classDecl &amp;&amp; </span><br><span class="line">                        classDecl.AttributeLists</span><br><span class="line">                            .SelectMany(al =&gt; al.Attributes)</span><br><span class="line">                            .Any(a =&gt; a.Name.ToString() == <span class="string">&quot;Test&quot;</span>),</span><br><span class="line">                    (ctx, _) =&gt; ctx.Node <span class="keyword">as</span> ClassDeclarationSyntax</span><br><span class="line">                ).Collect();</span><br><span class="line"></span><br><span class="line">            context.RegisterSourceOutput(provider, (spc, source) =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">foreach</span> (<span class="keyword">var</span> @class <span class="keyword">in</span> source)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">var</span> namespaceName = @class.FirstAncestorOrSelf&lt;NamespaceDeclarationSyntax&gt;().Name.ToString();</span><br><span class="line">                    <span class="comment">// Add Test method to the class</span></span><br><span class="line">                    <span class="keyword">var</span> code = <span class="string">$@&quot;// &lt;auto-generated/&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">using System;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">namespace <span class="subst">&#123;namespaceName&#125;</span></span></span><br><span class="line"><span class="string">&#123;&#123;</span></span><br><span class="line"><span class="string">    public partial class <span class="subst">&#123;@<span class="keyword">class</span>.Identifier&#125;</span></span></span><br><span class="line"><span class="string">    &#123;&#123;</span></span><br><span class="line"><span class="string">        public void Test() =&gt; Console.WriteLine(&quot;&quot;Test&quot;&quot;);</span></span><br><span class="line"><span class="string">    &#125;&#125;</span></span><br><span class="line"><span class="string">&#125;&#125;&quot;</span>;</span><br><span class="line">                    spc.AddSource(<span class="string">$&quot;<span class="subst">&#123;@<span class="keyword">class</span>.Identifier&#125;</span>_Test.g.cs&quot;</span>, SourceText.From(code, Encoding.UTF8));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦å¤–åœ¨ä¸€ä¸ªç»ˆç«¯é¡¹ç›®ä¸­å¼•ç”¨è¯¥é¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ª TestAttributeï¼Œç„¶ååœ¨ä¸€ä¸ªåˆ†éƒ¨ç±»ä¸Šä½¿ç”¨å®ƒï¼Œç„¶åè¿™ä¸ªç±»å°±ä¼šè‡ªåŠ¨å®ç° Test() æ–¹æ³•äº†ã€‚</p><blockquote><p>  è¯´æ˜:information_source: ï¼š ç”±äºæµ‹è¯•é¡¹ç›®ä½¿ç”¨çš„æ˜¯ net9.0ï¼Œ æ”¯æŒé¡¶çº§è¡¨è¾¾å¼ï¼Œæ‰€ä»¥å¯ä»¥ä¸éœ€è¦å†™é™æ€ Main å‡½æ•°ã€‚</p></blockquote><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> test = <span class="keyword">new</span> Test.TestClass();</span><br><span class="line">test.Test();</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Test</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Test</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">TestClass</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">AttributeUsage(AttributeTargets.Class, AllowMultiple = true, Inherited = true)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestAttribute</span> : <span class="title">Attribute</span> &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸‹å°±ä¼šå‘ç°æ­£ç¡®è¾“å‡ºäº† <code>&quot;Test&quot;</code></p><h3 id="C-è¯Šæ–­åˆ†æå™¨ï¼ˆDiagnosticAnalyzerï¼‰å®è·µ"><a href="#C-è¯Šæ–­åˆ†æå™¨ï¼ˆDiagnosticAnalyzerï¼‰å®è·µ" class="headerlink" title="C# è¯Šæ–­åˆ†æå™¨ï¼ˆDiagnosticAnalyzerï¼‰å®è·µ"></a>C# è¯Šæ–­åˆ†æå™¨ï¼ˆDiagnosticAnalyzerï¼‰å®è·µ</h3><p>æ¯”å¦‚æˆ‘å¸Œæœ› <code>[Test]</code> æ‰€åœ¨çš„ class æ˜¯å¯†å°çš„ï¼Œé‚£ä¹ˆæˆ‘å¯ä»¥åˆ›å»ºä¸€ä¸ªè¯Šæ–­å™¨æ¥åˆ†æï¼Œå½“ä¸æ˜¯ sealed æ—¶æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span> disable RS2008</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Collections.Immutable;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> Microsoft.CodeAnalysis;</span><br><span class="line"><span class="keyword">using</span> Microsoft.CodeAnalysis.CSharp;</span><br><span class="line"><span class="keyword">using</span> Microsoft.CodeAnalysis.CSharp.Syntax;</span><br><span class="line"><span class="keyword">using</span> Microsoft.CodeAnalysis.Diagnostics;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Test.Analysis</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">DiagnosticAnalyzer(LanguageNames.CSharp)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">TestAnalyzer</span> : <span class="title">DiagnosticAnalyzer</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">override</span> ImmutableArray&lt;DiagnosticDescriptor&gt; SupportedDiagnostics =&gt; ImmutableArray.Create(Rule);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> DiagnosticDescriptor Rule = <span class="keyword">new</span> DiagnosticDescriptor(</span><br><span class="line">            id: <span class="string">&quot;TEST001&quot;</span>,</span><br><span class="line">            title: <span class="string">&quot;Test class must be sealed&quot;</span>,</span><br><span class="line">            messageFormat: <span class="string">&quot;class &#x27;&#123;0&#125;&#x27; must be sealed&quot;</span>,</span><br><span class="line">            category: <span class="string">&quot;Test&quot;</span>,</span><br><span class="line">            defaultSeverity: DiagnosticSeverity.Error,</span><br><span class="line">            isEnabledByDefault: <span class="literal">true</span>,</span><br><span class="line">            description: <span class="string">&quot;Test class must be sealed.&quot;</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Initialize</span>(<span class="params">AnalysisContext context</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            context.ConfigureGeneratedCodeAnalysis(GeneratedCodeAnalysisFlags.Analyze | GeneratedCodeAnalysisFlags.ReportDiagnostics);</span><br><span class="line">            context.EnableConcurrentExecution();</span><br><span class="line">            context.RegisterSyntaxNodeAction(AnalyzeSyntax, SyntaxKind.ClassDeclaration);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AnalyzeSyntax</span>(<span class="params">SyntaxNodeAnalysisContext context</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (context.Node <span class="keyword">is</span> <span class="keyword">not</span> ClassDeclarationSyntax classDecl) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> hasTestAttribute = classDecl.AttributeLists</span><br><span class="line">                .SelectMany(al =&gt; al.Attributes)</span><br><span class="line">                .Any(a =&gt; a.Name.ToString() == <span class="string">&quot;Test&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (hasTestAttribute == <span class="literal">false</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> isSealed = classDecl.Modifiers.Any(m =&gt; m.IsKind(SyntaxKind.SealedKeyword));</span><br><span class="line">            <span class="keyword">if</span> (isSealed == <span class="literal">false</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                context.ReportDiagnostic(Diagnostic.Create(SupportedDiagnostics[<span class="number">0</span>], classDecl.GetLocation(), classDecl.Identifier.Text));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå›åˆ°æµ‹è¯•é¡¹ç›®å°è¯• buildï¼Œå°±å¯ä»¥çœ‹åˆ°æœ‰æ¡æŠ¥é”™ï¼š<code>error TEST001: class &#39;TestClass&#39; must be sealed</code></p><h3 id="Rust-å‡½æ•°å®ï¼ˆå£°æ˜å®ï¼‰å®è·µ"><a href="#Rust-å‡½æ•°å®ï¼ˆå£°æ˜å®ï¼‰å®è·µ" class="headerlink" title="Rust å‡½æ•°å®ï¼ˆå£°æ˜å®ï¼‰å®è·µ"></a>Rust å‡½æ•°å®ï¼ˆå£°æ˜å®ï¼‰å®è·µ</h3><blockquote><p>  æˆ‘ä½¿ç”¨çš„æ˜¯æ–°çš„å®å£°æ˜æ–¹å¼ï¼Œæ—§çš„æ–¹å¼æ˜¯ä½¿ç”¨ <code>macro_rules!</code> è¿›è¡Œå£°æ˜</p><p>  <code>#![feature(decl_macro)]</code> éœ€è¦ä½¿ç”¨ Rust çš„ nightly æˆ– beta ç‰ˆæœ¬ :warning:</p></blockquote><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#![feature(decl_macro)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    macros::hello!(world);</span><br><span class="line">    macros::muti_hello!(world, rust, <span class="keyword">macro</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> macros &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">macro</span> <span class="title function_ invoke__">hello</span>($n:ident) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Hello, &#123;&#125;!&quot;</span>, <span class="built_in">stringify!</span>($n));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">macro</span> <span class="title function_ invoke__">muti_hello</span>($( $n:ident ),*$(,)?) &#123;</span><br><span class="line">        $(</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;Hello, &#123;&#125;!&quot;</span>, <span class="built_in">stringify!</span>($n));</span><br><span class="line">        )*</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸‹è§‚å¯Ÿè¾“å‡ºï¼š</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Hello,</span> world!</span><br><span class="line"><span class="built_in">Hello,</span> world!</span><br><span class="line"><span class="built_in">Hello,</span> rust!</span><br><span class="line"><span class="built_in">Hello,</span> macro!</span><br></pre></td></tr></table></figure><h3 id="Rust-è¿‡ç¨‹å®ï¼ˆproc-macroï¼‰å®è·µ"><a href="#Rust-è¿‡ç¨‹å®ï¼ˆproc-macroï¼‰å®è·µ" class="headerlink" title="Rust è¿‡ç¨‹å®ï¼ˆproc-macroï¼‰å®è·µ"></a>Rust è¿‡ç¨‹å®ï¼ˆproc-macroï¼‰å®è·µ</h3><p>Rust å†™è¿‡ç¨‹å®ç±»ä¼¼äº C# çš„å¢é‡ç”Ÿæˆå™¨æˆ–è¯Šæ–­å™¨ï¼Œä¹Ÿæ˜¯éœ€è¦æ–°å»ºä¸€ä¸ª Rust é¡¹ç›®ï¼Œåœ¨æ–°çš„è¿‡ç¨‹å®é¡¹ç›®ä¸­æ·»åŠ  quote, syn ä¾èµ–ï¼Œç„¶åç®€å•å†™ä¸€ä¸ª Hello ç‰¹å¾çš„ derive</p><blockquote><p>  Rust trait ï¼ˆç‰¹å¾ï¼‰ å¯ä»¥ç±»æ¯”äºå…¶ä»–è¯­è¨€çš„ interfaceï¼ˆæ¥å£ï¼‰</p></blockquote><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> proc_macro;</span><br><span class="line"><span class="keyword">use</span> proc_macro::TokenStream;</span><br><span class="line"><span class="keyword">use</span> quote::quote;</span><br><span class="line"><span class="keyword">use</span> syn::&#123;parse::Parse, parse_macro_input, DeriveInput, Token&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[proc_macro_derive(Hello)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">hello_derive</span>(input: TokenStream) <span class="punctuation">-&gt;</span> TokenStream &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">input</span> = parse_macro_input!(input <span class="keyword">as</span> DeriveInput);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">name</span> = &amp;input.ident;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">expanded</span> = quote! &#123;</span><br><span class="line">        <span class="keyword">impl</span> <span class="title class_">Hello</span> <span class="keyword">for</span> #name &#123;</span><br><span class="line">            <span class="keyword">fn</span> <span class="title function_">hello</span>() &#123;</span><br><span class="line">                <span class="built_in">println!</span>(<span class="string">&quot;Hello, &#123;&#125;!&quot;</span>, <span class="built_in">stringify!</span>(#name));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    expanded.<span class="title function_ invoke__">into</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SingleHelloInput</span> &#123;</span><br><span class="line">    from: syn::Ident,</span><br><span class="line">    to: syn::Ident,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HelloInput</span> &#123;</span><br><span class="line">    some_hellos: <span class="type">Vec</span>&lt;SingleHelloInput&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Parse</span> <span class="keyword">for</span> <span class="title class_">HelloInput</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">parse</span>(input: syn::parse::ParseStream) <span class="punctuation">-&gt;</span> syn::<span class="type">Result</span>&lt;<span class="keyword">Self</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">some_hellos</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">        <span class="keyword">while</span> !input.<span class="title function_ invoke__">is_empty</span>() &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">from</span> = input.<span class="title function_ invoke__">parse</span>()?;</span><br><span class="line">            input.parse::&lt;Token![=&gt;]&gt;()</span><br><span class="line">                .<span class="title function_ invoke__">map_err</span>(|e| syn::Error::<span class="title function_ invoke__">new</span>(e.<span class="title function_ invoke__">span</span>(), <span class="string">&quot;Expected `=&gt;`&quot;</span>))?;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">to</span> = input.<span class="title function_ invoke__">parse</span>()?;</span><br><span class="line">            some_hellos.<span class="title function_ invoke__">push</span>(SingleHelloInput &#123; from, to &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(HelloInput &#123; some_hellos &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[proc_macro]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">say_hello</span>(input: TokenStream) <span class="punctuation">-&gt;</span> TokenStream &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">input</span> = parse_macro_input!(input <span class="keyword">as</span> HelloInput);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">hellos</span> = input.some_hellos.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">map</span>(|SingleHelloInput &#123; from, to &#125;| &#123;</span><br><span class="line">        quote! &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;say hello from &#123;&#125; to &#123;&#125;!&quot;</span>, <span class="built_in">stringify!</span>(#from), <span class="built_in">stringify!</span>(#to));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">expanded</span> = quote! &#123;</span><br><span class="line">        #(#hellos)*</span><br><span class="line">    &#125;;</span><br><span class="line">    expanded.<span class="title function_ invoke__">into</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŠŠè¯¥é¡¹ç›®æ·»åŠ åˆ°å¦ä¸€ä¸ªé¡¹ç›®çš„ä¾èµ–ï¼Œå¹¶æµ‹è¯•å®çš„åŠŸèƒ½ï¼š</p><blockquote><p>  <code>hello_derive</code> å®çš„åŠŸèƒ½æ˜¯ç»™ç›®æ ‡å®ç° <code>Hello</code> ç‰¹å¾ï¼ˆå½“ç„¶ï¼Œè¿™å¾—ä½ è‡ªå·±å®šä¹‰ï¼‰ï¼Œäºæ˜¯å¯ä»¥è°ƒç”¨ <code>World::hello()</code> æ–¹æ³•</p><p>  æ³¨æ„:warning: ï¼šæ­¤å¤„ä¸æ˜¯é™æ€æ–¹æ³•ï¼ŒRust å¹¶ä¸èƒ½ç›´æ¥åœ¨ struct ä¸­å®šä¹‰é™æ€æ–¹æ³•ï¼ˆå®é™…ä¸Šä¹Ÿæ²¡æœ‰è¿™ä¸ªæ¦‚å¿µxï¼‰ï¼Œæ­¤å¤„æ˜¯ç”±äº World ç»“æ„ä½“æ²¡æœ‰ä»»ä½•æˆå‘˜ï¼Œæ‰€ä»¥åˆ›å»º World å®ä¾‹å¯ä»¥ç›´æ¥ç®€åŒ–æˆ <code>World</code> ï¼Œè€Œä¸éœ€è¦ <code>World &#123; &#125;</code></p><p>  <code>say_hello</code> å®åˆ™æ˜¯å¯ä»¥æ¥å—ä»»æ„å¤šç»„è¾“å…¥ï¼Œæ¯ä¸€ç»„çš„æ ¼å¼å¿…é¡»æ˜¯ <code>æ ‡è¯†ç¬¦ =&gt; æ ‡è¯†ç¬¦</code> ï¼Œè¯¥å®çš„è§£ææ˜¯è‡ªå®šä¹‰çš„ã€‚</p></blockquote><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> test_macro::&#123;Hello, say_hello&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    World::<span class="title function_ invoke__">hello</span>();</span><br><span class="line">    say_hello!(World =&gt; Rust);</span><br><span class="line">    say_hello! &#123;</span><br><span class="line">        Hacbit =&gt; Rust</span><br><span class="line">        Rust =&gt; Hacbit     My =&gt; ABAB</span><br><span class="line">            My =&gt; Anii</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Hello)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">World</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Hello</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">hello</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Hello, World!</span><br><span class="line"><span class="built_in">say</span> hello <span class="keyword">from</span> World <span class="keyword">to</span> Rust!</span><br><span class="line"><span class="built_in">say</span> hello <span class="keyword">from</span> Hacbit <span class="keyword">to</span> Rust!</span><br><span class="line"><span class="built_in">say</span> hello <span class="keyword">from</span> Rust <span class="keyword">to</span> Hacbit!</span><br><span class="line"><span class="built_in">say</span> hello <span class="keyword">from</span> My <span class="keyword">to</span> ABAB!</span><br><span class="line"><span class="built_in">say</span> hello <span class="keyword">from</span> My <span class="keyword">to</span> Anii!</span><br></pre></td></tr></table></figure><h2 id="C-å’ŒRuståœ¨å…ƒç¼–ç¨‹å®ç°ä¸Šçš„å¼‚åŒ"><a href="#C-å’ŒRuståœ¨å…ƒç¼–ç¨‹å®ç°ä¸Šçš„å¼‚åŒ" class="headerlink" title="C#å’ŒRuståœ¨å…ƒç¼–ç¨‹å®ç°ä¸Šçš„å¼‚åŒ"></a>C#å’ŒRuståœ¨å…ƒç¼–ç¨‹å®ç°ä¸Šçš„å¼‚åŒ</h2><p>çœ‹äº†ä¸Šé¢çš„å‡ ä¸ªç¤ºä¾‹ï¼Œåº”è¯¥å¯¹ä¸¤è€…çš„å…ƒç¼–ç¨‹æœºåˆ¶æœ‰äº†ä¸€å®šçš„å°è±¡ã€‚</p><p>å¯¹äº C# å’Œ Rust çš„ç›¸åŒçš„åœ°æ–¹ï¼ˆè™½ç„¶ä¸Šé¢çš„ä¾‹å­å¯èƒ½æ²¡æœ‰å¾ˆå¥½çš„ä½“ç°ï¼‰ï¼š</p><ul><li>éƒ½æ˜¯æŠŠæºä»£ç è§£ææˆ AST ï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ï¼Œç„¶ååˆ†æèŠ‚ç‚¹å¯¹è±¡</li><li>éœ€è¦é¢å¤–å¼•å…¥åº“é¡¹ç›®ä½œä¸ºç±»ä¼¼ç¼–è¯‘å™¨æ’ä»¶çš„ä¸œè¥¿ï¼Œä»¥æ­¤å®ç°åœ¨ç¼–è¯‘æœŸå¯¹åŸæœ‰ä»£ç çš„åŠŸèƒ½è¿›è¡Œæ‹“å±•</li></ul><p>ä¸è¿‡å·®å¼‚ä¹Ÿååˆ†æ˜¾è‘—ï¼š</p><ul><li>C# æä¾›å¤šä¸ªç®¡é“ï¼ˆæ¯”å¦‚ <code>context.SyntaxProvider</code>ï¼‰æ¥è®¿é—®å„ç§èŠ‚ç‚¹ï¼ˆæ¯”å¦‚ <code>ClassDeclarationSyntax</code>ï¼‰å¯¹è±¡ï¼Œç”Ÿæˆå™¨å¯ä»¥è‡ªå®šä¹‰ç­›é€‰æ¡ä»¶ï¼Œå¹¶åˆ†æç­›é€‰å‡ºæ¥çš„èŠ‚ç‚¹æ¥ç”Ÿæˆç›¸å…³æ‹“å±•ï¼› Rust åˆ™éœ€è¦ç”¨æˆ·æ˜¾ç¤ºçš„å» â€œä½¿ç”¨â€ å®ï¼Œæ¯”å¦‚ <code>#[derive(Hello)]</code> å°±æ˜¯ç›´æ¥æŒ‡å®šäº†å®çš„ä½¿ç”¨ç›®æ ‡ï¼Œå› è€Œæ— éœ€ç­›é€‰ã€‚æ‰€ä»¥å®é™…ä¸Šï¼Œ<strong>C# åœ¨è·å–å…ƒä¿¡æ¯çš„èŒƒå›´æ›´å¹¿ï¼ŒRust åªèƒ½è·å–ç›®æ ‡çš„å…ƒä¿¡æ¯ï¼Œè€Œæ— æ³•å¾—çŸ¥ç›®æ ‡ä»¥å¤–çš„å…ƒä¿¡æ¯ã€‚</strong></li><li>ä½†æ˜¯å¦ä¸€æ–¹é¢ï¼Œ<strong>å—é™äº C# æœ¬èº«çš„è¯­æ³•ï¼ŒC# æ— æ³•æä¾›æ›´ç»†ç²’åº¦çš„æŒ‡ä»¤æµåˆ†æ</strong>ã€‚è€Œ Rust åœ¨è¿™æ–¹é¢å°±ååˆ†çµæ´»ï¼Œå¯ä»¥è‡ªå®šä¹‰ Token æµè§£æå™¨ï¼Œä½ å¯ä»¥æŠŠå„ç§ç¬¦å·ï¼ˆå…è®¸çš„ Tokenï¼‰å¡è¿›çš„å®è§„åˆ™ä¸­ï¼Œè€Œæ— éœ€åœ¨æ„è¯­æ³•ï¼ˆå°±åƒä¸Šé¢çš„ <code>say_hello!</code> é‚£æ ·ï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œ<strong>åœ¨ Rust ä¸­ä½ å¯ä»¥å®šä¹‰è‡ªå·±è¯­æ³•ã€‚</strong></li></ul><p>æ— è®ºæ˜¯ C# çš„ç”Ÿæˆå™¨&#x2F;åˆ†æå™¨ï¼Œè¿˜æ˜¯ Rust çš„å®ï¼Œå…¶å®æ ¸å¿ƒåŒºåˆ«æ— éå°±æ˜¯ä½œç”¨èŒƒå›´çš„ä¸åŒï¼Œä¸€ä¸ªæ˜¯å…¨å±€ï¼Œä¸€ä¸ªæ˜¯å±€éƒ¨ã€‚è€Œç”±è¿™ä¸¤ç‚¹åˆ†æ­§ï¼Œåˆå¾ˆå®¹æ˜“æƒ³åˆ°ï¼ŒC# çš„å…ƒç¼–ç¨‹æœºåˆ¶åªèƒ½è¿›è¡Œ<strong>å¢é‡</strong>ï¼Œæ˜¯ä¸èƒ½å¤Ÿä¿®æ”¹åŸæœ‰ä»£ç çš„ï¼ˆå› ä¸ºç”Ÿæˆå™¨&#x2F;åˆ†æå™¨æ˜¯å¹¶è¡Œçš„ï¼Œè€Œå…ƒä¿¡æ¯ä½œä¸ºå…±äº«èµ„æºï¼Œè‡ªç„¶ä¸èƒ½éšæ„ä¿®æ”¹ï¼‰ï¼›Rust çš„å®ä½œç”¨èŒƒå›´åªæœ‰å±€éƒ¨ï¼Œæ¯ä¸ªå®ä¹‹é—´æ˜¯ç‹¬ç«‹ï¼ˆæˆ–è€…åŒ…å«ï¼‰ï¼Œè€Œä¸ä¼šäº§ç”Ÿäº¤å‰ï¼Œå› è€Œå¯ä»¥<strong>éšæ„ä¿®æ”¹åŸæœ‰é€»è¾‘</strong>ã€‚</p><p>ä¸ç®¡å…·ä½“å®ç°å¦‚ä½•ï¼Œæ¯«æ— ç–‘é—®ä»–ä»¬éƒ½æ˜¯å…·æœ‰ç›¸å½“ç¨‹åº¦å¯å®šåˆ¶åŒ–çš„ï¼Œå¹¶ä¸”ä¹Ÿèƒ½ä¿è¯è¿è¡Œæ—¶æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚ä¸åŒäºåå°„ã€æˆ–è€…è¿è¡Œæ—¶åŠ¨æ€æ‰§è¡Œå­—ç¬¦ä¸²ç­‰è¿è¡Œæ—¶ç‰¹æ€§ï¼Œä»–ä»¬æœ¬è´¨ä¸Šæ˜¯<strong>å°†ä¸€éƒ¨åˆ†è¿è¡Œæ—¶é€»è¾‘æå‰åˆ°ç¼–è¯‘æœŸ</strong>ï¼Œå› è€Œå‡å°‘è¿è¡Œæ—¶çš„æ€§èƒ½æŸè€—ï¼ˆå½“ç„¶ï¼Œè¿™ä¹Ÿæ„å‘³ç€ä½ éœ€è¦ä»˜å‡ºæ›´é•¿ç¼–è¯‘æ—¶é—´çš„ä»£ä»· :laughing: ï¼‰ï¼Œä¹Ÿå°±æ˜¯ Rust ä¸­ç‰¹åˆ«æå€¡çš„<strong>é›¶æˆæœ¬æŠ½è±¡</strong>ã€‚åŒæ—¶ï¼Œç”±äºè¿™äº›ç¼–è¯‘æœŸç‰¹æ€§åªä¼šåœ¨ç¼–è¯‘æœŸäº§ç”Ÿä½œç”¨ï¼Œå°±ä¸ä¼šæœ‰è¿è¡Œæ—¶ç‰¹æ€§é‚£æ ·æ½œåœ¨çš„æ³¨å…¥æ¼æ´ç­‰å®‰å…¨é£é™©ã€‚ï¼ˆé™¤éé»‘å®¢èƒ½å¤Ÿæ§åˆ¶ä½ çš„ç¼–è¯‘ç®¡çº¿ x :laughing: ï¼‰</p><h2 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h2><p>æœ‰ä»€ä¹ˆæ¯”è¾ƒåˆé€‚çš„ä½¿ç”¨åœºæ™¯å‘¢ï¼Ÿ</p><p>æŒ‰ç…§æˆ‘çš„ç»éªŒå¯èƒ½å¾€å¾€æ˜¯ç”¨æ¥åŠ¨æ€å®ç°ä¸€äº›æ¥å£ï¼Œå‡½æ•°ä¹‹ç±»çš„ã€‚ä¸è¿‡è¿™ä¸ªåº”è¯¥æ›´å®¹æ˜“åœ¨ Rust ä¸­å®ç°ï¼ˆä¹Ÿååˆ†è‡ªç„¶ï¼‰ï¼Œå› ä¸º Rust çš„ <code>struct</code> å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹å»å®ç°æ–°åŠŸèƒ½ï¼Œåªéœ€è¦å®šä¹‰ä¸€ä¸ªæ–°çš„ <code>trait</code> ï¼ˆå¦‚æœæ˜¯åœ¨è¯¥ <code>struct</code> å®šä¹‰æ‰€åœ¨çš„æ¨¡å—ä¹‹å¤–ï¼‰ã€‚è€Œæ”¾åœ¨ C# å°±æœ‰ç‚¹éº»çƒ¦ï¼Œé€šå¸¸æˆ‘ä»¬ä¸å¾—ä¸éœ€è¦å¼ºåˆ¶ç”¨æˆ·ä½¿ç”¨ <code>partial</code> å…³é”®å­—ï¼Œå¹¶ä¸”ä¹Ÿæ— æ³•å¯¹ä¸€äº›å†…ç½®çš„ï¼ˆæˆ–ç¬¬ä¸‰æ–¹åº“ä¸­çš„ï¼‰ç±»å‹è¿›è¡Œæ›´å¤§é™åº¦çš„æ‹“å±•ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸èƒ½ç»™ <code>int</code> æ·»åŠ æ–°çš„æ¥å£å®ç°ã€‚</p><p>ç”Ÿæˆä¸€äº›æ¡¥æ¥ä»£ç å¯èƒ½æ˜¯ä¸é”™çš„é€‰æ‹©ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³è¦åœ¨ c ç«¯å’Œ s ç«¯äº¤æ¢æ•°æ®ï¼Œé‚£ä¹ˆè‚¯å®šéœ€è¦å¯¹ä¸¤ç«¯çš„æ•°æ®ç»“æ„è¿›è¡Œä¸€ä¸ªé€‚é…ï¼Œè¿™æ—¶å€™å°±å¯ä»¥æ ¹æ®é…ç½®åŠ¨æ€ç”Ÿæˆï¼›æˆ–è€…æ˜¯æƒ³è¦å’Œå…¶ä»–è¯­è¨€èµ° FFIï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥é€šè¿‡å…ƒç¼–ç¨‹æœºåˆ¶ç”Ÿæˆç›¸å…³ä»£ç ï¼ˆæ¯”å¦‚ pyo3 é¡¹ç›®å¯¹ Rust å’Œ Python çš„ FFI é€šä¿¡çš„å¤„ç†ï¼‰ã€‚</p><p>ä¸è¿‡ C# çš„è¯Šæ–­å™¨ç¡®å®æ˜¯ä¸ªå¾ˆæœ‰æ„æ€çš„ä¸œè¥¿ï¼Œå¤©ç„¶é€‚åˆå†™æ¡†æ¶ã€‚æ¯•ç«Ÿå¯ä»¥å…¨å±€æ£€æŸ¥ä½ çš„ä»£ç ï¼Œå¹¶ä¸”æ·»åŠ å„ç§çº¦æŸï¼Œä»¥å‡å°‘ä½¿ç”¨æ¡†æ¶æ—¶çš„æœªå®šä¹‰è¡Œä¸ºï¼Œæ‰€ä»¥å¦‚æœå»ç¿»å„ç§ç¬¬ä¸‰æ–¹åº“ï¼Œä»–ä»¬å¤§å¤šéƒ½ä¼šå†™ä¸€äº› Analyzer ã€‚Rust çš„ç¡®åšä¸äº†è¿™å—ï¼ŒåŸå› å¦‚å‰æ–‡æ‰€è¿°ï¼ŒRust ä¸æä¾›èƒ½å¤Ÿç›´æ¥è®¿é—®å…¨å±€è¯­æ³•æ ‘çš„ APIï¼Œä¸è¿‡ Rust æœ¬èº«ä¹Ÿæœ‰ rust-analyzer ï¼Œè¿˜å¯ä»¥é…åˆ cargo-clippyï¼Œå› æ­¤å¯¹äºä»£ç æœ¬èº«çš„æ£€æŸ¥ä¹Ÿå¾ˆä¸¥æ ¼å°±æ˜¯äº†ï¼ˆï¼‰</p><h2 id="å†™åœ¨åé¢"><a href="#å†™åœ¨åé¢" class="headerlink" title="å†™åœ¨åé¢"></a>å†™åœ¨åé¢</h2><p>è¦æˆ‘è¯´çš„è¯ï¼Œè‚¯å®šæ˜¯ Rust çš„æœºåˆ¶å†™çš„æ›´çˆ½ï¼ˆï¼‰ï¼Œæ¯•ç«Ÿå¯ä»¥è‡ªå®šä¹‰è¯­æ³•æ¬¸ï¼Œè¶…å¸…çš„å§ï¼</p><p>Rust ç‹¬ç«‹å¼€å‘çš„è¯ï¼Œéšä¾¿å†™ç‚¹å®è‡ªå¨±è‡ªä¹å…¶å®æŒºæœ‰è¶£çš„ï¼Œä¹‹å‰ä¹Ÿå†™è¿‡ä¸€äº›<del>å¥‡å¥‡æ€ªæ€ªçš„</del>åŠŸèƒ½ï¼Œæ¯”å¦‚ä½¿ç”¨å®åŠ è½½ json æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆ enumã€‚ï¼ˆC# å½“ç„¶ä¹Ÿå¾ˆå®¹æ˜“å®ç°ï¼‰</p><p>ç”±äºæˆ‘æ˜¯ Rust å‡ºèº«ï¼Œä»£ç é£æ ¼æå¤§ç¨‹åº¦å—åˆ°äº† Rust è®¾è®¡å“²å­¦çš„å½±å“ï¼Œåœ¨ä½¿ç”¨ C# çš„æ—¶å€™ï¼Œè¯´å®è¯å¤šæ¬¡å°è¯•å°†ä¸€äº› Rust ç‰¹æ€§åœ¨ C# ä¸­å®ç°ï¼ˆï¼‰ï¼Œä¸è¿‡ç¡®å®æœ‰ç‚¹éº»çƒ¦ï¼Œç‰¹åˆ«æ˜¯æˆ‘æƒ³è¦å®ç°ç±»ä¼¼è¿‡ç¨‹å®çš„ä¸œè¥¿æ—¶å€™é‡åˆ°äº†å¾ˆå¤§çš„é˜»ç¢ï¼ˆä¸€å¤§ç†ç”±å°±æ˜¯ C# ä¸å…è®¸ç”¨æˆ·è‡ªå·±åˆ†æ TokenStreamï¼Œä½¿å¾—ä¸å¯èƒ½åƒ Rust é‚£æ ·è‡ªç”±ï¼‰ï¼Œæˆ‘å°è¯•çš„ä¸€ä¸ªæ€è·¯æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²ï¼Œç„¶åæˆ‘å°±è‡ªå·±è®¾è®¡è¯­æ³•ï¼ˆå‚è€ƒ Rustï¼‰ï¼Œæ“äº†è¯æ³•åˆ†æï¼Œè¯­æ³•åˆ†æã€‚ä¸è¿‡è¯è¯´å›æ¥ï¼Œè¿™æ ·å°±ä¸åƒæ˜¯ C#ï¼Œå›ºç„¶äººå®¶ Lispï¼ŒRust å¯ä»¥è®¾è®¡è‡ªå·±çš„è¯­æ³•ï¼Œä½†æ˜¯ä»–ä»¬éƒ½è¿˜æ˜¯ Lispï¼ŒRustï¼Œè€Œ C# æ—¢ç„¶æœ¬èº«è®¾è®¡å“²å­¦å°±æ˜¯è¿™æ ·ï¼Œå¼ºè¡Œæ”¹å˜å†™æ³•åªä¼šæ˜¾å¾—æŠ½è±¡å’Œä¸‘é™‹ã€‚</p><p>å½“ç„¶ Rust å’Œ C# éƒ½æ˜¯æå…¶ä¼˜ç§€çš„è¯­è¨€ï¼Œå†™å·¥ç¨‹ç¡®å®èˆ’æœã€‚<del>ï¼ˆå ä¸ªç”²ï¼‰</del></p><p>ä¸çŸ¥é“çœ‹æœ¬ç¯‡æ–‡ç« çš„è¯»è€…æœ‰æ²¡æœ‰ç©è¿‡æ‰€å­¦è¯­è¨€çš„å…ƒç¼–ç¨‹æœºåˆ¶ï¼Œå¦‚æœæœ¬æ–‡ç»™ä½ æ‰“å¼€äº†ä¸€æ‰‡æ–°ä¸–ç•Œçš„å¤§é—¨<del>ï¼ˆå¤§æ¦‚ä¸æ˜¯æ·±æ¸Šå§ï¼‰</del>ï¼Œå°†æ˜¯æˆ‘çš„è£å¹¸ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://blog.hacbit.net/categories/%E6%9D%82%E8%AE%B0/">æ‚è®°</category>
      
      
      <category domain="https://blog.hacbit.net/tags/Rust/">Rust</category>
      
      <category domain="https://blog.hacbit.net/tags/CSharp/">CSharp</category>
      
      
      <comments>https://blog.hacbit.net/%E6%B5%85%E8%B0%88CSharp%E4%B8%8ERust%E7%9A%84%E5%85%83%E7%BC%96%E7%A8%8B%E6%9C%BA%E5%88%B6/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>åœ¨Unityä¸­è§£æ”¾é«˜ç‰ˆæœ¬C#ç‰¹æ€§</title>
      <link>https://blog.hacbit.net/%E5%9C%A8Unity%E4%B8%AD%E8%A7%A3%E6%94%BE%E9%AB%98%E7%89%88%E6%9C%ACCS%E7%89%B9%E6%80%A7/</link>
      <guid>https://blog.hacbit.net/%E5%9C%A8Unity%E4%B8%AD%E8%A7%A3%E6%94%BE%E9%AB%98%E7%89%88%E6%9C%ACCS%E7%89%B9%E6%80%A7/</guid>
      <pubDate>Mon, 24 Feb 2025 14:10:35 GMT</pubDate>
      
      <description>&lt;p&gt;ä¹‹å‰æˆ‘åœ¨çŸ¥ä¹é—®è¿‡ç›¸å…³é—®é¢˜ï¼Œåé¢å‚è€ƒäº†å‡ ä¸ªçŸ¥å‹çš„å›ç­”ï¼Œå€Ÿé‰´äº†ä¸€äº›é¡¹ç›®ï¼Œä¹Ÿç®—æ˜¯åŸºæœ¬è§£å†³äº†è¿™ä¸ªé—®é¢˜&lt;/p&gt;
&lt;p&gt;ä¹Ÿé¡ºä¾¿é™„ä¸Šæˆ‘çš„çŸ¥ä¹å›ç­”ï¼š&lt;a href=&quot;https://www.zhihu.com/question/11672499668/answer/103930816515&quot;&gt;https://www.zhihu.com/question/11672499668/answer/103930816515&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯å…³äºå¦‚ä½•åœ¨ Unity ä¸­ä½¿ç”¨&lt;strong&gt;æ›´é«˜ç‰ˆæœ¬çš„ C# ç‰¹æ€§&lt;/strong&gt;çš„è¯¦ç»†è§£å†³åŠæ³•ï¼ˆ&lt;strong&gt;å…·æœ‰ä¸€å®šå±€é™æ€§&lt;/strong&gt;ï¼‰&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>ä¹‹å‰æˆ‘åœ¨çŸ¥ä¹é—®è¿‡ç›¸å…³é—®é¢˜ï¼Œåé¢å‚è€ƒäº†å‡ ä¸ªçŸ¥å‹çš„å›ç­”ï¼Œå€Ÿé‰´äº†ä¸€äº›é¡¹ç›®ï¼Œä¹Ÿç®—æ˜¯åŸºæœ¬è§£å†³äº†è¿™ä¸ªé—®é¢˜</p><p>ä¹Ÿé¡ºä¾¿é™„ä¸Šæˆ‘çš„çŸ¥ä¹å›ç­”ï¼š<a href="https://www.zhihu.com/question/11672499668/answer/103930816515">https://www.zhihu.com/question/11672499668/answer/103930816515</a></p><p>ä»¥ä¸‹æ˜¯å…³äºå¦‚ä½•åœ¨ Unity ä¸­ä½¿ç”¨<strong>æ›´é«˜ç‰ˆæœ¬çš„ C# ç‰¹æ€§</strong>çš„è¯¦ç»†è§£å†³åŠæ³•ï¼ˆ<strong>å…·æœ‰ä¸€å®šå±€é™æ€§</strong>ï¼‰</p><span id="more"></span><h2 id="Comfirm-the-C-version-that-Unity-supports"><a href="#Comfirm-the-C-version-that-Unity-supports" class="headerlink" title="Comfirm the C# version that Unity supports"></a>Comfirm the C# version that Unity supports</h2><p>å…³äºä½ çš„ unity editor <strong>æœ¬èº«èƒ½å¤Ÿæ”¯æŒ</strong>åˆ°å¤šé«˜çš„ C# ç‰ˆæœ¬ï¼Œä»¥æˆ‘çš„ unity 2022.3.52f1c1 ä¸ºä¾‹ï¼Œå» unity editor æ‰€åœ¨çš„ç›®å½•ä¸‹é¢è¿™ä¸ªè·¯å¾„ï¼Œæ‰“å¼€ README é‡Œé¢æœ‰ dotnet sdk ç‰ˆæœ¬</p><img src="/%E5%9C%A8Unity%E4%B8%AD%E8%A7%A3%E6%94%BE%E9%AB%98%E7%89%88%E6%9C%ACCS%E7%89%B9%E6%80%A7/dotnet_sdk.png" alt="dotnet_sdk" style="zoom: 67%;"><p>ç„¶åå»å®˜æ–¹æœç´¢ä¸€ä¸‹è¯¥ç‰ˆæœ¬çš„ç›¸å…³ä¿¡æ¯ï¼š</p><img src="/%E5%9C%A8Unity%E4%B8%AD%E8%A7%A3%E6%94%BE%E9%AB%98%E7%89%88%E6%9C%ACCS%E7%89%B9%E6%80%A7/sdk_search.png" alt="sdk_search" style="zoom: 67%;"><p>å‘ç°å¯ä»¥æ”¯æŒåˆ° C#10ï¼Œåœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼ŒC#å¤„äºå¯é¢„è§ˆçŠ¶æ€ï¼Œå¦‚æœæ˜¯ä¸€èˆ¬çš„ cs é¡¹ç›®ï¼ˆä½¿ç”¨è¯¥ sdkï¼‰ï¼Œå¯ä»¥ç›´æ¥åœ¨ csproj æŒ‡å®š <code>&lt;LangVersion&gt;preview&lt;/LangVersion&gt;</code>  æ¥ä½¿ç”¨éƒ¨åˆ†çš„ C#11 ç‰¹æ€§ã€‚</p><p>ä½†æ˜¯ Unity ä¸­çš„æ‰€è°“ C# é¡¹ç›®å¹¶ä¸æ˜¯è¿™ä¹ˆä¸€å›äº‹ï¼Œé¡¹ç›®æ ¹ç›®å½•é‡Œé¢çš„ä¸€å † .csproj æ–‡ä»¶ï¼Œåªæ˜¯ Unity è‡ªåŠ¨ç”Ÿæˆç»™ IDE çœ‹çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç”¨ Riderï¼ŒVSCode ä¹‹ç±»çš„ IDE æ‰“å¼€é¡¹ç›®åèƒ½è¿›è¡Œè§£æï¼ˆï¼‰</p><h2 id="Unity-Compile"><a href="#Unity-Compile" class="headerlink" title="Unity Compile"></a>Unity Compile</h2><p>åœ¨<a href="https://docs.unity3d.com/2022.3/Documentation/Manual/CSharpCompiler.html">å®˜æ–¹æ‰‹å†Œ</a>é‡Œé¢æœ‰å…³äºè¿™ä¸ªçš„è¯´æ˜ï¼šUnity editor ä¼šæŒ‡å®šé»˜è®¤çš„ç¼–è¯‘é€‰é¡¹ç»™åç«¯çš„ Roslyn ç¼–è¯‘å™¨ï¼ˆä¹Ÿå°±æ˜¯C#ç‰ˆæœ¬æŒ‡å®š 9.0ï¼‰</p><img src="/%E5%9C%A8Unity%E4%B8%AD%E8%A7%A3%E6%94%BE%E9%AB%98%E7%89%88%E6%9C%ACCS%E7%89%B9%E6%80%A7/compiler.png" alt="compiler" style="zoom:67%;"><p>ä¸è¿‡åé¢ä¹Ÿè¯´æ˜äº†å¯ä»¥ä¼ é€’åˆ«çš„å‚æ•°ï¼ˆï¼‰ï¼Œäºæ˜¯å¯ä»¥åœ¨<a href="https://docs.unity3d.com/2022.3/Documentation/Manual/CustomScriptingSymbols.html">è¿™ç¯‡æ–‡ç« </a>æ‰¾åˆ°ç­”æ¡ˆï¼Œç”¨æˆ·å¯ä»¥åœ¨ Assets&#x2F; ç›®å½•ä¸‹æ·»åŠ  csc.rsp æ–‡ä»¶æ¥æŒ‡å®šç¼–è¯‘å‚æ•°ï¼Œæ–‡æ¡£ç»™çš„ä¾‹å­æ˜¯åœ¨ .rsp æ–‡ä»¶é‡Œé€šè¿‡ <code>-define:XXXX</code> æ¥å®šä¹‰å®ï¼Œç”¨ä»¥æ¡ä»¶ç¼–è¯‘ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬æ˜¾ç„¶èƒ½ç©ç‚¹åˆ«çš„ä¸œè¥¿ï¼Œæ¯”å¦‚æŒ‡å®š <code>-langversion</code> ï¼ŒæŒ‰ç…§å‰æ–‡çš„æ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥å¯ç”¨ C#11 çš„éƒ¨åˆ†ç‰¹æ€§ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>csc.rsp</code> æ–‡ä»¶æ”¾åœ¨ <strong>Assets&#x2F; ç›®å½•</strong>ä¸‹ï¼ˆ<strong>æˆ–è€…ä½ çš„ç¨‹åºé›†çš„åŒç›®å½•</strong>ï¼‰ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-langversion:preview -<span class="literal">null</span>able</span><br></pre></td></tr></table></figure><p>è¿™äº›æŒ‡ä»¤æ˜¯å°†è¯­è¨€ç‰ˆæœ¬<strong>è®¾ç½®ä¸ºé¢„è§ˆçŠ¶æ€</strong>ï¼Œç„¶å<strong>å¯ç”¨nullableç¼–è¯‘</strong></p><blockquote><p>  å…³äºåè€…ï¼Œä½ å¯ä»¥åœ¨ä»£ç ä¸­ä½¿ç”¨  ? æ¥å£°æ˜ä¸€ä¸ªç±»å‹<strong>å¯ä¸º null</strong>ï¼Œæ¯”å¦‚ï¼š</p>  <figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> Example</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">int</span>? ValueInt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  å¦‚æœä¸å¯ç”¨çš„ nullableï¼Œä½¿ç”¨ ï¼Ÿ ä¼šè­¦å‘Šä½  â€œéœ€è¦åœ¨ #nullable çš„ä¸Šä¸‹æ–‡ä½¿ç”¨â€ã€‚</p></blockquote><p>ç„¶åä½ å¯ä»¥åœ¨ä½ çš„è„šæœ¬é‡Œé¢ä½¿ç”¨ C#11 çš„ç‰¹æ€§ï¼Œ<strong>å›åˆ° UnityEditor ä¸­</strong>çœ‹çœ‹èƒ½ä¸èƒ½é€šè¿‡ç¼–è¯‘ã€‚ä»¥ä¸‹æ˜¯ä¸€æ®µç®€å•çš„æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> DefaultValue</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// set default value in struct field</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Value = <span class="number">114514</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> NonArgConstructor</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// struct constructor with no-args</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NonArgConstructor</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">Value = <span class="string">&quot;1145141919810&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ ä½¿ç”¨çš„è¾ƒæ–°çš„ unity 2022.3 ï¼ˆ&gt;&#x3D; 2022.3.12f1ï¼‰é‚£ä¹ˆè¿™æ®µä»£ç æ˜¯å¯ä»¥é€šè¿‡ç¼–è¯‘çš„ï¼ˆå½“ç„¶ä½ ä¹Ÿå¯ä»¥æ•´ä¸ª mono ç±»å»åˆ›å»ºè¿™ä¸¤ä¸ª struct è¾“å‡ºç¡®è®¤æ˜¯å¦çœŸçš„è®¾ç½®æˆäº†æŒ‡å®šçš„é»˜è®¤å€¼ï¼‰</p><p>ä¸è¿‡ä½ åœ¨ç¼–å†™ä¸Šè¿°ä»£ç çš„æ—¶å€™ï¼ŒIDE é‡Œé¢ä¸€å®šæ˜¯ä¸€ç‰‡çˆ†çº¢å§ :laughing: ã€‚</p><p>ä¸ç”¨æ‹…å¿ƒï¼Œè®© csproj æ¥æ•‘ä½ ï¼ˆx</p><h2 id="Change-csproj-files"><a href="#Change-csproj-files" class="headerlink" title="Change .csproj files"></a>Change .csproj files</h2><p>åœ¨å‰é¢æœ‰è¯´è¿‡ï¼ŒUnity é¡¹ç›®æ ¹ç›®å½•çš„ .csproj æ–‡ä»¶éƒ½æ˜¯ç»™ IDE çœ‹çš„ï¼Œä½ å¯ä»¥éšä¾¿æ‰“å¼€ä¸€ä¸ª .csproj æ–‡ä»¶ï¼Œé‡Œé¢åº”è¯¥å¾ˆå®¹æ˜“æ‰¾åˆ°ä¸€è¡Œå†…å®¹æ˜¯ï¼š<code>&lt;LangVersion&gt;9.0&lt;/LangVersion&gt;</code></p><p>è¿™ä¼šå¯¼è‡´ä½ çš„ IDE ä¼šè®¤ä¸ºä½ çš„é¡¹ç›®ä½¿ç”¨ C#9 ï¼Œæ‰€ä»¥å‰é¢ç¼–å†™ C#11 çš„ä»£ç çš„æ—¶å€™è‡ªç„¶æ˜¯ä¼šæŠ¥é”™çš„å•¦ï¼ˆï¼‰ï¼Œä½ å¯ä»¥æ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹æ–‡ä»¶è¯•è¯•ã€‚</p><p>å°è¯•å°†ä½ çš„ <code>Assembly-CSharp.csproj</code>  æ–‡ä»¶é‡Œé¢çš„ langversion é‚£ä¸€è¡Œæ”¹æˆ <code>&lt;LangVersion&gt;preview&lt;/LangVersion&gt;</code></p><blockquote><p>  å¦‚æœä½ ä½¿ç”¨ç¨‹åºé›†ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ª <code>My.Test.asmdef</code> çš„ç¨‹åºé›†ï¼Œé‚£ä¹ˆ UnityEditor ä¼šè‡ªåŠ¨ç»™è¿™ä¸ªç¨‹åºé›†ç”Ÿæˆä¸€ä¸ª <code>My.Test.csproj</code> ï¼ˆå½“ç„¶ä¹Ÿæ˜¯åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼‰ï¼Œé‚£ä¹ˆ IDE å¯¹è¯¥ç¨‹åºé›†ä¸­çš„ä»£ç çš„è§£æï¼Œå°±ä¼šå—åˆ° <code>My.Test.csproj</code> çš„å½±å“ï¼Œè¿™æ—¶å€™éœ€è¦å»ä¿®æ”¹ <code>My.Test.csproj</code> é‡Œé¢çš„ langversion é€‰é¡¹äº†ï¼ˆï¼‰</p></blockquote><p>å›åˆ°ä½ çš„ IDE é‡Œé¢åº”è¯¥å°±ä¸ä¼šæŠ¥é”™äº†ã€‚</p><p>å½“ç„¶æ¯æ¬¡ç¼–è¯‘åï¼Œunity éƒ½ä¼šé‡æ–°ç”Ÿæˆä¸€éï¼Œæ‰€ä»¥å»ºè®®å†™ä¸ªè„šæœ¬ï¼Œè¯»å– csprojï¼Œ ç„¶åä¿®æ”¹ç›¸å…³çš„é€‰é¡¹ï¼Œç„¶åå¯ä»¥ç›‘å¬ <code>compilationFinished</code> äº‹ä»¶è‡ªåŠ¨æ‰§è¡Œã€‚</p><h2 id="Some-lunatic-ideas-for-higher-version-P-S"><a href="#Some-lunatic-ideas-for-higher-version-P-S" class="headerlink" title="Some lunatic ideas for higher version (P.S.)"></a>Some lunatic ideas for higher version (P.S.)</h2><p>è¿˜æœ‰ä¸€äº›æœ¬äººæ²¡æœ‰å®è·µè¿‡çš„æƒ³æ³•ï¼Œæœ‰äº›å·²ç»è¢«åˆ«äººå°è¯•è¿‡ï¼Œæœ‰äº›ä¸ç¡®å®šæœ‰æ²¡æœ‰äººè¯•è¿‡ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç©ç© :laughing:</p><ul><li>å¼€ä¸€ä¸ª C# é¡¹ç›®ï¼Œç›®æ ‡æ¡†æ¶è®¾ç½® <code>&lt;TargetFramework&gt;netstandard2.1&lt;/TargetFramework&gt;</code>ï¼Œç„¶åè¯­è¨€ç‰ˆæœ¬è®¾ç½® <code>&lt;TargetFramework&gt;latest&lt;/TargetFramework&gt;</code> ï¼Œåº”è¯¥èƒ½å¤Ÿä½¿ç”¨åˆ° C#12 ç”šè‡³æ›´é«˜çš„ç‰¹æ€§ï¼Œå½“ç„¶éƒ¨åˆ†ç‰¹æ€§å¯èƒ½ç¼ºå°‘é¢„å®šä¹‰ç±»ï¼Œå¯ä»¥é€šè¿‡ PolySharp æ¥è¡¥å……ï¼ˆï¼‰ï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒ R3 é¡¹ç›®ã€‚</li><li>ä¿®æ”¹ä½ çš„ Unity Editor çš„ Roslyn ç¼–è¯‘å™¨ä¾èµ–çš„ SDK ç‰ˆæœ¬ï¼ˆï¼Ÿï¼‰ï¼ˆå¦‚æœè¦å°è¯•å»ºè®®å¤‡ä»½ä¸€ä¸‹ï¼‰</li></ul>]]></content:encoded>
      
      
      <category domain="https://blog.hacbit.net/categories/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">æ¸¸æˆå¼€å‘</category>
      
      
      <category domain="https://blog.hacbit.net/tags/Unity/">Unity</category>
      
      <category domain="https://blog.hacbit.net/tags/Tutorial/">Tutorial</category>
      
      <category domain="https://blog.hacbit.net/tags/CSharp/">CSharp</category>
      
      
      <comments>https://blog.hacbit.net/%E5%9C%A8Unity%E4%B8%AD%E8%A7%A3%E6%94%BE%E9%AB%98%E7%89%88%E6%9C%ACCS%E7%89%B9%E6%80%A7/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>CSharpå®ç°å¼ºåˆ¶ç±»å‹é™å®š</title>
      <link>https://blog.hacbit.net/CSharp%E5%AE%9E%E7%8E%B0%E5%BC%BA%E5%88%B6%E7%B1%BB%E5%9E%8B%E9%99%90%E5%AE%9A/</link>
      <guid>https://blog.hacbit.net/CSharp%E5%AE%9E%E7%8E%B0%E5%BC%BA%E5%88%B6%E7%B1%BB%E5%9E%8B%E9%99%90%E5%AE%9A/</guid>
      <pubDate>Sat, 15 Feb 2025 05:43:43 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;CSharp-å®ç°å¼ºåˆ¶ç±»å‹é™å®š&quot;&gt;&lt;a href=&quot;#CSharp-å®ç°å¼ºåˆ¶ç±»å‹é™å®š&quot; class=&quot;headerlink&quot; title=&quot;CSharp å®ç°å¼ºåˆ¶ç±»å‹é™å®š&quot;&gt;&lt;/a&gt;CSharp å®ç°å¼ºåˆ¶ç±»å‹é™å®š&lt;/h1&gt;&lt;p&gt;ä¹‹å‰å¶ç„¶æœ‰äº›çµæ„Ÿï¼Œæƒ³ç€å¦‚æœé‡åˆ°äº†å¦‚ä¸‹æƒ…æ™¯ï¼Œéœ€è¦æ­¤å¤„çš„ object åªèƒ½æ˜¯æŸç§ç‰¹å®šç±»å‹ï¼Œæ¯”å¦‚å®ç°äº† &lt;code&gt;ITestInterface&lt;/code&gt; è¿™ä¸ªæ¥å£ï¼Œé‚£ä¹ˆå¤§æ¦‚ä¼šå†™æˆä¸‹é¢è¿™æ ·ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight cs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Method&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;object&lt;/span&gt; obj&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (obj &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; ITestInterface target)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// ...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;è¿™æ ·åšè‡ªç„¶æ²¡å•¥é—®é¢˜ï¼Œä½†æ˜¯åªæœ‰åˆ°è¿è¡Œæ—¶æ‰çŸ¥é“ obj çš„ç±»å‹åˆ°åº•ç¬¦ä¸ç¬¦åˆè¦æ±‚ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½æŠŠ&lt;strong&gt;æ£€æŸ¥æå‰åˆ°ç¼–è¯‘æœŸ&lt;/strong&gt;å‘¢ï¼Ÿä¹Ÿå°±æ˜¯åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™å°±èƒ½å¤Ÿå¾ˆå¤§ç¨‹åº¦é¿å…ä½¿ç”¨ä¸åˆè¦æ±‚çš„ç±»å‹ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äº C# æ¥è¯´ï¼Œå…¶å®å¯ä»¥å†™ä¸€ä¸ªè¯Šæ–­åˆ†æå™¨æ¥å®ç°ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;  ä»¥ä¸‹ä½¿ç”¨ Unity 2022.3 å¯¹åº”çš„ç¯å¢ƒ&lt;/p&gt;
&lt;/blockquote&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="CSharp-å®ç°å¼ºåˆ¶ç±»å‹é™å®š"><a href="#CSharp-å®ç°å¼ºåˆ¶ç±»å‹é™å®š" class="headerlink" title="CSharp å®ç°å¼ºåˆ¶ç±»å‹é™å®š"></a>CSharp å®ç°å¼ºåˆ¶ç±»å‹é™å®š</h1><p>ä¹‹å‰å¶ç„¶æœ‰äº›çµæ„Ÿï¼Œæƒ³ç€å¦‚æœé‡åˆ°äº†å¦‚ä¸‹æƒ…æ™¯ï¼Œéœ€è¦æ­¤å¤„çš„ object åªèƒ½æ˜¯æŸç§ç‰¹å®šç±»å‹ï¼Œæ¯”å¦‚å®ç°äº† <code>ITestInterface</code> è¿™ä¸ªæ¥å£ï¼Œé‚£ä¹ˆå¤§æ¦‚ä¼šå†™æˆä¸‹é¢è¿™æ ·ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Method</span>(<span class="params"><span class="built_in">object</span> obj</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (obj <span class="keyword">is</span> ITestInterface target)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·åšè‡ªç„¶æ²¡å•¥é—®é¢˜ï¼Œä½†æ˜¯åªæœ‰åˆ°è¿è¡Œæ—¶æ‰çŸ¥é“ obj çš„ç±»å‹åˆ°åº•ç¬¦ä¸ç¬¦åˆè¦æ±‚ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½æŠŠ<strong>æ£€æŸ¥æå‰åˆ°ç¼–è¯‘æœŸ</strong>å‘¢ï¼Ÿä¹Ÿå°±æ˜¯åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™å°±èƒ½å¤Ÿå¾ˆå¤§ç¨‹åº¦é¿å…ä½¿ç”¨ä¸åˆè¦æ±‚çš„ç±»å‹ã€‚</p><p>å¯¹äº C# æ¥è¯´ï¼Œå…¶å®å¯ä»¥å†™ä¸€ä¸ªè¯Šæ–­åˆ†æå™¨æ¥å®ç°ã€‚</p><blockquote><p>  ä»¥ä¸‹ä½¿ç”¨ Unity 2022.3 å¯¹åº”çš„ç¯å¢ƒ</p></blockquote><span id="more"></span><h2 id="ç¼–å†™ä¹‹å‰"><a href="#ç¼–å†™ä¹‹å‰" class="headerlink" title="ç¼–å†™ä¹‹å‰"></a>ç¼–å†™ä¹‹å‰</h2><p>é‚£ä¹ˆæŒ‰ç…§æˆ‘çš„ä¸ªäººä¹ æƒ¯ã€‚è¿™é‡Œå…ˆå®šä¹‰ä¸€ä¸ª <code>TypeConstraintAttribute</code> ï¼Œè¦æ³¨æ„ç”±äºæ˜¯ç»™å‚æ•°åšä¸€ä¸ªé™å®šï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦æŒ‡å®šè¿™ä¸ª attribute çš„ç›®æ ‡ä¸º <code>Parameter</code> ï¼Œåé¢çš„ä¸¤ä¸ªä¸€èˆ¬éƒ½æ˜¯è®¾ç½® <code>false</code> å°±è¡Œäº†ã€‚</p><blockquote><p>  è¿™é‡Œ <code>AllowMultiple</code> å¯ä»¥è€ƒè™‘è®¾ç½®æˆ trueï¼ˆä¹Ÿå°±æ˜¯ä¸€ä¸ªå‚æ•°å¯ä»¥æŒ‚å¤šä¸ª <code>[TypeConstraint]</code> ï¼‰ï¼Œç†ç”±åé¢å†è¯´ï¼ˆ</p></blockquote><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">AttributeUsage(AttributeTargets.Parameter, AllowMultiple = false, Inherited = false)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">TypeConstraintAttribute</span> : <span class="title">Attribute</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Type[] Constraints &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TypeConstraintAttribute</span>(<span class="params"><span class="keyword">params</span> Type[] constraints</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Constraints = constraints;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åªå®šä¹‰ attr è‡ªç„¶æ˜¯æ²¡å•¥ç”¨çš„ï¼Œä¸€èˆ¬å¯èƒ½ä¼šç»å¸¸é…åˆåå°„ï¼Œæºç”Ÿæˆå™¨ï¼Œåˆ†æå™¨ä¹‹ç±»çš„æ¥ç”¨ã€‚</p><blockquote><p>  æ ¹æ® Unity å®˜æ–¹æ‰‹å†Œä¸­çš„è¯´æ˜ï¼Œå¯¹äº Unity2022.3 çš„ editorï¼Œä½¿ç”¨çš„æºç”Ÿæˆå™¨é¡¹ç›®ç›®æ ‡æ¡†æ¶éœ€è¦æ˜¯ <code>netstandard2.0</code> ï¼Œç„¶åä¾èµ–çš„ <code>Microsoft.CodeAnalysis.CSharp</code> éœ€è¦æ˜¯ <code>3.8.0</code> ç‰ˆæœ¬</p></blockquote><p>æ‰€ä»¥å»å¦å¤–åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dotnet new classlib <span class="literal">-n</span> Analysis <span class="operator">-f</span> netstandard2.<span class="number">0</span></span><br><span class="line"><span class="built_in">cd</span> Analysis</span><br><span class="line">dotnet add package Microsoft.CodeAnalysis.CSharp <span class="literal">--version</span> <span class="number">3.8</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure><p>ç„¶åé¡ºä¾¿æ‰“å¼€ <code>Analysis.csproj</code> æŠŠè¯­è¨€ç‰ˆæœ¬è®¾ç½®æˆ <code>9.0</code> ï¼ˆè¦ä¸ç„¶é»˜è®¤å°±åªæœ‰ <code>C#7.3</code> ï¼‰</p><p>ç°åœ¨é…ç½®æ–‡ä»¶é‡Œé¢åº”è¯¥å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Project</span> <span class="attr">Sdk</span>=<span class="string">&quot;Microsoft.NET.Sdk&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TargetFramework</span>&gt;</span>netstandard2.0<span class="tag">&lt;/<span class="name">TargetFramework</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">LangVersion</span>&gt;</span>9.0<span class="tag">&lt;/<span class="name">LangVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">&quot;Microsoft.CodeAnalysis.CSharp&quot;</span> <span class="attr">Version</span>=<span class="string">&quot;3.8.0&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">Project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç¼–å†™åˆ†æå™¨"><a href="#ç¼–å†™åˆ†æå™¨" class="headerlink" title="ç¼–å†™åˆ†æå™¨"></a>ç¼–å†™åˆ†æå™¨</h2><p>åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­æ–°å»ºä¸€ä¸ª <code>TypeConstraintAnalyzer.cs</code> ï¼Œç„¶ååœ¨å°±æ˜¯è¯Šæ–­å™¨çš„èµ·æ‰‹å¼ï¼ˆx</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Analysis</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">DiagnosticAnalyzer(LanguageNames.CSharp)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">TypeConstraintAnalyzer</span> : <span class="title">DiagnosticAnalyzer</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">override</span> ImmutableArray&lt;DiagnosticDescriptor&gt; SupportedDiagnostics =&gt; <span class="keyword">throw</span> <span class="keyword">new</span> NotImplement();</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Initialize</span>(<span class="params">AnalysisContext context</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            context.ConfigureGeneratedCodeAnalysis(GeneratedCodeAnalysisFlags.None);</span><br><span class="line">            context.EnableConcurrentExecution();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>SupportedDiagnostics</code> å¯ä»¥å…ˆä¸ç®¡ï¼Œç„¶åå°±æ˜¯æ³¨å†Œä¸€äº›è¡Œä¸ºï¼Œä¸€èˆ¬å¯èƒ½æ³¨å†Œç¬¦å·è¡Œä¸ºæˆ–è€…è¯­æ³•èŠ‚ç‚¹è¡Œä¸ºï¼ˆï¼‰</p><p>å¯¹äºæˆ‘ä»¬è¦å®ç°å¯¹ç±»å‹çš„é™å®šï¼Œé‚£ä¹ˆç¬¬ä¸€æ­¥å°±æ˜¯å…ˆè§£æ<strong>å‡½æ•°å®šä¹‰</strong>å¤„ï¼Œå…¶å‚æ•°ä¸Šçš„ <code>[TypeConstraint(...)]</code> ä¸­çš„æä¾›çš„é‚£äº›é™å®šç±»å‹ã€‚è¿™æ„å‘³æˆ‘ä»¬éœ€è¦æŠŠè§£æåˆ°çš„ç›¸å…³ä¿¡æ¯å‚¨å­˜ï¼Œç„¶åç¬¬äºŒæ­¥è§£æå‡½æ•°è°ƒç”¨æ—¶æ ¹æ®å…ˆå‰çš„ä¿¡æ¯ç±»åˆ¤æ–­æ˜¯å¦ç¬¦åˆé™å®šã€‚</p><h3 id="åˆ†æ-Attribute"><a href="#åˆ†æ-Attribute" class="headerlink" title="åˆ†æ Attribute"></a>åˆ†æ Attribute</h3><p>å®šä¹‰ä¸€ä¸ª <code>AnalyzeSymbol</code> ï¼Œå¹¶æ³¨å†Œï¼š</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Initialize</span>(<span class="params">AnalysisContext context</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// SymbolKind.Method è¡¨ç¤º AnalyzeSymbol ä¼šç”¨æ¥åˆ†æå‡½æ•°çš„ç¬¦å·ä¿¡æ¯</span></span><br><span class="line">    context.RegisterSymbolAction(AnalyzeSymbol, SymbolKind.Method);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AnalyzeSymbol</span>(<span class="params">SymbolAnalysisContext context</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯æ£€æŸ¥å‚æ•°æ˜¯å¦æœ‰ <code>TypeConstraintAttribute</code> ä¹‹ç±»çš„ï¼Œæœ€åæŠŠå¯¹åº”çš„å‚æ•°ä¿¡æ¯å‚¨å­˜ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå­—æ®µæ¥å‚¨å­˜</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Dictionary&lt;IMethodSymbol, Dictionary&lt;IParameterSymbol, ImmutableHashSet&lt;INamedTypeSymbol&gt;&gt;&gt; MethodConstraints = <span class="keyword">new</span>();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AnalyzeSymbol</span>(<span class="params">SymbolAnalysisContext context</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (context.Symbol <span class="keyword">is</span> <span class="keyword">not</span> IMethodSymbol methodSymbol) <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (methodSymbol.Parameters.Length <span class="keyword">is</span> <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> parametersConstraints = <span class="keyword">new</span> Dictionary&lt;IParameterSymbol, ImmutableHashSet&lt;INamedTypeSymbol&gt;&gt;();</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> parameter <span class="keyword">in</span> methodSymbol.Parameters)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// check if the parameter have TypeConstraintAttribute</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œæœ‰ç‚¹å¿˜äº†ï¼Œ&quot;TypeConstraintAttribute&quot; ä¸è¡Œçš„è¯å°±æ”¹æˆ &quot;TypeConstraint&quot; å§</span></span><br><span class="line">        <span class="keyword">var</span> attrs = parameter.GetAttributes().Where(attr =&gt; attr.AttributeClass.Name == <span class="string">&quot;TypeConstraintAttribute&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (attrs.Any() <span class="keyword">is</span> <span class="literal">false</span>) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> typeConstraintAttr = attrs.First();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Correctly handle the type of ConstructorArguments</span></span><br><span class="line">        <span class="keyword">var</span> allowedTypes = typeConstraintAttr.ConstructorArguments</span><br><span class="line">            .SelectMany(arg =&gt; arg.Values)</span><br><span class="line">            .Select(arg =&gt; arg.Value <span class="keyword">as</span> INamedTypeSymbol)</span><br><span class="line">            .Where(type =&gt; type <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>)</span><br><span class="line">            .ToImmutableHashSet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (allowedTypes.Any() <span class="keyword">is</span> <span class="literal">false</span>) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        parametersConstraints.Add(parameter, allowedTypes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (parametersConstraints.Any())</span><br><span class="line">    &#123;</span><br><span class="line">        MethodConstraints[methodSymbol] = parametersConstraints;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>  å¦‚æœæƒ³è¦æµ‹è¯•æœ‰æ²¡æœ‰æ­£ç¡®å»è§£æï¼Œå¯ä»¥æ‰“ä¸€äº› log åˆ°æ–‡ä»¶é‡Œé¢ï¼ˆå¦‚æœè¦æ–¹ä¾¿ç‚¹å»ºè®®ä½¿ç”¨ç»å¯¹è·¯å¾„å§ï¼‰</p></blockquote><p>è¿™é‡Œçš„ç›´æ¥å‚¨å­˜åˆ°å­—æ®µä¼šç»™ä½ ä¸€ä¸ªè­¦å‘Šï¼š<em>ä¸è¦å°†æ¯æ¬¡ç¼–è¯‘çš„æ•°æ®å­˜å‚¨åˆ°è¯Šæ–­åˆ†æå™¨çš„å­—æ®µä¸­</em></p><p>å¦‚æœæ‡’å¾—å»ä¼˜åŒ–çš„è¯ï¼Œå°±ç›´æ¥åœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ ä¸€è¡Œ <code>#pragma warning disable RS1008</code>  å°±è¡Œã€‚</p><p>é¡ºä¾¿è¯´æ˜ä¸€ä¸‹ä¸Šé¢çš„ <code>allowedTypes</code> å§ï¼š</p><blockquote><p>  åœ¨ roslyn åˆ†æå™¨ä¸­ä¸èƒ½ç›´æ¥å»è·å–ä¸€ä¸ª Attribute å†…éƒ¨çš„å­—æ®µä¿¡æ¯ï¼Œä¸€èˆ¬æ˜¯ä»æ„é€ å‡½æ•°æ¥è·å–ä¿¡æ¯ã€‚</p><p>  åœ¨å…ˆå‰æˆ‘ä»¬å®šä¹‰çš„ attr æ—¶å€™æ˜¯è¿™æ ·çš„ï¼š</p>  <figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">TypeConstraintAttribute</span>(<span class="params"><span class="keyword">params</span> Type[] constraints</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Constraints = constraints;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  ä¹Ÿå°±æ˜¯ constraints å‚æ•°æ˜¯ä¸€ä¸ª Type[] ï¼Œè™½ç„¶ä½¿ç”¨çš„æ—¶å€™å¯ä»¥åƒæ˜¯ä»»æ„æ•°é‡å‚æ•°é‚£æ ·ï¼Œä½†æ˜¯è§£æç¬¦å·çš„æ—¶å€™è¿™é‡Œæ˜¯ä¸€ä¸ªå‚æ•°ï¼Œæ‰€ä»¥å°±éœ€è¦å…ˆ SelectMany å† Select ï¼Œå¦‚æœç›´æ¥ <code>typeConstraintAttr.ConstructorArguments.Select(...)</code>  å°±ä¼šå¼‚å¸¸ï¼Œå…·ä½“çš„è¡¨ç°å°±æ˜¯åœ¨åˆ«çš„é¡¹ç›®é‡Œä½¿ç”¨è¯¥åˆ†æå™¨çš„æ—¶å€™ä¼šæ²¡æœ‰ä»»ä½•è¡¨ç°ï¼ˆå› ä¸ºåˆ†æå™¨è¿è¡Œåˆ°è¿™é‡Œå°±å´©æºƒäº†ï¼‰</p></blockquote><h3 id="åˆ†æè°ƒç”¨"><a href="#åˆ†æè°ƒç”¨" class="headerlink" title="åˆ†æè°ƒç”¨"></a>åˆ†æè°ƒç”¨</h3><p>æ³¨å†Œä¸€ä¸ªæ–°çš„è¡Œä¸ºï¼Œè¿™æ¬¡æˆ‘ä»¬æ³¨å†Œåˆ° <code>SyntaxNodeAction</code> ï¼ˆå› ä¸ºè¿™ä¸ªæ˜¯åœ¨ <code>SymbolAction</code> ä¹‹åæ‰§è¡Œçš„ï¼Œä¸è¿‡æˆ‘çŒœè¿™ä¸€æ­¥æ³¨å†Œ <code>SymbolAction</code> åº”è¯¥æ²¡å•¥é—®é¢˜ï¼‰</p><p>ç„¶ååˆ†æçš„ç›®æ ‡æ˜¯è°ƒç”¨è¡¨è¾¾å¼ï¼ˆ<code>Invocation Expression</code>ï¼‰</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Initialize</span>(<span class="params">AnalysisContext context</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    context.RegisterSyntaxNodeAction(AnalyzeMethodCall, SyntaxKind.InvocationExpression);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AnalyzeMethodCall</span>(<span class="params">SyntaxNodeAnalysisContext context</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ¤æ–­è¢«è°ƒç”¨çš„å‡½æ•°æ˜¯ä¸æ˜¯æœ‰ <code>[TypeConstraint(...)]</code> é™å®šè¿‡çš„å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯æ£€æŸ¥æ˜¯ä¸æ˜¯åœ¨ä¹‹å‰å‚¨å­˜çš„é‚£ä¸ªå­—å…¸å°±è¡Œï¼‰ï¼Œå¹¶è·å–è°ƒç”¨æ—¶çš„å®å‚ï¼Œä»¥åŠå®šä¹‰æ—¶çš„å‚æ•°ä¿¡æ¯</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">AnalyzeMethodCall</span>(<span class="params">SyntaxNodeAnalysisContext context</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> invocation = (InvocationExpressionSyntax)context.Node;</span><br><span class="line">    <span class="keyword">if</span> (context.SemanticModel.GetSymbolInfo(invocation).Symbol <span class="keyword">is</span> <span class="keyword">not</span> IMethodSymbol methodSymbol</span><br><span class="line">        || MethodConstraints.ContainsKey(methodSymbol) <span class="keyword">is</span> <span class="literal">false</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> parametersConstraints = MethodConstraints[methodSymbol];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> arguments = invocation.ArgumentList.Arguments;</span><br><span class="line">    <span class="keyword">var</span> parameters = methodSymbol.Parameters;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åéå†å‚æ•°ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦æ»¡è¶³é™åˆ¶ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ arg å’Œ param è¦å¯¹åº”ä¸Š</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> (argument, parameter) <span class="keyword">in</span> arguments.Zip(parameters, (arg, param) =&gt; (arg, param)))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> argumentType = context.SemanticModel.GetTypeInfo(argument.Expression).Type;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (parametersConstraints.TryGetValue(parameter, <span class="keyword">out</span> <span class="keyword">var</span> allowedTypes))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> isValid = allowedTypes.Any(allowed =&gt;</span><br><span class="line">            SymbolEqualityComparer.Default.Equals(allowed, argumentType) ||</span><br><span class="line">            argumentType.AllInterfaces.Any(i =&gt; SymbolEqualityComparer.Default.Equals(i, allowed)) ||</span><br><span class="line">            (argumentType.BaseType != <span class="literal">null</span> &amp;&amp; SymbolEqualityComparer.Default.Equals(argumentType.BaseType, allowed)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åå°±æ˜¯æ ¹æ®å®å‚æ˜¯å¦åˆæ³•ï¼Œæ¥æŠ›å‡ºæç¤ºå°±è¡Œäº†ã€‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ–°çš„è§„åˆ™ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><blockquote><p>  è¿™é‡Œåº”è¯¥ä¹Ÿä¼šæœ‰ä¸€ä¸ªè­¦å‘Šï¼Œæ‡’å¾—æä¹Ÿæ˜¯åœ¨æ–‡ä»¶å¼€å¤´åŠ ä¸€è¡Œï¼š <code>#pragma warning disable RS2008</code></p><p>  ä¹Ÿå¯ä»¥æŒ‰ç…§å®˜æ–¹çš„è¯´æ˜ï¼š<a href="https://github.com/dotnet/roslyn-analyzers/blob/main/src/Microsoft.CodeAnalysis.Analyzers/ReleaseTrackingAnalyzers.Help.md">https://github.com/dotnet/roslyn-analyzers/blob/main/src/Microsoft.CodeAnalysis.Analyzers/ReleaseTrackingAnalyzers.Help.md</a></p><p>  åˆ›å»º <code>AnalyzerReleases.Unshipped.md</code> å’Œ <code>AnalyzerReleases.Shipped.md</code> ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”æŒ‰ç…§æ ¼å¼æŠŠè§„åˆ™ä¿¡æ¯è¡¥å……ï¼ˆ</p></blockquote><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> DiagnosticDescriptor Rule = <span class="keyword">new</span> DiagnosticDescriptor(</span><br><span class="line">    id: <span class="string">&quot;ANALY001&quot;</span>,</span><br><span class="line">    title: <span class="string">&quot;æ— æ•ˆçš„å‚æ•°ç±»å‹&quot;</span>,</span><br><span class="line">    messageFormat: <span class="string">&quot;å‚æ•°ç±»å‹ &#x27;&#123;0&#125;&#x27; ä¸æ»¡è¶³ TypeConstraintAttribute ä¸­çš„çº¦æŸæ¡ä»¶, ç±»å‹ &#x27;&#123;0&#125;&#x27; éœ€è¦ä¸º &#x27;&#123;1&#125;&#x27; ä¸­çš„ä¸€ç§, æˆ–æ´¾ç”Ÿäºå…¶ä¸­ä¹‹ä¸€ã€‚&quot;</span>,</span><br><span class="line">    category: <span class="string">&quot;Usage&quot;</span>,</span><br><span class="line">    defaultSeverity: DiagnosticSeverity.Error,</span><br><span class="line">    isEnabledByDefault: <span class="literal">true</span>,</span><br><span class="line">    description: <span class="string">&quot;å‚æ•°ç±»å‹ä¸æ»¡è¶³ TypeConstraintAttribute ä¸­çš„çº¦æŸæ¡ä»¶&quot;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">override</span> ImmutableArray&lt;DiagnosticDescriptor&gt; SupportedDiagnostics =&gt; ImmutableArray.Create(Rule);</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨åŸæ¥æ£€æµ‹çš„åœ°æ–¹è·å–ä¸Šä¸‹æ–‡å¹¶æŠ›å‡ºé”™è¯¯</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isValid <span class="keyword">is</span> <span class="literal">false</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> diagnostic = Diagnostic.Create(Rule, argument.GetLocation(), argumentType, <span class="built_in">string</span>.Join(<span class="string">&quot;, &quot;</span>, allowedTypes.Select(type =&gt; type.Name)));</span><br><span class="line">    context.ReportDiagnostic(diagnostic);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åœ¨-Unity-ä¸­ä½¿ç”¨åˆ†æå™¨"><a href="#åœ¨-Unity-ä¸­ä½¿ç”¨åˆ†æå™¨" class="headerlink" title="åœ¨ Unity ä¸­ä½¿ç”¨åˆ†æå™¨"></a>åœ¨ Unity ä¸­ä½¿ç”¨åˆ†æå™¨</h2><p>æŠŠé¡¹ç›® build ä¸€ä¸‹ï¼ŒæŠŠ dll æ–‡ä»¶æŒ‰ç…§ Unity å®˜æ–¹æ‰‹å†Œçš„è¯´æ˜ <a href="https://docs.unity3d.com/cn/2022.3/Manual/roslyn-analyzers.html">https://docs.unity3d.com/cn/2022.3/Manual/roslyn-analyzers.html</a> åº”ç”¨åˆ°é¡¹ç›®ä¸­ï¼Œä¹‹åå°±å¯ä»¥æµ‹è¯•äº†ã€‚</p><blockquote><p>  åœ¨å‰é¢çš„å®ç°ä¸­ï¼Œæˆ‘ç”±äºæ˜¯åˆ¤æ–­åªæœ‰æ»¡è¶³å¤šä¸ªé™åˆ¶ä¸­çš„ä¸€ä¸ªå°±è¡Œï¼Œæ‰€ä»¥å¤šä¸ªç±»å‹ä¹‹é—´å…¶å®æ˜¯ <code>or</code> çš„å…³ç³»ã€‚</p><p>  åœ¨æœ€å¼€å§‹æˆ‘è¯´å®šä¹‰ <code>TypeConstraintAttribute</code> çš„æ—¶å€™ï¼Œå¯ä»¥æŠŠ <code>AllowMultiple</code> è®¾ç½®ä¸º trueï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥è€ƒè™‘å¤šä¸ª <code>[TypeConstraint(...)]</code> ä¹‹é—´æ˜¯ <code>and</code> å…³ç³»ï¼Œè¿™é‡Œæˆ‘å°±ä¸å®ç°äº†ï¼ˆ</p></blockquote><p><img src="/CSharp%E5%AE%9E%E7%8E%B0%E5%BC%BA%E5%88%B6%E7%B1%BB%E5%9E%8B%E9%99%90%E5%AE%9A/Test.png" alt="Test"></p>]]></content:encoded>
      
      
      <category domain="https://blog.hacbit.net/categories/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">æ¸¸æˆå¼€å‘</category>
      
      
      <category domain="https://blog.hacbit.net/tags/Tutorial/">Tutorial</category>
      
      <category domain="https://blog.hacbit.net/tags/CSharp/">CSharp</category>
      
      <category domain="https://blog.hacbit.net/tags/Analysis/">Analysis</category>
      
      
      <comments>https://blog.hacbit.net/CSharp%E5%AE%9E%E7%8E%B0%E5%BC%BA%E5%88%B6%E7%B1%BB%E5%9E%8B%E9%99%90%E5%AE%9A/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Unity é¡¹ç›®æ–‡æ¡£ç”Ÿæˆ</title>
      <link>https://blog.hacbit.net/Unity-%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/</link>
      <guid>https://blog.hacbit.net/Unity-%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/</guid>
      <pubDate>Sat, 08 Feb 2025 09:06:38 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;Unity-é¡¹ç›®æ–‡æ¡£ç”Ÿæˆ&quot;&gt;&lt;a href=&quot;#Unity-é¡¹ç›®æ–‡æ¡£ç”Ÿæˆ&quot; class=&quot;headerlink&quot; title=&quot;Unity é¡¹ç›®æ–‡æ¡£ç”Ÿæˆ&quot;&gt;&lt;/a&gt;Unity é¡¹ç›®æ–‡æ¡£ç”Ÿæˆ&lt;/h1&gt;&lt;p&gt;å¯¹äº C# é¡¹ç›®æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨ docfx è¿™ä¸ªå¼€æºå·¥å…·æ¥ç”Ÿæˆä»£ç æ–‡æ¡£ï¼Œè¿™ä¸ªå·¥å…·ä¹ŸåŒæ ·èƒ½ç”¨åœ¨ Unity çš„é¡¹ç›®ä¸­ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="Unity-é¡¹ç›®æ–‡æ¡£ç”Ÿæˆ"><a href="#Unity-é¡¹ç›®æ–‡æ¡£ç”Ÿæˆ" class="headerlink" title="Unity é¡¹ç›®æ–‡æ¡£ç”Ÿæˆ"></a>Unity é¡¹ç›®æ–‡æ¡£ç”Ÿæˆ</h1><p>å¯¹äº C# é¡¹ç›®æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨ docfx è¿™ä¸ªå¼€æºå·¥å…·æ¥ç”Ÿæˆä»£ç æ–‡æ¡£ï¼Œè¿™ä¸ªå·¥å…·ä¹ŸåŒæ ·èƒ½ç”¨åœ¨ Unity çš„é¡¹ç›®ä¸­ã€‚</p><span id="more"></span><p>ä»¥æˆ‘çš„ KimerA æ¡†æ¶çš„é¡¹ç›®ç»“æ„ä¸ºä¾‹å§ï¼š</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">KimerA</span><br><span class="line">â”œâ”€Docs</span><br><span class="line">â””â”€Src</span><br><span class="line">    â”œâ”€KimerA</span><br><span class="line">    â”‚  â”œâ”€<span class="string">.vscode</span></span><br><span class="line">    â”‚  â”œâ”€Assets</span><br><span class="line"><span class="string">......</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <strong>KimerA&#x2F;Src&#x2F;KimerA</strong> å°±æ˜¯ unity é¡¹ç›®çš„æ ¹ç›®å½•ã€‚</p><blockquote><p>  é¦–å…ˆä¿è¯è‡³å°‘æœ‰ DotNet8 çš„ç¯å¢ƒ</p><p>  è¿è¡Œ <code>dotnet tool update -g docfx</code> æ¥å…¨å±€å®‰è£… docfx å·¥å…·</p></blockquote><p><em>å…³äº docfx çš„å…¥é—¨ï¼Œå»ºè®®ç›´æ¥çœ‹å®˜æ–¹çš„  <a href="https://dotnet.github.io/docfx/index.html">https://dotnet.github.io/docfx/index.html</a></em></p><p>åœ¨ <strong>KimerA&#x2F;Docs</strong> æ‰“å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œè¾“å…¥ <code>docfx init</code> åˆå§‹åŒ–ç›¸å…³è®¾ç½®</p><p>ç„¶ååº”è¯¥å°±çœ‹åˆ°äº† Docs æ–‡ä»¶å¤¹ä¸‹å¤šäº† <code>docfx.json, index.md, toc.yml</code>  è¿™ä¸‰ä¸ªæ–‡ä»¶</p><blockquote><p>  å¯åŠ¨ docfx æœåŠ¡åçš„ä¸»ç•Œé¢å°±æ˜¯æ ¹æ® index.md æ¥çš„</p><p>  toc.yml ï¼ˆTable of Configï¼‰ï¼Œå°±å’Œåå­—ä¸€æ ·ï¼Œæ˜¯æŒ‡ç¤ºæ–‡æ¡£ç»“æ„çš„</p><p>  docfx.json å°±æ˜¯ç”Ÿæˆæ–‡æ¡£æ—¶çš„ç›¸å…³é…ç½®</p></blockquote><p>docfx.json ä¸­ metadata -&gt; src åº”è¯¥é»˜è®¤æ˜¯æŒ‡å‘ä¸€ä¸ª .csproj è·¯å¾„ï¼Œä½†æ˜¯å¯¹äº unity é¡¹ç›®ï¼Œå»ºè®®æ”¹æˆ .cs æ–‡ä»¶çš„è·¯å¾„</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹çš„ docfx.json æ–‡ä»¶å†…å®¹ï¼Œï¼ˆå½“ç„¶ï¼Œç”±äºæˆ‘æ˜¯ä¸ºäº†æ‰“åŒ…æˆ unitypackage æˆ‘æ‰æ”¾åˆ° Plugins ä¸‹é¢ï¼Œå¦‚æœåªæ˜¯è¦ç»™é¡¹ç›®æ ¸å¿ƒé€»è¾‘çš„å“ªäº›è„šæœ¬ç”Ÿæˆæ–‡æ¡£ï¼Œå¤§å¯æ”¹æˆç±»ä¼¼  <code>TestProj/Assets/Scripts/*.cs</code> ,  <code>TestProj/Assets/Scripts/**/*.cs</code> è¿™æ ·çš„ï¼‰</p><blockquote><p>  éœ€è¦è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆåœ¨ metadata ä¸­ä¼šæ·»åŠ ä¸€ä¸ª   <code>&quot;references&quot;: [ &quot;*.dll&quot; ]</code></p><p>  å› ä¸ºæˆ‘ä¾èµ–äº† UnityEngineï¼Œæ‰€ä»¥å½“ docfx å°è¯• build çš„æ—¶å€™ï¼ˆç”Ÿæˆæ–‡æ¡£å‰ä¼šå…ˆbuildï¼‰å°±ä¼šç¼ºå°‘ä¾èµ–ï¼Œæˆ‘çš„åšæ³•æ˜¯ç›´æ¥å»ç¼–è¾‘å™¨æ–‡ä»¶å¤¹ä¸‹é¢å¤åˆ¶äº†ä¸€ä¸ª UnityEngine.dll ï¼ˆä¸çŸ¥é“æœ‰æ²¡æœ‰æ›´å¥½çš„åŠæ³•ï¼‰</p><p>  ç„¶å â€œreferencesâ€ å­—æ®µéœ€è¦çš„æ˜¯æ¨¡å¼ï¼Œå¯ä»¥å¡«  â€œUnityEngine.dllâ€, â€œ*.dllâ€ï¼Œä½†æ˜¯ä¸èƒ½ â€œ.&#x2F;UnityEngine.dllâ€</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;metadata&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;KimerA/Assets/Plugins/KimerA/Runtime/**/*.cs&quot;</span></span><br><span class="line">          <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;src&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../Src&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;dest&quot;</span><span class="punctuation">:</span> <span class="string">&quot;api&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;disableGitFeatures&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;disableDefaultFilter&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;references&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;*.dll&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;globalMetadata&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;_disableContribution&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;_appTitle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;KimerA&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;api/**.yml&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;api/index.md&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;articles/**.md&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;articles/**/toc.yml&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;toc.yml&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;*.md&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;resource&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;images/**&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;overwrite&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;apidoc/**.md&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;exclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;obj/**&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;_site/**&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dest&quot;</span><span class="punctuation">:</span> <span class="string">&quot;_site&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;globalMetadataFiles&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fileMetadataFiles&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;template&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;modern&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;postProcessors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;markdownEngineName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;markdig&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;noLangKeyword&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;keepFileLink&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cleanupCacheHistory&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>toc.yml</strong></p><blockquote><p>  ç”Ÿæˆçš„ yml æ–‡ä»¶åæ˜¯æ ¹æ®å‘½åç©ºé—´æ¥çš„ï¼Œæˆ‘å¸Œæœ›ä¸€æ‰“å¼€å°±æ˜¯ <code>KimerA.Core</code> è¿™ä¸ªå‘½åç©ºé—´å†…çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆ homepage å°±è¿™ä¹ˆå†™ï¼ˆ</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KimerA</span> <span class="string">API</span> <span class="string">Documentation</span></span><br><span class="line">  <span class="attr">href:</span> <span class="string">api/</span></span><br><span class="line">  <span class="attr">homepage:</span> <span class="string">api/KimerA.Core.yml</span></span><br></pre></td></tr></table></figure><p>ç„¶å index.md é‡Œé¢éšä¾¿å†™ç‚¹ä¸œè¥¿ï¼Œå°±å¯ä»¥ç›´æ¥ <code>docfx .\docfx.json --serve</code> äº†</p><img src="/Unity-%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/Home.png" alt="Home" style="zoom:67%;"><p>ç‚¹ä¸Šæ–¹æŒ‰é’®è¿›å»å°±æ˜¯å¤§æ¦‚è¿™æ ·</p><img src="/Unity-%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/Core.png" alt="Core" style="zoom: 67%;"><h2 id="ä¸€äº›å¯èƒ½çš„é—®é¢˜"><a href="#ä¸€äº›å¯èƒ½çš„é—®é¢˜" class="headerlink" title="ä¸€äº›å¯èƒ½çš„é—®é¢˜"></a>ä¸€äº›å¯èƒ½çš„é—®é¢˜</h2><ul><li><p>ä½¿ç”¨äº† unsafe ä»£ç ï¼Œæ— æ³•ç›´æ¥ç¼–è¯‘</p><blockquote><p>  å¯ä»¥åœ¨ docfx.json ä¸­çš„ metadata ä¸­æ·»åŠ  <code>&quot;properties&quot;: &#123; &quot;AllowUnsafeBlocks&quot;: &quot;true&quot; &#125;</code></p><p>  ä½†æ˜¯è¦æ³¨æ„ï¼Œ properties ä¸­çš„å±æ€§çš„å€¼éƒ½å¿…é¡»æ˜¯ String ç±»å‹ï¼Œè¿™é‡Œå¡«  true ä¼šæ— æ³•è§£æï¼ˆx</p></blockquote></li><li><p>æœ€è¿‘ä½¿ç”¨çš„æ—¶å€™é‡åˆ°äº† UnityEngine.dll ä¸­ç¼ºå°‘ç¬¦å·çš„é—®é¢˜ï¼Œå¤§æ¦‚æ˜¯ UnityEngine.dll è¿˜ä¼šä¾èµ–å…¶ä»–çš„ dllï¼Œæ‰€ä»¥æˆ‘ç›´æ¥æŠŠ editor é‡Œé¢çš„ <code>Data/Managed/UnityEngine/</code> è¿™ä¸ªç›®å½•ä¸€èµ·å¤åˆ¶è¿‡å»äº†ï¼Œç„¶åæŠŠé…ç½®æ–‡ä»¶é‡Œé¢çš„ references æ”¹æˆ <code>&quot;UnityEngine/*.dll&quot;</code> å°±å¯ä»¥äº†ã€‚</p></li></ul>]]></content:encoded>
      
      
      <category domain="https://blog.hacbit.net/categories/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">æ¸¸æˆå¼€å‘</category>
      
      
      <category domain="https://blog.hacbit.net/tags/Unity/">Unity</category>
      
      <category domain="https://blog.hacbit.net/tags/Tutorial/">Tutorial</category>
      
      
      <comments>https://blog.hacbit.net/Unity-%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>rustå®é­”æ³•-2</title>
      <link>https://blog.hacbit.net/rust%E5%AE%8F%E9%AD%94%E6%B3%95-2/</link>
      <guid>https://blog.hacbit.net/rust%E5%AE%8F%E9%AD%94%E6%B3%95-2/</guid>
      <pubDate>Mon, 26 Aug 2024 14:31:29 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;Rustå®é­”æ³•â€”â€”ç¬¬äºŒè¾‘ï¼ˆ&quot;&gt;&lt;a href=&quot;#Rustå®é­”æ³•â€”â€”ç¬¬äºŒè¾‘ï¼ˆ&quot; class=&quot;headerlink&quot; title=&quot;Rustå®é­”æ³•â€”â€”ç¬¬äºŒè¾‘ï¼ˆ&quot;&gt;&lt;/a&gt;Rustå®é­”æ³•â€”â€”ç¬¬äºŒè¾‘ï¼ˆ&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;  åˆæ¥æ•´ç‚¹å¥‡æŠ€æ·«å·§äº†&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™æœŸå°±ç©ç©ç”¨å£°æ˜å®æ¥ç”Ÿæˆå®ï¼ˆ&lt;/p&gt;
&lt;p&gt;æ€»ç»“å¯ä»¥ç›´æ¥çœ‹ ğŸ‘‰ &lt;a href=&quot;#%E7%9C%81%E6%B5%81&quot;&gt;çœæµ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å‡è®¾æœ‰ä»¥ä¸‹çš„å¥‡æ€ªæƒ…æ™¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;  ä½ æ•´äº†ä¸€ä¸ªæ—¥å¿—ç³»ç»Ÿï¼Œä½†æ˜¯å…¶ä¸­çš„è¾“å‡ºå†…å®¹æ˜¯é¢„è®¾å¥½çš„ï¼ˆå½“ç„¶ä¹Ÿåº”è¯¥é¢„ç•™ä¸€ä¸ªæ¯”å¦‚ Other çš„æ¥è‡ªå®šä¹‰å†…å®¹ï¼‰&lt;/p&gt;
&lt;p&gt;  ç„¶åä½ æƒ³è¦ç»™æ¯ä¸€ç§è¾“å‡ºå†…å®¹éƒ½æ³¨å†Œä¸€ä¸ªå®ï¼Œå¹¶ä¸”æœ‰äº›è¾“å‡ºæ˜¯å¸¦æœ‰ â€œ{}â€ çš„ï¼Œå› æ­¤ä½ å¸Œæœ›èƒ½å¤Ÿæœ‰ç±»ä¼¼ä¸‹é¢è¿™ä¸ªæ•ˆæœï¼š&lt;/p&gt;
  &lt;figure class=&quot;highlight rust&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;app_start_failed!(e)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// App start failed due to the error : &amp;#123;e&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;  ä¹Ÿå°±æ˜¯åƒ &lt;code&gt;println!&lt;/code&gt; ä¹‹ç±»çš„å®èƒ½å¤Ÿæ¥å—ä¸å®šæ•°é‡çš„å‚æ•°ï¼Œå…·ä½“çœ‹æ ¼å¼ï¼ˆä¹Ÿå°±æ˜¯ä½ é¢„è®¾å­—ç¬¦ä¸²é‡Œé¢æœ‰å‡ ä¸ª â€œ{}â€ )&lt;/p&gt;
&lt;/blockquote&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="Rustå®é­”æ³•â€”â€”ç¬¬äºŒè¾‘ï¼ˆ"><a href="#Rustå®é­”æ³•â€”â€”ç¬¬äºŒè¾‘ï¼ˆ" class="headerlink" title="Rustå®é­”æ³•â€”â€”ç¬¬äºŒè¾‘ï¼ˆ"></a>Rustå®é­”æ³•â€”â€”ç¬¬äºŒè¾‘ï¼ˆ</h1><blockquote><p>  åˆæ¥æ•´ç‚¹å¥‡æŠ€æ·«å·§äº†</p></blockquote><p>è¿™æœŸå°±ç©ç©ç”¨å£°æ˜å®æ¥ç”Ÿæˆå®ï¼ˆ</p><p>æ€»ç»“å¯ä»¥ç›´æ¥çœ‹ ğŸ‘‰ <a href="#%E7%9C%81%E6%B5%81">çœæµ</a></p><p>å‡è®¾æœ‰ä»¥ä¸‹çš„å¥‡æ€ªæƒ…æ™¯ï¼š</p><blockquote><p>  ä½ æ•´äº†ä¸€ä¸ªæ—¥å¿—ç³»ç»Ÿï¼Œä½†æ˜¯å…¶ä¸­çš„è¾“å‡ºå†…å®¹æ˜¯é¢„è®¾å¥½çš„ï¼ˆå½“ç„¶ä¹Ÿåº”è¯¥é¢„ç•™ä¸€ä¸ªæ¯”å¦‚ Other çš„æ¥è‡ªå®šä¹‰å†…å®¹ï¼‰</p><p>  ç„¶åä½ æƒ³è¦ç»™æ¯ä¸€ç§è¾“å‡ºå†…å®¹éƒ½æ³¨å†Œä¸€ä¸ªå®ï¼Œå¹¶ä¸”æœ‰äº›è¾“å‡ºæ˜¯å¸¦æœ‰ â€œ{}â€ çš„ï¼Œå› æ­¤ä½ å¸Œæœ›èƒ½å¤Ÿæœ‰ç±»ä¼¼ä¸‹é¢è¿™ä¸ªæ•ˆæœï¼š</p>  <figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app_start_failed!(e)</span><br><span class="line"><span class="comment">// App start failed due to the error : &#123;e&#125;</span></span><br></pre></td></tr></table></figure><p>  ä¹Ÿå°±æ˜¯åƒ <code>println!</code> ä¹‹ç±»çš„å®èƒ½å¤Ÿæ¥å—ä¸å®šæ•°é‡çš„å‚æ•°ï¼Œå…·ä½“çœ‹æ ¼å¼ï¼ˆä¹Ÿå°±æ˜¯ä½ é¢„è®¾å­—ç¬¦ä¸²é‡Œé¢æœ‰å‡ ä¸ª â€œ{}â€ )</p></blockquote><span id="more"></span><p>ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œå°±ä»¥ä»¥ä¸‹ä½œä¸ºä¾‹å­å§</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app_started : <span class="string">&quot;App start!&quot;</span></span><br><span class="line">app_start_failed : <span class="string">&quot;App start failed due to the error: &#123;&#125;&quot;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœåªæ˜¯è€ƒè™‘ä¸Šé¢è¿™ç§ï¼Œåº”è¯¥å¾ˆå®¹æ˜“å†™æˆè¿™æ ·ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[macro_export]</span></span><br><span class="line"><span class="built_in">macro_rules!</span> generate_macros &#123;</span><br><span class="line">    ( $( $id:ident =&gt; $e:expr ),*$(,)? ) =&gt; &#123;</span><br><span class="line">        $(</span><br><span class="line">            <span class="meta">#[macro_export]</span></span><br><span class="line">            <span class="built_in">macro_rules!</span> $id &#123;</span><br><span class="line">                () =&gt; &#123;</span><br><span class="line">                    <span class="built_in">println!</span>($e);</span><br><span class="line">    &#125;;</span><br><span class="line">                ($tt:tt) =&gt; &#123;</span><br><span class="line">                    <span class="built_in">println!</span>($e, $tt);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        )*</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">generate_macros! &#123;</span><br><span class="line">    app_started =&gt; <span class="string">&quot;App start!&quot;</span>,</span><br><span class="line">    app_start_failed =&gt; <span class="string">&quot;App start failed due to the error: &#123;&#125;&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    app_started!();</span><br><span class="line">    app_start_failed!(<span class="string">&quot;AAAAAAA&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·è‡ªç„¶èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯ä¹Ÿä¸éš¾å‘ç°é—®é¢˜ï¼Œå°±æ˜¯å¦‚æœå¢åŠ äº†ä¸€ä¸ªæœ‰ä¸¤ä¸ª â€œ{}â€ çš„å­—æ®µï¼Œé‚£å°±ä¸å¾—ä¸ç»™ generate_macros é‡Œé¢æ–°å¢ä¸€ä¸ªè§„åˆ™ã€‚</p><p>å½“ç„¶ï¼Œå¯¹äº macro çƒ‚ç†Ÿäºå¿ƒçš„ä½ ï¼Œè‚¯å®šæƒ³åˆ°å¯ä»¥æŠŠè¿™ä¸ªé‡Œé¢çš„åŒ¹é…æ¨¡å¼ç»Ÿä¸€æˆ  <code>$($tt:tt)*</code> ï¼Œä¹Ÿå°±æ˜¯ç±»ä¼¼ä¸‹é¢è¿™ç§ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[macro_export]</span></span><br><span class="line"><span class="built_in">macro_rules!</span> generate_macros &#123;</span><br><span class="line">    ( $( $id:ident =&gt; $e:expr ),*$(,)? ) =&gt; &#123;</span><br><span class="line">        $(</span><br><span class="line">            <span class="meta">#[macro_export]</span></span><br><span class="line">            <span class="built_in">macro_rules!</span> $id &#123;</span><br><span class="line">                ($($tt:tt)*) =&gt; &#123;</span><br><span class="line">                    <span class="built_in">println!</span>($e, $tt);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        )*</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥è‡ªä¿¡è¿è¡Œï¼</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">error: attempted to repeat an expression containing no syntax variables matched as repeating at this depth</span><br><span class="line"> <span class="literal">--</span>&gt; src/main.rs:<span class="number">9</span>:<span class="number">19</span></span><br><span class="line">  |</span><br><span class="line"><span class="number">9</span> |                 (<span class="variable">$</span>(<span class="variable">$tt:tt</span>)*) =&gt; &#123;</span><br><span class="line">  |                   ^^^^^^^</span><br></pre></td></tr></table></figure><p>æŠ¥é”™äº†ï¼Œæ‚²ï¼ˆ</p><p>è¿™ä¸ªåŸå› ä¸»è¦æ˜¯åƒ <code>$( #[macro_export] xxxxx )*</code> è¿™æ ·ï¼Œè¢«é€’å½’å±•å¼€äº†ï¼Œä½†æ˜¯åœ¨ <code>macro_rules! $id &#123;&#125;</code> ä¸­è¿™ä¹ˆå†™ï¼Œå°±ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™ç»“æŸï¼Œå› ä¸º <code>$tt</code> ä¹Ÿæ˜¯æ²¡æœ‰åœ¨ <code>macro_rules! generate_macros</code> ä¸­å£°æ˜ï¼ˆ</p><p>ä½†æ˜¯è¿™é‡Œå¦‚æœæ˜¯é€šè¿‡ <code>proc-macro</code> åŒ…ä¸Šä¸€å±‚å°±å¯ä»¥æ­£ç¡®è§£æäº†</p><p>æ–°å»ºä¸€ä¸ª <code>proc-macro</code> ç±»å‹çš„crateï¼Œå†™ä¸Šä»¥ä¸‹ä»£ç </p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> proc_macro;</span><br><span class="line"><span class="keyword">use</span> proc_macro::TokenStream;</span><br><span class="line"><span class="keyword">use</span> quote::quote;</span><br><span class="line"><span class="keyword">use</span> syn::&#123;parse_macro_input, parse::&#123;Parse, ParseBuffer&#125;, Token, Ident, LitStr&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MacroInfo</span> &#123;</span><br><span class="line">    id: Ident,</span><br><span class="line">    msg: LitStr,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Parse</span> <span class="keyword">for</span> <span class="title class_">MacroInfo</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">parse</span>(input: &amp;ParseBuffer) <span class="punctuation">-&gt;</span> syn::<span class="type">Result</span>&lt;<span class="keyword">Self</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">id</span> = input.parse::&lt;Ident&gt;()?;</span><br><span class="line">        input.parse::&lt;Token![=&gt;]&gt;()?;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">msg</span> = input.parse::&lt;LitStr&gt;()?;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(<span class="keyword">Self</span> &#123; id, msg &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[proc_macro]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">make_macro</span>(input: TokenStream) <span class="punctuation">-&gt;</span> TokenStream &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">input</span> = parse_macro_input!(input <span class="keyword">as</span> MacroInfo);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="variable">id</span> = &amp;input.id;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">msg</span> = &amp;input.msg;</span><br><span class="line">    </span><br><span class="line">    quote! &#123;</span><br><span class="line">        <span class="built_in">macro_rules!</span> #id &#123;</span><br><span class="line">            ($($tt:tt)*) =&gt; &#123;</span><br><span class="line">                <span class="built_in">println!</span>(#msg, $($tt)*);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.<span class="title function_ invoke__">into</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶å <code>generate_macros</code> è¿™è¾¹æ›¿æ¢ä¸€ä¸‹å°±å¥½äº†</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[macro_export]</span></span><br><span class="line"><span class="built_in">macro_rules!</span> generate_macros &#123;</span><br><span class="line">    ( $( $id:ident =&gt; $e:expr ),*$(,)? ) =&gt; &#123;</span><br><span class="line">        $(</span><br><span class="line">            make_macro! &#123;</span><br><span class="line">                $id =&gt; $e</span><br><span class="line">            &#125;</span><br><span class="line">        )*</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç¤ºèŒƒï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">generate_macros! &#123;</span><br><span class="line">    hello =&gt; <span class="string">&quot;Hello, &#123;&#125;!&quot;</span>,</span><br><span class="line">    goodbye =&gt; <span class="string">&quot;Goodbye, &#123;&#125;!&quot;</span>,</span><br><span class="line">    hhh =&gt; <span class="string">&quot;hhh, &#123;&#125; and &#123;&#125;!&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    hello!(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">    goodbye!(<span class="string">&quot;world&quot;</span>); </span><br><span class="line">    hhh!(<span class="string">&quot;world&quot;</span>, <span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æ­¤ï¼Œå†™ä»»æ„æ ¼å¼çš„å­—ç¬¦ä¸²å°±ä¸éœ€è¦åœ¨ generate_macros é‚£é‡Œæ·»åŠ æ–°çš„åŒ¹é…æ¨¡å¼äº†ã€‚</p><h2 id="çœæµ"><a href="#çœæµ" class="headerlink" title="çœæµ"></a>çœæµ</h2><p>ä¸ºäº†é¿å…åœ¨ macro_rules ä¸­å®šä¹‰ macro_rules æ—¶é”™è¯¯çš„è§£æå†…å±‚å£°æ˜å®çš„ <code>$( xxx )*</code> è¿™ä¸€ç±»æ¨¡å¼ï¼Œéœ€è¦æŠŠè¿™éƒ¨åˆ†ç§»åŠ¨åˆ° <code>proc-macro</code> ä¸­ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://blog.hacbit.net/categories/%E5%BC%80%E5%8F%91/">å¼€å‘</category>
      
      
      <category domain="https://blog.hacbit.net/tags/Rust/">Rust</category>
      
      
      <comments>https://blog.hacbit.net/rust%E5%AE%8F%E9%AD%94%E6%B3%95-2/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>rustå®é­”æ³•(1)</title>
      <link>https://blog.hacbit.net/rust%E5%AE%8F%E9%AD%94%E6%B3%95-1/</link>
      <guid>https://blog.hacbit.net/rust%E5%AE%8F%E9%AD%94%E6%B3%95-1/</guid>
      <pubDate>Wed, 17 Apr 2024 00:29:14 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;Rustå®é­”æ³•â€”â€”ç¬¬ä¸€è¾‘ï¼ˆä¸çŸ¥é“åé¢è¿˜ä¼šä¸ä¼šæ›´æ–°ï¼Œæ€»ä¹‹è¿™æ˜¯ä¸ªç³»åˆ—ï¼‰&quot;&gt;&lt;a href=&quot;#Rustå®é­”æ³•â€”â€”ç¬¬ä¸€è¾‘ï¼ˆä¸çŸ¥é“åé¢è¿˜ä¼šä¸ä¼šæ›´æ–°ï¼Œæ€»ä¹‹è¿™æ˜¯ä¸ªç³»åˆ—ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;Rustå®é­”æ³•â€”â€”ç¬¬ä¸€è¾‘ï¼ˆä¸çŸ¥é“åé¢è¿˜ä¼šä¸ä¼šæ›´æ–°ï¼Œæ€»ä¹‹è¿™æ˜¯ä¸ªç³»åˆ—ï¼‰&quot;&gt;&lt;/a&gt;Rustå®é­”æ³•â€”â€”ç¬¬ä¸€è¾‘ï¼ˆä¸çŸ¥é“åé¢è¿˜ä¼šä¸ä¼šæ›´æ–°ï¼Œæ€»ä¹‹è¿™æ˜¯ä¸ªç³»åˆ—ï¼‰&lt;/h1&gt;&lt;p&gt;&lt;em&gt;&lt;strong&gt;æ³¨ï¼šæœ¬æ–‡é»˜è®¤ä½ å·²ç»æœ‰ä¸€å®šçš„RuståŸºç¡€&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;rustçš„å®çš„å¼ºå¤§ç›¸ä¿¡å¤§å®¶è‚¯å®šå¬çš„ä¸å°‘ï¼Œæœ¬ç¯‡å°±ç®€å•è¯´è¯´rustçš„è¿‡ç¨‹å®&lt;/p&gt;
&lt;p&gt;rustçš„å®æœ‰å¥½å‡ ç§ï¼Œæœ‰åŸºäºæ¨¡å¼åŒ¹é…çš„ï¼Œè¿˜æœ‰å¯ä»¥ç›´æ¥å¯¹è¯­æ³•æ ‘åŠ¨æ‰‹çš„ï¼Œè¿‡ç¨‹å®å°±æ˜¯å¯ä»¥ä¿®æ”¹è¯­æ³•æ ‘ï¼Œå¯ä»¥åœ¨ç¼–è¯‘å™¨æ´¾ç”Ÿä»£ç ï¼šæ¯”å¦‚æœ‰ä¸ªtest crateï¼Œç„¶åå®ƒä¾èµ–äºtest_macro crateï¼Œè€Œåè€…æ˜¯ä¸€ä¸ªproc-macroåº“ï¼Œä¹Ÿå°±æ˜¯é‡Œé¢å®šä¹‰äº†è¿‡ç¨‹å®ï¼Œç¼–è¯‘æ—¶å°±ä¼šå…ˆç¼–è¯‘test_macroç„¶åç”¨test_macroçš„å¯¹testçš„è¯­æ³•è§£ææµä¿®æ”¹å†ä¸¢ç»™ç¼–è¯‘å™¨ï¼Œæ‰€ä»¥å¯ä»¥å®ç°å¾ˆå¤šéå¸¸æŠ½è±¡çš„æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;å†™æœ¬æ–‡çš„å¥‘æœºæ˜¯ï¼Œå‰æ®µæ—¶é—´åœ¨Rustä¸­æ–‡ç¤¾åŒºç¾¤é‡Œçœ‹åˆ°æœ‰äººé—®èƒ½ä¸èƒ½ç”¨å®æŠŠjsonç”Ÿæˆä¸€ä¸ªenumï¼ˆjsonåªæœ‰ä¸€å±‚ï¼‰ï¼Œè¿™ä¸ªéœ€æ±‚å’Œè¿‡ç¨‹å®è¿˜æ˜¯å¾ˆå¥‘åˆçš„ï¼Œæ‰€ä»¥å°±ç®€å•å®ç°äº†ä¸€ä¸‹ï¼Œä»¥ä¸‹å†…å®¹å°±æ˜¯å¯¹å®ç°çš„è®²è§£&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="Rustå®é­”æ³•â€”â€”ç¬¬ä¸€è¾‘ï¼ˆä¸çŸ¥é“åé¢è¿˜ä¼šä¸ä¼šæ›´æ–°ï¼Œæ€»ä¹‹è¿™æ˜¯ä¸ªç³»åˆ—ï¼‰"><a href="#Rustå®é­”æ³•â€”â€”ç¬¬ä¸€è¾‘ï¼ˆä¸çŸ¥é“åé¢è¿˜ä¼šä¸ä¼šæ›´æ–°ï¼Œæ€»ä¹‹è¿™æ˜¯ä¸ªç³»åˆ—ï¼‰" class="headerlink" title="Rustå®é­”æ³•â€”â€”ç¬¬ä¸€è¾‘ï¼ˆä¸çŸ¥é“åé¢è¿˜ä¼šä¸ä¼šæ›´æ–°ï¼Œæ€»ä¹‹è¿™æ˜¯ä¸ªç³»åˆ—ï¼‰"></a>Rustå®é­”æ³•â€”â€”ç¬¬ä¸€è¾‘ï¼ˆä¸çŸ¥é“åé¢è¿˜ä¼šä¸ä¼šæ›´æ–°ï¼Œæ€»ä¹‹è¿™æ˜¯ä¸ªç³»åˆ—ï¼‰</h1><p><em><strong>æ³¨ï¼šæœ¬æ–‡é»˜è®¤ä½ å·²ç»æœ‰ä¸€å®šçš„RuståŸºç¡€</strong></em></p><p>rustçš„å®çš„å¼ºå¤§ç›¸ä¿¡å¤§å®¶è‚¯å®šå¬çš„ä¸å°‘ï¼Œæœ¬ç¯‡å°±ç®€å•è¯´è¯´rustçš„è¿‡ç¨‹å®</p><p>rustçš„å®æœ‰å¥½å‡ ç§ï¼Œæœ‰åŸºäºæ¨¡å¼åŒ¹é…çš„ï¼Œè¿˜æœ‰å¯ä»¥ç›´æ¥å¯¹è¯­æ³•æ ‘åŠ¨æ‰‹çš„ï¼Œè¿‡ç¨‹å®å°±æ˜¯å¯ä»¥ä¿®æ”¹è¯­æ³•æ ‘ï¼Œå¯ä»¥åœ¨ç¼–è¯‘å™¨æ´¾ç”Ÿä»£ç ï¼šæ¯”å¦‚æœ‰ä¸ªtest crateï¼Œç„¶åå®ƒä¾èµ–äºtest_macro crateï¼Œè€Œåè€…æ˜¯ä¸€ä¸ªproc-macroåº“ï¼Œä¹Ÿå°±æ˜¯é‡Œé¢å®šä¹‰äº†è¿‡ç¨‹å®ï¼Œç¼–è¯‘æ—¶å°±ä¼šå…ˆç¼–è¯‘test_macroç„¶åç”¨test_macroçš„å¯¹testçš„è¯­æ³•è§£ææµä¿®æ”¹å†ä¸¢ç»™ç¼–è¯‘å™¨ï¼Œæ‰€ä»¥å¯ä»¥å®ç°å¾ˆå¤šéå¸¸æŠ½è±¡çš„æ“ä½œã€‚</p><p>å†™æœ¬æ–‡çš„å¥‘æœºæ˜¯ï¼Œå‰æ®µæ—¶é—´åœ¨Rustä¸­æ–‡ç¤¾åŒºç¾¤é‡Œçœ‹åˆ°æœ‰äººé—®èƒ½ä¸èƒ½ç”¨å®æŠŠjsonç”Ÿæˆä¸€ä¸ªenumï¼ˆjsonåªæœ‰ä¸€å±‚ï¼‰ï¼Œè¿™ä¸ªéœ€æ±‚å’Œè¿‡ç¨‹å®è¿˜æ˜¯å¾ˆå¥‘åˆçš„ï¼Œæ‰€ä»¥å°±ç®€å•å®ç°äº†ä¸€ä¸‹ï¼Œä»¥ä¸‹å†…å®¹å°±æ˜¯å¯¹å®ç°çš„è®²è§£</p><span id="more"></span><p>é¦–å…ˆå¼€ä¸ªcrateå§</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo new json_to_enum</span><br></pre></td></tr></table></figure><blockquote><p>  ç›´åˆ°æ’°å†™æœ¬æ–‡æ—¶ï¼Œæƒ³è¦å®šä¹‰è¿‡ç¨‹å®è¿˜æ˜¯å¿…é¡»è¦å•ç‹¬å¼€ä¸ªcrateï¼Œå¹¶ä¸”åœ¨<code>cargo.toml</code>é‡Œé¢è®¾ç½® <code>lib.proc-macro = true</code></p><p>  è‡³äºåŸå› æ˜¯rustçš„ç¼–è¯‘å•å…ƒæ˜¯crateï¼Œè€Œå‰é¢ä¹Ÿè¯´è¦æ‹¿è¿‡ç¨‹å®çš„åº“ç¼–è¯‘å¥½å¯¹å…¶ä»–åº“ä½¿ç”¨çš„ï¼Œæ‰€ä»¥å°±ä¸å¯é¿å…è¦åˆ†å‰²ï¼Œå•ç‹¬å¼€ä¸ªcrateã€‚</p></blockquote><p>ç„¶ååˆ›å»ºè¿‡ç¨‹å®åº“ï¼Œè¿™é‡Œæˆ‘ä¸€èˆ¬å–œæ¬¢æŠŠä¾èµ–çš„å…¶ä»–è‡ªå·±å†™çš„åº“æ”¾åœ¨srcä¸‹</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> src</span><br><span class="line">cargo new <span class="literal">--lib</span> json_to_enum_macro</span><br><span class="line"><span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ›å»ºä¸€ä¸ªjsonæ–‡ä»¶ç”¨äºæµ‹è¯•ï¼Œå†…å®¹æ¯”å¦‚ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;app_name_not_set&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åº”ç”¨åç§°æœªè®¾ç½®&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;app_name_too_long&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åº”ç”¨åç§°è¿‡é•¿&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;app_name_invalid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åº”ç”¨åç§°æ— æ•ˆ&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;app_name_already_exists&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åº”ç”¨åç§°å·²å­˜åœ¨&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨çš„æ–‡ä»¶ç»“æ„åº”è¯¥æ˜¯ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€src</span><br><span class="line">â”‚  â”œâ”€main.rs</span><br><span class="line">â”‚  â””â”€json_to_enum_macro</span><br><span class="line">â”‚      â””â”€src</span><br><span class="line">â”‚   â””â”€lib.rs</span><br><span class="line">â””â”€test.json</span><br></pre></td></tr></table></figure><p>emmï¼Œå…ˆå±•ç¤ºä¸€ä¸‹è°ƒç”¨çš„æ•ˆæœå§</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> json_to_enum_macro::json_to_enum;</span><br><span class="line"></span><br><span class="line">json_to_enum! &#123;</span><br><span class="line">    <span class="meta">#[from_json(<span class="string">&quot;test.json&quot;</span>)]</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">Test</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">4</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">t</span> = <span class="keyword">unsafe</span> &#123; std::mem::transmute::&lt;<span class="type">u8</span>, Test&gt;(i) &#125;;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125; &#123;&#125;&quot;</span>, t, t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// output</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">AppNameAlreadyExists &quot;åº”ç”¨åç§°å·²å­˜åœ¨&quot;</span></span><br><span class="line"><span class="comment">AppNameInvalid &quot;åº”ç”¨åç§°æ— æ•ˆ&quot;</span></span><br><span class="line"><span class="comment">AppNameNotSet &quot;åº”ç”¨åç§°æœªè®¾ç½®&quot;</span></span><br><span class="line"><span class="comment">AppNameTooLong &quot;åº”ç”¨åç§°è¿‡é•¿&quot;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p><code>json_to_enum</code>å®é‡Œé¢çš„åŒ¹é…è§„åˆ™æ˜¯ä¸€çœ‹åˆ°è¿™ä¸ªéœ€æ±‚æ—¶çš„æƒ³æ³•ï¼Œæ‰€ä»¥åˆ«é—®æˆ‘ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™ï¼ˆï¼‰</p><p>é‡Œé¢å¡ä¸€ä¸ªç©ºçš„enumä¹Ÿæ˜¯æ–¹ä¾¿æŒ‡å®šè¿™ä¸ªè§£æå‡ºçš„enumçš„åå­—è€Œå·²ï¼Œæœ€ç»ˆçš„æ•ˆæœæ˜¯ä¼šæ›¿æ¢æ‰enumçš„å†…å®¹ï¼Œæ‰€ä»¥é‡Œé¢å†™ä»€ä¹ˆå†…å®¹éƒ½æ²¡æœ‰ç”¨</p><p>å¥½äº†ï¼Œç°åœ¨å¼€å§‹æ­£å¼ç¼–å†™ï¼</p><h2 id="å¼€å§‹ç¼–å†™ä½ çš„proc-macro"><a href="#å¼€å§‹ç¼–å†™ä½ çš„proc-macro" class="headerlink" title="å¼€å§‹ç¼–å†™ä½ çš„proc-macro"></a>å¼€å§‹ç¼–å†™ä½ çš„proc-macro</h2><p>å…ˆåœ¨json_to_enum_macroçš„<code>cargo.toml</code>é‡Œé¢è®¾ç½® <code>lib.proc-macro = true</code></p><p>ç„¶åå¯¼å…¥proc-macroçš„ä¾èµ– quoteï¼Œsynï¼Œä»¥åŠç”¨äºè§£æjsonæ–‡ä»¶çš„serde_jsonåº“</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo add quote syn serde_json</span><br></pre></td></tr></table></figure><p>ç°åœ¨æ–‡ä»¶åº”è¯¥æ˜¯è¿™æ ·</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[package]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;json_to_enum_macro&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">edition</span> = <span class="string">&quot;2021&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[lib]</span></span><br><span class="line"><span class="attr">proc-macro</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">quote</span> = <span class="string">&quot;1.0.36&quot;</span></span><br><span class="line"><span class="attr">serde_json</span> = <span class="string">&quot;1.0.116&quot;</span></span><br><span class="line"><span class="attr">syn</span> = <span class="string">&quot;2.0.59&quot;</span></span><br></pre></td></tr></table></figure><p>æŠŠè¿™ä¸ªåº“æ·»åŠ åˆ°json_to_enumçš„ä¾èµ–</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[workspace]</span></span><br><span class="line"><span class="attr">members</span> = [</span><br><span class="line">    <span class="string">&quot;src/json_to_enum_macro&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="section">[package]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;json_to_enum&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">edition</span> = <span class="string">&quot;2021&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies.json_to_enum_macro]</span></span><br><span class="line"><span class="attr">path</span> = <span class="string">&quot;src/json_to_enum_macro&quot;</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥rust-analyserå°±ä¼šä¸€èµ·è§£æä½ çš„macroåº“äº†</p><p>æ‰“å¼€<code>lib.rs</code>æ–‡ä»¶å¯¼å…¥ä¾èµ–</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> proc_macro;</span><br><span class="line"><span class="keyword">use</span> proc_macro::&#123;Span, TokenStream&#125;;</span><br><span class="line"><span class="keyword">use</span> quote::quote;</span><br><span class="line"><span class="keyword">use</span> syn::&#123;parse_macro_input, DeriveInput, Ident, Lit&#125;;</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æ¥è¯´åŸºæœ¬éƒ½ä¼šç”¨ä¸Šè¿™å‡ ä¸ªï¼š<code>proc_macro::TokenStream, quote::quote, syn::&#123;parse_macro_input, DeriveInput&#125;</code></p><p>proc macroä¹Ÿæœ‰å¥½å‡ ç§ï¼Œæ¯”å¦‚ <code>proc_macro_derive</code> å¯ä»¥ç»™enumï¼Œstructå•¥çš„å®ç°æŸä¸ªç‰¹å¾ï¼Œ ä½¿ç”¨æ–¹æ³•æ¯”å¦‚ï¼š <code>#[derive(Debug)] struct DebugStruct;</code>ï¼Œ æ¯”å¦‚ <code>proc_macro_attribute</code> å¯ä»¥æ‰©å±•å‡½æ•°ï¼Œenumå­—æ®µç­‰çš„åŠŸèƒ½ã€‚</p><p>è€Œè¿™é‡Œç”±äºæˆ‘ä»¬è¿enuméƒ½è¦æ´¾ç”Ÿï¼Œä¸Šé¢è¯´çš„ä¸¤è€…éƒ½è¦ä¾æ‰˜äºæŸä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œä¹Ÿå°±é‡‡ç”¨<code>proc_macro</code></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[proc_macro]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">json_to_enum</span>(input: TokenStream) <span class="punctuation">-&gt;</span> TokenStream &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">input</span> = parse_macro_input!(input <span class="keyword">as</span> DeriveInput);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="variable">gen</span> = quote! &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;;</span><br><span class="line">    gen.<span class="title function_ invoke__">into</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦å…ˆè§£æä¸€ä¸ªattributeï¼Œå¾—åˆ°jsonæ–‡ä»¶çš„è·¯å¾„ï¼Œæ¯”å¦‚è¿™ä¸ªattributeæ˜¯ <code>#[from_json(&quot;test.json&quot;)]</code></p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”±äºå¯ä»¥æœ‰å¾ˆå¤šä¸ªattributeï¼Œæ‰€ä»¥è¿™é‡Œè¿”å›çš„æ˜¯ä¸€ä¸ªVec</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">attribute</span> = &amp;input.attrs;</span><br><span class="line"><span class="comment">// è§£æå‡ºattré‡Œæä¾›çš„jsonæ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">json_name</span> = attribute</span><br><span class="line">.<span class="title function_ invoke__">iter</span>()</span><br><span class="line">.<span class="title function_ invoke__">find_map</span>(|attr| &#123;</span><br><span class="line">        <span class="keyword">if</span> attr.<span class="title function_ invoke__">path</span>().<span class="title function_ invoke__">is_ident</span>(<span class="string">&quot;from_json&quot;</span>) &#123;</span><br><span class="line">            <span class="comment">// å°è¯•æŠŠattrè§£ææˆå­—é¢é‡(literal)</span></span><br><span class="line">            <span class="keyword">let</span> <span class="variable">lit</span> = <span class="keyword">match</span> attr.parse_args::&lt;Lit&gt;() &#123;</span><br><span class="line">                <span class="title function_ invoke__">Ok</span>(lit) =&gt; lit,</span><br><span class="line">                <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="built_in">panic!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, e),</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Lit</span>::<span class="title function_ invoke__">Str</span>(lit) = lit &#123;</span><br><span class="line">                <span class="title function_ invoke__">Some</span>(lit.<span class="title function_ invoke__">value</span>())</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="literal">None</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="literal">None</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line"><span class="comment">// è¯»å–æ–‡ä»¶å†…å®¹</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">json_content</span> = std::fs::<span class="title function_ invoke__">read_to_string</span>(json_name).<span class="title function_ invoke__">expect</span>(<span class="string">&quot;file not found&quot;</span>);</span><br><span class="line"><span class="comment">// è§£ææ–‡ä»¶å†…å®¹</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">json</span>: serde_json::Value = serde_json::<span class="title function_ invoke__">from_str</span>(&amp;json_content).<span class="title function_ invoke__">expect</span>(<span class="string">&quot;json parse error&quot;</span>);</span><br></pre></td></tr></table></figure><p>ç„¶åè·å–ä½ ä¼ å…¥çš„enumçš„åå­—ï¼ˆæ ‡è¯†ç¬¦ï¼‰ï¼Œå’Œjsonçš„keyså°±å¯ä»¥æ´¾ç”Ÿenumäº†</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">name</span> = &amp;input.ident;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">variants</span> = json</span><br><span class="line">    .<span class="title function_ invoke__">as_object</span>()</span><br><span class="line">    .<span class="title function_ invoke__">expect</span>(<span class="string">&quot;json should be object&quot;</span>)</span><br><span class="line">    .<span class="title function_ invoke__">keys</span>()</span><br><span class="line">    .<span class="title function_ invoke__">map</span>(|k| &#123;</span><br><span class="line">        <span class="comment">// jsoné‡Œé¢æ˜¯snakeå‘½åï¼Œè½¬æˆé©¼å³°å¼å‘½å</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">ident</span> = Ident::<span class="title function_ invoke__">new</span>(&amp;<span class="title function_ invoke__">snake_to_camel</span>(k), Span::<span class="title function_ invoke__">call_site</span>().<span class="title function_ invoke__">into</span>());</span><br><span class="line">        quote! &#123;</span><br><span class="line">            #ident,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™å°±å¯ä»¥åƒè¿™æ ·æ´¾ç”Ÿä¸€ä¸ªenum</p><p>æ˜¯ä¸æ˜¯æ„Ÿè§‰å’Œå†™<code>macro_rules!</code>å¾ˆåƒå‘¢</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">quote! &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">enum</span> #name &#123;</span><br><span class="line">        *(#variants)*</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åè¿˜è¦å®ç°ä¸€ä¸‹Displayï¼Œéœ€æ±‚è¯´çš„æ˜¯è¦jsonå­—æ®µå¯¹åº”çš„å€¼ï¼ˆä¹Ÿå°±æ˜¯é‚£äº›ä¸­æ–‡ï¼‰ï¼Œè¿™ä¹Ÿæ˜¾ç„¶åªè¦è·å–jsonçš„valueså³å¯</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">msgs</span> = json.<span class="title function_ invoke__">as_object</span>().<span class="title function_ invoke__">unwrap</span>().<span class="title function_ invoke__">values</span>().<span class="title function_ invoke__">map</span>(|v| &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">msg</span> = v.<span class="title function_ invoke__">as_str</span>().<span class="title function_ invoke__">expect</span>(<span class="string">&quot;value should be string&quot;</span>);</span><br><span class="line">        quote! &#123;</span><br><span class="line">            #msg</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><p>åé¢å®ç°Displayï¼Œï¼ˆæˆ‘ä¹Ÿé¡ºä¾¿å®ç°äº†Debugï¼‰ä¹Ÿå°±è·Ÿä¸Šé¢ä¸€æ ·</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">std</span>::fmt::Display <span class="keyword">for</span> #name &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> std::fmt::Formatter) <span class="punctuation">-&gt;</span> std::fmt::<span class="type">Result</span> &#123;</span><br><span class="line">        <span class="keyword">match</span> <span class="keyword">self</span> &#123;</span><br><span class="line">            #(</span><br><span class="line">                #name::#keys =&gt; <span class="built_in">write!</span>(f, <span class="string">&quot;&#123;&#125;&quot;</span>, <span class="built_in">stringify!</span>(#msgs)),</span><br><span class="line">            )*</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œå°±å·²ç»å®Œæˆäº†ï¼Œå¦‚æœä½ ä¸çŸ¥é“åé¢è¿™éƒ¨åˆ†æ€ä¹ˆå¼„å°±å¥½å¥½ç†è§£ä¸€ä¸‹å‰é¢çš„ä»£ç ï¼Œæˆ‘æ•…æ„æ²¡æœ‰å…¨éƒ½å†™å‡ºæ¥ï¼ˆï¼‰</p><p>å®ç°å®Œåè®°å¾—æµ‹è¯•ä¸€ä¸‹</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> json_to_enum_macro::json_to_enum;</span><br><span class="line"></span><br><span class="line">json_to_enum! &#123;</span><br><span class="line">    <span class="meta">#[from_json(<span class="string">&quot;test.json&quot;</span>)]</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">Test</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = Test::AppNameNotSet;</span><br><span class="line">    <span class="built_in">assert_eq!</span>(a.<span class="title function_ invoke__">to_string</span>(), <span class="string">&quot;åº”ç”¨åç§°æœªè®¾ç½®&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>èƒ½æ­£å¸¸è·‘å°±åŸºæœ¬æ²¡å•¥é—®é¢˜äº†ï¼Œè¿˜æ‹…å¿ƒå°±å±•å¼€çœ‹çœ‹</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo expand</span><br></pre></td></tr></table></figure><p>å±•å¼€ç»“æœï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#![feature(prelude_import)]</span></span><br><span class="line"><span class="meta">#[prelude_import]</span></span><br><span class="line"><span class="keyword">use</span> std::prelude::rust_2021::*;</span><br><span class="line"><span class="meta">#[macro_use]</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> std;</span><br><span class="line"><span class="keyword">use</span> parser_macro::json_to_enum;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    AppNameAlreadyExists,</span><br><span class="line">    AppNameInvalid,</span><br><span class="line">    AppNameNotSet,</span><br><span class="line">    AppNameTooLong,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">std</span>::fmt::Display <span class="keyword">for</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> std::fmt::Formatter) <span class="punctuation">-&gt;</span> std::fmt::<span class="type">Result</span> &#123;</span><br><span class="line">        <span class="keyword">match</span> <span class="keyword">self</span> &#123;</span><br><span class="line">            Test::AppNameAlreadyExists =&gt; &#123;</span><br><span class="line">                f.<span class="title function_ invoke__">write_fmt</span>(</span><br><span class="line">                    <span class="built_in">format_args!</span>(</span><br><span class="line">                        <span class="string">&quot;&#123;0&#125;&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;\&quot;\u&#123;5e94&#125;\u&#123;7528&#125;\u&#123;540d&#125;\u&#123;79f0&#125;\u&#123;5df2&#125;\u&#123;5b58&#125;\u&#123;5728&#125;\&quot;&quot;</span>,</span><br><span class="line">                    ),</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">            Test::AppNameInvalid =&gt; &#123;</span><br><span class="line">                f.<span class="title function_ invoke__">write_fmt</span>(</span><br><span class="line">                    <span class="built_in">format_args!</span>(</span><br><span class="line">                        <span class="string">&quot;&#123;0&#125;&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;\&quot;\u&#123;5e94&#125;\u&#123;7528&#125;\u&#123;540d&#125;\u&#123;79f0&#125;\u&#123;65e0&#125;\u&#123;6548&#125;\&quot;&quot;</span>,</span><br><span class="line">                    ),</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">            Test::AppNameNotSet =&gt; &#123;</span><br><span class="line">                f.<span class="title function_ invoke__">write_fmt</span>(</span><br><span class="line">                    <span class="built_in">format_args!</span>(</span><br><span class="line">                        <span class="string">&quot;&#123;0&#125;&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;\&quot;\u&#123;5e94&#125;\u&#123;7528&#125;\u&#123;540d&#125;\u&#123;79f0&#125;\u&#123;672a&#125;\u&#123;8bbe&#125;\u&#123;7f6e&#125;\&quot;&quot;</span>,</span><br><span class="line">                    ),</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">            Test::AppNameTooLong =&gt; &#123;</span><br><span class="line">                f.<span class="title function_ invoke__">write_fmt</span>(</span><br><span class="line">                    <span class="built_in">format_args!</span>(</span><br><span class="line">                        <span class="string">&quot;&#123;0&#125;&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;\&quot;\u&#123;5e94&#125;\u&#123;7528&#125;\u&#123;540d&#125;\u&#123;79f0&#125;\u&#123;8fc7&#125;\u&#123;957f&#125;\&quot;&quot;</span>,</span><br><span class="line">                    ),</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">std</span>::fmt::<span class="built_in">Debug</span> <span class="keyword">for</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> std::fmt::Formatter) <span class="punctuation">-&gt;</span> std::fmt::<span class="type">Result</span> &#123;</span><br><span class="line">        <span class="keyword">match</span> <span class="keyword">self</span> &#123;</span><br><span class="line">            Test::AppNameAlreadyExists =&gt; &#123;</span><br><span class="line">                f.<span class="title function_ invoke__">write_fmt</span>(<span class="built_in">format_args!</span>(<span class="string">&quot;&#123;0&#125;&quot;</span>, <span class="string">&quot;AppNameAlreadyExists&quot;</span>))</span><br><span class="line">            &#125;</span><br><span class="line">            Test::AppNameInvalid =&gt; f.<span class="title function_ invoke__">write_fmt</span>(<span class="built_in">format_args!</span>(<span class="string">&quot;&#123;0&#125;&quot;</span>, <span class="string">&quot;AppNameInvalid&quot;</span>)),</span><br><span class="line">            Test::AppNameNotSet =&gt; f.<span class="title function_ invoke__">write_fmt</span>(<span class="built_in">format_args!</span>(<span class="string">&quot;&#123;0&#125;&quot;</span>, <span class="string">&quot;AppNameNotSet&quot;</span>)),</span><br><span class="line">            Test::AppNameTooLong =&gt; f.<span class="title function_ invoke__">write_fmt</span>(<span class="built_in">format_args!</span>(<span class="string">&quot;&#123;0&#125;&quot;</span>, <span class="string">&quot;AppNameTooLong&quot;</span>)),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = Test::AppNameNotSet;</span><br><span class="line">    <span class="title function_ invoke__">match</span> (&amp;a.<span class="title function_ invoke__">to_string</span>(), &amp;<span class="string">&quot;åº”ç”¨åç§°æœªè®¾ç½®&quot;</span>) &#123;</span><br><span class="line">        (left_val, right_val) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> !(*left_val == *right_val) &#123;</span><br><span class="line">                <span class="keyword">let</span> <span class="variable">kind</span> = ::core::panicking::AssertKind::<span class="built_in">Eq</span>;</span><br><span class="line">                ::core::panicking::<span class="title function_ invoke__">assert_failed</span>(</span><br><span class="line">                    kind,</span><br><span class="line">                    &amp;*left_val,</span><br><span class="line">                    &amp;*right_val,</span><br><span class="line">                    ::core::option::<span class="type">Option</span>::<span class="literal">None</span>,</span><br><span class="line">                );</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://blog.hacbit.net/categories/%E5%BC%80%E5%8F%91/">å¼€å‘</category>
      
      
      <category domain="https://blog.hacbit.net/tags/Rust/">Rust</category>
      
      
      <comments>https://blog.hacbit.net/rust%E5%AE%8F%E9%AD%94%E6%B3%95-1/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>idapythonå…¥é—¨</title>
      <link>https://blog.hacbit.net/idapython%E5%85%A5%E9%97%A8/</link>
      <guid>https://blog.hacbit.net/idapython%E5%85%A5%E9%97%A8/</guid>
      <pubDate>Fri, 23 Feb 2024 13:15:03 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;IDA-Pythonå…¥é—¨ï¼ˆtodoï¼‰&quot;&gt;&lt;a href=&quot;#IDA-Pythonå…¥é—¨ï¼ˆtodoï¼‰&quot; class=&quot;headerlink&quot; title=&quot;IDA Pythonå…¥é—¨ï¼ˆtodoï¼‰&quot;&gt;&lt;/a&gt;IDA Pythonå…¥é—¨ï¼ˆtodoï¼‰&lt;/h1&gt;&lt;p&gt;ida pro7.7å·²ç»åŸºæœ¬æ™®åŠäº†ï¼Œæ‰€ä»¥æœ¬ç¯‡æ–‡ç« æ˜¯åŸºäºida pro77å’Œpython3ç¯å¢ƒç¼–å†™ã€‚&lt;/p&gt;
&lt;p&gt;ä¸å¯å¦è®¤çš„æ˜¯ida proåœ¨é™æ€åˆ†æä¸Šæä¸ºå¼ºå¤§ï¼Œä¸è¿‡åŠ¨è°ƒæ–¹é¢è¿˜æ˜¯æ¯”èµ·å…¶ä»–å·¥å…·ç¨æ˜¾ä¸è¶³ï¼Œè€Œidapythonæä¾›äº†å¤§é‡çš„idaçš„apiï¼Œèƒ½ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£åŠ¨è°ƒçš„ç¼ºé™·ï¼Œè¿™é‡Œå°±ç»™å¤§å®¶ç®€å•ä»‹ç»ä¸€ä¸‹ï¼ˆ&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;PSï¼šå‚è€ƒäº†Qç¥çš„ &lt;a href=&quot;http://www.qfrost.com/posts/ctf/idapython&quot;&gt;http://www.qfrost.com/posts/ctf/idapython&lt;/a&gt; ï¼Œå¹¶ä¸”ä¿®æ­£ä¸ºäº†æ–°ç‰ˆida pythonçš„api&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="IDA-Pythonå…¥é—¨ï¼ˆtodoï¼‰"><a href="#IDA-Pythonå…¥é—¨ï¼ˆtodoï¼‰" class="headerlink" title="IDA Pythonå…¥é—¨ï¼ˆtodoï¼‰"></a>IDA Pythonå…¥é—¨ï¼ˆtodoï¼‰</h1><p>ida pro7.7å·²ç»åŸºæœ¬æ™®åŠäº†ï¼Œæ‰€ä»¥æœ¬ç¯‡æ–‡ç« æ˜¯åŸºäºida pro77å’Œpython3ç¯å¢ƒç¼–å†™ã€‚</p><p>ä¸å¯å¦è®¤çš„æ˜¯ida proåœ¨é™æ€åˆ†æä¸Šæä¸ºå¼ºå¤§ï¼Œä¸è¿‡åŠ¨è°ƒæ–¹é¢è¿˜æ˜¯æ¯”èµ·å…¶ä»–å·¥å…·ç¨æ˜¾ä¸è¶³ï¼Œè€Œidapythonæä¾›äº†å¤§é‡çš„idaçš„apiï¼Œèƒ½ä¸€å®šç¨‹åº¦ä¸Šç¼“è§£åŠ¨è°ƒçš„ç¼ºé™·ï¼Œè¿™é‡Œå°±ç»™å¤§å®¶ç®€å•ä»‹ç»ä¸€ä¸‹ï¼ˆ</p><p><em><strong>PSï¼šå‚è€ƒäº†Qç¥çš„ <a href="http://www.qfrost.com/posts/ctf/idapython">http://www.qfrost.com/posts/ctf/idapython</a> ï¼Œå¹¶ä¸”ä¿®æ­£ä¸ºäº†æ–°ç‰ˆida pythonçš„api</strong></em></p><span id="more"></span><p><img src="/idapython%E5%85%A5%E9%97%A8/image-20240223213616667.png" alt="image-20240223213616667"></p><p><img src="/idapython%E5%85%A5%E9%97%A8/image-20240223221902702.png" alt="image-20240223221902702"></p><p><strong>æŒ‡ä»¤ç›¸å…³ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> idaapi <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ida_dbg <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ida_bytes <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># è¿”å›ç›®æ ‡åœ°å€æŒ‡å‘çš„æŒ‡ä»¤çš„å‰ä¸€æ¡æŒ‡ä»¤çš„åœ°å€</span></span><br><span class="line"><span class="comment"># å‚æ•°ä¸€æ˜¯æŸ¥æ‰¾çš„å¼€å§‹åœ°å€ï¼Œå‚æ•°äºŒæ˜¯å¾€å‰æŸ¥æ‰¾çš„æœ€å°åœ°å€ï¼ˆåœ¨èŒƒå›´å†…ï¼‰</span></span><br><span class="line">prev_1 = prev_head(<span class="number">0x00007FF6A1AA2577</span>, <span class="number">1</span>)</span><br><span class="line">prev_2 = prev_head(<span class="number">0x00007FF6A1AA257a</span>, <span class="number">0x00007FF6A1AA2578</span>)<span class="comment"># fail</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(prev_1), <span class="built_in">hex</span>(prev_2))</span><br><span class="line">&gt;&gt; <span class="number">0x7ff6a1aa2573</span> <span class="number">0xffffffffffffffff</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿”å›ç›®æ ‡åœ°å€æŒ‡å‘çš„æŒ‡ä»¤çš„åä¸€æ¡æŒ‡ä»¤çš„åœ°å€</span></span><br><span class="line"><span class="comment"># å‚æ•°ä¸€æ˜¯æŸ¥æ‰¾å¼€å§‹åœ°å€ï¼Œå‚æ•°äºŒæ˜¯å¾€åæŸ¥æ‰¾çš„æœ€å¤§åœ°å€ï¼ˆä¸åœ¨èŒƒå›´å†…ï¼‰</span></span><br><span class="line">next_1 = next_head(<span class="number">0x00007FF6A1AA257a</span>, <span class="number">1</span>)<span class="comment"># fail</span></span><br><span class="line">next_2 = next_head(<span class="number">0x00007FF6A1AA257a</span>, <span class="number">0x00007FF6A1AA2580</span>)</span><br><span class="line">&gt;&gt; <span class="number">0xffffffffffffffff</span> <span class="number">0x7ff6a1aa257b</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç›®æ ‡åœ°å€çš„åæ±‡ç¼–è¯­å¥ï¼ˆå°±æ˜¯æœ‰ä¸€ç‚¹ç‚¹ä¹±ç xï¼‰</span></span><br><span class="line">a = generate_disasm_line(<span class="number">0x00007FF6A1AA2585</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line">&gt;&gt; <span class="string">b&#x27;\x01\x05movzx\x02\x05   \x01)\x01!eax\x02!\x02)\x01\t,\x02\t \x01*\x01 byte ptr\x02  \x01\t[\x02\t\x01!r10\x02!\x01\t]\x02\t\x02*&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ç›®æ ‡åœ°å€æŒ‡ä»¤</span></span><br><span class="line">a = print_insn_mnem(<span class="number">0x00007FF6A1AA2585</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line">&gt;&gt; movzx</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ç›®æ ‡åœ°å€çš„æŸä¸ªæ“ä½œæ•°ï¼ˆæŒ‰ç´¢å¼•å–ï¼‰</span></span><br><span class="line">a = print_operand(<span class="number">0x00007FF6A1AA2585</span>, <span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line">&gt;&gt; <span class="string">b&#x27;\x01)\x01!eax\x02!\x02)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ç›®æ ‡åœ°å€æŸä¸ªæ“ä½œæ•°çš„å€¼ï¼ˆæŒ‰ç´¢å¼•å–ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(get_operand_value(<span class="number">0x00007FF6A1AA2577</span>, <span class="number">1</span>)))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(get_operand_value(<span class="number">0x00007FF6A1AA2577</span>, <span class="number">1</span>)))</span><br><span class="line">&gt;&gt; <span class="number">0x10</span></span><br><span class="line">&gt;&gt; &lt;<span class="keyword">class</span> <span class="string">&#x27;int&#x27;</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ç›®æ ‡åœ°å€å­—ç¬¦ä¸²ï¼Œå‚æ•°äºŒæ˜¯é•¿åº¦ï¼Œå‚æ•°ä¸‰æ˜¯stringçš„ç±»å‹</span></span><br><span class="line">a = get_strlit_contents(<span class="number">0x00007FF6A1AC28A8</span>, <span class="number">4</span>, <span class="number">0</span>)</span><br><span class="line">b = get_strlit_contents(<span class="number">0x00007FF6A1AC28A8</span>, <span class="number">4</span>, <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line">&gt;&gt; <span class="string">b&#x27;Erro&#x27;</span></span><br><span class="line">&gt;&gt; <span class="string">b&#x27;\xe7\x89\x85\xe6\xbd\xb2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ç›®æ ‡åœ°å€æ·»åŠ æ³¨é‡Šï¼Œå‚æ•°ä¸‰ä¸ºTrueåˆ™ä¸ä¼šæ›¿æ¢comment</span></span><br><span class="line">a = set_cmt(<span class="number">0x00007FF6A1AA2577</span>, <span class="string">&quot;this is a comment&quot;</span>, <span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line">&gt;&gt; <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»™ç›®æ ‡åœ°å€çš„å˜é‡æ”¹å</span></span><br><span class="line">a = set_name(<span class="number">0x00007FF6A1AC28A8</span>, <span class="string">&quot;err&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line">&gt;&gt; <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å½“å‰å…‰æ ‡å¤„åœ°å€</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(get_screen_ea()))</span><br><span class="line">&gt;&gt; <span class="number">0x7ff6a1ac28a8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»Ÿè®¡ç›®æ ‡åœ°å€æ‰€åœ¨å‡½æ•°æœ‰å¤šå°‘ä¸ªåŸºæœ¬å—</span></span><br><span class="line"><span class="built_in">print</span>(FlowChart(get_func(<span class="number">0x00007FF6A1AA21B0</span>)).size)</span><br><span class="line">&gt;&gt; <span class="number">149</span></span><br></pre></td></tr></table></figure><p><strong>åŠŸèƒ½+è°ƒè¯•ç›¸å…³ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®æ–­ç‚¹</span></span><br><span class="line">add_bpt(<span class="number">0x00007FF6A1AA2577</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤æ–­ç‚¹</span></span><br><span class="line">del_bpt(<span class="number">0x00007FF6A1AA2577</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æ–­ç‚¹æ˜¯å¦å¼€å¯</span></span><br><span class="line">enable_bpt(<span class="number">0x00007FF6A1AA2577</span>, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®idapythonä¸ºé»˜è®¤è¯­è¨€ï¼Œåœ¨è®¾ç½®æ¡ä»¶æ–­ç‚¹æ—¶ä¸è®¾ç½®ä¼šé»˜è®¤ä½¿ç”¨idc</span></span><br><span class="line">load_and_run_plugin(<span class="string">&quot;idapython&quot;</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">condition</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&gt;&gt;&gt; rip:&quot;</span>, get_reg_val(<span class="string">&quot;rip&quot;</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">add_bpt(<span class="number">0x00007FF6011D2581</span>)</span><br><span class="line"><span class="comment"># è®¾ç½®æ¡ä»¶æ–­ç‚¹ï¼Œæ¯æ¬¡è¿è¡Œåˆ°è¿™ä¸ªæ–­ç‚¹åœä¸‹ä¼šè§¦å‘condition</span></span><br><span class="line">set_bpt_cond(<span class="number">0x00007FF6011D2581</span>, <span class="string">&quot;condition()&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹äº¤å‰å¼•ç”¨ï¼Œè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼ŒåŒ…å«idautils._xrefå¯¹è±¡</span></span><br><span class="line">a = XrefsTo(<span class="number">0x00007FF6011D2577</span>, flags=<span class="number">0</span>)</span><br><span class="line"><span class="keyword">for</span> addr <span class="keyword">in</span> a:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(addr.frm))<span class="comment"># .frm è¿”å›äº¤å‰å¼•ç”¨åœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»/å†™ 1/2/4/8å­—èŠ‚ï¼Œ wideæ˜¯å®½å­—èŠ‚</span></span><br><span class="line">get_byte(addr)</span><br><span class="line">get_word(addr)</span><br><span class="line">get_dword(addr)</span><br><span class="line">get_qword(addr)</span><br><span class="line">get_wide_byte(addr)</span><br><span class="line">get_wide_word(addr)</span><br><span class="line">get_wide_dword(addr)</span><br><span class="line">get_wide_qword(addr)</span><br><span class="line">patch_byte(addr, val)</span><br><span class="line">patch_word(addr, val)</span><br><span class="line">patch_dword(addr, val)</span><br><span class="line">patch_qword(addr, val)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å¯„å­˜å™¨ripçš„å€¼</span></span><br><span class="line">get_reg_val(<span class="string">&quot;rip&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¯„å­˜å™¨raxçš„å€¼ä¸º0x10</span></span><br><span class="line">set_reg_val(<span class="string">&quot;rax&quot;</span>, <span class="number">0x10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å§‹è°ƒè¯•</span></span><br><span class="line">start_process()</span><br><span class="line"><span class="comment"># continue</span></span><br><span class="line">continue_process()</span><br><span class="line"><span class="comment"># è¿è¡Œåˆ°ç›®æ ‡åœ°å€</span></span><br><span class="line">run_to(addr)</span><br><span class="line"><span class="comment"># è·å–å¹¶æ¸…é™¤è°ƒè¯•å™¨äº‹ä»¶ä»£ç ï¼Œæ™®é€šä»£ç è¿”å›0x20ï¼Œæ–­ç‚¹ã€retè¿”å›0x10ï¼Œç¨‹åºç»“æŸè¿”å›è´Ÿæ•°</span></span><br><span class="line"><span class="comment"># å¿…é¡»åœ¨è¿›ç¨‹æ‰§è¡Œçš„ä»£ç åé¢è°ƒç”¨è¯¥å‡½æ•°ï¼Œä»¥ä¾¿æ£€ç´¢è°ƒè¯•å™¨çš„äº‹ä»¶ä»£ç ï¼Œå¦åˆ™å¯èƒ½ä¼šé˜»æ­¢åç»­å°è¯•</span></span><br><span class="line">wait_for_next_event(EVENT_TYPE, flags)</span><br><span class="line"><span class="comment"># å•æ­¥</span></span><br><span class="line">step_over()</span><br><span class="line">wait_for_next_event(WFNE_SUSP, -<span class="number">1</span>) <span class="comment"># æ¯æ¬¡step_overéƒ½è¦è°ƒç”¨ä¸€æ¬¡ï¼Œcontinueè¿™äº›ä¹Ÿæ˜¯</span></span><br><span class="line"><span class="comment"># äº‹ä»¶ WFNE_SUSP å°†ç­‰å¾…å¯¼è‡´è¢«è°ƒè¯•è¿›ç¨‹æŒ‚èµ·çš„äº‹ä»¶ï¼Œæ¯”å¦‚å¼‚å¸¸æˆ–æ–­ç‚¹</span></span><br><span class="line"><span class="comment"># äº‹ä»¶ WFNE_CONT å¯ä»¥æ¢å¤è¢«æŒ‚èµ·çš„è¿›ç¨‹ï¼Œç»§ç»­æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"># example:</span></span><br><span class="line">wait_for_next_event(WFNE_SUSP, -<span class="number">1</span>)</span><br><span class="line">wait_for_next_event(WFNE_ANY | WFNE_CONT, -<span class="number">1</span>)</span><br></pre></td></tr></table></figure><h1 id="å®æˆ˜ï¼šä½¿ç”¨IDApythonç¼–å†™çˆ†ç ´è„šæœ¬"><a href="#å®æˆ˜ï¼šä½¿ç”¨IDApythonç¼–å†™çˆ†ç ´è„šæœ¬" class="headerlink" title="å®æˆ˜ï¼šä½¿ç”¨IDApythonç¼–å†™çˆ†ç ´è„šæœ¬"></a>å®æˆ˜ï¼šä½¿ç”¨IDApythonç¼–å†™çˆ†ç ´è„šæœ¬</h1><p><strong>PSï¼šä½¿ç”¨æˆ‘ç»™SICTF Round3å‡ºçš„Reé¢˜Closemeä½œä¸ºä¾‹å­</strong></p><p>é™„ä»¶ï¼š <a href="../resources/re_asset/closeme_release.zip" target="_block">ç‚¹å‡»ä¸‹è½½é™„ä»¶</a></p><p>è¿™é¢˜è¯´å®è¯é¢„æœŸå°±æ˜¯çˆ†ç ´ï¼ˆx</p><p>å¤§æ¦‚å›é¡¾ä¸€ä¸‹é¢˜ç›®ï¼Œæ¯æ¬¡åˆ›å»ºå‡ ä¸ªçª—å£åéƒ½ä¼šå¼¹å‡ºä¸€ä¸ªmessageboxï¼Œç‚¹å‡»yes&#x2F;noä¼šè¢«å‚¨å­˜ä¸º1&#x2F;0ï¼Œç„¶åé•¿åº¦ä¸º16æ—¶å°±checkä¸€æ¬¡ï¼Œæ‰€ä»¥å…ˆæŠŠCreateWindowsExå’ŒMessageBoxWé‚£é‡Œçš„call xxxç»™nopæ‰ï¼ˆä½ ä¹Ÿä¸æƒ³å¼€å‡ åƒä¸Šä¸‡ä¸ªçª—å£æŠŠcpuå¹²çƒ§äº†å§xï¼‰ï¼Œç„¶åå°±éœ€è¦æ‰‹åŠ¨æ·»åŠ å„ç§å€¼äº†ã€‚</p><p>å› ä¸ºæ¯16æ¬¡å¾ªç¯æ‰èƒ½ä½¿é•¿åº¦è¾¾åˆ°16è¿›è€Œcheckï¼Œå¤ªå½±å“æ•ˆç‡äº†ï¼Œæ‰€ä»¥ç›´æ¥åœ¨åŸæ¥call messageboxé‚£é‡Œpatchæˆjmpåˆ°cmp rax, 10hè¿™é‡Œã€‚</p><p>raxæ˜¯é•¿åº¦ï¼Œç›´æ¥jmpè¿‡æ¥å°±æ²¡æœ‰è°ƒç”¨è·å–é•¿åº¦çš„å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è®¾ç½®0x10</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">breakpoint_addr = <span class="number">0x00007FF6A1AA2577</span></span><br><span class="line">add_bpt(breakpoint_addr)</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">rip = get_reg_val(<span class="string">&quot;RIP&quot;</span>)</span><br><span class="line"><span class="comment">#print(&quot;rip: &quot;, hex(rip))</span></span><br><span class="line"><span class="keyword">if</span> rip == breakpoint_addr:</span><br><span class="line">    set_reg_val(<span class="string">&quot;rax&quot;</span>, <span class="number">0x10</span>)</span><br></pre></td></tr></table></figure><p><img src="/idapython%E5%85%A5%E9%97%A8/image-20240224010303964.png" alt="image-20240224010303964"></p><p>ä½†æ˜¯å†æ‰§è¡Œä¸¤æ­¥å°±ä¼šæŠŠä¸€ä¸ªå±€éƒ¨å˜é‡å–å‡ºæ¥è§£ä¸€å±‚å¼•ç”¨ç»™r10ï¼Œåç»­å°±æ˜¯16ä¸ªæ¯”è¾ƒï¼Œæ‰€ä»¥r10åº”è¯¥æ˜¯ä¸€ä¸ªæŒ‡å‘æˆ‘ä»¬å‚¨å­˜16ä¸ª1æˆ–0çš„åœ°å€ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬è¦ä¼ªé€ 2å±‚ï¼Œä¸€æ˜¯å…ˆæŠŠé‚£ä¸ªå±€éƒ¨å˜é‡çš„å€¼ä¿®æ”¹ä¸ºä¸€ä¸ªå¯å†™åœ°å€ï¼ˆåŒæ—¶ä¹Ÿè¦ä¿è¯è¿è¡Œæ—¶ä¸ä¼šæœ‰å…¶ä»–çš„å†™è€…ï¼‰ï¼Œç„¶åäºŒæ˜¯åœ¨è¿™ä¸ªå¯å†™åœ°å€å†™å…¥æˆ‘ä»¬çˆ†ç ´çš„æ•°æ®ã€‚</p><p>æˆ‘ç›´æ¥æ‰¾äº†.dataæ®µæœ€æœ«å°¾çš„0x10çš„ç©ºé—´</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .data section</span></span><br><span class="line">buf_addr = <span class="number">0x7FF6A1ACDFF0</span></span><br><span class="line">patch_qword(get_reg_val(<span class="string">&quot;rbp&quot;</span>) + <span class="number">0x38</span>, buf_addr) <span class="comment"># å†™å…¥å±€éƒ¨å˜é‡</span></span><br></pre></td></tr></table></figure><p>ç„¶åå†™å…¥è¦çˆ†ç ´çš„æ•°æ®éœ€è¦æ³¨æ„ç«¯åºé—®é¢˜ï¼ˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">send = <span class="comment"># ä½ è¦çˆ†ç ´çš„æ•°æ®ï¼Œ æ¯”å¦‚ 0101010101010101</span></span><br><span class="line">left = <span class="string">&#x27;0&#x27;</span> + <span class="string">&#x27;0&#x27;</span>.join(send[:<span class="number">8</span>][::-<span class="number">1</span>])</span><br><span class="line">left = <span class="built_in">int</span>(left, <span class="number">16</span>)</span><br><span class="line">right = <span class="string">&#x27;0&#x27;</span> + <span class="string">&#x27;0&#x27;</span>.join(send[<span class="number">8</span>:][::-<span class="number">1</span>])</span><br><span class="line">right = <span class="built_in">int</span>(right, <span class="number">16</span>)</span><br><span class="line">patch_qword(buf_addr, left)</span><br><span class="line">patch_qword(buf_addr + <span class="number">8</span>, right)</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯çˆ†ç ´2^16æ¬¡å°±è¡Œäº†ï¼</p><p><strong>å®Œæ•´çˆ†ç ´è„šæœ¬ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> idaapi <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ida_dbg <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ida_bytes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">this_input = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">start = <span class="number">0x00007FF6530D220F</span></span><br><span class="line"><span class="comment">#add_bpt(start)</span></span><br><span class="line">breakpoint_addr = <span class="number">0x00007FF6A1AA2577</span></span><br><span class="line">add_bpt(breakpoint_addr)</span><br><span class="line">win_addr = <span class="number">0x00007FF6A1AA2993</span></span><br><span class="line">add_bpt(win_addr)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Start!&quot;</span>)</span><br><span class="line">start_process()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Waiting for next event...&quot;</span>)</span><br><span class="line">wait_for_next_event(WFNE_SUSP, -<span class="number">1</span>)</span><br><span class="line"><span class="comment"># .data section</span></span><br><span class="line">buf_addr = <span class="number">0x7FF6A1ACDFF0</span></span><br><span class="line">patch_qword(get_reg_val(<span class="string">&quot;rbp&quot;</span>) + <span class="number">0x38</span>, buf_addr)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">if</span> this_input &gt;= <span class="number">0x10000</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Burst Finished.&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    send = <span class="built_in">bin</span>(this_input)[<span class="number">2</span>:].zfill(<span class="number">16</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;send: &quot;</span>, send)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        rip = get_reg_val(<span class="string">&quot;RIP&quot;</span>)</span><br><span class="line">        <span class="comment">#print(&quot;rip: &quot;, hex(rip))</span></span><br><span class="line">        <span class="keyword">if</span> rip == breakpoint_addr:</span><br><span class="line">            set_reg_val(<span class="string">&quot;rax&quot;</span>, <span class="number">0x10</span>)</span><br><span class="line">            <span class="comment">#print(&quot;set rax to 0x10&quot;)</span></span><br><span class="line"></span><br><span class="line">            left = <span class="string">&#x27;0&#x27;</span> + <span class="string">&#x27;0&#x27;</span>.join(send[:<span class="number">8</span>][::-<span class="number">1</span>])</span><br><span class="line">            left = <span class="built_in">int</span>(left, <span class="number">16</span>)</span><br><span class="line">            right = <span class="string">&#x27;0&#x27;</span> + <span class="string">&#x27;0&#x27;</span>.join(send[<span class="number">8</span>:][::-<span class="number">1</span>])</span><br><span class="line">            right = <span class="built_in">int</span>(right, <span class="number">16</span>)</span><br><span class="line">            patch_qword(buf_addr, left)</span><br><span class="line">            patch_qword(buf_addr + <span class="number">8</span>, right)</span><br><span class="line">        <span class="keyword">elif</span> rip == win_addr:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;win&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;flag: SICTF&#123;&quot;</span> + <span class="built_in">bin</span>(this_input - <span class="number">1</span>)[<span class="number">2</span>:].zfill(<span class="number">16</span>) + <span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line">        continue_process()</span><br><span class="line">        wait_for_next_event(WFNE_SUSP, -<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;err: &quot;</span>, e)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    this_input += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;out&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://blog.hacbit.net/categories/CTF/">CTF</category>
      
      
      <category domain="https://blog.hacbit.net/tags/IDA/">IDA</category>
      
      <category domain="https://blog.hacbit.net/tags/Tutorial/">Tutorial</category>
      
      
      <comments>https://blog.hacbit.net/idapython%E5%85%A5%E9%97%A8/#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
